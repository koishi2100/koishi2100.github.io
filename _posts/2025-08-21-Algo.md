---
layout: post
title:  "Algo"
date:   2025-08-21 15:06:39 +0800
categories: algo
introduction: è®°å½•äº†è¿„ä»Šä¸ºæ­¢å­¦ä¹ çš„ç®—æ³•ï¼Œæ–‡ä»¶è¾ƒå¤§ï¼ŒåŠ è½½ç¼“æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
---


[TOC]



å¾…å¡«å‘ï¼š<br>
**æ•°å­¦**ï¼šè«æ¯”ä¹Œæ–¯åæ¼”ã€å¤šé¡¹å¼ä¸ç”Ÿæˆå‡½æ•°ã€å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ã€å¿«é€Ÿæ•°è®ºå˜æ¢ã€è®¡ç®—å‡ ä½•ã€åŸæ ¹ã€Pickå®šç†ã€çº¿æ€§åŸºã€æ¯å‡½æ•°ã€<br>
**åŸºç¡€ç®—æ³•**ï¼šè«é˜Ÿã€å€å¢ã€<br>
**å­—ç¬¦ä¸²**ï¼šexKMPã€ACè‡ªåŠ¨æœºã€åç¼€è‡ªåŠ¨æœºã€å¯æŒä¹…åŒ–Trieã€å›æ–‡æ ‘ã€<br>
**å›¾è®º**ï¼šæ ‘é“¾å‰–åˆ†ã€åŸºç¯æ ‘ã€æ ‘åˆ†æ²»ã€åœ†æ–¹æ ‘ã€<br>
**æ•°æ®ç»“æ„**ï¼šä¸»å¸­æ ‘ã€å¹³è¡¡æ ‘ã€ç¬›å¡å°”æ ‘ã€åŠ¨æ€æ ‘ã€å¯æŒä¹…åŒ–æ•°æ®ç»“æ„ã€<br>
**åŠ¨æ€è§„åˆ’**ï¼šè®¡æ•°DPã€æ’å¤´DPã€æœŸæœ›/æ¦‚ç‡DPã€<br>


# æ•°å­¦



## åŸºç¡€è¿ç®—

### å¿«é€Ÿå†¥/ä¹˜

```cpp
//æ±‚a^bå¯¹på–æ¨¡çš„å€¼
long long qmi(long long a, long long b,long long p) {
	long long ans = 1;
	while (b) {
		if (b&1) {//å¦‚æœæŒ‡æ•°ä¸ºå¥‡æ•°
			ans = ans*a%p;//æ”¶é›†å¥½æŒ‡æ•°ä¸ºå¥‡æ•°æ—¶åˆ†ç¦»å‡ºæ¥çš„ä¸€æ¬¡æ–¹,(ä¸å¯å†™ä¸ºans*=a%p)
		}
		b >>= 1;	//æŒ‡æ•°æŠ˜åŠ
		a = a*a%p;	//åº•æ•°å˜å¹³åˆ†
	}
	return ans%p;
}
```

```cpp
//é¾Ÿé€Ÿä¹˜
//æ±‚a*bå¯¹på–æ¨¡çš„å€¼
long long qmx(long long a, long long b, long long p) {
	long long ans = 0;
	while (b) {
		if (b & 1) ans = (ans + a) % p;
        b >>= 1;
        a = (a + a) % p;		
	}
	return ans;
}

//__int128
long long qmx(long long a, long long b, long long p) {
	return __int128(a) * b % p;
}

//è½¬ä¸ºæµ®ç‚¹è¿ç®—(æ¨¡æ•°pä¸è¶…è¿‡int)
long long qmx(long long a, long long b, long long p) {
	a %= p; b %= p;
    long long r = a * b - p*(long long)(1.0L / p * a * b);
    return r - p * (r >= p) + p * (r < 0);
}
```



æ±‚$n^k$çš„å‰ä¸‰ä½æ•°

$n^k = 10^{k\lg n} = 10^{\lfloor k\lg n\rfloor} \times 10^{k\lg n - \lfloor k\lg n\rfloor}$
å‰åŠéƒ¨åˆ†ä¸ºæ•´æ•°æ¬¡å¹‚ï¼ŒååŠéƒ¨åˆ†ä¸ºå°æ•°æ¬¡å¹‚ã€‚$n^k = å°æ•°æ¬¡å¹‚ \times 10^{æ•´æ•°æ¬¡å¹‚}$ ï¼Œä¾‹å¦‚$2^{20} = 1.048576\times 10^6$
æˆ‘ä»¬åªéœ€è¦å–å°æ•°æ¬¡å¹‚çš„ä¸‰ä½(ä¹˜100å†å–æ•´å³å¯)

```cpp
//https://vjudge.net/problem/LightOJ-1282
int p = pow(10,k*log10(n) - floor(k*log10(n))) * 100;
```





### é«˜ç²¾åº¦

[å¤§æ•´æ•°åœ¨çº¿è®¡ç®—å·¥å…· (gptkong.com)](https://www.gptkong.com/tools/big_integer_calculator)

#### [åŠ ](#jumpAdd)    [å‡](#jumpSub)    [ä¹˜](#jumpMul)    [é™¤](#jumpDiv)     [æ¨¡](#jumpMod)     [å¹‚](#jumpPower)  

//æŒ‰ä½ctrlç‚¹å‡»è·³è½¬

<span id="jumpAdd">**åŠ **</span>

```cpp
//  A+B  
#include<iostream>
#include<vector>
using namespace std;
string a, b;
vector<int> A, B;
vector<int> add(vector<int>&A, vector<int>&B) {
    vector<int>C;
	int t = 0;
	for (int i = 0; i < A.size() || i < B.size(); i++){
		if (i < A.size()) t += A[i];
		if (i < B.size()) t += B[i];
		C.push_back(t % 10);	//æ— è®ºæ˜¯å¦æœ‰è¿›ä½ï¼Œéƒ½å– %10çš„ä½™æ•°
		t /= 10;	//åˆ¤æ–­æ˜¯å¦æœ‰è¿›ä½
	}
	if (t) C.push_back(1);	//å¦‚æœæœ‰æœ€é«˜ä½è¿˜æœ‰è¿›ä½åˆ™åœ¨Cæ•°ç»„æœ€ååŠ å…ƒç´ 1
	return C;
}
int main() {
	cin >> a >> b;	//a = 123456
	for (int i = a.size() - 1; i >= 0; i--) {
		A.push_back(a[i] - '0');	//A = {6,5,4,3,2,1}
	}
	for (int i = b.size() - 1; i >= 0; i--) {
		B.push_back(b[i] - '0');
	}

	A = add(A, B);	//auto è¿›è¡Œç±»å‹è‡ªåŠ¨è½¬æ¢ åœ¨æ­¤ç›¸å½“äºvector<int>;

	for (int i = A.size() - 1; i >= 0; i--) {
		printf("%d", A[i]);
	}
}
```



<span id="jumpSub">**å‡**</span>

```cpp
//  A-B
#include <iostream>
#include <vector>
using namespace std;
string a, b;
vector<int>A, B, C;	//åˆ¤æ–­aä¸bçš„å¤§å°
bool cmp(vector<int>& A, vector<int>& B) {
	if (A.size() != B.size()) return A.size() > B.size();//å…ˆæ¯”è¾ƒä½æ•°
	for (int i = A.size() - 1; i >= 0; i--) {	//ä½æ•°ç›¸åŒåˆ™ä»é«˜ä½ä¾æ¬¡æ¯”ä¸‹æ¥
		if (A[i] != B[i]) return A[i] > B[i];
	}
	return 1;
}

vector<int>sub(vector<int>& A, vector<int>& B) {//A >= B
    vector<int>C;
    int t = 0;
	for (int i = 0;i < A.size();i++){
		t+=A[i];
		if (i < B.size()) t -= B[i];
		C.push_back((t + 10) % 10);	//ä¿è¯ç›¸å‡åå–æ­£æ•°
		if (t < 0) t = -1;	//åˆ¤æ–­æ˜¯å¦è¦å€Ÿä½
		else t = 0;
	}
	while (C.size() > 1 && C.back() == 0)	C.pop_back();//å»é™¤å‰å¯¼0ï¼Œpop_backåˆ é™¤å®¹å™¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ 
	return C;
}

int main() {
	cin >> a >> b;
	for (int i = a.size() - 1; i >= 0; i--) {
		A.push_back(a[i] - '0');
	}
	for (int i = b.size() - 1;i >= 0;i--){
		B.push_back(b[i] - '0');
	}

	if (cmp(A, B)) A = sub(A, B);
	else A = sub(B, A);
	
	for (int i = A.size() - 1; i >= 0; i--) printf("%d", A[i]);
}
```



<span id="jumpMul">**ä¹˜**</span>

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20231118143232446.png" alt="image-20231118143232446" style="zoom: 25%;" />   

```cpp
//A*b   O(N)
vector<int>mul(vector<int>& A, int b) {
	int t = 0;
    vector<int>C;
	for (int i = 0; i < A.size() || t; i++) {	//æ³¨æ„åŠ ä¸Š||t;
		if (i < A.size()) t += A[i] * b;	//å°†bå½“åšä¸€ä¸ªæ•´ä½“åˆ†åˆ«ä¸açš„æ¯ä¸€ä½ç›¸ä¹˜ï¼Œå†åŠ ä¸Šè¿›ä½
		C.push_back(t % 10);	//Cçš„æ¯ä¸€ä½å–å…¶%10
		t /= 10;	//è®¡ç®—è¿›ä½
	}
	return C;
}
```



```cpp
//A*B   O(N*M)
vector<int> mul(vector<int> &A,vector<int> &B)
    vector<int> C(A.size()+B.size());
    for(int i=0;i<A.size();i++)
        for(int j=0;j<B.size();j++)
            C[i+j]+=A[i]*B[j];
    for(int i=0,t=0;i<res.size();i++){
        t+=C[i];
        C[i]=t%10;
        t/=10;
    }
    while(C.size() >= 2 && C.back()==0) C.pop_back();
    return C;
}
```



```cpp
//A*B   FFTå®ç° O((N+M)log(N+M))
//https://www.luogu.com.cn/problem/P1919
const long double PI = acosl(-1.0);
void FFT(std::vector<std::complex<long double>>& a, bool invert) {
    int n = a.size();
    if(n == 0) return;

    for(int i = 1, j = 0; i < n; i++) {
        int bit = n >> 1;
        for (; j & bit; bit >>= 1) j ^= bit;
        j ^= bit;
        if (i < j) std::swap(a[i], a[j]);
    }

    for(int len = 2; len <= n; len <<= 1) {
        long double ang = 2 * PI / len * (invert ? -1 : 1);
        std::complex<long double> wlen(cosl(ang), sinl(ang));
        for (int i = 0; i < n; i += len) {
            std::complex<long double> w(1.0);
            for (int j = 0; j < len / 2; j++) {
                std::complex<long double> u = a[i + j];
                std::complex<long double> v = a[i + j + len / 2] * w;
                a[i + j] = u + v;
                a[i + j + len / 2] = u - v;
                w *= wlen;
            }
        }
    }
    if(invert) {
        for (std::complex<long double>& x : a) x /= n;
    }
}

std::vector<long long> operator * (const std::vector<long long>&A,const std::vector<long long>&B){
	std::vector<long long>C;
    int n = A.size(), m = B.size();
    if((n == 1 && A[0] == 0) || (m == 1 && B[0] == 0)) return {0};

    int MAX_N = 1;
    while (MAX_N < n + m) MAX_N <<= 1;

    std::vector<std::complex<long double>> a(MAX_N, 0.0), b(MAX_N, 0.0);
    for(int i = 0; i < n; i++) a[i] = std::complex<long double>(A[i], 0);
    for(int i = 0; i < m; i++) b[i] = std::complex<long double>(B[i], 0);

    FFT(a, false);
    FFT(b, false);
    for(int i = 0; i < MAX_N; i++) a[i] *= b[i];
    FFT(a, true);

    std::vector<long long> temp(n + m, 0);
    for(int i = 0; i < n + m; i++) {
        long long val = (long long)(a[i].real() + 0.5);
        temp[i] = val;
    }

    long long carry = 0;
    for(int i = 0; i < n + m; i++) {
        long long total = temp[i] + carry;
        C.push_back(total % 10);
        carry = total / 10;
    }
    if(carry) C.push_back(carry);
    while(C.size() >= 2 && C.back() == 0) C.pop_back();
	return C;
}
```





<span id="jumpDiv">**é™¤**</span>

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20231118151225445.png" alt="image-20231118151225445" style="zoom: 33%;" /> 

```cpp
//A/båŠå…¶ä½™æ•° 
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
vector<int>A;//Cä¸ºå•†

vector<int>div(vector<int>&A,int b,int&r){  //ræ˜¯å¼•ç”¨
    vector<int>C;
	for (int i = A.size() - 1;i >= 0;i--){	//é™¤æ³•æ­¤å¤„å€’åºï¼Œç„¶åå†ç¿»è½¬
		r = r * 10 + A[i];	//ä¸Šä¸€ä½çš„ä½™æ•°*10å†åŠ ä¸Šæœ¬ä½
		C.push_back(r / b);	//å°†å…¶å¯¹bçš„å•†è®°å½•è¿›Cæ•°ç»„
		r %= b;	//ç„¶åå˜ä¸ºå…¶å¯¹bçš„ä½™æ•°ä¾›ä¸‹ä¸€ä½ä½¿ç”¨
	}
	reverse(C.begin(), C.end());
	while (C.size() > 1 && C.back() == 0) C.pop_back();
	return C;	
}

int main() {
	string a; int b, r = 0;	//rä¸ºä½™æ•°
	cin >> a >> b;
	for (int i = a.size() - 1; i >= 0; i--) {
		A.push_back(a[i] - '0');
	}

	A = div(A, b, r);

	for (int i = A.size() - 1;i >= 0;i--){
		printf("%d", A[i]);
	}
	cout << endl << r << endl;

	return 0;
}
```



```cpp
//a/b ä¿ç•™kä½å°æ•°
long long a,b,k;cin >> a >> b >> k;
cout << a/b << '.';
a = a%b*10;
while(k--){
    cout << a/b;
    a = a%b*10;
}
```

```cpp
//æ±‚a/bçš„ç¬¬kä½å°æ•°   ç›¸å½“äºa*10^k/b%10
long long a,b,k;cin >> a >> b >> k;
cout << a*qmi(10,k-1,b)*10/b%10;
```





<span id="jumpMod">**æ¨¡**</span>

ç»™ä¸¤ä¸ªæ­£æ•´æ•°a,bï¼Œè¾“å‡ºä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•° a<=1e10^6,b <= 1e9

> é¦–å…ˆæœ‰ä»¥ä¸‹æ€§è´¨
> 1.(a+b)%modç­‰ä»·äºa%mod+b%mod
> 2.a * b%mod ç­‰ä»·äº a%mod*b%mod(ä»…å½“a * bæ²¡æœ‰æº¢å‡ºæ—¶)
> è¯¥é¢˜æ±‚è§£gcd(a,b)aæ˜¯å¤§æ•°
> æ ¹æ®è¾—è½¬ç›¸é™¤æ³•
> gcd(a,b)=gcd(b,a%b)
> å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆæ±‚a%bæŠŠaé™åˆ¶åœ¨1e9çš„èŒƒå›´å†…ï¼Œç„¶ååšgcd
> å› ä¸ºaå¾ˆå¤§ï¼Œåˆå¯ä»¥è¡¨ç¤ºä¸º$\sum_{i=1}^n{a_i*10^{n-i}}$(å…¶ä¸­nä¸ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œaiä¸ºç¬¬iä¸ªå­—ç¬¦)
> åˆç”±æ€§è´¨1å’Œ2ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ¯ä¸ªaiæ±‚mod,åŒæ—¶é€šè¿‡ä¹˜å’Œç´¯åŠ æ±‚å‡º 

```cpp
//A%b
//https://ac.nowcoder.com/acm/contest/86034/D
#include <iostream>
using namespace std;
using ll = long long;

ll gcd(ll a,ll b){return b?gcd(b,a%b):a;}

ll qmod(string& a,ll b){//é«˜ç²¾åº¦A % ä½ç²¾åº¦b
    ll t = 0;
    for(int i = 0;i < a.size();i++)  {
		t=(t*10+a[i]-'0')%b;
	}
    return t;
}

int main(){
	string a;cin >> a;
	ll b;cin >> b;
	cout << gcd(b,qmod(a,b));
}
```





<span id="jumpPower">**å¹‚**</span>

```cpp
//ä¸­ç²¾åº¦ 2^n   2*n <= 30000        //nå¯ä»¥ä¸ºè´Ÿæ•°
//ä»…é€‚ç”¨äºè®¡ç®—2^nçš„ç²¾ç¡®å€¼
#include <iostream>
#include <sstream>
#include <iomanip>
#include <cmath>
using namespace std;

int main(){
    int n; cin>>n;
    stringstream ss;
    ss << fixed << setprecision(n>0?0:-n) << pow(2.0L,n);
    //string s = ss.str();  //å­—ç¬¦ä¸²æµ,ä¹Ÿå¯ä»¥ç”¨sprintf
	string s; ss >> s;

	cout << s;
}
```



```cpp
//é«˜ç²¾åº¦å¿«é€Ÿå¹‚ A^b   ä¸€èˆ¬bå–ä¸äº†å¤ªå¤§
Bigint qmi(Bigint &a,int b){
	Bigint ans = 1;
	while(b){
		if(b&1) ans = ans*a;
		b >>= 1;
		a = a*a;
	}
	return ans;
}
```



#### pythoné«˜ç²¾

```python
import sys
sys.set_int_max_str_digits(100005)	#ä¿®æ”¹æœ€å¤§ä½æ•°
a = int(input())
b = int(input())
print(a+b)	#åŠ 
print(a-b)	#å‡
print(a*b)	#ä¹˜
print(a//b)	#é™¤
print(a%b)	#æ¨¡
print(a**b)	#å¹‚
```



### æ•°å­¦è¿ç®—



#### sqrt



```cpp
//å‘ä¸‹å–æ•´
long long qsqrt(long long n) { 
    long long s = std::sqrt(n);
    while (s*s > n) { s--; }
    while ((s+1)*(s+1) <= n) { s++; }
    return s;
}
```



#### log

```cpp
//å‘ä¸Šå–æ•´
long long logi(long long a, long long b) {//log(a,b)  a^t â‰¥ b
    long long t = 0;
    long long v = 1;
    while (v < b) {
        v *= a;
        t++;
    }
    return t;
}

long long llog(long long a, long long b) {//loglog(a,b)  a^(a^t) â‰¥ b
    if (a <= b) {
        int l = logi(a, b);
        return (l == 0 ? 0 : std::__lg(2 * l - 1));
    }
	assert(b != 1);
    long long l = logi(b, a + 1) - 1;
    assert(l > 0);
    return -std::__lg(l);
}
```



```cpp
//é¢„å¤„ç†log2,  (å‘ä¸‹å–æ•´)
lg2[0] = -1;
for(int i = 1;i < N;i++){
    lg2[i] = lg2[i>>1]+1;
}
```



#### é™¤æ³•å–æ•´

```cpp
long long ceilDiv(long long n, long long m) {//ä¸Šå–æ•´
    if (n >= 0) return (n + m - 1) / m;
    else return n / m;
}
 
long long floorDiv(long long n, long long m) {//å‘ä¸‹å–æ•´
    if (n >= 0) return n / m;
    else return (n - m + 1) / m;
}
```



#### åˆ†å¼è¿ç®—

æºè‡ª[jianglyåˆ†æ•°å››åˆ™è¿ç®— åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/WIDA/p/17633758.html#åˆ†æ•°å››åˆ™è¿ç®—frac)

Frac a(1,3);  è¡¨ç¤º$\frac{1}{3}$  ï¼Œæ”¯æŒåˆ†å¼ä¹‹é—´ `+` `-` `*` `/`  å’Œæ¯”è¾ƒå¤§å°

```cpp
template<class T>
struct Frac {// num/den
    T num;
    T den;
    Frac(T num_, T den_) : num(num_), den(den_) {
        if (den < 0) {
            den = -den;
            num = -num;
        }
    }
    Frac() : Frac(0, 1) {}
    Frac(T num_) : Frac(num_, 1) {}
    explicit operator double() const {
        return 1. * num / den;
    }
    explicit operator long long() const{
		return num / den;
	}
	friend long long floor(const Frac &x){
		if(x.num >= 0) return x.num / x.den;
		else return (x.num - x.den + 1) / x.den;
	}
	friend long long ceil(const Frac &x){
		if(x.num >= 0) return (x.num + x.den - 1) / x.den;
		else return x.num / x.den;
	}
    Frac &operator+=(const Frac &rhs) {
        num = num * rhs.den + rhs.num * den;
        den *= rhs.den;
        return *this;
    }
    Frac &operator-=(const Frac &rhs) {
        num = num * rhs.den - rhs.num * den;
        den *= rhs.den;
        return *this;
    }
    Frac &operator*=(const Frac &rhs) {
        num *= rhs.num;
        den *= rhs.den;
        return *this;
    }
    Frac &operator/=(const Frac &rhs) {
        num *= rhs.den;
        den *= rhs.num;
        if (den < 0) {
            num = -num;
            den = -den;
        }
        return *this;
    }
    friend Frac operator+(Frac lhs, const Frac &rhs) {
        return lhs += rhs;
    }
    friend Frac operator-(Frac lhs, const Frac &rhs) {
        return lhs -= rhs;
    }
    friend Frac operator*(Frac lhs, const Frac &rhs) {
        return lhs *= rhs;
    }
    friend Frac operator/(Frac lhs, const Frac &rhs) {
        return lhs /= rhs;
    }
    friend Frac operator-(const Frac &a) {
        return Frac(-a.num, a.den);
    }
    friend bool operator==(const Frac &lhs, const Frac &rhs) {
        return lhs.num * rhs.den == rhs.num * lhs.den;
    }
    friend bool operator!=(const Frac &lhs, const Frac &rhs) {
        return lhs.num * rhs.den != rhs.num * lhs.den;
    }
    friend bool operator<(const Frac &lhs, const Frac &rhs) {
        return lhs.num * rhs.den < rhs.num * lhs.den;
    }
    friend bool operator>(const Frac &lhs, const Frac &rhs) {
        return lhs.num * rhs.den > rhs.num * lhs.den;
    }
    friend bool operator<=(const Frac &lhs, const Frac &rhs) {
        return lhs.num * rhs.den <= rhs.num * lhs.den;
    }
    friend bool operator>=(const Frac &lhs, const Frac &rhs) {
        return lhs.num * rhs.den >= rhs.num * lhs.den;
    }
    friend std::ostream &operator << (std::ostream &os, Frac x) {
        T g = std::gcd(x.num, x.den);
        if (x.den == g) { return os << x.num / g; } //
        else { return os << x.num / g << "/" << x.den / g; }
    }
};
```







#### BigInt



é«˜ç²¾åº¦æ•´æ•°è¿ç®—ï¼Œ**ä¸æ”¯æŒè´Ÿæ•°è¿ç®—**(~~å¾…å®Œå–„~~)ï¼Œå†™å¾—ä¸€å¨ï¼Œå‹‰å¼ºèƒ½ç”¨åªèƒ½è¯´æ˜¯==

| æ“ä½œ                   | A op b    ï¼ˆé«˜ç²¾åº¦opä½ç²¾åº¦ï¼‰ | A op B    ï¼ˆé«˜ç²¾åº¦opé«˜ç²¾åº¦ï¼‰ |
| ---------------------- | ---------------------------- | ---------------------------- |
| åŠ æ³•                   | `+` ã€`+=`                   |`+` ã€`+=`                               |
| å‡æ³•(ä»…é™å¤§opå°) | `-`ã€ `-=`                   | `-`ã€ `-=`                          |
| ä¹˜æ³•      | `*`ã€ `*=`                   | `*`ã€ `*=`    (O(N*M)æ¨¡æ‹Ÿ)ï¼Œä¸æ¨èï¼Œå»ºè®®æ¢FFT) |
| é™¤æ³•(ä¸‹å–æ•´)              | `/`ã€ `/=`                  |  |
| å–æ¨¡                   | `%` ã€`%=`                   |                              |
| æ¯”è¾ƒå¤§å°               | `>` `<` `==` `!=` `>=` `<=`  | `>` `<` `==` `!=` `>=` `<=`  |

å…è®¸ç›´æ¥A/Bã€A%B ä½†éœ€è¦ä¿è¯Båœ¨æ•´å‹èŒƒå›´å†…ï¼ˆB  <= 9.2e17ï¼‰

> åˆå§‹åŒ–
>
> ```cpp
> Bigint A(123);
> ```
>
> ```cpp
> Bigint A("123");
> ```
>
> ```cpp
> int n = 123;
> Bigint A = n;
> ```
>
> ```cpp
> string s = 123;
> Bigint A = s;
> ```
>
> ```cpp
> cin >> A;
> ```



```cpp
struct Bigint{
	std::vector<long long> a;

	Bigint (){ }

	Bigint(const std::string &s){
		for(int i = s.size()-1;i >= 0;i--){
			if(s[i] >= '0' && s[i] <= '9') a.emplace_back(s[i] - '0');
		}
		while(a.size() >= 2 && a.back() == 0) a.pop_back();
	}

	Bigint(long long x){
		if(x == 0) {a.emplace_back(0); return;}
		if(x < 0) x = ~x + 1;
		while(x) a.emplace_back(x%10),x/=10;
	}

	friend long long Bigint_to_int(const Bigint &B){
		long long b = 0;
		for(int i = B.a.size()-1;i >= 0;i--){
			b = b*10 + B.a[i];
		}
		return b;
	}

	Bigint operator + (const Bigint &B){
		Bigint C;
		std::vector<long long>&c = C.a;
		const std::vector<long long>&b = B.a;
		long long t = 0;
		for(int i = 0;i < a.size() || i < b.size() || t;i++){
			if(i < a.size()) t += a[i];
			if(i < b.size()) t += b[i];
			c.emplace_back(t%10);
			t/=10;
		}
		return C;
	}

	Bigint operator + (long long b){
		return *this + Bigint(b);
	}

	Bigint operator * (long long b){
		long long t = 0;
		Bigint C;
		std::vector<long long>&c = C.a;
		for(int i = 0;i < a.size() || t;i++){
			if(i < a.size()) t += a[i]*b;
			c.emplace_back(t%10);
			t/=10;
		}
		while(c.size() >= 2 && c.back() == 0) c.pop_back();
		return C;
	}

	Bigint operator * (const Bigint &B){
		const auto &A = this->a;
		Bigint C;
		C.a = std::vector<long long>(A.size()+B.a.size());
		for(int i = 0;i < A.size();i++){
			for(int j = 0;j < B.a.size();j++){
				C.a[i+j] += A[i]*B.a[j];
			}
		}
		long long t = 0;
		for(int i = 0;i < C.a.size();i++){
			t += C.a[i];
			C.a[i] = t%10;
			t /= 10;
		}
		while(C.a.size() >= 2 && C.a.back() == 0) C.a.pop_back();
		return C;
	}

	Bigint operator - (const Bigint &B){
		Bigint C;
		std::vector<long long>&c = C.a;
		const std::vector<long long>&b = B.a;
		long long t = 0;
		for(int i = 0;i < a.size();i++){
			t += a[i];
			if(i < b.size()) t -= b[i];
			c.emplace_back((t+10)%10);
			if(t < 0) t = -1;
			else t = 0;
		}
		while(c.size() >= 2 && c.back() == 0) c.pop_back();
		return C;
	}

	Bigint operator - (long long b){
		return *this - Bigint(b);
	}

	Bigint operator / (long long b){
		Bigint C;
		std::vector<long long>&c = C.a;
		long long t = 0;
		for(int i = a.size()-1;i >= 0;i--){
			t = t*10 + a[i];
			c.emplace_back(t/b);
			t %= b;
		}//t as the remainder == A%b
		reverse(c.begin(),c.end());
		while(c.size() >= 2 && c.back() == 0) c.pop_back();
		return C;
	}

	Bigint operator / (const Bigint &B){
		return (*this)/Bigint_to_int(B);
	}

	Bigint operator % (long long b){
		long long t = 0;
		for(int i = a.size()-1;i >= 0;i--){
			t = (t*10 + a[i]) %b;
		}
		return Bigint(t);
	}

	Bigint operator % (const Bigint &B){
		return (*this)%Bigint_to_int(B);
	}

	int cmp (const Bigint &B){
		const std::vector<long long>&b = B.a;
		if(a.size() != b.size()) {
			return a.size() > b.size() ? 1 : -1;
		}
		for(int i = a.size()-1;i >= 0;i--){
			if(a[i] != b[i]){
				return a[i] > b[i] ? 1 : -1;
			}
		}
		return 0;
	};

	void operator += (const auto &b){*this = *this + b;}
	void operator -= (const auto &b){*this = *this - b;}
	void operator *= (const auto &b){*this = *this * b;}
	void operator /= (const auto &b){*this = *this / b;}
	void operator %= (const auto &b){*this = *this % b;}
	bool operator > (const auto &b){return cmp(b) == 1;}
	bool operator < (const auto &b){return cmp(b) == -1;}
	bool operator == (const auto &b){return cmp(b) == 0;}
	bool operator != (const auto &b){return cmp(b) != 0;}
	bool operator >= (const auto &b){return cmp(b) != -1;}
	bool operator <= (const auto &b){return cmp(b) != 1;}

	friend std::ostream &operator << (std::ostream &o,const Bigint &t){
		for(int i = t.a.size()-1;i >= 0;i--){
			o << t.a[i];
		}
		return o;
	}

	friend std::istream &operator >> (std::istream &o,Bigint &t){
		std::string s;o >> s;
		t = s;
		return o;
	}
};
```





## åˆç­‰æ•°è®º



å¸¸è§ç¬¦å·

1.  æ•´é™¤ç¬¦å·ï¼š$x\mid y$ï¼Œè¡¨ç¤º $x$ æ•´é™¤ $y$ï¼Œå³ $x$ æ˜¯ $y$ çš„å› æ•°ã€‚
2.  å–æ¨¡ç¬¦å·ï¼š$x\bmod y$ï¼Œè¡¨ç¤º $x$ é™¤ä»¥ $y$ å¾—åˆ°çš„ä½™æ•°ã€‚
3.  äº’è´¨ç¬¦å·ï¼š$x\perp y$ï¼Œè¡¨ç¤º $x$ï¼Œ$y$ äº’è´¨ã€‚
4.  æœ€å¤§å…¬çº¦æ•°ï¼š$\gcd(x,y)$ï¼Œåœ¨æ— æ··æ·†æ„ä¹‰çš„æ—¶ä¾¯å¯ä»¥å†™ä½œ $(x,y)$ã€‚
5.  æœ€å°å…¬å€æ•°ï¼š$\operatorname{lcm}(x,y)$ï¼Œåœ¨æ— æ··æ·†æ„ä¹‰çš„æ—¶ä¾¯å¯ä»¥å†™ä½œ $[x,y]$ã€‚



### çº¦æ•°

å¹³å‡¡çº¦æ•°ï¼ˆå¹³å‡¡å› æ•°ï¼‰ï¼šå¯¹äºæ•´æ•° $b\ne0$ï¼Œ$\pm1$ã€$\pm b$ æ˜¯ $b$ çš„å¹³å‡¡çº¦æ•°ã€‚å½“ $b=\pm1$ æ—¶ï¼Œ$b$ åªæœ‰ä¸¤ä¸ªå¹³å‡¡çº¦æ•°ã€‚

å¯¹äºæ•´æ•° $b\ne 0$ï¼Œ$b$ çš„å…¶ä»–çº¦æ•°ç§°ä¸ºçœŸçº¦æ•°ï¼ˆçœŸå› æ•°ã€éå¹³å‡¡çº¦æ•°ã€éå¹³å‡¡å› æ•°ï¼‰ã€‚



#### å…¬çº¦æ•°

> æ±‚ä¸€ä¸ªæ•°gçš„æ‰€æœ‰çº¦æ•°ï¼Œæˆ–ä¸¤ä¸ªæ•°x,yçš„æ‰€æœ‰å…¬çº¦æ•°
> f(30) = {1 2 3 5 6 10 15 30}
> f(30,5) =  {1,5}

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
int gcd(int a,int b){return b?gcd(b,a%b):a;}
vector<int>v;
int main(){
    int x,y;cin >> x >> y;
    int g = gcd(x,y);
    
    //é¢„å¤„ç†æ‰€æœ‰å…¬çº¦æ•°ï¼Œè¿™äº›å…¬çº¦æ•°ä¸€å®šæ˜¯æœ€å¤§å…¬çº¦æ•°çš„çº¦æ•°
    for (int i = 1; i <= g/i; ++i) {
        if(g%i == 0) {
            v.push_back(i);
            if(i!=g/i) v.push_back(g/i);
        }   
    }   
    sort(v.begin(),v.end());//æ’åº
    
    for (int i = 0; i < v.size(); ++i) {
        cout << v[i] << ' ';
    }

    return 0;
}
```



#### æœ€å¤§å…¬çº¦æ•°

[AcWing 872. å…­ç§æ–¹æ³•æ±‚æœ€å¤§å…¬çº¦æ•°åŠå…¶æ—¶é—´å¤æ‚åº¦åˆ†æ - AcWing](https://www.acwing.com/solution/content/98177/)

```cpp
//GNUç¼–è¯‘å™¨
__gcd(a,b);	//#include <algorithm> è¿”å›a,bçš„æœ€å¤§å…¬çº¦æ•°
```

```cpp
//äºŒè¿›åˆ¶ä¼˜åŒ–,å¿«ä¸ªä¸¤ä¸‰å€
int gcd(int a,int b){
	int az = __builtin_ctz(a),bz = __builtin_ctz(b);//æœ«å°¾å…ƒç´ 0çš„ä¸ªæ•°,å¯¹äºLLç±»å‹,éœ€è¦ä½¿ç”¨__builtin_ctzll
	int z = std::min(az,bz);
	b >>= bz;
	while(a) {
		a >>= az;
		int dif = b-a;
		az = __builtin_ctz(dif);
		if(a < b) b = a;
		if(dif < 0) a = -dif;
		else a = dif;
	}
	return b << z;
}
```

**[æ¬§å‡ é‡Œå¾—ç®—æ³•][è¾—è½¬ç›¸é™¤æ³•]æ±‚æœ€å¤§å…¬çº¦æ•°**ï¼š

```cpp
//aå’Œbçš„æœ€å¤§å…¬çº¦æ•°æ˜¯a%bå’Œbçš„æœ€å¤§å…¬çº¦æ•°
int gcd(int a, int b) {return b ? gcd(b,a%b) : a;}
```



ç›¸é‚»çš„ä¸¤ä¸ªæ•°gcd(n,n-1) = 1

$GCD(a_1,a_2,a_3,\ldots,a_n) = GCD(s_1,s_2,s_3,\ldots,s_n)$  å…¶ä¸­s[ ]ä¸ºa[ ]çš„å‰ç¼€å’Œæ•°ç»„(æˆ–è€…å·®åˆ†æ•°ç»„)





##### æ‰©å±•æ¬§å‡ é‡Œå¾—

æ±‚è§£å½¢å¦‚ $a*x +b*y = c$ çš„é€šè§£ï¼ˆ**æœ‰è§£çš„å……è¦æ¡ä»¶ï¼š c % gcd(a , b) == 0**ï¼‰

> **è£´èœ€å®šç†**ï¼šå¯¹äºä»»æ„æ•´æ•°a,bï¼Œä¸€å®šå­˜åœ¨ä¸€å¯¹æ•´æ•°x,yï¼Œæ»¡è¶³ï¼š**ax + by = gcd(a,b)**

> è®¾d = gcd(a,b)
>
> è®¾x,yä¸ºå½“å‰å±‚çš„ä¸€ç»„è§£ ,x1,y1ä¸ºä¸‹ä¸€å±‚çš„ä¸€ç»„è§£
>
> å½“å‰å±‚æ–¹ç¨‹ä¸º  $ax+by = d$
>
> ä¸‹ä¸€å±‚æ–¹ç¨‹ä¸º  $bx_1+(a\%b)*y_1  = d$
> $\Longrightarrow bx_1 + (a-(a/b)*b)*y_1 = d$
> $\Longrightarrow ay_1 + b(x_1 - a/b*y_1) = d$
>
> è”ç«‹å½“å‰å±‚ä¸ä¸‹ä¸€å±‚ï¼Œåˆ™å¯å¾—åˆ°å½“å‰å±‚çš„è§£x,yï¼Œä¸ä¸‹ä¸€å±‚æ–¹ç¨‹è§£x1,y1çš„å…³ç³»
> $ax+by = ay_1 + b(x_1 - a/b*y_1)$
>
> ä¸‹å±‚å¾€ä¸Šå›æº¯æ—¶ç”¨ä¸‹ä¸€å±‚çš„è§£x1,y1æ›´æ–°å½“å‰å±‚çš„è§£x,y
> $x = y_1$  ï¼Œ$y = x_1-a/b*y_1$

$ax+by = gcd(a,b)$çš„ç‰¹è§£ã€é€šè§£ã€æœ€å°æ­£æ•´æ•°è§£ï¼Œ$x_0,y_0$ ä¸º $d = exgcd(a,b,x,y)$çš„ä¸€ç»„è§£
**ç‰¹è§£**ï¼š$x = x_0ï¼Œy = y_0$ ï¼Œè¯º$b \ne 0$ï¼Œé‚£ä¹ˆå¿…æœ‰$|x_0| \le b,|y_0| \le a$
**é€šè§£**ï¼š$x = x_0 + \frac{b}{d} * k$ï¼Œ$y = y_0 - \frac{a}{d}*k ï¼Œå…¶ä¸­k\in Z$ï¼Œç”±æ­¤å¯çŸ¥$x,y$çš„å¢å‡æ€§ç›¸å
**xçš„æœ€å°éè´Ÿæ•´æ•°è§£**ï¼š$x=(x_0 \% |\frac{b}{d}|+|\frac{b}{d}|)\%|\frac{b}{d}|$

$ax+by = c$çš„ç‰¹è§£ã€é€šè§£ã€æœ€å°æ­£æ•´æ•°è§£ï¼ˆè¯º`c%gcd(a,b) != 0` åˆ™æ— è§£ï¼‰ä»¤ $x_0,y_0$ ä¸º $d = exgcd(a,b,x,y)$çš„ä¸€ç»„è§£
**ç‰¹è§£**ï¼š$x = x_0 * \frac{c}{d},y = y_0 * \frac{c}{d}$
**é€šè§£**ï¼š$x = x_0*\frac{c}{d} + \frac{b}{d}*k,y = y_0 * \frac{c}{d} - \frac{a}{d}*k,å…¶ä¸­k\in Z$
**xçš„æœ€å°éè´Ÿæ•´æ•°è§£**ï¼š$x = x_0 * \frac{c}{d} \% |\frac{b}{d}| + |\frac{b}{d}|) \% |\frac{b}{d}|$

```cpp
int exgcd(int a,int b,int& x,int& y){//x,yå¼•ç”¨ä¼ é€’
	if(!b){
		x = 1,y = 0;//å½“æœ€ç»ˆb = 0æ—¶ï¼Œx = 1ï¼Œy = 0 æ˜¾ç„¶æ˜¯æ–¹ç¨‹çš„è§£a*1+0*0 = a
		return a;
	}
	int d = exgcd(b,a%b,x,y);
	int x1 = x,y1 = y;
    x = y1;
    y = x1 - a/b*y1;
	return d;
}
```



ç±»ä¼¼çš„ï¼Œå¤šå…ƒçº¿æ€§ä¸¢ç•ªå›¾$a_1x_1+a_2x_2+\dots +a_nx_n = c$æœ‰æ•´æ•°è§£ï¼Œå½“ä¸”ä»…å½“$d = gcd(a_1,a_2\dots a_n)$æ•´é™¤cã€‚






#### æœ€å°å…¬å€æ•°

> **é‡è¦æ¨è®ºï¼šgcd(a,b) * lcm(a,b) = a*b**

```cpp
long long gcd(long long a, long long b) { return b ? gcd(b, a % b) : a; }

long long lcm(long long a, long long b) { return a / gcd(a, b) * b; }
//å…ˆç®—é™¤æ³•é¿å…æ•°æ®è¶Šç•Œ

#define lcm(a, b) a / gcd(a, b) * b
//è®¡ç®—æœ€å°å…¬å€æ•°æ—¶,å¯ä»¥ä½¿ç”¨å¸¦å‚æ•°çš„å®å®šä¹‰,æ¯”ä½¿ç”¨å‡½æ•°ç•¥å¾®å¿«ä¸€äº›(çœå»äº†å‡½æ•°çš„è°ƒç”¨ã€è¿”å›å’Œä¼ å‚)
```





#### åˆ†è§£åªå› æ•°

> æ¯ä¸ªåˆæ•°éƒ½å¯ä»¥å†™æˆå‡ ä¸ªè´¨æ•°ç›¸ä¹˜çš„å½¢å¼ï¼Œå…¶ä¸­æ¯ä¸ªè´¨æ•°éƒ½æ˜¯è¿™ä¸ªåˆæ•°çš„å› æ•°
>
> å¦‚ï¼š$12 = 2^2 * 3^1$

**è¯•é™¤æ³•**

æ—¶é—´å¤æ‚åº¦ $O(\sqrt N)$ 

`fac(12) = {(2,2),(3,1)}`

```cpp
//https://www.acwing.com/problem/content/description/869/
#include <iostream>
using namespace std;

int main() {
	int t; cin >> t;
	while (t--){
		int n; cin >> n;
		for (int i = 2; i <= n / i; i++) {
			if (n % i == 0) {//å¾ªç¯é‡Œçš„iä¸€å®šæ˜¯nçš„ç´ å› å­
				int s = 0;
				while (n%i == 0){
					n /= i;
					s++;
				}
				cout << i << ' ' << s << endl;
			}
		}
		if (n > 1) cout << n << ' ' << 1 << endl;
		cout << endl;
	}
}
```



**çº¦æ•°åˆ†è§£**

`fac(12) = {1,2,3,4,6,12}`

```cpp
//è¯•é™¤æ³•æ±‚çº¦æ•° https://www.acwing.com/problem/content/871/
vector<int>fac;
void dfs(vector<pair<int,int>>&v,int u,int now){
	if(u >= v.size()) return;
	for(int i = u;i < v.size();i++){
		int w = 1;
		for(int j = 0;j < v[i].second;j++){
			w *= v[i].first;
			fac.emplace_back(now*w);
			dfs(v,i+1,now*w);
		}
	}
}

void soviet(){
	int x; cin >> x;
	auto v = factorize(x);
	fac = {1};
	dfs(v,0,1);
	sort(fac.begin(),fac.end());
	cout << fac.size() << '\n';
	for(auto x:fac){
		cout << x << ' ';
	}
	cout << '\n';
}
```



##### ç­›æ³•æ±‚è´¨å› æ•°

$O(N)$ é¢„å¤„ç†ï¼Œ$O(p(x))$ æŸ¥è¯¢ï¼Œ$p(x)$ä¸º$x$çš„å› æ•°ä¸ªæ•°

`primes[]`å­˜1~Nçš„æ‰€æœ‰ç´ æ•°,0_idx
`minp[x]`ä¸ºxçš„æœ€å°è´¨å› å­
`maxp[x]`ä¸ºxçš„æœ€å¤§è´¨å› å­ï¼Œè¯º` maxp[x] == x`åˆ™xä¸ºè´¨æ•°

```cpp
std::vector<int> primes, minp, maxp;
void sieve(int n = 1e6) {
    minp.resize(n + 1);
    maxp.resize(n + 1);
    for (int i = 2; i <= n; i++) {
        if (!minp[i]) {
            minp[i] = maxp[i] = i;
            primes.emplace_back(i);
        }
        for (auto &j : primes) {
            if (j > minp[i] || j > n / i) break;
            minp[i * j] = j;
            maxp[i * j] = maxp[i];
        }
    }
}
std::vector<std::pair<int,int>> factorize(int n) {//pair{è´¨å› æ•°,æ¬¡æ–¹}
	std::vector<std::pair<int,int>>ans;
    while (n > 1) {
        long long now = get_maxprime(x);
        ans.push_back({now,1});
        x /= now;
        while(x % now == 0) {
            ans.back().second++;
            x /= now;
        }
    }
    return ans;
}

int main(){
    sieve(1000000);
    int x; std::cin >> x;
    for(auto [p,k]:factorize(x)){
        std::cout << p << '^' << k << '\n';
    }
}
```



##### Pollard_Rho

æ³¼è¾£çš„è‚‰ï¼ŒæœŸæœ›æ—¶é—´å¤æ‚åº¦ä¸º $O(\sqrt{p}) = O(N^{\frac{1}{4}})$

```cpp
namespace Pollard_Rho{
	long long qmi(long long a,long long b,long long p){
		long long ans = 1;
		while(b){
			if(b&1) ans = __int128(ans) * a % p;
			b>>=1;
			a = __int128(a) * a % p;
		}
		return ans;
	}

	bool isprime(long long x) {//Miller-Rabinç´ æ•°åˆ¤æ–­,æ—¶é—´å¤æ‚log~log^2
		if (x < 2 || x % 6 % 4 != 1) return (x|1) == 3;
		long long s = __builtin_ctzll(x-1), d = x >> s;
		for (long long a : {2, 325, 9375, 28178, 450775, 9780504, 1795265022}) {
			long long p = qmi(a % x, d, x), i = s;
			while (p != 1 && p != x - 1 && a % x && i--) {
				p = __int128(p) * p % x;
			}
			if (p != x - 1 && i != s) return 0;
		}
		return 1;
	}

    long long gcd(long long a,long long b) {return b ? gcd(b,a%b) : a;}
    
	long long max_factor;
	long long Pollard_Rho(long long x) {
		long long s = 0, t = 0;
		long long c = (long long)rand() % (x - 1) + 1;
		long long val = 1;
		for (int goal = 1;; goal <<= 1, s = t, val = 1) {//å€å¢ä¼˜åŒ–
			for (int step = 1; step <= goal; ++step) {
				t = ((__int128)t*t%x + c) % x;
				val = (__int128)val*std::abs(t-s)%x;
				if ((step % 127) == 0) {
					long long d = gcd(val, x);
					if (d > 1) return d;
				}
			}
			long long d = gcd(val, x);
			if (d > 1) return d;
		}
	}

	void fac(long long x) {
		if (x <= max_factor || x < 2) return;
		if (isprime(x)) {
			max_factor = std::max(max_factor, x);
			return;
		}
		long long p = x;
		while (p >= x) p = Pollard_Rho(x);
		while ((x % p) == 0) x /= p;
		fac(x), fac(p);
	}
	long long get_maxprime(long long x){//è¿”å›xçš„æœ€å¤§è´¨å› å­
		max_factor = 0;
		fac(x);
		return max_factor;
	}
	std::vector<std::pair<long long,int>> factorize(long long x){//è¿”å›xçš„è´¨å› å­vec{prime,kæ¬¡æ–¹}
		std::vector<std::pair<long long,int>> ans;
		while(x > 1) {
			long long now = get_maxprime(x);
			if(ans.empty() || now != ans.back().first) ans.push_back({now,1});
			else ans.back().second++;
			x /= now;
		}
		std::reverse(ans.begin(),ans.end());
		return ans;
	}
};
using Pollard_Rho::isprime,Pollard_Rho::get_maxprime,Pollard_Rho::factorize;

int main(){//ä½¿ç”¨æ–¹æ³•ç¤ºä¾‹
    long long x; std::cin >> x;
    std::cout << isprime(x) << '\n';//ç´ æ•°åˆ¤æ–­
    std::cout << get_maxprime(x) << '\n';//æœ€å¤§è´¨å› å­
    for(auto &[p,k]:factorize(x)){//åˆ†è§£è´¨å› æ•°(ä»å°åˆ°å¤§æ’åº)
        std::cout << p << '^' << k << '\n';
    }
}
```



#### çº¦æ•°ä¸ªæ•°

 å¦‚æœN = $p_1^{c_1}*p_2^{c_2}*...*p_k^{c_k}$

> çº¦æ•°ä¸ªæ•° = $(c_1+1)*(c_2+1)*...*(c_k+1) = \prod_{i=1}^{k}(c_i+1)$
> çº¦æ•°ä¹‹å’Œ = $(p_1^0+p_1^1+...p_1^{c_1})*...*(p_k^0+p_k^1+...p_k^{c_k})=\prod_{i=1}^k(\sum_{j=0}^{c_i}p_i^j)$

```cpp
//https://www.acwing.com/problem/content/872/
//ç»™å®š n ä¸ªæ­£æ•´æ•° a[]ï¼Œè¯·ä½ è¾“å‡ºè¿™äº›æ•°çš„ä¹˜ç§¯çš„çº¦æ•°ä¸ªæ•°ï¼Œç­”æ¡ˆå¯¹ 1e9+7 å–æ¨¡ã€‚
#include <iostream>
#include <unordered_map>
using namespace std;
const int mod = 1e9 + 7;
unordered_map<int, int>primes;

int main() {
	int t; cin >> t;
	while (t--){
		int n; cin >> n;
		for (int i = 2; i <= n / i;i++) {
			while (n % i == 0) {
				n /= i;
				primes[i]++;
			}
		}
		if (n > 1) primes[n]++;
	}

	long long ans = 1;
	for (auto& i : primes) {
        int a = i.second;
		ans = ans * (a + 1) % mod;
	}
    cout << ans << endl;
}
```







#### çº¦æ•°ä¹‹å’Œ

å¦‚æœN = $p_1^{c_1}*p_2^{c_2}*...*p_k^{c_k}$

> çº¦æ•°ä¸ªæ•° = $(c_1+1)*(c_2+1)*...*(c_k+1) = \prod_{i=1}^{k}(c_i+1)$
> çº¦æ•°ä¹‹å’Œ = $(p_1^0+p_1^1+...p_1^{c_1})*...*(p_k^0+p_k^1+...p_k^{c_k})=\prod_{i=1}^k(\sum_{j=0}^{c_i}p_i^j)$



**æ±‚a^bçº¦æ•°ä¹‹å’Œ%modï¼Œ0 <= a,b <= 5e7**

å®ç°ä¸€ä¸ªsumå‡½æ•°ï¼Œsum(p, k)è¡¨ç¤º$p^0+p^1+â€¦+p^{kâˆ’1}$

> æ–¹æ³•ä¸€O(k):é€’æ¨æ±‚p^0 + p^1 + ... + p^k
>
> ```cpp
> ll sum0(ll p,ll k){
> 	ll res = 1;
> 	for(int i = 1;i <= k;i++){
> 		res = (res*p+1)%mod;
> 	}
> 	return res;
> }
> ```

> æ–¹æ³•äºŒO(logK):é€’å½’æ±‚
> kä¸ºå¶æ•°æ—¶sum(p,k) => $p^0+p^1+...+p^{\frac{k}{2}-1}+p^{\frac{k}{2}}+p^{\frac{k}{2}+1}+...+p^{k-1}$
> =>$p^0+p^1+...+p^{\frac{k}{2}-1}+p^{\frac{k}{2}}*(p^0+p^1+...+p^{\frac{k}{2}-1})$
> =>$sum(p,\frac{k}{2}$) + $p^{\frac{k}{2}}*sum(p,\frac{k}{2}$)
> =>$(p^{\frac{k}{2}}+1) * sum(p,\frac{k}{2}$)
> å½“kä¸ºå¥‡æ•°æ—¶ï¼Œä¸ºäº†æ›´æ–¹ä¾¿è°ƒç”¨æˆ‘ä»¬å†™çš„å¶æ•°é¡¹æƒ…å†µï¼Œå¯ä»¥å•ç‹¬æ‹¿å‡ºæœ€åä¸€é¡¹ï¼ŒæŠŠå‰©ä¸‹çš„é¡¹è½¬åŒ–ä¸ºæ±‚å¶æ•°é¡¹çš„æƒ…å†µæ¥è€ƒè™‘ï¼Œå†åŠ ä¸Šæœ€åä¸€é¡¹ï¼Œå°±æ˜¯å¥‡æ•°é¡¹çš„æƒ…å†µäº†ï¼Œä¹Ÿå³$sum(p,k-1) + p^{k-1}$
>
> ```cpp
> ll sum1(ll p,ll k){//sum1(p,k+1),è°ƒç”¨æ—¶kè¦åŠ 1
> 	if(k == 1) return 1;//è¾¹ç•Œæ¡ä»¶
> 	if(!(k&1)) return (qmi(p,k/2)+1)*sum1(p,k/2)%mod;//kä¸ºå¶æ•°
> 	return (qmi(p,k-1) + sum1(p,k-1))%mod;//kä¸ºå¥‡æ•°ï¼Œk-1ä¸ºå¶æ•°
> }
> ```

> æ–¹æ³•ä¸‰(OlogK)ï¼šç­‰æ¯”æ±‚å’Œå…¬å¼
> $sum = p^0+p^1+p^2+...+p^k$ 		------â‘ 
> $sum*p = p^1+p^2+p^3...+p^{k+1}$   ------â‘¡
> â‘¡-â‘ åŒ–ç®€å¾—sum = $\frac{p^{k+1}-1}{p-1}$  ï¼Œåˆ©ç”¨å¿«é€Ÿå¹‚æ±‚é€†å…ƒæ±‚è§£
>
> ```cpp
> ll sum2(ll p,ll k){
> 	if((p-1)%mod == 0) return k+1;  //p-1ä¸modä¸äº’è´¨,é€†å…ƒä¸å­˜åœ¨
> 	return (qmi(p,k+1)-1)%mod*qmi(p-1,mod-2)%mod;
> }
> ```

```cpp
//https://www.acwing.com/problem/content/99/
#include <iostream>
#include <map>
using namespace std;
using ll = long long;
const int mod = 9901;

ll qmi(ll a,ll b){
	ll ans = 1;
	while(b){
		if(b&1) ans = ans*a%mod;
		b >>= 1;
		a = a*a%mod;
	}
	return ans%mod;
}

ll sum0(ll p,ll k){//é€’æ¨æ±‚p^0 + p^1 + ... + p^k
	ll res = 1;
	for(int i = 1;i <= k;i++){
		res = (res*p+1)%mod;
	}
	return res;
}

ll sum1(ll p,ll k){//é€’å½’æ±‚p^0 + p^1 + ... +p^(k-1)
	if(k == 1) return 1;//è¾¹ç•Œæ¡ä»¶
	if(!(k&1)) return (qmi(p,k/2)+1)*sum1(p,k/2)%mod;//kä¸ºå¶æ•°
	return (qmi(p,k-1) + sum1(p,k-1))%mod;//kä¸ºå¥‡æ•°ï¼Œk-1ä¸ºå¶æ•°
}

ll sum2(ll p,ll k){//ç­‰æ¯”æ±‚å’Œå…¬å¼[p^(nï¼‹1)ï¼a^0]/(pï¼1)
	if((p-1)%mod == 0) return k+1;  //p-1ä¸modä¸äº’è´¨,é€†å…ƒä¸å­˜åœ¨
	return (qmi(p,k+1)-1)%mod*qmi(p-1,mod-2)%mod;
}

int main(){
	ll a,b;cin >> a >> b;
	if(a == 0) return cout << 0,0;
	map<ll,ll>mp;
	for(int i = 2;i <= a/i;i++){
		while(a%i == 0){
			mp[i]+=b;
			a/=i;
		}
	}
	if(a > 1) mp[a]+=b;

	ll ans1 = 1;
	for(auto &[p,k]:mp){
		ans1 = ans1*sum1(p,k+1)%mod;//ans*=p^(0~k)ï¼Œsumä¸º(0~k-1)ï¼Œæ‰€ä»¥kè¦åŠ 1
		//ans2 = ans2*sum2(p,k)%mod;
	}
	cout << ans1;
	//cout << (ans2%mod+mod)%mod;
}
```



### ç´ æ•°

> [ç´ æ•°çš„åˆ¤æ–­æ–¹æ³•æ€»ç»“](https://blog.csdn.net/zhao2chen3/article/details/82955794)

**è¯•é™¤æ³•**

æ—¶é—´å¤æ‚åº¦$O(\sqrt x)$

```cpp
bool isPrime(int n){
	if (n <= 1 || n == 4) return 0;
	if (n == 2 || n == 3) return 1;
	if (n % 6 != 1 && n % 6 != 5) return 0;
	for (int i = 5; i <= n/i; i += 6) {
		if (n % i == 0 || n % (i + 2) == 0) return 0;
	}
	return 1;
}
```





#### Miller-Rabin

å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªæ•° $x$ æ˜¯ä¸æ˜¯ç´ æ•°ï¼Œæ—¶é—´å¤æ‚åº¦å¤§æ¦‚ä¸º $log(x)\sim log^2(x)$

```cpp
long long qmi(long long a,long long b,long long p){
	long long ans = 1;
	while(b){
		if(b&1) ans = __int128(ans) * a % p;
		b>>=1;
		a = __int128(a) * a % p;
	}
	return ans;
}

bool isprime(long long x) {
    if (x < 2 || x % 6 % 4 != 1) return (x|1) == 3;
    long long s = __builtin_ctzll(x-1), d = x >> s;
    for (long long a : {2, 325, 9375, 28178, 450775, 9780504, 1795265022}) {
        long long p = qmi(a % x, d, x), i = s;
        while (p != 1 && p != x - 1 && a % x && i--) {
			p = __int128(p) * p % x;
        }
        if (p != x - 1 && i != s) return 0;
    }
    return 1;
}
```



#### ç´ æ•°ç­›

$O(N)$ é¢„å¤„ç†ï¼Œ $O(1)$ æŸ¥è¯¢

```cpp
//çº¿æ€§ç­› https://www.luogu.com.cn/problem/P3912
#include <iostream>
using namespace std;
const int N = 1e8 + 5;
bool st[N];//i >= 2ä¸”st[i] == 0 åˆ™iæ˜¯ç´ æ•°
int primes[N],cnt;//primeså­˜è´¨æ•°

void initi(int n){
    //st[0] = st[1] = 1;
    for(int i = 2;i <= n;i++){
        if(!st[i]) primes[++cnt] = i;//å¦‚æœæ²¡è¢«ç­›è¿‡ï¼Œåˆ™iæ˜¯ç´ æ•°
        for(int j = 1;primes[j] <= n/i;j++){
            st[i*primes[j]] = 1;
            if(i%primes[j] == 0) break;
        }
    }
}

int main() {
	int n; cin >> n;
	initi(n);
	cout << cnt;
}
```



æ±‚`[l,r]`ä¹‹é—´çš„æ‰€æœ‰è´¨æ•° $1\le l \le r < 2^{31} \ \ \ \ \ \    r-l <= 1e6$

```cpp
//https://vjudge.net/problem/LightOJ-1197
//ç”¨æ•°ç»„på­˜å‚¨âˆšrä»¥å†…çš„æ‰€æœ‰è´¨æ•°
//å†ç”¨pç­›é€‰å‡ºl~rä¹‹é—´çš„æ‰€æœ‰åˆæ•°ï¼Œå‰©ä¸‹çš„å³ä¸ºè´¨æ•°
#include <iostream>

const int N = 100005;
bool vis[N];
int primes[N],cnt;
void get_primes(int n){
	for(int i = 2;i <= n;i++){
		if(!vis[i]) primes[++cnt] = i;
		for(int j = 1;i*primes[j] <= n;j++){
			vis[i*primes[j]] = 1;
			if(i%primes[j] == 0) break;
		}
	}
}

bool st[N];
void sol(){
	long long l,r; std::cin >> l >> r;
	for(int i = 0;i < r-l+1;i++) st[i] = 0;
    
	for(int i = 1;(long long)primes[i]*primes[i] <= r;i++){
		long long p = primes[i];//p[i]çš„å€æ•°å³ä¸ºåˆæ•°
		for(long long j = std::max(p+p,p*((l+p-1)/p));j <= r;j += p){
			st[j-l] = 1;//j-lä¸ºæ•°jç›¸å¯¹äºlçš„åç§»ä½ç½®
		}
	}
	int ans = 0;
	for(int i = 0;i < r-l+1;i++){
		if(!st[i] && l+i > 1) {//ç‰¹åˆ¤1
			ans++;
		}
	}
	std::cout << ans << '\n';
}

int main(){
	get_primes(N-1);
	int t; std::cin >> t;
	for(int i = 1;i <= t;i++){
		printf("Case %d: ",i);
		sol();
	}
}
```





#### å¨å°”é€Šå®šç†

å¯¹äºç´ æ•°p > 1ï¼Œ$(p-1)!\equiv -1\ (mod\ p)$æ˜¯ p ä¸ºç´ æ•°çš„å……åˆ†å¿…è¦æ¡ä»¶ã€‚

$(p-1)! \equiv p-1(mod\ p) \equiv -1\ (mod\ p)$





### æ¬§æ‹‰å‡½æ•°

Ï•(ğ‘)è¡¨ç¤º1~Nä¸­ä¸Näº’è´¨çš„æ•°çš„ä¸ªæ•°
> è¯ºå°†Nåˆ†è§£è´¨å› æ•°ï¼šN = $p_1^{a_1}p_2^{a_2}p_3^{a_3}...p_k^{a_k}$
> åˆ™æ¬§æ‹‰å‡½æ•°è®¡ç®—å…¬å¼Ï•(ğ‘) = $NÂ·\frac{p_1-1}{p1}Â·\frac{p_2-1}{p2}Â·\frac{p_3-1}{p3}...\frac{p_k-1}{pk}$



```cpp
//æ±‚ä¸€ä¸ªæ•°çš„æ¬§æ‹‰å‡½æ•°   âˆšN
//æ ¹æ®è®¡ç®—å…¬å¼,åœ¨åˆ†è§£è´¨å› æ•°æ—¶é¡ºä¾¿æ±‚æ¬§æ‹‰å‡½æ•°
//https://www.acwing.com/problem/content/875/
#include <iostream>
#include <map>
using namespace std;

int phi(int n){
	int ans = n;
	for(int i = 2;i <= n/i;i++){
		if(n%i == 0){
			ans = ans/i*(i-1);
			while(n % i == 0){ n /= i; }
		}
	}
	if(n >= 2) ans = ans/n*(n-1);
	return ans;
}

int main(){
	int tt;cin >> tt;
	while(tt--){
		int x;cin >> x;
		cout << phi(x) <<endl;
	}
}
```



#### æ¬§æ‹‰ç­›

```cpp
//ç­›é€‰æ³•æ±‚æ¬§æ‹‰å‡½æ•°  O(N)
//åœ¨ç­›è´¨æ•°æ—¶é¡ºä¾¿æ±‚æ¬§æ‹‰å‡½æ•°
//https://www.acwing.com/problem/content/876/
#include <iostream>
using namespace std;
const int N = 1000006;
int n;
bool st[N];
int primes[N],cnt;
int phi[N];

void get_phi(int n){
    phi[1] = 1;
	for(int i = 2;i <= n;i++){
		if(!st[i]) {
			primes[++cnt] = i;
			phi[i] = i-1;//è¯ºiä¸ºè´¨æ•°ï¼Œåˆ™phi[i] = i-1
		}
		for(int j = 1;primes[j] <= n/i;j++){
			st[i*primes[j]] = 1;
			if(i%primes[j] == 0) {
				phi[i*primes[j]] = phi[i]*primes[j];
				break;
			}
			else phi[i*primes[j]] = phi[i]*(primes[j]-1);
		}
	}
}

int main(){
	cin >> n;
	get_phi(n);
}
```



#### æ¬§æ‹‰å®šç†

> è¯ºæ­£æ•´æ•°aä¸näº’è´¨ï¼Œåˆ™$a^{\phi(n)} \equiv 1 (mod\ n)$

**æ¬§æ‹‰å®šç†æ¨è®º**ï¼š

> è¯ºæ­£æ•´æ•°aä¸näº’è´¨ï¼Œå¯¹äºä»»æ„æ­£æ•´æ•°bï¼Œæœ‰$a^b\equiv a^{b\%\phi(n)}(mod\ n)$
> é¢å¯¹ä¹˜æ–¹ç®—å¼å¯¹è´¨æ•°på–æ¨¡ï¼Œå¯ä»¥å…ˆæŠŠï¼Œå¯ä»¥å…ˆæŠŠåº•æ•°å¯¹på–æ¨¡ã€æŒ‡æ•°å¯¹$\phi(p)$å–æ¨¡å†è®¡ç®—ä¹˜æ–¹

> è¯ºæ­£æ•´æ•°aä¸näº’è´¨ï¼Œåˆ™æ»¡è¶³$a^x\equiv 1(mod\ n)$çš„æœ€å°æ­£æ•´æ•°$x_0$æ˜¯$phi(n)$çš„çº¦æ•°ã€‚

> $\sum_{d|n}\phi{(d)} = n$   (nä¸ºæ­£æ•´æ•°)
>
> ```cpp
> for(int i = 1;i <= n;i++){
>    	if(n%i == 0){ ans += phi[i]; }
> }//ans == n
> ```




æ±‚$\sum_{i=1}^n\sum_{j=1}^n\gcd(i,j)$

> åœ¨ç»“è®º$n=\sum_{d|n}\varphi(d)$ä¸­ä»£å…¥n=gcd(a,b)ï¼Œåˆ™æœ‰$\gcd(a,b) = \sum_{d|\gcd(a,b)}\varphi(d) = \sum_d [d|a][d|b]\varphi(d)$
>
> å…¶ä¸­ï¼Œ$[\cdot]$ ç§°ä¸º [Iverson æ‹¬å·](https://mathworld.wolfram.com/IversonBracket.html)ï¼Œåªæœ‰å½“å‘½é¢˜ $P$ ä¸ºçœŸæ—¶ $[P]$ å–å€¼ä¸º $1$ï¼Œå¦åˆ™å– $0$ã€‚å¯¹ä¸Šå¼æ±‚å’Œï¼Œå°±å¯ä»¥å¾—åˆ°
> $$
> \sum_{i=1}^n\gcd(i,n)=\sum_{d}\sum_{i=1}^n[d|i][d|n]\varphi(d)=\sum_d\left\lfloor\frac{n}{d}\right\rfloor[d|n]\varphi(d)=\sum_{d|n}\left\lfloor\frac{n}{d}\right\rfloor\varphi(d).
> $$
> è¿™é‡Œå…³é”®çš„è§‚å¯Ÿæ˜¯ $\sum_{i=1}^n[d|i]=\lfloor\frac{n}{d}\rfloor$ï¼Œå³åœ¨ $1$ å’Œ $n$ ä¹‹é—´èƒ½å¤Ÿè¢« $d$ æ•´é™¤çš„ $i$ çš„ä¸ªæ•°æ˜¯ $\lfloor\frac{n}{d}\rfloor$ã€‚
>
> åˆ©ç”¨è¿™ä¸ªå¼å­ï¼Œå°±å¯ä»¥éå†çº¦æ•°æ±‚å’Œäº†ã€‚éœ€è¦å¤šç»„æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥é¢„å¤„ç†æ¬§æ‹‰å‡½æ•°çš„å‰ç¼€å’Œï¼Œåˆ©ç”¨æ•°è®ºåˆ†å—æŸ¥è¯¢ã€‚

ä»¿ç…§ä¸Šæ–‡çš„æ¨å¯¼ï¼Œå¯ä»¥å¾—å‡º
$$
\sum_{i=1}^n\sum_{j=1}^n\gcd(i,j) = \sum_{d=1}^n\left\lfloor\frac{n}{d}\right\rfloor^2\varphi(d).
$$

```cpp
//https://www.luogu.com.cn/problem/P2398
#include <iostream>
using namespace std;
using ll = long long;
const int N = 100005;
int primes[N],cnt;
int phi[N],sum[N];
bool st[N];

void get_phi(int n){
	phi[1] = 1;
	for(int i = 2;i <= n;i++){
		if(!st[i]){
			primes[++cnt] = i;
			phi[i] = i-1;
		}
		for(int j = 1;i*primes[j] <= n;j++){
			st[i*primes[j]] = 1;
			if(i%primes[j] == 0){
				phi[primes[j]*i] = phi[i]*primes[j];
				break;
			}
			else phi[primes[j]*i] = phi[i]*(primes[j]-1);
		}
	}
}

int main(){
	int n;cin >> n;
	get_phi(n);
	ll ans = 0;
	for(int i = 1;i <= n;i++){
		ans +=(long long)(n/i)*(n/i)*phi[i];
	}
	/*for(int l = 1,r;l <= n;l = r+1){//è¿™éƒ¨åˆ†è®¡ç®—,å¯ä»¥ç”¨æ•´é™¤åˆ†å—è¿›ä¸€æ­¥ä¼˜åŒ–ä¸ºO(sqrt(n))
		int t = n/l;
		r = n/t;
		ans += (long long)t*t * (sum[r] - sum[l-1]);//sumä¸ºphiçš„å‰ç¼€å’Œæ•°ç»„
	}*/
	cout << ans;
}
```





#### æ‹“å±•æ¬§æ‹‰å®šç† (æ¬§æ‹‰é™å¹‚)

$$
a^b \equiv \begin{cases}
  a^{b \bmod \varphi(m)},                &\gcd(a,m) =  1,                   \\
  a^b,                                   &\gcd(a,m)\ne 1, b <   \varphi(m), \\
  a^{(b \bmod \varphi(m)) + \varphi(m)}, &\gcd(a,m)\ne 1, b \ge \varphi(m).
\end{cases} \pmod m
$$



ç¬¬ä¸€ä¸ªè¦æ±‚aå’Œmäº’è´¨ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯**å¹¿ä¹‰æ¬§æ‹‰é™å¹‚**ï¼Œä¸è¦æ±‚aå’Œmäº’è´¨ï¼Œä½†è¦æ±‚bå’Œphi(m)çš„å¤§å°å…³ç³»ã€‚



[P5091 ã€æ¨¡æ¿ã€‘æ‰©å±•æ¬§æ‹‰å®šç† - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P5091)

æ±‚$a^B \% m$ 

```cpp
#include <iostream>
using namespace std;

int phi(int n){
	int ans = n;
	for(int i = 2;i <= n/i;i++){
		if(n%i == 0){
			ans = ans/i*(i-1);
			while(n % i == 0){n /= i;}
		}
	}
	if(n >= 2) ans = ans/n*(n-1);
	return ans;
}

long long qmi(long long a,long long b,long long p){
	long long ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b >>= 1;
		a = a*a%p;
	}
	return ans%p;
}

int mo(string &b,int pm){//é«˜ç²¾åº¦å–æ¨¡ï¼Œé¡ºä¾¿ä¸phi(m)æ¯”è¾ƒå¤§å°
	int ans = 0;
	bool flag = 0;
	for(int i = 0;i < b.size();i++){
		int x = b[i] - '0';
		ans = ans*10+x;
		if(ans >= pm) flag = 1;
		ans %= pm;
	}
	if(flag) return ans+pm;//b >= phi(m)
	return ans;//b < phi(m)
}

int main(){
	int a,m;string b;cin >> a >> m >> b;
	int pm = phi(m);
	int ans = qmi(a,mo(b,pm),m);
	cout << ans;
}
```



[P4139 ä¸Šå¸ä¸é›†åˆçš„æ­£ç¡®ç”¨æ³• - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4139)

ç»™å®š pï¼Œæ±‚$2^{2^{2^{2^{...}}}}\%p$

å³ $a_0 = 1,a_n = 2^{a_{n-1}}$ï¼Œå¯ä»¥è¯æ˜$b_n = a_n\ mod\ p$åœ¨æŸä¸€é¡¹åéƒ½æ˜¯åŒä¸€ä¸ªå€¼ï¼Œæ±‚è¿™ä¸ªå€¼ã€‚

```cpp
#include <iostream>
using namespace std;
const int N = 10000007;
int p;
int phi[N],primes[N],cnt;
bool st[N];

void get_phi(int n){
	phi[1] = 1;
	for(int i = 2;i <= n;i++){
		if(!st[i]) {
			primes[++cnt] = i;
			phi[i] = i-1;
		}
		for(int j = 1;primes[j] <= n/i;j++){
			st[i*primes[j]] = 1;
			if(i%primes[j] == 0){
				phi[i*primes[j]] = phi[i]*primes[j];
				break;
			}
			else phi[i*primes[j]] = phi[i]*(primes[j]-1);
		}
	}
}

long long qmi(long long a,long long b,long long p){
	long long ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b >>= 1;
		a = a*a%p;
	}
	return ans%p;
}

int sol(int p){
	if(p == 1) return 0;
	return qmi(2,sol(phi[p])+phi[p],p);
}

int main(){
	get_phi(N-1);
	int t;cin >> t;
	while(t--){
		cin >> p;
		cout << sol(p) << '\n';
	}
}
```

[P10414 [è“æ¡¥æ¯ 2023 å›½ A\] 2023 æ¬¡æ–¹ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10414)

æ±‚$2^{3^{4^{...^{2023}}}} \% 2023$

```cpp
int sol(int a,int p){
	if(p == 1) return 0;
	return qmi(a,sol(a+1,phi[p])+phi[p],p);
}
cout << sol(2,2023) << '\n';
```



### æ¨¡æ•°

$a \% b$ ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸º $a - \lfloor \frac{a}{b} \rfloor * b$

c++å–æ¨¡è¿ç®—ä¸­ -7%4 =  -3
è€Œæ•°å­¦å–æ¨¡ä¸­ -7 % 4 = 4
é¢˜ç›®å¾€å¾€è¦æ±‚æ•°å­¦å–æ¨¡

```cpp
int f(int x,int mod){//å°†c++å–æ¨¡è½¬ä¸ºæ•°å­¦å–æ¨¡
    return (x % mod + mod) % mod;
}
```



**è¿ç®—æ³•åˆ™**

> æ¨¡è¿ç®—ä¸åŸºæœ¬å››åˆ™è¿ç®—æœ‰äº›ç›¸ä¼¼ï¼Œä½†æ˜¯**[é™¤æ³•ä¾‹å¤–][è¯¦è§ï¼šä¹˜æ³•é€†å…ƒ]**ã€‚å…¶è§„åˆ™å¦‚ä¸‹ï¼š
> (a + b) % p = (a % p + b % p) % p 
> (a - b) % p = (a % p - b % p ) % p 
> (a * b) % p = (a % p * b % p) % p 
> **(a * b * c)%p=(a%p * b%p * c%p) % p**
> (a ^ b) % p = ((a % p) ^ b) % p  



#### åŒä½™å®šç†

> åŒä½™å®šç†ï¼šç»™å®šä¸€ä¸ªæ­£æ•´æ•°mï¼Œå¦‚æœä¸¤ä¸ªæ•´æ•°aå’Œbæ»¡è¶³a-bèƒ½å¤Ÿè¢«mæ•´é™¤ï¼Œé‚£ä¹ˆå°±ç§°æ•´æ•°aä¸bå¯¹æ¨¡måŒä½™ï¼Œ$a-bâ‰¡0(mod\ m)$ï¼Œè®°ä½œ$aâ‰¡b(mod\ m)$ã€‚å¯¹æ¨¡måŒä½™æ˜¯æ•´æ•°çš„ä¸€ä¸ªç­‰ä»·å…³ç³»ã€‚



è‹¥æ•°ç»„a[ ]çš„æ‰€æœ‰å…ƒç´ å¯¹ m å–ä½™ç›¸åŒï¼Œåˆ™ä»»æ„ä¸¤ä¸ªå…ƒç´ çš„å·®éƒ½èƒ½è¢« m æ•´é™¤ã€‚m å¿…é¡»æ˜¯åŒºé—´å†…æ‰€æœ‰å…ƒç´ ä¸¤ä¸¤å·®å€¼çš„æœ€å¤§å…¬çº¦æ•° GCDã€‚å³$m = GCD(a_{l+1}-a_l,a_{l+2}-a_{l+1},...,a_r - a_{r-1})$ã€‚https://codeforces.com/contest/2050/problem/F





##### çº¿æ€§åŒä½™

æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚çº¿æ€§åŒä½™æ–¹ç¨‹$ax\equiv b\ (mod\ m)$ï¼Œå› ä¸ºæœªçŸ¥æ•°$x$çš„æŒ‡æ•°ä¸º1ï¼Œæ‰€ä»¥ç§°ä½œçº¿æ€§åŒä½™æˆ–ä¸€æ¬¡åŒä½™ã€‚

> ç»™å®š$a,b,m$ï¼Œæ±‚å‡º$x$ä½¿å¾—$ax\equiv b\ (mod\ m)$ï¼Œå¦‚æœæ— è§£åˆ™è¾“å‡ºimpossibleã€‚

é—®é¢˜ç­‰ä»·äº$ax-b$æ˜¯$m$çš„å€æ•°ï¼Œå‡è®¾ä¸º$-y$å€ï¼Œåˆ™é—®é¢˜å¯è½¬åŒ–ä¸º$ax+my=b$æ±‚è§£$x$ã€‚

```cpp
//https://www.acwing.com/problem/content/880/
#include <iostream>
using namespace std;

int exgcd(int a,int b,int &x,int &y){
	if(!b){
		x = 1,y = 0;
		return a;
	}
	int d = exgcd(b,a%b,x,y);
	int x1 = x,y1 = y;
    x = y1;
    y = x1 - a/b*y1;
	return d;
}

int f(int a,int b,int m){
	int x,y,d = exgcd(a,m,x,y);
	if(b%d) return -1;//è¯ºä¸èƒ½æ•´é™¤æœ€å¤§å…¬çº¦æ•°åˆ™æ— è§£
    int t = std::abs(m/d);
	return ((long long)x*(b/d) % t + t ) % t;//è¿”å›æœ€å°æ­£æ•´æ•°è§£
}

int main(){
	int q;cin >> q;
	while(q--){
		int a,b,m;cin >> a >> b >> m;
		int x = f(a,b,m);
		if(x == -1) cout << "impossible\n";
		else cout << x << '\n';
	}
}
```





##### é«˜æ¬¡åŒä½™

**BSGS**

> æ±‚è§£$a^x \equiv b (mod\ p)$çš„æœ€å°éè´Ÿæ•´æ•°è§£$x$(æˆ–è¿”å›æ— è§£)ï¼Œå…¶ä¸­**a,päº’è´¨**ï¼Œ$2\le a,b < p < 2^{31}$ã€‚

BSGS(baby-step giant-stepï¼Œå¤§æ­¥å°æ­¥ç®—æ³•)å¸¸ç”¨äºæ±‚è§£**ç¦»æ•£å¯¹æ•°**é—®é¢˜ï¼Œè¯¥ç®—æ³•å¯ä»¥åœ¨$O( \sqrt N)$ çš„æ—¶é—´å†…æ±‚è§£(ç”¨mapåˆ™å¤šä¸€ä¸ªlog)ã€‚

```cpp
//æ¨¡ç‰ˆé¢˜ https://www.luogu.com.cn/problem/P3846
int bsgs(int a,int b,int p){//æ— è§£åˆ™è¿”å›-1,å¦åˆ™è¿”å›æœ€å°éè´Ÿæ•´æ•°è§£
	map<int,int>hs;
	b %= p;
	int t = (int)sqrt(p) + 1;
	for(int j = 0;j < t;j++){
		int val = (long long) b * qmi(a,j,p) % p;
		hs[val] = j;
	}
	a = qmi(a,t,p);
	if(a == 0) return b == 0 ? 1 : -1;
	for(int i = 0;i <= t;i++){
		int val = qmi(a,i,p);
		int j = hs.find(val) == hs.end() ? -1 : hs[val];
		if(j >= 0 && i * t - j >= 0) return i * t - j;
	}
	return -1;
}
```



**æ‰©å±•BSGS**

> æ±‚è§£$a^x \equiv b (mod\ p)$çš„æœ€å°éè´Ÿæ•´æ•°è§£$x$(æˆ–è¿”å›æ— è§£)ï¼Œå…¶ä¸­**a,pä¸ä¸€å®šäº’è´¨**ï¼Œ$1\le a,b,p \le 10^9$æˆ–$a=b=p=0$ã€‚

```cpp
//æ¨¡ç‰ˆé¢˜ https://www.luogu.com.cn/problem/P4195
int exbsgs(int a,int b,int p){
	a%=p; b%=p;
	if(b == 1 || p == 1) return 0;
	int d,ax=1,cnt=0,x,y;
	while((d=exgcd(a,p,x,y))^1){
		if(b%d) return -1;
		b/=d; p/=d; cnt++;
		ax=1ll*ax*(a/d)%p;
		if(ax == b) return cnt;
	}
	exgcd(ax,p,x,y);
	int inv=(x%p+p)%p;
	b=1ll*b*inv%p;

    //ä¸‹é¢ä¸ºbsgs
	map<int,int>hs;
	b %= p;
	int t = (int)sqrt(p) + 1;
	for(int j = 0;j < t;j++){
		int val = (long long) b * qmi(a,j,p) % p;
		hs[val] = j;
	}
	a = qmi(a,t,p);
	if(a == 0) return b == 0 ? 1 : -1;
	for(int i = 0;i <= t;i++){
		int val = qmi(a,i,p);
		int j = hs.find(val) == hs.end() ? -1 : hs[val];
		if(j >= 0 && i * t - j >= 0) return i * t - j + cnt;//è¿™é‡Œ+cnt
	}
	return -1;
}
```





#### ä¹˜æ³•é€†å…ƒ

> è´¹é©¬å°å®šç†ï¼šå¯¹äºä»»ä½•ä¸€ä¸ªæ•´æ•°aï¼Œä»¥åŠç´ æ•°pï¼š
> 1.å¦‚æœaæ˜¯pçš„å€æ•°ï¼Œ$a^p â‰¡ a (mod\ p)$
> **2.å¦‚æœaä¸æ˜¯pçš„å€æ•°ï¼Œ$a^{p-1} â‰¡ 1 (mod\ p)$**

å°†ä¸Šè¿°å…¬å¼2å˜å½¢å¾—åˆ°:
							$a * a^{p-2} â‰¡ 1  (mod\ p)$
							 $a^{p-2} â‰¡ a^{-1} (mod\ p)$
æ‰€ä»¥ï¼š$a^{-1} â‰¡ a^{p-2}  (mod\ p)$	å…¶ä¸­**aå’Œpäº’è´¨**(æœ‰é€†å…ƒçš„å……è¦æ¡ä»¶)
$\frac{a}{b}\%p = a*b^{p-2}\% p = a\%p*b^{p-2}\%p$

```cpp
//å¿«é€Ÿå¹‚æ±‚é€†å…ƒ
//ç»™å®šnç»„a,p,å…¶ä¸­pæ˜¯è´¨æ•°,æ±‚aæ¨¡pçš„ä¹˜æ³•é€†å…ƒ,è‹¥é€†å…ƒä¸å­˜åœ¨åˆ™è¾“å‡ºimpossible
#include <iostream>
using namespace std;
using ll = long long;

ll qmi(ll a,ll b,ll p){
    ll ans = 1;
    while(b){
        if(b&1) ans = ans*a%p;
        b>>=1;
        a = a*a%p;
    }
    return ans%p;
}

ll gcd(ll a,ll b){return b?gcd(b,a%b):a;}

int main(){
    int t;cin >> t;
    while(t--){
        int a,p;cin >> a >> p;
        if(gcd(a,p) != 1) cout << "impossible" << endl;
        //aæœ‰é€†å…ƒçš„å……è¦æ¡ä»¶æ˜¯aä¸päº’è´¨
        else cout << qmi(a,p-2,p) << endl;
    }
}
```



$\frac{1}{a*b} \% mod= qmi(a,mod-2)*qmi(b,mod-2)\%mod$





#### ä¸­å›½å‰©ä½™å®šç†





**æ‰©å±•ä¸­å›½å‰©ä½™å®šç†(EXCRT)ï¼šæ¨¡æ•°ä¸äº’è´¨**

$\begin{cases}
x &\equiv m_1 \pmod {a_1} \\
x &\equiv m_2 \pmod {a_2} \\
  &\vdots \\
x &\equiv m_n \pmod {a_n} \\
\end{cases}$

ç»™å®š a[1~n] å’Œ m[1~n]ï¼Œæ±‚ä¸€ä¸ªæœ€å°çš„éè´Ÿæ•´æ•° ğ‘¥ï¼Œæ»¡è¶³âˆ€ğ‘–âˆˆ[1,ğ‘›],ğ‘¥ â‰¡ ğ‘šğ‘–(ğ‘šğ‘œğ‘‘ ğ‘ğ‘–)ã€‚
è¾“å‡ºæœ€å°éè´Ÿæ•´æ•°è§£ ğ‘¥ï¼Œå¦‚æœ ğ‘¥ ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º âˆ’1ã€‚$a \geqslant 1,0 \leqslant  m < a$ï¼Œaiä¹‹é—´å¯ä»¥ä¸äº’è´¨

> é€‰ç¬¬ä¸€ä¸ªå¼å­å’Œç¬¬äºŒä¸ªå¼å­æœ‰ï¼š
> $xâ‰¡m_1(mod\ a_1)$ï¼Œ$xâ‰¡m_2(mod\ a_2)$
> $\Longrightarrow x = k_1a_1 + m_1$ï¼Œ$x = k_2a_2+m_2$  //å³æ±‚æœ€å°éè´Ÿæ•´æ•°k1
> $\Longrightarrow k_1a_1+m_1 = k_2a_2+m_2$
> $\Longrightarrow k_1a_1-k_2a_2=m_2-m_1$     ----------------â‘ 
>
> ä»¤d = exgcd(a1,-a2)ï¼Œè§£ä¸º$k_1',k_2'$
> å¦‚æœm2-m1ä¸èƒ½æ•´é™¤dåˆ™æ— è§£,è¿”å›-1
> å¦åˆ™ä¸€å¯¹æ•´æ•°è§£ä¸º$k1 = (m2-m1)/d*k_1' ï¼Œ k2 = (m2-m1)/d*k_2'$ 
>
> å¯¹äºâ‘ å¼åˆæœ‰æ€§è´¨$k_1=(k_1+\frac{ka_2}{d})$ï¼Œ$k_2=(k_2+\frac{ka_1}{d})$
> k1æœ€å°éè´Ÿæ•´æ•°è§£ä¸º$k_1 = k_1\%|\frac{a_2}{d}|$  //ä¸ç¡®å®šdçš„æ­£è´Ÿï¼Œå–ç»å¯¹å€¼
>
> $x = (k_1 + \frac{ka_2}{d})a_1 + m_1$
> $\Longrightarrow x=k_1a_1+m_1 + k*\frac{a_1*a_2}{d}$
> $\Longrightarrow x = k_1a_1+m_1+k*lcm(a_1,a_2)$
> ä»¤$m_0 = k_1a_1+m_1$ï¼Œ$a_0 = lcm(a_1a_2)$
> åˆ™$x = ka_0+m_0$       //å†ç”¨æ­¤å¼å­ä¸å…¶å®ƒå¼å­ä¾æ¬¡é€’æ¨ï¼Œx=må³ä¸ºå½“å‰xæœ€å°æ­£æ•´æ•°è§£





[P4777 ã€æ¨¡æ¿ã€‘æ‰©å±•ä¸­å›½å‰©ä½™å®šç†ï¼ˆEXCRTï¼‰](https://www.luogu.com.cn/problem/P4777)

ç»™å®š $n$ ç»„éè´Ÿæ•´æ•° $a_i, b_i$ ï¼Œæ±‚è§£å…³äº $x$ çš„æ–¹ç¨‹ç»„çš„æœ€å°éè´Ÿæ•´æ•°è§£ã€‚

$$\begin{cases}x\equiv b_1\pmod{a_1}\\x\equiv b_2\pmod{a_2}\\\dots\\x\equiv b_n\pmod{a_n}\end{cases}$$

æ—¶é—´å¤æ‚åº¦$O(N)$

```cpp
//https://www.luogu.com.cn/problem/P4777
//æ•°æ®ç•¥å¼ºï¼šq <= 1e5;a[i],b[i] <= 1e12;
#include <iostream>
#include <vector>
using namespace std;
const int N = 100005;

struct node{
	long long a,b;
};

long long exgcd(long long a,long long b,long long& x,long long& y){
	if(!b){
		x = 1,y = 0;
		return a;
	}
	long long d = exgcd(b,a%b,x,y);
	long long x1 = x,y1 = y;
	x = y1,y = x1 - a/b*y1;
	return d;
}

long long excrt(const std::vector<node> &e){//0_idx
	long long ans = e[0].b,M = e[0].a,x = 0,y = 0;
	for(int i = 1;i < e.size();i++){
		long long B = ((e[i].b - ans) % e[i].a + e[i].a) % e[i].a;
		long long d = exgcd(M,e[i].a,x,y);
		if(B%d) {return -1;}//è¯ºBä¸èƒ½æ•´é™¤æœ€å¤§å…¬çº¦æ•°d,åˆ™æ— è§£ã€‚
		x = (__int128)x*(B/d) % e[i].a;//__int128æˆ–é¾Ÿé€Ÿä¹˜é˜²æ­¢çˆ†long long
		ans += M*x;
		M *= e[i].a / d;
		ans = (ans + M) % M;//anså³ä¸ºå‰i(0_idx)ä¸ªæŸ¿å­çš„è§£
	}
	return ans;
}

int main(){
	int n;cin >> n;
	std::vector<node>e(n);
	for(int i = 0;i < n;i++) {
		std::cin >> e[i].a >> e[i].b;//x%a == b
	}
	cout << excrt(e);
}
```





### æ•°è®ºåˆ†å—

å¿«é€Ÿæ±‚è§£å½¢å¦‚$\sum_{i=1}^{n}{f(i)g(\lfloor \frac{n}{i} \rfloor)}$ çš„å’Œå¼ã€‚å½“å¯ä»¥åœ¨$O(1)$å†…è®¡ç®—$f(r) - f(l)$æˆ–å·²ç»é¢„å¤„ç†å‡º$f$çš„å‰ç¼€å’Œæ—¶ï¼Œæ•°è®ºåˆ†å—å°±å¯ä»¥åœ¨$O(\sqrt N)$çš„æ—¶é—´å†…è®¡ç®—ä¸Šè¿°å’Œå¼çš„å€¼ã€‚



[P2261 [CQOI2007\] ä½™æ•°æ±‚å’Œ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P2261)

> ç»™å®šnï¼Œkï¼Œæ±‚$\sum_{i=1}^{n}{k\%i}$ ã€‚

$åŸå¼ = \sum_{i=1}^{n}{(k - i * \lfloor \frac{k}{i} \rfloor)} = n*k - \sum_{i=1}^{n}{(i * \lfloor \frac{k}{i} \rfloor)}$

ä¾‹å¦‚æ ·ä¾‹ n = 10ï¼Œk = 5

| i                                 | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   |
| --------------------------------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| $t = \lfloor \frac{k}{i} \rfloor$ | 5    | 2    | 1    | 1    | 1    | 0    | 0    | 0    | 0    | 0    |

å‘ç°$\lfloor \frac{k}{i} \rfloor$åˆ†åˆ«åœ¨ä¸€å®šçš„åŒºåŸŸå†…ç›¸ç­‰ã€‚
å·¦ç«¯ç‚¹$l$ä»1å¼€å§‹æšä¸¾ï¼Œä»¤$t = \lfloor \frac{k}{l} \rfloor$ï¼Œåˆ™æ•°å€¼$t$æ‰€åœ¨çš„å³ç«¯ç‚¹$r = \lfloor \frac{k}{t} \rfloor$ï¼Œåœ¨åŒºé—´$[l, r]$å†…$t$çš„å€¼ç›¸ç­‰ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ±‚å‡ºè¿™ä¸€æ®µåŒºé—´çš„å–å€¼ï¼Œå†è®©$l = r + 1$ã€‚

```cpp
#include <iostream>
using namespace std;

int main(){
	long long n,k;cin >> n >> k;
	long long ans = n * k;
	for(int l = 1,r;l <= n;l = r + 1){
		long long t = k/l;
		if(t == 0) r = n;
		else r = min(k/t,n);
		ans -= t * (l+r)*(r-l+1)/2;//åŒºé—´[l,r]å€¼å‡ä¸ºt,å¿«é€Ÿè®¡ç®—
	}
	cout << ans;
}
```



### å…¶å®ƒ

**ä¸€äº›æ•°å­¦å¸¸æ•°**

åœ†å‘¨ç‡ï¼š	Ï€ = acos(-1) = 3.14159265358979323846264338327950288419716939937510

è‡ªç„¶å¸¸æ•°:	e = 2.7182818284590452353602874713526624977572470936999595749




**â‘¨çš„å€æ•°**

å¦‚æœä¸€ä¸ªæ•°èƒ½æ•´é™¤9ï¼Œé‚£ä¹ˆå®ƒçš„æ‰€æœ‰ä½æ•°ä¹‹å’Œä¹Ÿèƒ½æ•´é™¤9



**xä¸ªkè¿åœ¨ä¸€èµ·ç»„æˆçš„æ­£æ•´æ•°**

å¯ä»¥è¡¨ç¤ºä¸º $\frac{k(10^x-1)}{9}$ ï¼Œå¦‚x = 6,k = 8ï¼Œf(x,k) = 888888



**ä¸€å †æ­£æ•´æ•°ç›¸ä¹˜åï¼Œæœ«å°¾0çš„ä¸ªæ•°**

`cnt2`ç»Ÿè®¡æ‰€æœ‰ä¹˜æ•°ä¸­è´¨å› æ•°`2`çš„ä¸ªæ•°
`cnt5`ç»Ÿè®¡æ‰€æœ‰ä¹˜æ•°ä¸­è´¨å› æ•°`5`çš„ä¸ªæ•°
åˆ™æœ«å°¾0çš„ä¸ªæ•° =`min(cnt2,cnt5)`






## ç»„åˆæ•°å­¦



### æ’åˆ—ç»„åˆ 

æ’åˆ—ï¼ˆnPrï¼‰ï¼š$A_n^m = \frac{n!}{(n-m)!} = \underbrace{n(n-1)(n-2)...(n-m+1)}_{mä¸ªå› å­}$

ç»„åˆï¼ˆnCrï¼‰ï¼š$C_n^m = \frac{A_n^m}{m!} = \frac{n!}{m!(n-m)!}$

> A[7,3] = 7 * 6 * 5 = 210
> C[7,3] = (7 * 6 * 5)/(3 * 2  * 1) = 6

**æ€§è´¨**

> $C_n^m = C_{n-1}^{m-1} + C_{n-1}^{m}$
>
> $C_n^0+C_n^1+...+C_n^n = 2^n$
>
> $C_n^m = C_n^{n-m}$
>
> ç»„åˆæ•°åˆ¤å®šå¥‡å¶ï¼šå¯¹äºC(n,m)ï¼Œè¯º n&m==m åˆ™ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¸ºå¶æ•°ã€‚



**å¤šé‡é›†**

å¤šé‡é›†æ˜¯æŒ‡åŒ…å«é‡å¤å…ƒç´ çš„å¹¿ä¹‰é›†åˆï¼Œè®¾ S = {$n_1ä¸ªa_1,n_2ä¸ªa_2,...,n_kä¸ªa_k$} 

Sçš„å…¨æ’åˆ—ä¸ªæ•°$A = \frac{n!}{n_1!n_2!Â·Â·Â·n_k!}$

ä»Sä¸­é€‰ r ($r <= n_k$)ä¸ªå…ƒç´ ç»„æˆä¸€ä¸ªå¤šé‡é›†ï¼Œäº§ç”Ÿçš„ä¸åŒå¤šé‡é›†çš„æ•°é‡ä¸º$C_{k+r-1}^{k-1}$





**äºŒé¡¹å¼å®šç†**

$(a+b)^n = \sum_{k=0}^n{C_n^ka^kb^{n-k}}$



**ä¸€äº›å¸¸è§çš„ç»„åˆè®¡æ•°**

n*mçš„ç½‘æ ¼ä»å·¦ä¸Šè§’(1,1)èµ°åˆ°å³ä¸‹è§’(n,m)ï¼Œæ¯æ¬¡åªèƒ½å¾€ä¸‹æˆ–å³èµ°ï¼Œä¸åŒçš„è·¯å¾„çš„æ€»æ•°$C_{n+m-2}^{n-1}$æˆ–$C_{n+m-2}^{m-1}$ç§
>
> éœ€è¦çš„æ€»æ­¥æ•°ä¸ºn+m-2ï¼Œå…¶ä¸­å‘ä¸‹èµ°n-1æ­¥ï¼Œå‘å³èµ°m-1æ­¥ï¼Œä¸åŒçš„è·¯å¾„æ€»å…±æœ‰$C_{n+m-2}^{n-1}$æˆ–$C_{n+m-2}^{m-1}$ç§ã€‚



nä¸ªç›¸åŒçš„ç‰©å“åˆ†æˆmç»„ï¼Œæ¯ç»„è‡³å°‘1ä¸ªå…ƒç´ çš„æ–¹æ¡ˆæ•°ï¼š$C_{n-1}^{m-1}$

>è€ƒè™‘æ‹¿`m-1ä¸ªæ¿å­`æ’åˆ°nä¸ªå…ƒç´ å½¢æˆçš„`n-1ä¸ªç©º`é‡Œé¢ï¼Œå°†ç‰©å“åˆ†æˆmç»„ã€‚ç­”æ¡ˆå°±æ˜¯$C_{n-1}^{m-1}$ã€‚
> æœ¬è´¨æ˜¯æ±‚$x_1+x_2+...+x_m=n$çš„æ­£æ•´æ•°è§£çš„ç»„æ•°ã€‚å…¶ä¸­$x_i \ge 1$



nä¸ªç›¸åŒçš„ç‰©å“åˆ†æˆmç»„ï¼Œæ¯ç»„å¯ä»¥æœ‰0ä¸ªå…ƒç´ çš„æ–¹æ¡ˆæ•°ï¼š$C_{n+m-1}^{n}$æˆ–$C_{n+m-1}^{m-1}$

>
> æ˜¾ç„¶æ­¤æ—¶æ²¡æ³•ç›´æ¥æ’æ¿äº†ï¼Œå› ä¸ºå¯èƒ½å‡ºç°å¾ˆå¤šå—æ¿å­æ’åˆ°åŒä¸€ä¸ªç©ºé‡Œé¢ï¼Œä¸å¥½è®¡ç®—ã€‚
> å…ˆå€Ÿmä¸ªå…ƒç´ è¿‡æ¥ï¼Œåœ¨è¿™n+mä¸ªå½¢æˆçš„`n+m-1ä¸ªç©º`é‡Œé¢æ’å…¥`m-1ä¸ªæ¿å­`ï¼Œæ–¹æ¡ˆæ•°ä¸º$C_{n+m-1}^{n}$æˆ–$C_{n+m-1}^{m-1}$ã€‚
> å¼€å¤´å€Ÿäº†mä¸ªå…ƒç´ ç”¨äºä¿è¯æ¯ç»„è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ’å®Œæ¿åå°†å€Ÿæ¥çš„mä¸ªå…ƒç´ åˆ é™¤ï¼Œå› ä¸ºå…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è½¬åŒ–è¿‡çš„æƒ…å†µå’Œè½¬åŒ–å‰çš„æƒ…å†µå¯ä»¥ä¸€ä¸€å¯¹åº”ï¼Œç­”æ¡ˆä¹Ÿå°±æ˜¯ç›¸ç­‰çš„ã€‚
> ä¹Ÿç›¸å½“äºæ˜¯æ±‚å¤šé‡é›†{nä¸ªç‰©å“,m-1ä¸ªæ¿å­}çš„å…¨æ’åˆ—æ•°ã€‚
>
> æœ¬è´¨æ˜¯æ±‚$x_1+x_2+...+x_m=n$çš„éè´Ÿæ•´æ•°è§£çš„ç»„æ•°ã€‚å…¶ä¸­$x_i \ge 0$



nä¸ªç‰©å“åˆ†æˆmç»„ï¼Œè¦æ±‚å¯¹äºç¬¬$i$ç»„ï¼Œè‡³å°‘è¦åˆ†åˆ°$a_i$ä¸ªå…ƒç´ ($\sum{a_i\le n}$)ï¼Œæ–¹æ¡ˆæ•°ä¸º$C_{n-\sum{a_i}+m-1}^{n-\sum{a_i}}$

> ç±»æ¯”ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å€Ÿ$\sum{a_i}$ä¸ªå…ƒç´ è¿‡æ¥ï¼Œä¿è¯ç¬¬$i$ç»„è‡³å°‘èƒ½åˆ†åˆ°$a_i$ä¸ªï¼Œä¹Ÿå°±æ˜¯ä»¤$x^{\prime} = x_i - a_i$ã€‚
> å¾—åˆ°æ–°æ–¹ç¨‹ï¼š
> $$
> \begin{aligned}
> (x_1^{\prime}+a_1)+(x_2^{\prime}+a_2)+\cdots+(x_k^{\prime}+a_k)&=n\\
> x_1^{\prime}+x_2^{\prime}+\cdots+x_k^{\prime}&=n-a_1-a_2-\cdots-a_k\\
> x_1^{\prime}+x_2^{\prime}+\cdots+x_k^{\prime}&=n-\sum a_i
> \end{aligned}
> $$
> å…¶ä¸­$x_i^{\prime} \ge 0$ã€‚ç„¶åå°±è½¬åŒ–ä¸ºäº†ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œç›´æ¥ç”¨æ’æ¿æ³•å…¬å¼å¾—åˆ°ç­”æ¡ˆä¸º$C_{n-\sum{a_i}+m-1}^{n-\sum{a_i}}$
>
> æœ¬è´¨æ˜¯æ±‚$x_1+x_2+...+x_m = n$çš„è§£çš„æ•°ç›®ï¼Œå…¶ä¸­$x_i \ge a_i$



ä»1~nçš„è‡ªç„¶æ•°ä¸­é€‰mä¸ªï¼Œä¸”è¿™mä¸ªæ•°ä¸­ä»»æ„ä¸¤ä¸ªæ•°å·®å€¼å¤§äºkçš„æ–¹æ¡ˆæœ‰$C_{n-k(m-1)}^{m}$ç§ã€‚(å…¶ä¸­$n-k(m-1)\ge m$ï¼Œå¦åˆ™ä¸º0ç§ã€‚)

> [ä¾‹é¢˜ï¼šDon't be too closeï¼ˆâ˜…6ï¼‰ - AtCoder typical90_o - (vjudge.net)](https://vjudge.net/problem/AtCoder-typical90_o#author=GPT_zh)







#### æ¨è¾‰ä¸‰è§’

> O($N^2$) é¢„å¤„ç†   O(1)è¯¢é—®
>
> $C_n^m = C_{n-1}^{m-1} + C_{n-1}^{m}$

```cpp
const int mod = 1e9+7,N = 2005;
long long C[N][N];
void init() {//åˆå§‹åŒ–
    for (int i = 0; i <= 2000 ; i ++ ){
        for (int j = 0; j <= i; j ++ ){
            if (!j) C[i][j] = 1;
            else C[i][j] = (C[i - 1][j] + C[i - 1][j - 1]) % mod;
        }
    }
}
```



#### é€†å…ƒæ±‚ç»„åˆæ•°

> $O(N)$é¢„å¤„ç†  O(1)è¯¢é—®
>
> $C_n^m = \frac{n!}{m!(n-m)!}\  \%P= n!*(m!^{P-2})*(n-m)!^{P-2}\ \%P$

```cpp
#include <iostream>
using ll = long long;
using namespace std;
const int N = 100005,P = 1e9+7;
ll fact[N],infact[N];

ll qmi(ll a,ll b,ll p){
	ll ans = 1;
	while(b){
		if(b&1) ans = ans * a % p;
		b >>= 1;
		a = a * a % p;
	}
	return ans%p;
}

void initi(){
	fact[0] = infact[0] = 1;//0çš„é˜¶ä¹˜ç­‰äº1
	for(int i = 1;i < N;i++){//é¢„å¤„ç†é˜¶ä¹˜
		fact[i] = fact[i-1]*i%P;
	}
	infact[N-1] = qmi(fact[N-1],P-2,P);//é¢„å¤„ç†é˜¶ä¹˜çš„é€†å…ƒ,å€’ç€å¤„ç†åªç”¨ç®—ä¸€æ¬¡å¿«é€Ÿå¹‚æ±‚é€†å…ƒ
	for(int i = N - 2;i >= 1;i--){
		infact[i] = infact[i+1]*(i+1)%P;
	}
}

ll C(int a,int b){
	//if(a < b) return 0;
	return fact[a]*infact[b]%P*infact[a-b]%P;
}

int main(){
	initi();
	int t;cin >> t;
	while(t--){
		int a,b;cin >> a >> b;
		cout << C(a,b) << '\n';
	}
}
```





#### å¢å¡æ–¯å®šç†

> $M\le N \le 10^{18}ï¼ŒP \le 10^5$ï¼Œå…¶ä¸­$P$ä¸ºè´¨æ•°
>
> O($P\ logN\ logP$)è¯¢é—®
>
> $C_n^mâ‰¡C_{n/p}^{m/p} C_{n\%p}^{m\%p} (mod\ p)$

```cpp
#include <iostream>
using namespace std;
using ll = long long;

ll qmi(ll a,ll b,ll p){
	ll ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b >>= 1;
		a = a*a%p;
	}
	return ans%p;
}

ll C(ll a,ll b,ll p){//O(blogP)æœ´ç´ æ±‚ç»„åˆæ•°
	ll ans = 1;
	for(int i = 1,j = a;i <= b;i++,j--){
		ans = ans*j%p;
		ans = ans*qmi(i,p-2,p)%p;
	}
	return ans;
}

ll lucas(ll a,ll b,ll p){ 
	if(a < p && b < p) return C(a,b,p);
	return C(a%p,b%p,p)*lucas(a/p,b/p,p)%p;
}

int main(){
	int q; cin >> q;
	while(q--){
		ll a,b,p; cin >> a >> b >> p;
		cout << lucas(a,b,p) << endl;
	}

	return 0;
}
```



#### é«˜ç²¾åº¦æ’åˆ—ç»„åˆ

> $n,m \le 5000$
>
> é˜¶ä¹˜è´¨å› æ•°åˆ†è§£+é«˜ç²¾åº¦ä¹˜æ³•
>
> [åšå®¢ï¼šé˜¶ä¹˜ï¼ˆn!ï¼‰çš„ç´ å› æ•°åˆ†è§£_æ­£æ•´æ•° (sohu.com)](https://www.sohu.com/a/369994459_614593)
>
> ç®—æœ¯åŸºæœ¬å®šç†ï¼šä»»æ„ä¸€ä¸ªå¤§äº1çš„æ­£æ•´æ•°n,å®ƒéƒ½å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹å½¢å¼,å…¶ä¸­pä¸ºè´¨æ•°,aä¸ºæ­£æ•´æ•°
> $n = P_1^{a_1}P_2^{a^2}...P_k^{a_k}$ 
> $m = P_1^{b_1}P_2^{b^2}...P_k^{b_k}$ 
> $n-m = P_1^{c_1}P_2^{c^2}...P_k^{c_k}$
> å…¶ä¸­`P[]`ä¸ºnä»¥å†…çš„æ‰€æœ‰ç´ æ•°
> $$
> åˆ™æœ‰C_n^m =\frac{n!}{m!(n-m)!} =  \prod p_i^{a_i - b_i - c_i}
> $$

```cpp
//https://www.acwing.com/problem/content/890/
#include <iostream>
#include <vector>
using namespace std;
const int N = 5003;
int primes[N],cnt;
bool st[N];
int sum[N];

void initi(int n){
	for(int i = 2;i <= n;i++){
		if(!st[i]) primes[++cnt] = i;
		for(int j = 1;primes[j] <= n/i;j++){
			st[primes[j]*i] = 1;
			if(i % primes[j] == 0) break;
		}
	}
}

int get(int n,int p){//è®¡ç®—n!é‡Œé¢åˆ†è§£ä¸ºp^kçš„kå€¼
    //12! = 1*2*3*4*5*6*7*8*9*10*11*12
    //p   = 2  {2,4,6,8,10,12}  ans+=6
    //p^2 = 4  {4,8,12}  ans+=3
    //p^3 = 8  {8}  ans+=1
    //get(12,2) = 6+3+1 = 10
	int ans = 0;
	while(n){
		ans += n/p;
		n/=p;
	}
	return ans;
}

vector<int> mul(vector<int>&A,int b){
	vector<int>C;
	int t = 0;
	for(int i = 0;i < A.size();i++){
		t += A[i]*b;
		C.push_back(t%10);
		t /= 10;
	}
	while(t){
		C.push_back(t%10);
		t/=10;
	}
	return C;
}

int main(){
	int a,b;cin >> a >> b;
	initi(a);

	for(int i = 1;i <= cnt;i++){
		int p = primes[i];
		sum[i] = get(a,p) - get(b,p) - get(a-b,p); 
	}

	vector<int>A(1,1);
	for(int i = 1;i <= cnt;i++){
		for(int j = 1;j <= sum[i];j++){//A *= primes[i]^sum[i]
			A = mul(A,primes[i]);
		}
	}

	for(int i = A.size()-1;i >= 0;i--){
		cout << A[i];
	}
	return 0;
}
```











### é”™ä½æ’åˆ—

æ²¡æœ‰ä»»ä½•å…ƒç´ å‡ºç°åœ¨åŸæœ‰ä½ç½®çš„æ’åˆ—ã€‚å³ï¼Œå¯¹äº1~nçš„æ’åˆ—Pï¼Œå¦‚æœæ»¡è¶³$P_i \neq i$ï¼Œåˆ™ç§°Pæ˜¯nçš„é”™ä½æ’åˆ—ã€‚
å¦‚ä¸‰å…ƒé”™ä½æ’åˆ—æœ‰ï¼š$\{2,3,1\}$ å’Œ $\{3,1,2\}$

é€’æ¨å…³ç³»å¼ï¼š
$$
D_n = (n-1)(D_{n-1}+D_{n-2}) = n(D_{n-1} + (-1)^n)
$$


```cpp
//é€’æ¨è®¡ç®—é”™ä½æ’åˆ—æ•°åˆ— O(N)
a[0] = 1;
for(int i = 1;i < N;i++){
    a[i] = i*a[i-1] + (i&1?-1:1);
}
for(int i = 1;i < N;i++) cout << a[i] << ' ';//0 1 2 9 44 265 ...
```



å…¶å®ƒå…³ç³»ï¼š

é”™ä½æ’åˆ—æ•°æœ‰ä¸€ä¸ªç®€å•çš„å–æ•´è¡¨è¾¾å¼ï¼Œå¢é•¿é€Ÿåº¦ä¸é˜¶ä¹˜ä»…ç›¸å·®å¸¸æ•°ï¼š$D_n=\begin{cases}
    \left\lceil\frac{n!}{\mathrm{e}}\right\rceil, & nä¸ºå¶æ•° \\
    \left\lfloor\frac{n!}{\mathrm{e}}\right\rfloor,            & nä¸ºå¥‡æ•°
\end{cases}$

éšç€å…ƒç´ æ•°é‡çš„å¢åŠ ï¼Œå½¢æˆé”™ä½æ’åˆ—çš„æ¦‚ç‡ P æ¥è¿‘ï¼š$P=\lim_{n\to\infty}\frac{D_n}{n!}=\frac{1}{\mathrm{e}}$





### å®¹æ–¥åŸç†

$$
|A\cup B\cup C|=|A|+|B|+|C|-|A\cap B|-|B\cap C|-|C\cap A|+|A\cap B\cap C|
$$

![å®¹æ–¥åŸç† - venn å›¾ç¤ºä¾‹](https://oi-wiki.org/math/combinatorics/images/incexcp.png)  æŠŠä¸Šè¿°é—®é¢˜æ¨å¹¿åˆ°ä¸€èˆ¬æƒ…å†µï¼Œå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„å®¹æ–¥åŸç†

æŠŠåŒ…å«äºæŸå†…å®¹ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„æ•°ç›®å…ˆè®¡ç®—å‡ºæ¥ï¼Œç„¶åå†æŠŠè®¡æ•°æ—¶é‡å¤è®¡ç®—çš„æ•°ç›®æ’æ–¥å‡ºå»ï¼Œä½¿å¾—è®¡ç®—çš„ç»“æœæ—¢æ— é—æ¼åˆæ— é‡å¤

$$
\begin{aligned}
\left|\bigcup_{i=1}^{n}S_i\right|=&\sum_{i}|S_i|-\sum_{i<j}|S_i\cap S_j|+\sum_{i<j<k}|S_i\cap S_j\cap S_k|-\cdots\\
&+(-1)^{m-1}\sum_{a_i<a_{i+1} }\left|\bigcap_{i=1}^{m}S_{a_i}\right|+\cdots+(-1)^{n-1}|S_1\cap\cdots\cap S_n|
\end{aligned}
$$

å³

$$
\left|\bigcup_{i=1}^{n}S_i\right|=\sum_{m=1}^n(-1)^{m-1}\sum_{a_i<a_{i+1} }\left|\bigcap_{i=1}^mS_{a_i}\right|
$$


```cpp
//https://www.acwing.com/problem/content/description/892/
//ç»™å®šä¸€ä¸ªæ•´æ•° n å’Œ m ä¸ªä¸åŒçš„è´¨æ•° p1,p2,â€¦,pmã€‚
//è¯·ä½ æ±‚å‡º 1âˆ¼nä¸­èƒ½è¢« p1,p2,â€¦,pm ä¸­çš„è‡³å°‘ä¸€ä¸ªæ•°æ•´é™¤çš„æ•´æ•°æœ‰å¤šå°‘ä¸ªã€‚
#include <iostream>
using namespace std;
using ll = long long;
int p[20];
ll ans = 0;

int main(){
	int n,m;cin >> n >> m;
	for(int i = 1;i <= m;i++){
		cin >> p[i];
	}

	for(int i = 1;i < 1 << m;i++){//äºŒè¿›åˆ¶1~11...11æšä¸¾æ‰€æœ‰çŠ¶æ€
		ll cnt = 0,t = 1;
		for(int k = 0;k < m;k++){
			if(i >> k & 1){
				cnt++;
				t *= p[k+1];
				if(t > n){t = -1;break;}
			}
		}
		if(t == -1) continue;
		if(cnt&1) ans += n/t;
		else ans -= n/t;
	}
	cout << ans;
	return 0;
}
```







### æ•°åˆ—



#### ç­‰å·®/ç­‰æ¯”

**ç­‰å·®æ•°åˆ—**

> é€šé¡¹å…¬å¼ï¼š$a_n = a_1 + (n-1)*d$
>
> æ±‚å’Œå…¬å¼ï¼š$S_n = \frac{(a_1+a_n)*n}{2}$



**ç­‰æ¯”æ•°åˆ—**

> é€šé¡¹å…¬å¼ï¼š$a_n = a_1*q^{n-1}$
>
> æ±‚å’Œå…¬å¼ï¼š$\begin{cases} S_n = \frac{a_1(q^n-1)}{q-1}\ \quad (q\ !=1) \\
> S_n = n*a_1  \qquad  (q == \ 1) \end{cases}$
>
> è¯ºæ— æ³•æ±‚é€†å…ƒå¯ä»¥è€ƒè™‘é€’å½’ï¼š$S(k) = \begin{cases} 
> A \qquad\qquad\qquad\qquad\qquad\ \  k = 1 \\
> S(k-1)+A^k \qquad \qquad \quad \ kä¸ºå¥‡æ•°\\  
> S(k/2) + S(k/2)*A^\frac{k}{2} \qquad kä¸ºå¶æ•° \\
> \end{cases}$





$$
\sum_{x=1}^{n}{x} = {\frac{n(n+1)}{2}}
$$

$$
\sum_{x=1}^{n}{x^2} = \frac{n(n+1)(2n+1)}{6}
$$

$$
\sum_{x=1}^{n}{x^3} = {(\sum_{x=1}^{n}{x})^2} = (\frac{n(n+1)}{2})^2
$$



#### æ•°åˆ—é€’æ¨

**æ±‚è§£é€’æ¨æ•°åˆ— $a_n = a_{n-1} + k*n + b$ çš„ç¬¬ n é¡¹ï¼ˆå…¶ä¸­ k,b ä¸ºå¸¸æ•°ï¼‰**

$a_n = a_1 + \sum_{i=2}^{n}(ki+b) = a_1 + k\sum_{i=2}^{n}{i} + b\sum_{i=2}^{1}$  

å…¶ä¸­  $\sum_{i=2}^{n}{i} = \frac{n(n+1)}{2}-1$    ï¼Œ   $\sum_{i=2}^{n}{1}=n-1$

ä»£å…¥æ±‚å’Œå¾—$a_n = \frac{k}{2}n^2 + (b+\frac{k}{2})n + (a_1-b-k)$







#### æ–æ³¢é‚£å¥‘

[æ–æ³¢é‚£å¥‘æ•°åˆ—ç›¸å…³ - zhoukangyang - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/zkyJuruo/p/15714271.html)

f(0) = 0ï¼Œf(1) = 1ï¼Œf(n) = f(n-2)+f(n-1)

0 1 1 2 3 5 8 13 21 ....



**å¿«é€Ÿå€å¢æ³•**

O(logN) è¯¢é—®  æ¯”çŸ©é˜µä¹˜æ³•å¸¸æ•°æ›´å°ï¼Œè¿”å›å€¼ä¸ºpair<Fib(n),Fib(n+1)>;

$F_{2k} = F_k (2 F_{k+1} - F_{k}) $
$F_{2k+1} = F_{k+1}^2 + F_{k}^2$

```cpp
pair<ll,ll> fib(ll n) {
	if (n == 0) return {0,1};
	auto [a,b] = fib(n >> 1);
	ll c = a * (2*b%mod - a + mod)%mod;
	ll d = (a*a%mod + b*b%mod)%mod;
	if (n&1) return {d,c+d};
	else return {c,d};
}
//cout << fib(n).first;
```



**ä¸€äº›æ€§è´¨**

1.  å¡è¥¿å°¼æ€§è´¨ï¼š$F_{n-1} F_{n+1} - F_n^2 = (-1)^n$ã€‚
2.  é™„åŠ æ€§è´¨ï¼š$F_{n+k} = F_k F_{n+1} + F_{k-1} F_n$ã€‚
3.  å–ä¸Šä¸€æ¡æ€§è´¨ä¸­ $k = n$ï¼Œæˆ‘ä»¬å¾—åˆ° $F_{2n} = F_n (F_{n+1} + F_{n-1})$ã€‚
4.  ç”±ä¸Šä¸€æ¡æ€§è´¨å¯ä»¥å½’çº³è¯æ˜ï¼Œ$\forall k\in \mathbb{N},F_n|F_{nk}$ã€‚
5.  ä¸Šè¿°æ€§è´¨å¯é€†ï¼Œå³ $\forall F_a|F_b,a|b$ã€‚
6.  GCD æ€§è´¨ï¼š$GCD(F_n, F_m) = F_{GCD(n, m)}$ã€‚





##### å¹¿ä¹‰æ–æ³¢é‚£å¥‘æ•°åˆ—

O(logN)è¯¢é—®

ä¾‹ï¼šæ±‚ $f(n) = p*f(n-1) + q * f(n-2)$

å¯ä»¥å¾—åˆ°çŸ©é˜µå…¬å¼ï¼š $\begin{bmatrix} f(n) & f(n-1)  \end{bmatrix} = \begin{bmatrix} f(n-1) & f(n-2)  \end{bmatrix} \times \begin{bmatrix} p & 1 \\ q & 0\\ \end{bmatrix}$

$ans = \begin{bmatrix} f(2) & f(1) \\ 0 & 0\\ \end{bmatrix}$

$base = \begin{bmatrix} p & 1 \\ q & 0\\ \end{bmatrix}$

åˆ©ç”¨çŸ©é˜µå¿«é€Ÿå¹‚æ±‚  $ans*base^{n-2}$ï¼Œå¯¹äºn <= 2çš„æƒ…å†µ,ç›´æ¥è¾“å‡ºç­”æ¡ˆå³å¯ï¼ˆå› ä¸ºç¬¬ä¸€æ¬¡ç›¸ä¹˜å³å¾—åˆ°F[3],æ‰€ä»¥æ˜¯n-2æ¬¡æ–¹ï¼‰

æœ‰å…³baseè½¬ç§»çŸ©é˜µçš„æ„é€ ï¼š$F[N] = p*F[n-1]+q*F[n-2]$   ï¼Œ $F[N-1] = 1*F[N-1] + 0*F[N-2]$
å®é™…æ˜¯è½¬ä¸ºäº†äºŒç»´ï¼š$F[i][0] = F[i-1][0]*p + F[i-1][1]*q$    ï¼Œ   $F[i][1] = F[i-1][0]*1$

|        | F[n] | F[n-1] |
| ------ | ---- | ------ |
| F[n-1] | p    | 1      |
| F[n-2] | q    | 0      |

```cpp
//https://www.luogu.com.cn/problem/P1349
//ç»™å®šp,qå’Œå‰ä¸¤é¡¹f(1),f(2) æ±‚f(n)%mod
#include <iostream>
using namespace std;
int mod;

struct mat{
	long long a[2][2];
};

mat operator * (const mat &a,const mat &b){
	mat ans = {};
	for(int i = 0;i < 2;i++){
		for(int j = 0;j < 2;j++){
			for(int k = 0;k < 2;k++){
				ans.a[i][j] = (ans.a[i][j] + a.a[i][k] * b.a[k][j]) % mod;
			}
		}
	}
	return ans;
}

mat qmi(mat a,long long b){
	mat ans = {};
	for(int i = 0;i < 2;i++){
		ans.a[i][i] = 1;
	}
	while(b){
		if(b & 1) ans = ans * a;
		b >>= 1;
		a = a * a;
	}
	return ans;
}

int main(){
	int p,q,a1,a2,n; cin >> p >> q >> a1 >> a2 >> n >> mod;
	if(n == 1){cout << a1;return 0;}
	if(n == 2){cout << a2;return 0;}
    
	mat ans = {a2,a1};
	mat base = {p,1,q,0};
	ans = ans * qmi(base,n-2);

	cout << ans.a[0][0];
}
```







##### çš®è¨è¯ºå‘¨æœŸ

æ¨¡pæ„ä¹‰ä¸‹çš„æ–æ³¢é‚£å¥‘æ•°åˆ—æœ€ä¸‹æ­£å‘¨æœŸè¢«ç§°ä¸ºçš®è¨è¯ºå‘¨æœŸã€‚
çš®è¨è¯ºå‘¨æœŸæ€»æ˜¯**ä¸è¶…è¿‡6p**ï¼Œä¸”åªæœ‰åœ¨$p=2*5^k$å½¢å¼ä¸‹æ‰å–å¾—ç­‰å·

å½“éœ€è¦è®¡ç®—ç¬¬ $n$ é¡¹æ–æ³¢é‚£å¥‘æ•°æ¨¡ $m$ çš„å€¼çš„æ—¶å€™ï¼Œå¦‚æœ $n$ éå¸¸å¤§ï¼Œå°±éœ€è¦è®¡ç®—æ–æ³¢é‚£å¥‘æ•°æ¨¡ $m$ çš„å‘¨æœŸã€‚å½“ç„¶ï¼Œåªéœ€è¦è®¡ç®—å‘¨æœŸï¼Œä¸ä¸€å®šæ˜¯æœ€å°æ­£å‘¨æœŸã€‚

å¦‚æœ $a$ ä¸ $b$ äº’ç´ ï¼Œ$ab$ çš„çš®è¨è¯ºå‘¨æœŸå°±æ˜¯ $a$ çš„çš®è¨è¯ºå‘¨æœŸä¸ $b$ çš„çš®è¨è¯ºå‘¨æœŸçš„æœ€å°å…¬å€æ•°

```cpp
//https://codeforces.com/contest/2033/problem/F
//G(n,k)ä¸ºç¬¬nä¸ªèƒ½è¢«kæ•´é™¤çš„æ•°çš„ä¸‹æ ‡ n<=1e18,k<=1e5
//æš´åŠ›æ‰¾å‡ºç¬¬ä¸€æ¬¡èƒ½è¢«kæ•´é™¤æ—¶çš„ä¸‹æ ‡iï¼Œn*iå³ä¸ºç¬¬nä¸ªèƒ½è¢«kæ•´é™¤çš„ä¸‹æ ‡
void sol(){
	ll n,k;cin >> n >> k;
	ll l = 0,r = 1;
	for(ll i = 1;;i++){
		tie(l,r) = make_pair(r%k,(l+r)%k);
		if(!l) { cout << n%mod*i%mod << '\n'; return; }
	}
}
```













#### å¡ç‰¹å…°æ•°

ç»„åˆæ•°å­¦ä¸­ä¸€ä¸ªå¸¸å‡ºç°åœ¨å„ç§è®¡æ•°é—®é¢˜ä¸­å‡ºç°çš„æ•°åˆ—

[å¡ç‰¹å…°æ•°ï¼ˆCatalanï¼‰å…¬å¼ã€è¯æ˜ã€ä»£ç ã€å…¸ä¾‹._å¡ç‰¹å…°æ•°å…¬å¼](https://blog.csdn.net/sherry_yue/article/details/88364746)

> 1,1,2,5,14,42,132,429...(ä»ç¬¬0é¡¹å¼€å§‹)
>
> é€šé¡¹å…¬å¼ï¼š$h(n) = \frac{1}{n+1}C_{2n}^n$
>
> é€’æ¨å…¬å¼ï¼š$h[0] = 1ã€h[i] = \frac{2*(2i-1)}{i+1}*h[i-1]$

ä¾‹ï¼šnå¯¹æ‹¬å·æœ‰å¤šå°‘ç§åŒ¹é…æ–¹å¼ï¼Ÿ(è¯ºæœ‰kç§æ‹¬å·ï¼Œåˆ™ç­”æ¡ˆä¸º$h(n)*k^n$)
æ±‚nä¸ªèŠ‚ç‚¹èƒ½å¤Ÿæ„æˆçš„ä¸åŒçš„äºŒå‰æ ‘çš„ä¸ªæ•°?
ä¸€ä¸ªæ ˆçš„è¿›æ ˆåºåˆ—ä¸º1ï¼Œ2ï¼Œ3ï¼Œâ€¦ï¼Œnæœ‰å¤šå°‘ä¸ªä¸åŒçš„å‡ºæ ˆåºåˆ—?
ç»™å‡ºä¸€ä¸ªn,è¦æ±‚ä¸€ä¸ªé•¿åº¦ä¸º2nçš„01åºåˆ—,ä½¿å¾—åºåˆ—çš„ä»»æ„å‰ç¼€ä¸­1çš„ä¸ªæ•°ä¸å°‘äº0çš„ä¸ªæ•°, æœ‰å¤šå°‘ä¸ªä¸åŒçš„01åºåˆ—?

```cpp
//ç»„åˆæ•°æ±‚å¡ç‰¹å…°æ•°
//O(N)é¢„å¤„ç†ï¼ŒO(logN)è¯¢é—®
#include <iostream>
using namespace std;
using ll = long long;
const int N = 200005,P = 1e9+7;
int n;
ll fact[N],infact[N];

ll qmi(ll a,ll b,ll p){
	ll ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b >>= 1;
		a = a*a%p;
	}
	return ans;
}

void init(){
	fact[0] = infact[0] = 1;
	for(int i = 1;i < N;i++){
		fact[i] = fact[i-1]*i%mod;
	}
	infact[N-1] = qmi(fact[N-1],mod-2,mod);
	for(int i = N-2;i >= 1;i--){
		infact[i] = infact[i+1]*(i+1)%mod;
	}
}

ll C(int a,int b,int p){
	return fact[a]*infact[b]%p*infact[a-b]%p;
}

int main(){
	cin >> n;
	initi();
	cout << C(2*n,n,P)*qmi(n+1,P-2,P)%P;
}
```

```cpp
//é€’æ¨æ±‚å¡ç‰¹å…°æ•°
//O(NlogN)é¢„å¤„ç†,O(1)è¯¢é—®
#include <iostream>
using namespace std;
using ll = long long;
const int N = 200005, P = 1e9+7;
ll h[N];

ll qmi(ll a,ll b,ll p){
	ll ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b >>= 1;
		a = a*a%p;
	}
	return ans;
}

int main(){
	int n;cin >> n;
	h[0] = 1;
	for(int i = 1;i <= n;i++){
		h[i] = (4*i - 2)*h[i-1]%P*qmi(i+1,P-2,P)%P;
	}
	cout << h[n];	
}
```



```python
#pythonå¤§æ³•  é«˜ç²¾åº¦æ±‚å¡ç‰¹å…°æ•°
import math
n = int(input())
A = math.factorial(2 * n)
B = math.factorial(n)
ans = A/B/B/(n+1);
print(ans)
```





#### è´å°”æ•° (é›†åˆåˆ’åˆ†)

$$
B_0 = 1,B_1 = 1,B_2=2,B_3=5,B_4=15,B_5=52,B_6=203,\dots
$$

$B_n$ æ˜¯åŸºæ•°ä¸º $n$ çš„é›†åˆçš„åˆ’åˆ†æ–¹æ³•çš„æ•°ç›®ã€‚é›†åˆ $S$ çš„ä¸€ä¸ªåˆ’åˆ†æ˜¯å®šä¹‰ä¸º $S$ çš„ä¸¤ä¸¤ä¸ç›¸äº¤çš„éç©ºå­é›†çš„æ—ï¼Œå®ƒä»¬çš„å¹¶æ˜¯ $S$ã€‚ä¾‹å¦‚ $B_3 = 5$ å› ä¸º 3 ä¸ªå…ƒç´ çš„é›†åˆ ${a, b, c}$ æœ‰ 5 ç§ä¸åŒçš„åˆ’åˆ†æ–¹æ³•ï¼š

$$
\begin{aligned}
&\{ \{a\},\{b\},\{c\}\} \\
&\{ \{a\},\{b,c\}\} \\
&\{ \{b\},\{a,c\}\} \\
&\{ \{c\},\{a,b\}\} \\
&\{ \{a,b,c\}\} \\
\end{aligned}
$$


```cpp
//O(N^2)é¢„å¤„ç†  O(1)è¯¢é—®
//è´å°”ä¸‰è§’å½¢,æ¯è¡Œçš„é¦–é¡¹æ˜¯è´å°”æ•°
const int N = 2003,mod = 1e9+7;
void get_bell(int n) {
	bell[0][0] = 1;
	for (int i = 1; i <= n; i++) {
		bell[i][0] = bell[i-1][i-1];
		for (int j = 1; j <= i; j++)
			bell[i][j] = (bell[i-1][j-1] + bell[i][j-1])%mod;
	}
}

for(int i = 0;i <= n;i++) cout << bell[i][0] << endl;
```





### åº·æ‰˜å±•å¼€ (å…¨æ’åˆ—æ’å)

åº·æ‰˜å±•å¼€ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºNçš„å…¨æ’åˆ—a[ ]ï¼Œæ±‚å®ƒæ˜¯ç¬¬å‡ ä¸ªæ’åˆ—ã€‚
é€†åº·æ‰˜å±•å¼€ï¼šç»™ç‚¹ä¸€ä¸ªå…¨æ’åˆ—çš„é•¿åº¦Nï¼Œæ±‚ç¬¬rkä¸ªæ’åˆ—æ˜¯ä»€ä¹ˆï¼Ÿ

é‡è¦æŸ¿å­ï¼š$rk = \sum_{i=1}^{n}{S(i) * (n-i)!}$

`S(i)`è¡¨ç¤º`1 ~ a[i]-1`ä¸­æœªå‡ºç°è¿‡çš„æ•°çš„ä¸ªæ•°ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›åˆ¶ï¼Œä¹Ÿå«åšé˜¶ä¹˜è¿›åˆ¶ã€‚
å¦‚ï¼š$(463)_{10} = (341010)_{!} = 3\times 5!+4\times 4!+1\times 3!+0\times 2!+1\times 1!+0\times 0!$

æ—¶é—´å¤æ‚åº¦$O(NlogN)$

å‡è®¾åŸæ’åˆ—ä¸ºa[ ]ï¼Œé˜¶ä¹˜è¿›åˆ¶ä¸ºs[ ]ï¼Œæ’åä¸ºrkï¼Œä¸‹é¢ç›´æ¥ç»™å‡ºè½¬æ¢ä»£ç ï¼ˆæ’åä»0å¼€å§‹ï¼Œæ•°ç»„ä¸‹æ ‡å‡ä»1å¼€å§‹ï¼‰
 $a[\ ] \rightleftharpoons s[\ ] \rightleftharpoons rk$

```cpp
vector<long long> a_to_s(int n,vector<long long>&a){
	vector<long long>s(n+1);
	vector<long long>t(n+1);
	auto add = [&](int i,int x){
		while(i <= n){
			t[i] += x;
			i += i&-i;
		}
	};
	auto query = [&](int i)->long long{
		long long ans = 0;
		while(i){
			ans += t[i];
			i -= i&-i;
		}
		return ans;
	};
	for(int i = 1;i <= n;i++){
		add(i,1);
	}
	for(int i = 1;i <= n;i++){
		s[i] = query(a[i]-1);
		add(a[i],-1);
	}
	return s;
}
```

```cpp
vector<long long> s_to_a(int n,vector<long long>&s){
	vector<long long>a(n+1);
	struct st{
		int l,r,sum;
	};
	st* t = new st[(n<<2)+5];//æƒå€¼çº¿æ®µæ ‘,æ±‚å…¨å±€ç¬¬kå°

	auto pushup = [&](int p){
		t[p].sum = t[p<<1].sum + t[p<<1|1].sum;
	};

    auto build = [&](auto& build, int p, int l, int r) -> void {
        t[p].l = l;
        t[p].r = r;
        if (l == r) {
            t[p].sum = 1;
            return;
        }
        int mid = (l + r) >> 1;
        build(build, p << 1, l, mid); build(build, p << 1 | 1, mid + 1, r);
        pushup(p);
    };

	auto kth = [&](auto &kth,int p,int l,int r,int k)->int{
		if(t[p].l == t[p].r){
			t[p].sum = 0;//æ‰¾åˆ°ç¬¬kå°æ—¶,é¡ºä¾¿å°†ä»–åˆ é™¤
			return t[p].l;
		}
		int mid = t[p].l + t[p].r >> 1;
		int res = 0;
		if(k <= t[p<<1].sum) res = kth(kth,p<<1,l,mid,k);
		else res = kth(kth,p<<1|1,mid+1,r,k-t[p<<1].sum);
		pushup(p);
		return res;
	};

	build(build,1,1,n);

	for(int i = 1;i <= n;i++){
		a[i] = kth(kth,1,1,n,s[i]+1);
	}
	//delete[] t;
	return a;
}
```

```cpp
long long s_to_rk(int n,vector<long long>&s){
	vector<long long>fact(n+1);
	fact[0] = 1;
	for(int i = 1;i <= n;i++){
		fact[i] = fact[i-1]*i%mod;
	}
	long long rk = 0;
	for(int i = 1;i <= n;i++){
		rk = (rk + s[i]*fact[n-i])%mod;
	}
	return rk;
}

void s_add_rk(int n,vector<long long>&s,long long rk){
    s[n] += rk;
    for(int i = n;i >= 1;i--){
        s[i-1] += s[i] / (n-i+1);
        s[i] %= (n-i+1);
    }
}
```

```cpp
vector<long long> rk_to_s(int n,long long rk){
	vector<long long>s(n+1);
	for(int i = 1;i <= n;i++){
		s[n-i+1] = rk % i;
		rk /= i;
	}
	return s;
};
```

ä¸€äº›ä¾‹é¢˜ï¼ša[ ]->s[ ]->rkï¼š[P5367 ã€æ¨¡æ¿ã€‘åº·æ‰˜å±•å¼€ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P5367)
s[ ]->a[ ]ï¼š[UVA11525 Permutation - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/UVA11525)
a[ ]->s[ ]ï¼Œs[ ]+rk->a[ ] [U72177 ç«æ˜Ÿäººplus - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/U72177)







## çº¿æ€§ä»£æ•°

### çŸ©é˜µ



**çŸ©é˜µä¹˜æ³•**

çŸ©é˜µç›¸ä¹˜åªæœ‰åœ¨ç¬¬ä¸€ä¸ªçŸ©é˜µçš„åˆ—æ•°å’Œç¬¬äºŒä¸ªçŸ©é˜µçš„è¡Œæ•°ç›¸åŒæ—¶æ‰æœ‰æ„ä¹‰ã€‚

è®¾ $A$ ä¸º $P \times M$ çš„çŸ©é˜µï¼Œ$B$ ä¸º $M \times Q$ çš„çŸ©é˜µï¼Œè®¾çŸ©é˜µ $C$ ä¸ºçŸ©é˜µ $A$ ä¸ $B$ çš„ä¹˜ç§¯ï¼Œ

å…¶ä¸­çŸ©é˜µ $C$ ä¸­çš„ç¬¬ $i$ è¡Œç¬¬ $j$ åˆ—å…ƒç´ å¯ä»¥è¡¨ç¤ºä¸ºçŸ©é˜µAçš„ç¬¬$i$è¡Œä¸çŸ©é˜µBçš„ç¬¬$j$åˆ—åˆ†åˆ«ç›¸ä¹˜å†æ±‚å’Œï¼š

$$
C_{i,j} = \sum_{k=1}^MA_{i,k}B_{k,j}
$$
çŸ©é˜µä¹˜æ³•æ»¡è¶³ç»“åˆå¾‹ï¼Œä¸æ»¡è¶³ä¸€èˆ¬çš„äº¤æ¢å¾‹ã€‚åˆ©ç”¨ç»“åˆå¾‹ï¼ŒçŸ©é˜µä¹˜æ³•å¯ä»¥ç”¨å¿«é€Ÿå¹‚çš„æ€æƒ³ä¼˜åŒ–ã€‚







#### çŸ©é˜µå¿«é€Ÿå¹‚

æ—¶é—´å¤æ‚åº¦ $O(N^3logK)$

[P3390 ã€æ¨¡æ¿ã€‘çŸ©é˜µå¿«é€Ÿå¹‚ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P3390)

ç»™ç‚¹ä¸€ä¸ªn*nçš„çŸ©é˜µAï¼Œæ±‚$A^k$ï¼Œå¯¹1e9+7å–æ¨¡ã€‚

```cpp
#include <iostream>
using namespace std;
const int N = 105,mod = 1e9+7;
long long n,k;

struct mat{
	long long a[N][N];
};

mat operator * (const mat &a,const mat &b){
	mat ans = {};
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			for(int k = 1;k <= n;k++){
				ans.a[i][j] = (ans.a[i][j] + a.a[i][k] * b.a[k][j]) % mod;
			}
		}
	}
	return ans;
}

mat qmi(mat a,long long b){
	mat ans = {};//å•ä½çŸ©é˜µ
	for(int i = 1;i <= n;i++){
		ans.a[i][i] = 1;
	}
	while(b){
		if(b & 1) ans = ans * a;
		b >>= 1;
		a = a * a;
	}
	return ans;
}

void qmi(mat &ans,mat a, long long b){
	while(b){
		if(b & 1)ans = ans * a;
		b >>= 1;
		a = a * a;
	}
}

int main(){
	cin >> n >> k;
	mat base = {};
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			cin >> base.a[i][j];
		}
	}

	mat ans = qmi(base,k);

	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			cout << ans.a[i][j] << ' ';
		}cout << '\n';
	}
}
```





[P10502 Matrix Power Series - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10502)

> ç»™å®šä¸€ä¸ª $n\times n$ çš„çŸ©é˜µ $A$ å’Œä¸€ä¸ªæ­£æ•´æ•° $k$ ï¼Œæ±‚ $S = A + A^1 +A^2 +\dots +A^k$ã€‚

$S(k) = \begin{cases} 
S(k-1)+A^k \qquad \qquad \quad \ kä¸ºå¥‡æ•°\\  
S(k/2) + S(k/2)*A^\frac{k}{2} \qquad kä¸ºå¶æ•° \\
\end{cases}$

```cpp
#include <iostream>
#include <vector>

int mod;

struct Mat{
	int n;
	std::vector<std::vector<int> >a;

	Mat(){}
	Mat(int _n) {
		n = _n;
		a = std::vector<std::vector<int> >(n,std::vector<int> (n));
	}

	Mat operator * (const Mat &m2){
		Mat ans(n);
		for(int i = 0;i < n;i++){
			for(int j = 0;j < n;j++){
				for(int k = 0;k < n;k++){
					ans.a[i][j] = (ans.a[i][j] + a[i][k] * m2.a[k][j]) % mod;
				}
			}
		}
		return ans;
	}

	Mat operator + (const Mat &m2){
		Mat ans = *this;
		for(int i = 0;i < n;i++){
			for(int j = 0;j < n;j++){
				ans.a[i][j] = (ans.a[i][j] + m2.a[i][j]) % mod;
			}
		}
		return ans;
	}

	Mat qmi(long long b){
		Mat base = *this;
		Mat ans(n);
		for(int i = 0;i < n;i++) ans.a[i][i] = 1;
		while(b){
			if(b & 1) ans = ans * base;
			b >>= 1;
			base = base * base;
		}
		return ans;
	}
};

Mat A;

Mat f(int k){
	if(k == 1) return A;
	if(k&1) {
		return f(k-1) + A.qmi(k);
	}
	else{
		Mat B = f(k/2);
		return B + B * A.qmi(k/2);
	}
}

int main(){
	int n,k; std::cin >> n >> k >> mod;
	A = Mat(n);
	for(int i = 0;i < n;i++){
		for(int j = 0;j < n;j++){
			std::cin >> A.a[i][j];
			A.a[i][j] %= mod;
		}
	}

	A = f(k);

	for(int i = 0;i < n;i++){
		for(int j = 0;j < n;j++){
			std::cout << A.a[i][j] << ' ';
		}
		std::cout << '\n';
	}
}
```





#### çŸ©é˜µå°è£…

é»˜è®¤0_idxã€N*Nçš„çŸ©é˜µå¤§å°ï¼Œæ ¹æ®å®é™…éœ€è¦ä¿®æ”¹ä»£ç ã€‚

| Mat<int>A(n);       |              |                           |
| ------------------- | ------------ | ------------------------- |
| `A +* B`            | çŸ©é˜µåŠ /ä¹˜æ³•  |                           |
| `auto B = A.qmi(k)` | çŸ©é˜µå¿«é€Ÿå¹‚   |                           |
| `A.norm()`          | åŒ–ä¸ºå•ä½çŸ©é˜µ |                           |
| `auto B = inv(A)`   | æ±‚é€†çŸ©é˜µ     | è¯ºä¸å­˜åœ¨åˆ™`B[0][0] == -1` |
| `det(A)`            | è¡Œåˆ—å¼æ±‚å€¼   |                           |
| `add(x,y,w)`        | çŸ©é˜µæ ‘è¿è¾¹   | æ³¨æ„0_idx                 |
|                     |              |                           |



```cpp
const int mod = 1e9+7;//
namespace MAT{

	template<typename T>
	struct Mat{//0_idx
		int n;
		std::vector<std::vector<T>>a;

		Mat(int _n,T val = 0) {
			n = _n;
			a = std::vector<std::vector<T>>(n,std::vector<T>(n,val));
		}

		Mat operator * (const Mat &m2){
			Mat ans(n,0);
			for(int i = 0;i < n;i++){
				for(int j = 0;j < n;j++){
					for(int k = 0;k < n;k++){
						ans.a[i][j] = (ans.a[i][j] + a[i][k] * m2.a[k][j]) % mod;
					}
				}
			}
			return ans;
		}

		Mat operator + (const Mat &m2){
			auto ans = *this;
			for(int i = 0;i < n;i++){
				for(int j = 0;j < n;j++){
					ans.a[i][j] = (ans.a[i][j] + m2.a[i][j]) % mod;
				}
			}
			return ans;
		}
		void operator *= (const Mat &m2) {*this = *this * m2;}
		void operator += (const Mat &m2) {*this = *this + m2;}

		void norm(){
			for(int i = 0;i < n;i++) a[i][i] = 1;
		}

		void add(int x,int y,int w){//Mat_tree:add_edge(x,y,w);
			if(x == y) return;
			a[y][y] = (a[y][y] + w) % mod;
			a[x][y] = (a[x][y] - w) % mod;
		}

		Mat qmi(long long b){
			auto base = *this;
			Mat ans(n);
			ans.norm();
			while(b) {
				if(b&1) ans = ans * base;
				b >>= 1;
				base = base * base;
			}
			return ans;
		}
	};

	long long qmi(long long a,long long b,long long p){
		long long ans = 1;
		while(b){
			if(b&1) ans = ans*a%p;
			b>>=1;
			a = a*a%p;
		}
		return ans;
	}

	template<typename T>
	Mat<T> inv(Mat<T> mt){
		int n = mt.n;
		std::vector<std::vector<long long>> aug(n, std::vector<long long>(2 * n, 0));
		for (int i = 0; i < n; i++) {
			for (int j = 0; j < n; j++) { aug[i][j] = mt.a[i][j]; }
			aug[i][i + n] = 1;
		}

		for (int i = 0; i < n; i++) {
			int pivot = -1;
			for (int r = i; r < n; r++) {
				if (aug[r][i] != 0) {
					pivot = r;
					break;
				}
			}
			if (pivot == -1) { mt.a[0][0] = -1;return mt; }//No_inv
			if (i != pivot) { std::swap(aug[i], aug[pivot]); }
			long long inv_val = qmi(aug[i][i], mod - 2, mod);
			for (int j = 0; j < 2 * n; j++) {
				aug[i][j] = aug[i][j] * inv_val % mod;
			}
			for (int j = 0; j < n; j++) {
				if (j == i) continue;
				long long mul = aug[j][i];
				for (int k = 0; k < 2 * n; k++) {
					aug[j][k] = (aug[j][k] - mul * aug[i][k] % mod + mod) % mod;
				}
			}
		}

		for (int i = 0; i < n; i++) {
			for (int j = 0; j < n; j++) {
				mt.a[i][j] = aug[i][j + n];
			}
		}
		return mt;
	}

	template<typename T>
	T det(Mat<T> mt){
		int n = mt.n;
		long long ans = 1;
		for(int i = 0;i < n;i++){//if(mat_tree) please i begin with 1
			for(int j = i+1;j < n;j++){
				while(mt.a[j][i]){
					long long t = mt.a[i][i]/mt.a[j][i];
					for(int k = i;k < n;k++) {
						mt.a[i][k] = (mt.a[i][k] - mt.a[j][k] * t % mod + mod) % mod;
                        //mt.a[i][k] -= t * mt.a[j][k];
					}
					std::swap(mt.a[i],mt.a[j]);
					ans = -ans;
				}
			}
			if(!mt.a[i][i]) return 0;
			ans = (ans * mt.a[i][i] % mod + mod) % mod;
            //ans *= mt.a[i][i];
		}
		return std::abs(ans);
	}
}
using MAT::Mat;
```



### è¡Œåˆ—å¼

**å®šä¹‰**
$$
\operatorname A=\left|\begin{array}{cccc}
a_{11} & a_{12} & \cdots & a_{1 n} \\
a_{21} & a_{22} & \cdots & a_{2 n} \\
\vdots & \vdots & & \vdots \\
a_{n 1} & a_{n 2} & \cdots & a_{n n}
\end{array}\right|
$$
å¯¹äºä¸€ä¸ªçŸ©é˜µ$A[1\dots n][1\dots n]$ï¼Œå…¶è¡Œåˆ—å¼ä¸º$det(A) = \sum_{P}{(-1)^{\mu(P)}\prod_{i=1}^{n}A[i][p_i]}$ã€‚
ï¼ˆæšä¸¾æ’åˆ—$P[1\dots n]$ï¼Œå…¶ä¸­$\mu(P)$ä¸ºæ’åˆ—$P$çš„é€†åºå¯¹æ•°ï¼Œ$det(A)$åˆç§°ä½œ$|A|$ï¼‰



**ä¸€äº›æ€§è´¨**

- å•ä½çŸ©é˜µçš„è¡Œåˆ—å¼ä¸º1ã€‚

- äº¤æ¢ä¸¤è¡Œï¼ˆåˆ—ï¼‰ï¼Œè¡Œåˆ—å¼çš„å€¼å˜å·ã€‚

- è¯ºæŸä¸€è¡Œï¼ˆåˆ—ï¼‰ä¹˜ä»¥ $t$ï¼Œè¡Œåˆ—å¼çš„å€¼ä¹Ÿå°±ä¹˜ä»¥ $t$ ã€‚

- è‹¥è¡Œåˆ—å¼æŸä¸€è¡Œï¼ˆåˆ—ï¼‰çš„å…ƒç´ æ˜¯ä¸¤æ•°ä¹‹å’Œï¼Œåˆ™è¡Œåˆ—å¼å¯æ‹†æˆä¸¤ä¸ªè¡Œåˆ—å¼çš„å’Œã€‚$\left|
  \begin{array}{cc}
  a+a^{\prime} & b+b^{\prime} \\
  c & d
  \end{array}\right|=\left|\begin{array}{cc}
  a & b \\
  c & d
  \end{array}\right|+\left|\begin{array}{cc}
  a^{\prime} & b^{\prime} \\
  c & d
  \end{array}\right|$

- è¡Œåˆ—å¼æŸä¸€è¡Œï¼ˆåˆ—ï¼‰å…ƒç´ åŠ ä¸Šå¦ä¸€è¡Œï¼ˆåˆ—ï¼‰å¯¹åº”å…ƒç´ çš„kå€ï¼Œè¡Œåˆ—å¼çš„å€¼ä¸å˜ã€‚

- è¯ºæœ‰ä¸¤è¡Œï¼ˆåˆ—ï¼‰ä¸€æ ·ï¼Œåˆ™è¡Œåˆ—å¼çš„å€¼ä¸º0



**è¡Œåˆ—å¼æ±‚å€¼**

> é«˜æ–¯æ¶ˆå…ƒå®ç°ï¼Œæ—¶é—´å¤æ‚åº¦$O(N^3)$

```cpp
//æ¨¡ç‰ˆ https://www.luogu.com.cn/problem/P7112
#include <bits/stdc++.h>
using namespace std;

int mod;

struct Mat{//1_idx
	std::vector<std::vector<long long>>a;

	Mat(int n){
		a = std::vector<std::vector<long long>>(n+1,std::vector<long long>(n+1));
	}
    
	long long det(int n){
		long long ans = 1;
		for(int i = 1;i <= n;i++){
			for(int j = i+1;j <= n;j++){
				while(a[j][i]){
					long long t = a[i][i]/a[j][i];
					for(int k = i;k <= n;k++) {
						a[i][k] = (a[i][k] - a[j][k] * t % mod + mod) % mod;
					}
					std::swap(a[i],a[j]);
					ans = -ans;
				}
			}
			if(!a[i][i]) return 0;
			ans = (ans * a[i][i] % mod + mod) % mod;
		}
		return std::abs(ans);
	}
};

int main(){
	int n; cin >> n >> mod;
	Mat mat(n);
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			cin >> mat.a[i][j];
		}
	}
	cout << mat.det(n);
}
```













### ~~çº¿æ€§åŸº~~

å¸¸ç”¨æ¥è§£å†³å­é›†å¼‚æˆ–ä¸€ç±»é¢˜ç›®

ä»a[ ]ä¸­é€‰ä»»æ„ä¸ªæ•´æ•°(å¯èƒ½åŒ…å«é‡å¤å…ƒç´ )ï¼Œä½¿å¾—é€‰å‡ºçš„æ•´æ•°å¼‚æˆ–å’Œæœ€å¤§ï¼Œæ±‚è¿™ä¸ªå¼‚æˆ–å’Œæœ€å¤§å€¼å¯èƒ½æ˜¯å¤šå°‘

```cpp
//https://www.luogu.com.cn/problem/P3812
//æ—¶é—´å¤æ‚åº¦O(NlogV)
#include <iostream>
#include <algorithm>
using namespace std;
using ll = long long;
const int N = 100005;
ll n,a[N],p[N],cnt;

void add(ll x){
	for(int i = 1;i <= cnt;i++){
		x = min(x,x^p[i]);
	}
	if(x){
		p[++cnt] = x;
		sort(p+1,p+cnt+1,greater<ll>());
	}
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		add(a[i]);
	}
	ll x = 0;;
	for(int i = 1;i <= cnt;i++){
		x = max(x,x^p[i]);
	}
	cout << x;
}
```



åº”ç”¨ï¼š

- å¿«é€ŸæŸ¥è¯¢ä¸€ä¸ªæ•°æ˜¯å¦å¯ä»¥è¢«ä¸€å †æ•°å¼‚æˆ–å‡ºæ¥
- å¿«é€ŸæŸ¥è¯¢ä¸€å †æ•°å¯ä»¥å¼‚æˆ–å‡ºæ¥çš„æœ€å¤§/æœ€å°å€¼
- å¿«é€ŸæŸ¥è¯¢ä¸€å †æ•°å¯ä»¥å¼‚æˆ–å‡ºæ¥çš„ç¬¬kå¤§å€¼








## æ¦‚ç‡è®º



ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè§£å†³æ¦‚ç‡é—®é¢˜éœ€è¦é¡ºåºå¾ªç¯ï¼Œè€Œè§£å†³æœŸæœ›é—®é¢˜ä½¿ç”¨é€†åºå¾ªç¯





### æœŸæœ›

è‹¥éšæœºå˜é‡ $X, Y$ çš„æœŸæœ›å­˜åœ¨ï¼Œåˆ™

-   å¯¹ä»»æ„å®æ•° $a, b$ï¼Œæœ‰ $E(aX + b) = a \cdot EX + b$ã€‚
-   $E(X + Y) = EX + EY$ã€‚

é€šå¸¸æŠŠç»ˆæ­¢çŠ¶æ€ä½œä¸ºåˆå€¼ï¼ŒæŠŠèµ·å§‹çŠ¶æ€ä½œä¸ºç›®æ ‡ï¼Œå€’ç€è¿›è¡Œè®¡ç®—ã€‚å› ä¸ºåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œèµ·å§‹çŠ¶æ€æ˜¯å”¯ä¸€çš„ï¼Œè€Œç»ˆæ­¢çŠ¶æ€å¾ˆå¤šã€‚æ ¹æ®æ•°å­¦æœŸæœ›çš„å®šä¹‰ï¼Œè¯ºæˆ‘ä»¬æ­£ç€è®¡ç®—ï¼Œåˆ™è¿˜éœ€æ±‚å‡ºä»èµ·å§‹çŠ¶æ€åˆ°æ¯ä¸ªç»ˆæ­¢çŠ¶æ€çš„æ¦‚ç‡ï¼Œä¸Få€¼ç›¸ä¹˜æ±‚å’Œæ‰èƒ½å¾—åˆ°ç­”æ¡ˆï¼Œå¢åŠ äº†éš¾åº¦ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™

```cpp
//ç»¿è±†è›™çš„å½’å®¿https://www.luogu.com.cn/problem/P4316
//F[N]=0ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ±‚å‡ºF[1],æ•…æˆ‘ä»¬ä»ç»ˆç‚¹å‡ºå‘ï¼Œåœ¨åå›¾æ‰§è¡Œæ‹“æ‰‘æ’åºï¼Œåœ¨æ‹“æ‰‘æ’åºçš„è¿‡ç¨‹ä¸­é¡ºä¾¿è®¡ç®—F[x]å³å¯
#include <bits/stdc++.h>
using namespace std;
const int N = 200005;
int n,m;
int h[N],e[N],ne[N],w[N],idx;
int in[N],out[N];
double ans[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void uuz(int beg){
	ans[beg] = 0;
	queue<int>q;
	q.push(beg);
	while(q.size()){
		auto t = q.front();q.pop();
		for(int i = h[t];~i;i = ne[i]){
			int k = e[i];
			ans[k] += (ans[t] + w[i])/in[k];
			out[k]--;
			if(out[k] == 0) q.push(k);
		}
	}
}

void sol(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b,c;cin >> a >> b >> c;
		add(b,a,c);//åå‘å»ºè¾¹
		in[a]++;out[a]++;
	}
	uuz(n);
	cout << fixed << setprecision(2) << ans[1];
}

int main() {
	while(T--){ sol(); }
}
```





### æ–¹å·®

è®¾éšæœºå˜é‡ $X$ çš„æœŸæœ› $EX$ å­˜åœ¨ï¼Œä¸”æœŸæœ› $E(X - EX)^2$ ä¹Ÿå­˜åœ¨ï¼Œåˆ™ç§°ä¸Šå¼çš„å€¼ä¸ºéšæœºå˜é‡ $X$ çš„ **æ–¹å·®**ï¼Œè®°ä½œ $DX$ æˆ– $Var(x)$ï¼Œå„ä¸ªæ•°æ®ä¸å‡å€¼çš„å·®çš„å¹³æ–¹å’Œã€‚æ–¹å·®çš„ç®—æœ¯å¹³æ–¹æ ¹ç§°ä¸º **æ ‡å‡†å·®**ï¼Œè®°ä½œ $\sigma(X) = \sqrt{DX}$ã€‚

**æ–¹å·®çš„æ€§è´¨**

è‹¥éšæœºå˜é‡ $X$ çš„æ–¹å·®å­˜åœ¨ï¼Œåˆ™

-   å¯¹ä»»æ„å¸¸æ•° $a, b$ éƒ½æœ‰ $D(aX + b) = a^2 \cdot DX$
-   $DX = E(X^2) - (EX)^2$



## æ•°å€¼ç®—æ³•



### æ•°å€¼ç§¯åˆ†

**è‡ªé€‚åº”è¾›æ™®æ£®ç®—æ³•**

æ±‚å®šç§¯åˆ†$\int_{l}^{r}f(x)dx$ ï¼Œå³ä¸ºf(x)åœ¨åŒºé—´[l,r]ä¸Šä¸xè½´å›´æˆçš„é¢ç§¯ (å…¶ä¸­xè½´ä¸Šæ–¹ä¸ºæ­£å€¼ï¼Œä¸‹æ–¹ä¸ºè´Ÿå€¼)

```cpp
double f(double x){//f(x)
	
}

double simpson(double l, double r) {
	double mid = (l + r) / 2;
	return (r - l) * (f(l) + 4 * f(mid) + f(r)) / 6;  // è¾›æ™®æ£®å…¬å¼
}

double asr(double l, double r, double eps, double ans, int step) {
	double mid = (l + r) / 2;
	double fl = simpson(l, mid), fr = simpson(mid, r);
	if (abs(fl + fr - ans) <= 15 * eps && step < 0)
		return fl + fr + (fl + fr - ans) / 15;  // è¶³å¤Ÿç›¸ä¼¼çš„è¯å°±ç›´æ¥è¿”å›
	return asr(l, mid, eps / 2, fl, step - 1) + asr(mid, r, eps / 2, fr, step - 1);  // å¦åˆ™åˆ†å‰²æˆä¸¤æ®µé€’å½’æ±‚è§£
}

double calc(double l, double r, double eps) {// calc(l,r,eps)
	return asr(l, r, eps, simpson(l, r), 12);
}
```



[P4525 ã€æ¨¡æ¿ã€‘è‡ªé€‚åº”è¾›æ™®æ£®æ³• 1 - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4525)

> è¯•è®¡ç®—ç§¯åˆ†$\int_{l}^{r}\frac{cx+d}{ax+b}dx$ç»“æœä¿ç•™è‡³å°æ•°ç‚¹å6ä½ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
double a,b,c,d,l,r;

double f(double x){
	return (c*x+d)/(a*x+b);
}

double simpson(double l, double r) {
	double mid = (l + r) / 2;
	return (r - l) * (f(l) + 4 * f(mid) + f(r)) / 6;
}

double asr(double l, double r, double eps, double ans, int step) {
	double mid = (l + r) / 2;
	double fl = simpson(l, mid), fr = simpson(mid, r);
	if (abs(fl + fr - ans) <= 15 * eps && step < 0)
		return fl + fr + (fl + fr - ans) / 15;
	return asr(l, mid, eps / 2, fl, step - 1) + asr(mid, r, eps / 2, fr, step - 1);
}

double calc(double l, double r, double eps) {
	return asr(l, r, eps, simpson(l, r), 12);
}

int main() {
	cin >> a >> b >> c >> d >> l >> r;
	cout << fixed << setprecision(6) << calc(l,r,1e-9);
}
```

 



### é«˜æ–¯æ¶ˆå…ƒ



**é«˜æ–¯æ¶ˆå…ƒè§£çº¿æ€§æ–¹ç¨‹ç»„**
$$
\begin{cases}
a_{1,1}x_1 + a_{1,2}x_2 + \cdots + a_{1,n}x_n &= b_1\\
a_{2,1}x_1 + a_{2,2}x_2 + \cdots + a_{2,n}x_n &= b_2\\
\cdots &\cdots \\ a_{m,1}x_1 + a_{m,2}x_2 + \cdots + a_{m,n}x_n &= b_m
\end{cases}
$$

è¿ç”¨åˆç­‰è¡Œå˜æ¢ï¼ŒæŠŠå¢å¹¿çŸ©é˜µï¼Œå˜ä¸ºé˜¶æ¢¯å‹çŸ©é˜µã€‚æœ€åå†æŠŠé˜¶æ¢¯å‹çŸ©é˜µä»ä¸‹åˆ°ä¸Šå›ä»£åˆ°ç¬¬ä¸€å±‚å³å¯å¾—åˆ°æ–¹ç¨‹çš„è§£ã€‚

æ—¶é—´å¤æ‚åº¦$O(N^3)$

> æšä¸¾æ¯ä¸€åˆ—c
>
> æ‰¾åˆ°å½“å‰åˆ—ç»å¯¹å€¼æœ€å¤§çš„ä¸€è¡Œï¼Œæ”¾åˆ°ä¸Šé¢
> å°†è¯¥è¡Œè¯¥åˆ—ç¬¬ä¸€ä¸ªæ•°å˜æˆ1
> å†å°†ä¸‹é¢å…¶ä»–æ‰€æœ‰è¡Œè¯¥åˆ—å˜æˆ0

```cpp
//https://www.acwing.com/problem/content/885/
#include <bits/stdc++.h>
using namespace std;

const double eps = 1e-9;
int gauss(vector<vector<double>>&a) {//a[m+1][n+2];  1_idx
    int m = a.size()-1,n = a[0].size()-2;
	int c,r;//colåˆ—  rowè¡Œ

    for (c = 1,r = 1; c <= n; c++) {
        int tr = r;//æ‰¾åˆ°å½“å‰è¿™ä¸€åˆ—ï¼Œç»å¯¹å€¼æœ€å¤§çš„æ‰€åœ¨è¡Œ
        for (int i = r+1; i <= m; i++) {
            if (fabs(a[i][c]) > fabs(a[tr][c])) { tr = i; }
        }
        if (fabs(a[tr][c]) < eps)  continue; //è¯ºéƒ½æ˜¯0ç›´æ¥è·³è¿‡;

		swap(a[r],a[tr]);//æŠŠå½“å‰è¿™ä¸€è¡Œæ¢åˆ°ç¬¬æœ€ä¸Šé¢(ç¬¬rè¡Œ)
		for(int j = n+1;j >= c;j--) {a[r][j] /= a[r][c];}//æŠŠå½“å‰è¯¥è¡Œè¯¥åˆ—ç¬¬ä¸€ä¸ªæ•°å˜æˆ1(ä»åå¾€å‰ç³»æ•°å€’ç€ç®—)

        for (int i = r+1; i <= m; i++) {//æŠŠå½“å‰åˆ—ä¸‹é¢æ‰€æœ‰ç³»æ•°å˜ä¸º0
			if(fabs(a[i][c]) > eps){//å·²ç»æ˜¯0åˆ™å¯ä»¥è·³è¿‡
				for(int j = n+1;j >= c;j--){//æ¯ä¸€è¡Œä»åå¾€å‰,ç³»æ•°-=è¡Œé¦–ç³»æ•°*ç¬¬cè¡ŒåŒä¸€åˆ—ç³»æ•°
					a[i][j] -= a[i][c]*a[r][j];
				}
			}
        }
        r++;
    }

    if (r < n+1) {//r<n+1è¯´æ˜å·²ç»è§£å‡ºæ¥çš„xä¸è¶³ä»¥è§£å‡ºåŸæ–¹ç¨‹
		for (int i = r; i <= m; i++) {
			if (fabs(a[i][n+1]) > eps) {//å·¦è¾¹=0ï¼Œå³è¾¹b!=0ï¼Œæ— è§£
				return 0;
			}
		}
		return 2;//0=0è¯´æ˜æœ‰æ— ç©·è§£
    }

	for(int i = n;i >= 1;i--){//ä»ä¸‹å¾€ä¸Šå›ä»£ï¼Œè§£å‡ºåŸæ–¹ç¨‹
		for(int j = i+1;j <= n;j++){
			a[i][n+1] -= a[j][n+1]*a[i][j];
		}
	}
	return 1;
}

int main() {
    int n, m; cin >> n;m = n;

    vector<vector<double>> a(m+1, vector<double>(n+2));
    for (int i = 1; i <= m; i++) {
        for (int j = 1; j <= n+1; j++) {
            cin >> a[i][j];
        }
    }
	int t = gauss(a);
    if (t == 0) cout << "No solution";
    if (t == 2) cout << "Infinite group solutions";
    if (t == 1) {
        for (int i = 1; i <= n; i++) {
            printf("%.2lf\n", a[i][n+1]);
        }
    }
}
```



~~**é«˜æ–¯æ¶ˆå…ƒè§£å¼‚æˆ–æ–¹ç¨‹ç»„**~~
$$
\begin{cases}
a_{1,1}x_1 \oplus a_{1,2}x_2 \oplus \cdots \oplus a_{1,n}x_n &= b_1\\
a_{2,1}x_1 \oplus a_{2,2}x_2 \oplus \cdots \oplus a_{2,n}x_n &= b_2\\
\cdots &\cdots \\ 
a_{m,1}x_1 \oplus a_{m,2}x_2 \oplus \cdots \oplus a_{m,n}x_n &= b_1
\end{cases}
$$


åœ¨æ¶ˆå…ƒçš„æ—¶å€™ä½¿ç”¨ã€Œå¼‚æˆ–æ¶ˆå…ƒã€è€Œéã€ŒåŠ å‡æ¶ˆå…ƒã€ï¼Œä¸”ä¸éœ€è¦è¿›è¡Œä¹˜é™¤æ”¹å˜ç³»æ•°ï¼ˆå› ä¸ºç³»æ•°å‡ä¸º0å’Œ 1)

å¼‚æˆ–å¯ä»¥çœ‹åšä¸è¿›ä½çš„åŠ æ³•

```cpp
//https://www.acwing.com/problem/content/description/886/
#include <iostream>
#include <vector>
using namespace std;

int gauss_xor(vector<vector<int>>&a){//a[m+1][n+2];  1_idx
	int m = a.size()-1,n = a[0].size()-2;
	int c,r;
	for(c = 1,r = 1;c <= n;c++){
		int tr = r;
		for(int i = r;i <= m;i++){
			if(a[i][c]) {tr = i;break;}
		}
		if(a[tr][c] == 0) continue;

		swap(a[r],a[tr]);

		for(int i = r+1;i <= m;i++){
			if(a[i][c]){
				for(int j = n+1;j >= c;j--){
					a[i][j] ^= a[r][j];
				}
			}
		}
		r++;
	}

	if(r < n+1){
		for(int i = r;i <= m;i++){
			if(a[i][n+1]) return 0;
		}
		return 2;
	}

	for(int i = n;i >= 1;i--){
		for(int j = i+1;j <= n;j++){
			if(a[i][j]) a[i][n+1] ^= a[j][n+1];
		}
	}
	return 1;
}

int main(){
	int n,m;cin >> n;m = n;
	vector<vector<int>>a(m+1,vector<int>(n+2));
	for(int i = 1;i <= m;i++){
		for(int j = 1;j <= n+1;j++){
			cin >> a[i][j];
		}
	}

	int t = gauss_xor(a);
	if(t == 1){
		for(int i = 1;i <= n;i++){
			cout << a[i][n+1] << '\n';
		}
	}
	if(t == 2) cout << "Multiple sets of solutions";
	if(t == 0) cout << "No solution";
}
```





### æ’å€¼

æ’å€¼æ˜¯ä¸€ç§é€šè¿‡å·²çŸ¥çš„ã€ç¦»æ•£çš„æ•°æ®ç‚¹æ¨ç®—ä¸€å®šèŒƒå›´å†…çš„æ–°æ•°æ®ç‚¹çš„æ–¹æ³•ã€‚æ’å€¼æ³•å¸¸ç”¨äºå‡½æ•°æ‹Ÿåˆä¸­ã€‚

**æ‹‰æ ¼æœ—æ—¥æ’å€¼**
$$
f(x)=\sum_{i=1}^n(y_i\cdot\prod_{j\neq i}\dfrac{x-x_j}{x_i-x_j})
$$



[P4781 ã€æ¨¡æ¿ã€‘æ‹‰æ ¼æœ—æ—¥æ’å€¼ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4781)

å¯¹äº $n$ ä¸ªç‚¹ $(x_i,y_i)$ï¼Œå¦‚æœæ»¡è¶³ $\forall i\neq j, x_i\neq x_j$ï¼Œé‚£ä¹ˆç»è¿‡è¿™ $n$ ä¸ªç‚¹å¯ä»¥å”¯ä¸€åœ°ç¡®å®šä¸€ä¸ª $n-1$ æ¬¡å¤šé¡¹å¼ $y = f(x)$ã€‚

ç°åœ¨ï¼Œç»™å®šè¿™æ · $n$ ä¸ªç‚¹ï¼Œè¯·ä½ ç¡®å®šè¿™ä¸ª $n-1$ æ¬¡å¤šé¡¹å¼ï¼Œå¹¶æ±‚å‡º $f(k) \bmod 998244353$ çš„å€¼ã€‚

```cpp
//O(N^2)å®ç°
#include <iostream>
#include <vector>
using namespace std;
const int mod = 998244353;

long long qmi(long long a,long long b,long long p){
	long long ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b>>=1;
		a = a*a%p;
	}
	return ans%p;
}

long long lagrange_interpolation(vector<pair<long long,long long>> &v,int k){//1_idx
	long long ans = 0;
	for(int i = 1;i < v.size();i++){
		auto &[x1,y1] = v[i];
		long long s1 = y1,s2 = 1;
		for(int j = 1;j < v.size();j++){
			if(i == j) continue;
			auto &[x2,y2] = v[j];
			s1 = s1 * (k-x2)%mod;
			s2 = s2 * (x1-x2)%mod;
		}
		ans += s1 * qmi(s2,mod-2,mod) % mod;
		ans = (ans + mod) % mod;
	}
	return ans;
}

int main(){
	int n,k; cin >> n >> k;
	vector<pair<long long,long long>>v(n+1);
	for(int i = 1;i <= n;i++){
		cin >> v[i].first >> v[i].second;
	}
	cout << lagrange_interpolation(v,k) << '\n';
}
```







## åšå¼ˆè®º

[åšå¼ˆè®ºç®€ä»‹ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/math/game-theory/intro/)

### Nimæ¸¸æˆ

nå †ç‰©å“ï¼Œæ¯å †æœ‰$a_i$ä¸ªï¼Œä¸¤ä¸ªç©å®¶è½®æµå–èµ°ä»»æ„ä¸€å †çš„ä»»æ„ä¸€ä¸ªç‰©å“(ä¸èƒ½ä¸å–)ï¼Œå–èµ°æœ€åä¸€ä¸ªç‰©å“çš„äººè·èƒœ

**åšå¼ˆå›¾å’ŒçŠ¶æ€**

å¦‚æœå°†æ¯ä¸ªçŠ¶æ€è§†ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†ä»æ¯ä¸ªçŠ¶æ€å‘å®ƒçš„åç»§çŠ¶æ€è¿è¾¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåšå¼ˆçŠ¶æ€å›¾ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœèŠ‚ç‚¹ $(i, j, k)$ è¡¨ç¤ºå±€é¢ä¸º $i, j, k$ æ—¶çš„çŠ¶æ€ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ç”»å‡ºä¸‹é¢çš„åšå¼ˆå›¾

<img src="https://oi-wiki.org/math/game-theory/images/game1.png" alt="åšå¼ˆå›¾çš„ä¾‹å­" style="zoom:50%;" /> 

å®šä¹‰ å¿…èƒœçŠ¶æ€ ä¸º å…ˆæ‰‹å¿…èƒœçš„çŠ¶æ€ï¼Œå¿…è´¥çŠ¶æ€ ä¸º å…ˆæ‰‹å¿…è´¥çš„çŠ¶æ€ã€‚
é€šè¿‡æ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸‹é¢ä¸‰æ¡å®šç†ï¼š

- å®šç† 1ï¼šæ²¡æœ‰åç»§çŠ¶æ€çš„çŠ¶æ€æ˜¯å¿…è´¥çŠ¶æ€ã€‚
- å®šç† 2ï¼šä¸€ä¸ªçŠ¶æ€æ˜¯å¿…èƒœçŠ¶æ€å½“ä¸”ä»…å½“å­˜åœ¨è‡³å°‘ä¸€ä¸ªå¿…è´¥çŠ¶æ€ä¸ºå®ƒçš„åç»§çŠ¶æ€ã€‚
- å®šç† 3ï¼šä¸€ä¸ªçŠ¶æ€æ˜¯å¿…è´¥çŠ¶æ€å½“ä¸”ä»…å½“å®ƒçš„æ‰€æœ‰åç»§çŠ¶æ€å‡ä¸ºå¿…èƒœçŠ¶æ€ã€‚

å¯¹äºå®šç† 1ï¼Œå¦‚æœæ¸¸æˆè¿›è¡Œä¸ä¸‹å»äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªç©å®¶å°±è¾“æ‰äº†æ¸¸æˆã€‚

å¯¹äºå®šç† 2ï¼Œå¦‚æœè¯¥çŠ¶æ€è‡³å°‘æœ‰ä¸€ä¸ªåç»§çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€ï¼Œé‚£ä¹ˆç©å®¶å¯ä»¥é€šè¿‡æ“ä½œåˆ°è¯¥å¿…è´¥çŠ¶æ€ï¼›æ­¤æ—¶å¯¹æ‰‹çš„çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€â€”â€”å¯¹æ‰‹å¿…å®šæ˜¯å¤±è´¥çš„ï¼Œè€Œç›¸ååœ°ï¼Œè‡ªå·±å°±è·å¾—äº†èƒœåˆ©ã€‚

å¯¹äºå®šç† 3ï¼Œå¦‚æœä¸å­˜åœ¨ä¸€ä¸ªåç»§çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€ï¼Œé‚£ä¹ˆæ— è®ºå¦‚ä½•ï¼Œç©å®¶åªèƒ½æ“ä½œåˆ°å¿…èƒœçŠ¶æ€ï¼›æ­¤æ—¶å¯¹æ‰‹çš„çŠ¶æ€ä¸ºå¿…èƒœçŠ¶æ€â€”â€”å¯¹æ‰‹å¿…å®šæ˜¯èƒœåˆ©çš„ï¼Œè‡ªå·±å°±è¾“æ‰äº†æ¸¸æˆã€‚

å¦‚æœåšå¼ˆå›¾æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼Œåˆ™é€šè¿‡è¿™ä¸‰ä¸ªå®šç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»˜å‡ºåšå¼ˆå›¾çš„æƒ…å†µä¸‹ç”¨O(N+M)çš„æ—¶é—´ï¼ˆå…¶ä¸­Nä¸ºçŠ¶æ€ç§æ•°ï¼ŒMä¸ºè¾¹æ•°)å¾—å‡ºæ¯ä¸ªçŠ¶æ€æ˜¯å¿…èƒœçŠ¶æ€è¿˜æ˜¯å¿…è´¥çŠ¶æ€ã€‚

**Nimå’Œ**

é€šè¿‡ç»˜ç”»åšå¼ˆå›¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ $O(\prod_{i=1}^n a_i)$ çš„æ—¶é—´é‡Œæ±‚å‡ºè¯¥å±€é¢æ˜¯å¦å…ˆæ‰‹å¿…èµ¢ã€‚
ä½†æ˜¯ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦å®åœ¨å¤ªé«˜ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆå·§å¦™è€Œå¿«é€Ÿçš„æ–¹æ³•å‘¢ï¼Ÿ
å®šä¹‰ Nim å’Œ $=a_1 \oplus a_2 \oplus \ldots \oplus a_n$ã€‚
å½“ä¸”ä»…å½“ Nimå’Œä¸º $0$ æ—¶ï¼Œè¯¥çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€ï¼›å¦åˆ™è¯¥çŠ¶æ€ä¸ºå¿…èƒœçŠ¶æ€ã€‚

```cpp
//https://www.acwing.com/problem/content/893/
#include <iostream>
using namespace std;

int main(){
    int ans = 0;
    int n;cin >> n;
    for(int i = 1;i <= n;i++){
        int x;cin >> x;
        ans^=x;
    }
    if(ans) cout << "Yes";
    else cout << "No";
}
```



### SGå‡½æ•°

æœ‰å‘å›¾æ¸¸æˆæ˜¯ä¸€ä¸ªç»å…¸çš„åšå¼ˆæ¸¸æˆâ€”â€”å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†çš„å…¬å¹³ç»„åˆæ¸¸æˆéƒ½å¯ä»¥è½¬æ¢ä¸ºæœ‰å‘å›¾æ¸¸æˆã€‚
åœ¨ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ä¸­ï¼Œåªæœ‰ä¸€ä¸ªèµ·ç‚¹ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªæ£‹å­ï¼Œä¸¤ä¸ªç©å®¶è½®æµæ²¿ç€æœ‰å‘è¾¹æ¨åŠ¨æ£‹å­ï¼Œä¸èƒ½èµ°çš„ç©å®¶åˆ¤è´Ÿã€‚
å®šä¹‰ $\operatorname{mex}$ å‡½æ•°çš„å€¼ä¸ºä¸å±äºé›†åˆ $S$ ä¸­çš„æœ€å°éè´Ÿæ•´æ•°ï¼Œå³ï¼š
$$
\operatorname{mex}(S)=\min\{x\} \quad (x \notin S, x \in N)
$$

ä¾‹å¦‚ $\operatorname{mex}(\{0, 2, 4\})=1$ï¼Œ$\operatorname{mex}(\{1, 2\})=0$ã€‚

å¯¹äºçŠ¶æ€ $x$ å’Œå®ƒçš„æ‰€æœ‰ $k$ ä¸ªåç»§çŠ¶æ€ $y_1, y_2, \ldots, y_k$ï¼Œå®šä¹‰ $\operatorname{SG}$ å‡½æ•°ï¼š

$$
\operatorname{SG}(x)=\operatorname{mex}\{\operatorname{SG}(y_1), \operatorname{SG}(y_2), \ldots, \operatorname{SG}(y_k)\}
$$

è€Œå¯¹äºç”± $n$ ä¸ªæœ‰å‘å›¾æ¸¸æˆç»„æˆçš„ç»„åˆæ¸¸æˆï¼Œè®¾å®ƒä»¬çš„èµ·ç‚¹åˆ†åˆ«ä¸º $s_1, s_2, \ldots, s_n$ï¼Œåˆ™æœ‰å®šç†ï¼š**å½“ä¸”ä»…å½“ $\operatorname{SG}(s_1) \oplus \operatorname{SG}(s_2) \oplus \ldots \oplus \operatorname{SG}(s_n) \neq 0$ æ—¶ï¼Œè¿™ä¸ªæ¸¸æˆæ˜¯å…ˆæ‰‹å¿…èƒœçš„ã€‚åŒæ—¶ï¼Œè¿™æ˜¯è¿™ä¸€ä¸ªç»„åˆæ¸¸æˆçš„æ¸¸æˆçŠ¶æ€ $x$ çš„ SG å€¼ã€‚**

è¿™ä¸€å®šç†è¢«ç§°ä½œ **Spragueâ€“Grundy å®šç†**(Spragueâ€“Grundy Theorem), ç®€ç§° SG å®šç†ï¼Œé€‚ç”¨äºä»»ä½•å…¬å¹³çš„ä¸¤äººæ¸¸æˆ, å®ƒå¸¸è¢«ç”¨äºå†³å®šæ¸¸æˆçš„è¾“èµ¢ç»“æœã€‚



è®¡ç®—ç»™å®šçŠ¶æ€çš„ Grundy å€¼çš„æ­¥éª¤ä¸€èˆ¬åŒ…æ‹¬ï¼š

-   è·å–ä»æ­¤çŠ¶æ€æ‰€æœ‰å¯èƒ½çš„è½¬æ¢ï¼›

-   æ¯ä¸ªè½¬æ¢éƒ½å¯ä»¥å¯¼è‡´ **ä¸€ç³»åˆ—ç‹¬ç«‹çš„åšå¼ˆ**ï¼ˆé€€åŒ–æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªï¼‰ã€‚è®¡ç®—æ¯ä¸ªç‹¬ç«‹åšå¼ˆçš„ Grundy å€¼å¹¶å¯¹å®ƒä»¬è¿›è¡Œ **å¼‚æˆ–æ±‚å’Œ**ã€‚

-   åœ¨ä¸ºæ¯ä¸ªè½¬æ¢è®¡ç®—äº† Grundy å€¼ä¹‹åï¼ŒçŠ¶æ€çš„å€¼æ˜¯è¿™äº›æ•°å­—çš„ $\operatorname{mex}$ã€‚

-   å¦‚æœè¯¥å€¼ä¸ºé›¶ï¼Œåˆ™å½“å‰çŠ¶æ€ä¸ºè¾“ï¼Œå¦åˆ™ä¸ºèµ¢ã€‚



**å°† Nim æ¸¸æˆè½¬æ¢ä¸ºæœ‰å‘å›¾æ¸¸æˆ**

æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæœ‰ $x$ ä¸ªç‰©å“çš„å †è§†ä¸ºèŠ‚ç‚¹ $x$ï¼Œåˆ™å½“ä¸”ä»…å½“ $y<x$ æ—¶ï¼ŒèŠ‚ç‚¹ $x$ å¯ä»¥åˆ°è¾¾ $y$ã€‚
é‚£ä¹ˆï¼Œç”± $n$ ä¸ªå †ç»„æˆçš„ Nim æ¸¸æˆï¼Œå°±å¯ä»¥è§†ä¸º $n$ ä¸ªæœ‰å‘å›¾æ¸¸æˆäº†ã€‚
æ ¹æ®ä¸Šé¢çš„æ¨è®ºï¼Œå¯ä»¥å¾—å‡º $\operatorname{SG}(x)=x$ã€‚å†æ ¹æ® SG å®šç†ï¼Œå°±å¯ä»¥å¾—å‡º Nim å’Œçš„ç»“è®ºäº†ã€‚



[893. é›†åˆ-Nimæ¸¸æˆ - AcWingé¢˜åº“](https://www.acwing.com/problem/content/895/)

> ç»™å®šnå †çŸ³å­å’Œä¸€ä¸ªç”±mä¸ªä¸åŒæ­£æ•´æ•°æ„æˆçš„æ•°å­—é›†åˆSã€‚ä¸¤ä½ç©å®¶è½®æµæ“ä½œï¼Œæ¯æ¬¡å¯ä»¥ä»ä»»æ„ä¸€å †çŸ³å­ä¸­æ‹¿å–çŸ³å­ï¼Œæ¯æ¬¡æ‹¿å–çš„çŸ³å­æ•°é‡å¿…é¡»åŒ…å«äºé›†åˆSï¼Œåˆ¤æ–­å…ˆæ‰‹æ˜¯å¦å¿…èƒœï¼Ÿ

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
#include <set>
using namespace std;
const int N = 105,M = 10004;
int n,m;
int f[M],s[N];//få‚¨å­˜æ‰€æœ‰æƒ…å†µçš„sgå€¼ï¼Œså­˜å¯ä¾›é€‰æ‹©çš„é›†åˆ

int sg(int x){
	if(f[x] != -1) return f[x];//å¦‚æœå½“å‰æ•°çš„sgå·²ç»ç¡®å®šï¼Œç›´æ¥è¿”å›å³å¯
	set<int>st;
	for(int i = 0;i < m;i++){
		if(x >= s[i]) st.insert(sg(x-s[i]));//setå­˜å½“å‰èƒ½åˆ°è¾¾çŠ¶æ€çš„æ‰€æœ‰sgå€¼
	}
	for(int i = 0;;i++){
		if(st.find(i) == st.end()) {
			return  f[x] = i;//f[x] = ä¸å±äºé›†åˆsetçš„æœ€å°éè´Ÿæ•´æ•°
		}
	}
}

int main(){
	memset(f,-1,sizeof f);
	cin >> m;
	for(int i = 0;i < m;i++)cin >> s[i];
    
	cin >> n;
	int ans = 0;
	for(int i = 0;i < n;i++){
		int x;cin >> x;
		ans^=sg(x);
	}
	if(ans) cout << "Yes";
	else cout << "No";
}
```



[VS AtCoderï¼ˆâ˜…6ï¼‰ - AtCoder typical90_ae - Virtual Judge (vjudge.net)](https://vjudge.net/problem/AtCoder-typical90_ae#author=GPT_zh)

> ç»™å®šnå †çŸ³å­ï¼Œæ¯å †çŸ³å­ç”±w[i]é¢—ç™½çŸ³å’Œb[i]é¢—è“çŸ³ã€‚ä¸¤äººè½®æµè¿›è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š
>
> - é€‰æ‹©ä¸€å †ç™½çŸ³w >= 1çš„çŸ³å­ï¼Œå‘é€‰æ‹©çš„çŸ³å­ä¸­åŠ å…¥wé¢—è“çŸ³ï¼Œç„¶åç§»é™¤1é¢—ç™½çŸ³ã€‚
> - é€‰æ‹©ä¸€å †è“çŸ³b >= 2çš„çŸ³å­ï¼Œç§»é™¤ké¢—è“çŸ³å­ï¼Œå…¶ä¸­$1 \le k \le \lfloor \frac{b}{2} \rfloor$ã€‚
>
> æœ€åæ— æ³•æ“ä½œçš„è¾“æ‰æ¯”èµ›ã€‚

```cpp
#include <iostream>
#include <set>
#include <cstring>
using namespace std;
const int N = 100005;
int w[N],b[N];
int f[55][1505];

int sg(int x,int y){
	if(f[x][y] != -1) return f[x][y];
	set<int>se;
	if(x >= 1) se.insert(sg(x-1,y+x));
	if(y >= 2) {
		for(int i = 1;i*2 <= y;i++){
			se.insert(sg(x,y-i));
		}
	}
	for(int i = 0;;i++){
		if(se.find(i) == se.end()){
			return f[x][y] = i;
		}
	}
}

int main(){
	memset(f,-1,sizeof f);
	int n;cin >> n;
	for(int i = 1;i <= n;i++) cin >> w[i];
	for(int i = 1;i <= n;i++) cin >> b[i];

	int ans = 0;
	for(int i = 1;i <= n;i++){
		ans ^= sg(w[i],b[i]);
	}
	if(ans) cout << "First";
	else cout << "Second";
}
```





## è®¡ç®—å‡ ä½•



### è·ç¦»

| è·ç¦»         | äºŒç»´è®¡ç®—                                  | å¤šç»´è®¡ç®—                                                     |
| ------------ | ----------------------------------------- | ------------------------------------------------------------ |
| æ¬§æ°è·ç¦»     | $|AB| = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$ | ä¸‰ç»´ï¼š$|AB| = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2 + (z_2-z_1)^2}$ |
| æ›¼å“ˆé¡¿è·ç¦»   | $d(A,B) = |x_1-x_2| + |y_1-y_2|$          | nç»´ï¼š$d(A,B) = \sum_{i=1}^{n}|x_i-y_i|$                      |
| åˆ‡æ¯”é›ªå¤«è·ç¦» | $d(A,B) = max(|x_1-x_2|, |y_1-y_2|)$      | nç»´ï¼š$d(A,B) = max\{|x_i-y_i|\}(i\in [1,n])$                 |



**æ›¼å“ˆé¡¿è·ç¦»ä¸åˆ‡æ¯”é›ªå¤«è·ç¦»è½¬æ¢**

æ›¼å“ˆé¡¿->åˆ‡æ¯”é›ªå¤« ï¼š $(x,y) \Rightarrow (x+y,x-y)$ 

åˆ‡æ¯”é›ªå¤«->æ›¼å“ˆé¡¿ ï¼š $(x,y)\Rightarrow (\frac{x+y}{2},\frac{x-y}{2})$ï¼Œä¸€èˆ¬ä¸ºäº†é¿å…å°æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ¨ªçºµåæ ‡åŒæ—¶ä¹˜2(å³è½¬æ¢æ—¶ä¸é™¤ä»¥2)ï¼Œæœ€åç­”æ¡ˆé™¤ä»¥2ã€‚

æ›¼å“ˆé¡¿åæ ‡ç³»æ˜¯é€šè¿‡åˆ‡æ¯”é›ªå¤«åæ ‡ç³»æ—‹è½¬ $45^\circ$ åï¼Œå†ç¼©å°åˆ°åŸæ¥çš„ä¸€åŠå¾—åˆ°çš„ã€‚ç¢°åˆ°æ±‚åˆ‡æ¯”é›ªå¤«è·ç¦»æˆ–æ›¼å“ˆé¡¿è·ç¦»çš„é¢˜ç›®æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€å¯ä»¥ç›¸äº’è½¬åŒ–æ¥æ±‚è§£ã€‚ä¸¤ç§è·ç¦»åœ¨ä¸åŒçš„é¢˜ç›®ä¸­æœ‰ä¸åŒçš„ä¼˜ç¼ºç‚¹ï¼Œåº”è¯¥çµæ´»è¿ç”¨ã€‚



[P5098 [USACO04OPEN\] Cave Cows 3 - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P5098)

> æ±‚å¹³é¢å†…ä»»æ„ä¸€ç‚¹åˆ°å…¶å®ƒç‚¹çš„æœ€å¤§è·ç¦»

ç›´æ¥æ›¼å“ˆé¡¿è½¬åˆ‡æ¯”é›ªå¤«åæ ‡ï¼Œç­”æ¡ˆå°±æ˜¯max(å½“å‰çš„ç‚¹çš„ x å’Œ xçš„æå€¼åšå·®çš„ç»å¯¹å€¼ , å½“å‰çš„ç‚¹çš„ y å’Œ y çš„æå€¼åšå·®çš„ç»å¯¹å€¼çš„)

```cpp
#include <iostream>
#include <algorithm>
#include <vector>
#include <tuple>
using namespace std;
const int N = 100005;
int n;
vector<long long>dx,dy;

struct node{
	int x,y;
}p[N];

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		auto &[x,y] = p[i];cin >> x >> y;
		tie(x,y) = pair{x+y,x-y};
		dx.emplace_back(x);//ä¹Ÿå¯ä»¥ç”¨4ä¸ªå˜é‡åˆ†åˆ«ç»´æŠ¤xå’Œyçš„æå¤§å€¼å’Œæå°å€¼ï¼ŒO(N)
		dy.emplace_back(y);
	}
	sort(dx.begin(),dx.end());
	sort(dy.begin(),dy.end());
	long long ans = 0;
	for(int i = 1;i <= n;i++){
		auto [x,y] = p[i];
		long long nx = max(abs(dx.back()-x),abs(dx[0]-x));
		long long ny = max(abs(dy.back()-y),abs(dy[0]-y));
		long long now = max(nx,ny);
		ans = max(ans,now);
	}
	cout << ans;
}
```



### æ‰«æçº¿

æ‰«æçº¿çš„æ€è·¯å°±æ˜¯æ•°æ®ç»“æ„ç»´æŠ¤ä¸€ç»´ï¼Œæš´åŠ›æ¨¡æ‹Ÿå¦ä¸€ç»´ã€‚



#### é¢ç§¯å¹¶

<img src="https://oi-wiki.org/geometry/images/scanning.svg" alt="img" style="zoom:50%;" /> 



[P5490 ã€æ¨¡æ¿ã€‘æ‰«æçº¿ & çŸ©å½¢é¢ç§¯å¹¶ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P5490)

ç»™æ¯ä¸€ä¸ªçŸ©å½¢çš„ä¸Šä¸‹è¾¹è¿›è¡Œæ ‡è®°ï¼Œä¸‹é¢çš„è¾¹æ ‡è®°ä¸º 1ï¼Œä¸Šé¢çš„è¾¹æ ‡è®°ä¸º -1ã€‚æ¯é‡åˆ°ä¸€ä¸ªæ°´å¹³è¾¹æ—¶ï¼Œè®©è¿™æ¡è¾¹ï¼ˆåœ¨æ¨ªè½´æŠ•å½±åŒºé—´ï¼‰çš„æƒå€¼åŠ ä¸Šè¿™æ¡è¾¹çš„æ ‡è®°ã€‚å½“å‰çš„å®½åº¦å°±æ˜¯æ•´ä¸ªæ•°è½´ä¸Šæƒå€¼å¤§äº 0 çš„åŒºé—´æ€»é•¿åº¦ï¼Œæ€»é¢ç§¯å³ä¸º$\sum {(çº¿æ®µé•¿åº¦*æ‰«è¿‡çš„é«˜åº¦)}$

```
çº¿æ®µæ ‘ç»´æŠ¤çš„æ˜¯åŒºé—´æ®µ(å·¦é—­å³å¼€)è€Œä¸æ˜¯ç¦»æ•£ç‚¹
ç‚¹ï¼š   1     3     5     7
åŒºé—´ï¼š [1,3) [3,5) [5,7)
ç´¢å¼•ï¼š  1      2      3
modifyå½“å¤„ç†çŸ©å½¢è¾¹[1,5]æ—¶,è¦†ç›–çš„åŒºé—´æ®µç´¢å¼• = [hs[1],hs[5]-1] = [1,2]
pushupè®¡ç®—èŠ‚ç‚¹på¯¹åº”åŒºé—´æ®µæ—¶,èŠ‚ç‚¹pçš„å·¦å³ç«¯ç‚¹[1,2],å¯¹åº”åŒºé—´[v[1],v[2+1]) = [1,5)
```



```cpp
#include <iostream>
#include <algorithm>
#include <vector>

const int N = 200005;
int n;
std::vector<int>hs(1,-2e9);

struct line{//ä»ä¸‹å¾€ä¸Šæ‰«æ
	int l,r,h;//è®°å½•æ¯æ¡çº¿å…¶å·¦å³åŒºé—´[l,r]å’Œæ‰€åœ¨é«˜åº¦h
	int w;//w=1ä¸ºä¸‹è¾¹,w=-1ä¸ºä¸Šè¾¹
	bool operator < (const line &e2)const{
		if(h == e2.h) return w > e2.w;
		return h < e2.h;
	}
};

struct ST{
	int l,r;
	int cnt,len;//cnt:è¢«è¦†ç›–æ¬¡æ•°,len:è¦†ç›–é•¿åº¦
}t[N<<2];

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r) {
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
}

void pushup(int p){
	if(t[p].cnt){//å®Œå…¨è¦†ç›–,å–æ•´ä¸ªåŒºé—´é•¿åº¦
		t[p].len = hs[t[p].r+1] - hs[t[p].l]; 
	}
	else{
		if(t[p].l == t[p].r) t[p].len = 0; //å¶å­èŠ‚ç‚¹ä¸”æœªè¦†ç›–
		else t[p].len = t[p<<1].len + t[p<<1|1].len; //åˆå¹¶å­èŠ‚ç‚¹
	}
}

void modify(int p,int l,int r,int x){
	if(l <= t[p].l && r >= t[p].r){
		t[p].cnt += x;
		pushup(p);//æ›´æ–°å½“å‰èŠ‚ç‚¹,æ ‡è®°æ°¸ä¹…åŒ–(åˆ©ç”¨è¦†ç›–è®¡æ•°çš„ç‰¹æ€§)
		return;
	}//ä¸éœ€è¦pushdownä¸‹ä¼ æ ‡è®°
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) modify(p<<1,l,r,x);
	if(r > mid) modify(p<<1|1,l,r,x);
	pushup(p);//æ›´æ–°å½“å‰èŠ‚ç‚¹
}

int main(){
	std::cin >> n;
	std::vector<line>e(1);
	for(int i = 1;i <= n;i++){//è¯»å…¥åæ ‡,å¹¶è½¬åŒ–ä¸ºçº¿
		int x1,y1,x2,y2;std::cin >> x1 >> y1 >> x2 >> y2;
		e.push_back({x1,x2,y1,1});
		e.push_back({x1,x2,y2,-1});
		hs.push_back(x1);
		hs.push_back(x2);
	}
	//ç¦»æ•£åŒ–
	std::sort(e.begin()+1,e.end());
	std::sort(hs.begin()+1,hs.end());
	hs.erase(std::unique(hs.begin()+1,hs.end()),hs.end());
	int m = hs.size()-1;
	for(int i = 1;i <= n << 1;i++){
		e[i].l = std::lower_bound(hs.begin()+1,hs.end(),e[i].l) - hs.begin();
		e[i].r = std::lower_bound(hs.begin()+1,hs.end(),e[i].r) - hs.begin();
	}

	build(1,1,m-1);//å»ºæ ‘èŒƒå›´ä¸ºåŒºé—´æ®µä¸ªæ•°,mä¸ªç‚¹å¯¹åº”m-1ä¸ªåŒºé—´(å¼€mä¸ªä¹Ÿæ²¡å…³ç³»)

	long long ans = 0;
	for(int i = 1;i <= n << 1;i++){//æœ€åä¸€æ¡è¾¹ä¸ç”¨ç´¯åŠ ä¸Šç­”æ¡ˆ,ä½†ä»éœ€è¦modifyå¤„ç†,å¦åˆ™å¤šæµ‹ä¼šå¯¼è‡´çº¿æ®µæ ‘æ•°æ®æ®‹ç•™
		auto &[l,r,h,w] = e[i];
		modify(1,l,r-1,w);//å·¦é—­å³å¼€åŒºé—´
		if(i < n << 1) ans += (long long)t[1].len * (e[i+1].h - e[i].h);//é¢ç§¯+=å½“å‰å…¨å±€è¦†ç›–é•¿åº¦*ä¸Šä¸‹é«˜åº¦å·®
	}
	std::cout << ans;
}
```



#### å‘¨é•¿å¹¶

[P1856 [IOI 1998\][USACO5.5] çŸ©å½¢å‘¨é•¿ Picture - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P1856)

<img src="https://img.ffis.me/images/2019/08/10/image875b5bc59b29c404.png" alt="image875b5bc59b29c404.png" style="zoom: 25%;" /><img src="https://img.ffis.me/images/2019/08/10/imaged3ade113f8ed97a4.png" alt="imaged3ade113f8ed97a4.png" style="zoom:25%;" /> 

æ¨ªè¾¹çš„æ€»é•¿åº¦ = $\sum |å½“å‰æˆªå¾—çš„æ€»é•¿åº¦ - ä¸Šæ¬¡æˆªå¾—çš„æ€»é•¿åº¦|$
ç«–è¾¹çš„æ€»é•¿åº¦ = $\sum (2\times å½“å‰çº¿æ®µæ¡æ•°\times æ‰«è¿‡çš„é«˜åº¦)$

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

const int N = 10004;
int n;
std::vector<int>hs(1,-2e9);

struct line{
	int l,r,h,w;
	bool operator < (const line &e2) const{
		if(h == e2.h) return w > e2.w;//é«˜åº¦ç›¸åŒå…ˆæ‰«æåº•è¾¹,å¦åˆ™ä¼šå¤šç®—è¿™æ¡è¾¹
		return h < e2.h;
	}
};

struct ST{
	int l,r;
	int len,cnt;
	int c;//c:åŒºé—´çº¿æ®µæ¡æ•°
	bool lc,rc;//lcã€rc:å·¦å³ç«¯ç‚¹æ˜¯å¦è¢«è¦†ç›–,è¾…åŠ©è®¡ç®—c
}t[N<<2];

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
}

void pushup(int p){
	if(t[p].cnt){//å½“å‰åŒºé—´å®Œå…¨è¢«è¦†ç›–
		t[p].len = hs[t[p].r+1] - hs[t[p].l];
		t[p].lc = t[p].rc = t[p].c = 1;
	}
	else{
		if(t[p].l == t[p].r) {//å½“å‰åŒºé—´æœªè¢«è¦†ç›–ä¸”ä¸ºå­åŒºé—´
			t[p].len = 0;
			t[p].lc = t[p].rc = t[p].c = 0;
		}
		else {//åˆå¹¶ä¸¤ä¸ªå­åŒºé—´
			t[p].len = t[p<<1].len + t[p<<1|1].len;
			t[p].lc = t[p<<1].lc;
			t[p].rc = t[p<<1|1].rc;
			t[p].c = t[p<<1].c + t[p<<1|1].c;
			if(t[p<<1].rc && t[p<<1|1].lc) t[p].c--;
		}
	}
}

void modify(int p,int l,int r,int x){
	if(l <= t[p].l && r >= t[p].r){
		t[p].cnt += x;
		pushup(p);
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) modify(p<<1,l,r,x);
	if(r > mid) modify(p<<1|1,l,r,x);
	pushup(p);
}

int main(){
	std::cin >> n;
	std::vector<line>e(1);
	for(int i = 1;i <= n;i++){
		int x1,y1,x2,y2;std::cin >> x1 >> y1 >> x2 >> y2;
		e.push_back({x1,x2,y1,1});
		e.push_back({x1,x2,y2,-1});
		hs.push_back(x1);
		hs.push_back(x2);
	}

	std::sort(e.begin()+1,e.end());
	std::sort(hs.begin()+1,hs.end());
	hs.erase(std::unique(hs.begin()+1,hs.end()),hs.end());
	for(int i = 1;i <= n << 1;i++){
		e[i].l = std::lower_bound(hs.begin()+1,hs.end(),e[i].l) - hs.begin();
		e[i].r = std::lower_bound(hs.begin()+1,hs.end(),e[i].r) - hs.begin();
	}
	int m = hs.size() - 1;

	build(1,1,m-1);

	long long ans = 0;
	long long last = 0;
	for(int i = 1;i <= n << 1;i++){
		auto &[l,r,h,w] = e[i];
		modify(1,l,r-1,w);
		ans += std::abs(t[1].len - last);//è®¡ç®—æ¨ªè¾¹(i <= 2*n)
		last = t[1].len;
		if(i < n << 1) ans += 2 * t[1].c * (e[i+1].h - e[i].h);//è®¡ç®—ç«–è¾¹(i <= 2*n-1)
	}
	std::cout << ans;
}
```





#### äºŒç»´æ•°ç‚¹

[U245713 ã€æ¨¡æ¿ã€‘ äºŒç»´æ•°ç‚¹ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/U245713)

> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º`n`çš„åºåˆ—`a[]`ï¼Œç„¶åè¿›è¡Œ`m`æ¬¡è¯¢é—®ï¼šæ±‚åŒºé—´`[l,r]`å†…å¤§å°åœ¨`[x,y]`èŒƒå›´å†…çš„æ•°çš„ä¸ªæ•°ã€‚

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250707030246376.png" alt="image-20250707030246376" style="zoom: 50%;" /> 
æŠŠ`a[i]`çœ‹ä½œå¹³é¢ä¸Šçš„ä¸€ä¸ªç‚¹`(i,a[i])`ï¼Œè¯¢é—®å³ä¸ºæ±‚çŸ©å½¢å†…åŒ…å«å¤šå°‘ä¸ªç‚¹ã€‚
æˆ‘ä»¬å°†è¯¢é—®**ç¦»çº¿**ï¼Œç”¨ä¸€æ¡çº¿ä»å·¦å¾€å³æ‰«æï¼Œæ¯é‡åˆ°ä¸€ä¸ªç‚¹å°±æŠŠå®ƒåŠ å…¥ä¸€ä¸ªé›†åˆï¼Œè¡¨ç¤ºå½“å‰æ‰€æœ‰æ‰«è¿‡çš„ç‚¹ï¼Œç”¨æƒå€¼**æ ‘çŠ¶æ•°ç»„**ç»´æŠ¤é›†åˆã€‚æ¯ä¸ªè¯¢é—®çš„ç­”æ¡ˆå³ä¸º`1~r`å†…ä½äº`[x,y]`çš„æ•°çš„ä¸ªæ•°å‡å»`1~l-1`å†…ä½äº`[x,y]`çš„æ•°çš„ä¸ªæ•°ã€‚

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

const int N = 1000006;

struct ask{
	int l,r,x,y; 
};

struct node{
	int x,y,w,id;//w = 1è¡¨ç¤ºå½“å‰ä¸ºr,w = -1è¡¨ç¤ºå½“å‰ä¸ºl-1
};
std::vector<node>e[N];

int t[N*3],siz;//å¯¹ç¦»æ•£åŒ–åçš„a[],x[],y[]å»ºç«‹æƒå€¼æ ‘çŠ¶æ•°ç»„,è‡³å°‘å¼€ä¸‰å€å¤§å°
void add(int i,int x){
	while(i <= siz){
		t[i] += x;
		i += i&-i;
	}
}
int query(int i){
	int res = 0;
	while(i){
		res += t[i];
		i -= i&-i;
	}
	return res;
}

std::vector<int> sol(std::vector<int>&a,std::vector<ask>&q){
	std::vector<int>ans(q.size());
	std::vector<int>hs(1,-2e9);

	for(int i = 1;i < a.size();i++){
		hs.push_back(a[i]);
	}

	for(int i = 1;i < q.size();i++){
		auto &[l,r,x,y] = q[i];
		hs.push_back(x);
		hs.push_back(y);
	}

	std::sort(hs.begin()+1,hs.end());
	hs.erase(std::unique(hs.begin()+1,hs.end()));

	siz = hs.size();

	for(int i = 1;i < a.size();i++){
		a[i] = std::lower_bound(hs.begin()+1,hs.end(),a[i]) - hs.begin();
	}
	for(int i = 1;i < q.size();i++){
		auto &[l,r,x,y] = q[i];
		x = std::lower_bound(hs.begin()+1,hs.end(),x) - hs.begin();
		y = std::lower_bound(hs.begin()+1,hs.end(),y) - hs.begin();
		e[l-1].push_back({x,y,-1,i});
		e[r].push_back({x,y,1,i});
	}

	for(int i = 1;i < a.size();i++){
		add(a[i],1);
		for(auto &[x,y,w,id]:e[i]){
			ans[id] += w*(query(y) - query(x-1));//query(y) - query(x-1)å³ä¸ºå½“å‰ä½äº[x,y]çš„ç‚¹çš„ä¸ªæ•°
		}
	}
	return ans;
}

int main(){
	std::ios::sync_with_stdio(false);std::cin.tie(0);
	int n,m; std::cin >> n >> m;
	std::vector<int> a(n+1);
	std::vector<ask> q(m+1);
	for(int i = 1;i <= n;i++){
		std::cin >> a[i];
	}

	for(int i = 1;i <= m;i++){
		auto &[l,r,x,y] = q[i];
		std::cin >> l >> r >> x >> y;
	}

	auto ans = sol(a,q);

	for(int i = 1;i <= m;i++){
		std::cout << ans[i] << '\n';
	}
}
```

ç±»ä¼¼çš„ï¼Œè¯ºç»™å®šäºŒç»´å¹³é¢ä¸Šçš„ç‚¹é›†`[x,y]`ï¼Œç„¶åç»™å‡ºè¯ºå¹²ä¸ªè¯¢é—®æ±‚çŸ©å½¢`[x1,y1,x2,y2]`å†…æœ‰å¤šå°‘ä¸ªç‚¹ï¼Œåˆ™éœ€è¦åˆ†åˆ«å°†æ‰€æœ‰æ¨ªçºµåæ ‡éƒ½ç¦»æ•£åŒ–ã€‚ä¾‹é¢˜[P2163 [SHOI2007\] å›­ä¸çš„çƒ¦æ¼ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P2163)

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

const int N = 500005;

struct Point{
	int x,y;
};

struct Ask{
	int x1,y1,x2,y2;
};

struct Node{
	int x,y,w,id;
};
std::vector<Node>e[N*3];//x,x1,x2

int t[N*3],siz;//y,y1,y1
void add(int i,int x){
	while(i <= siz){
		t[i] += x;
		i += i&-i;
	}
}
int query(int i){
	int res = 0;
	while(i){
		res += t[i];
		i -= i&-i;
	}
	return res;
}

std::vector<int> sol(std::vector<Point>&p,std::vector<Ask>&ask){
	std::vector<int> ans(ask.size());
	std::vector<int> dx(1,-2e9),dy(1,-2e9);
	for(int i = 1;i < p.size();i++){
		auto &[x,y] = p[i];
		dx.push_back(x);
		dy.push_back(y);
	}

	for(int i = 1;i < ask.size();i++){
		auto &[x1,y1,x2,y2] = ask[i];
		dx.push_back(x1); dx.push_back(x2);
		dy.push_back(y1); dy.push_back(y2);
	}

	std::sort(dx.begin()+1,dx.end()); dx.erase(std::unique(dx.begin()+1,dx.end()),dx.end());
	std::sort(dy.begin()+1,dy.end()); dy.erase(std::unique(dy.begin()+1,dy.end()),dy.end());
	siz = dy.size()-1;

	for(int i = 1;i < p.size();i++){
		auto &[x,y] = p[i];
		x = std::lower_bound(dx.begin()+1,dx.end(),x) - dx.begin();
		y = std::lower_bound(dy.begin()+1,dy.end(),y) - dy.begin();
		e[x].push_back({y,y,0,0});
	}

	for(int i = 1;i < ask.size();i++){
		auto &[x1,y1,x2,y2] = ask[i];
		x1 = std::lower_bound(dx.begin()+1,dx.end(),x1) - dx.begin();
		x2 = std::lower_bound(dx.begin()+1,dx.end(),x2) - dx.begin();
		y1 = std::lower_bound(dy.begin()+1,dy.end(),y1) - dy.begin();
		y2 = std::lower_bound(dy.begin()+1,dy.end(),y2) - dy.begin();
		e[x1-1].push_back({y1,y2,-1,i});
		e[x2].push_back({y1,y2,1,i});
	}

    //è¿™é‡Œæ²¡æœ‰åˆ†å¼€å°†ç‚¹å’Œè¯¢é—®åˆ†å¼€å­˜å‚¨,è€Œæ˜¯ç”¨e[i].wä¸º0æˆ–è€…1/-1,è¡¨ç¤ºå½“å‰æ˜¯ç‚¹è¿˜æ˜¯è¯¢é—®ã€‚å› ä¸ºæ˜¯å…ˆpushç‚¹,å†pushè¯¢é—®,ä¿è¯äº†å¤„ç†è¯¢é—®å‰ä¼šå…ˆå¤„ç†ä¸è¯¢é—®ç›¸å…³çš„ç‚¹
	for(int i = 1;i < dx.size();i++){
		for(auto &[y1,y2,w,id]:e[i]){
			if(w == 0){ add(y1,1); }//æ‰«æåˆ°ç‚¹,åˆ™å°†ç‚¹åŠ å…¥é›†åˆ
			else{ ans[id] += w*(query(y2) - query(y1-1)); }//å¦åˆ™å¤„ç†è¯¢é—®
		}
	}
	return ans;
}

int main(){
	int n,m; std::cin >> n >> m;
	std::vector<Point>p(n+1); 
	std::vector<Ask>ask(m+1);
	for(int i = 1;i <= n;i++){
		auto &[x,y] = p[i];
		std::cin >> x >> y;
	}

	for(int i = 1;i <= m;i++){
		auto &[x1,y1,x2,y2] = ask[i];
		std::cin >> x1 >> y1 >> x2 >> y2;
	}

	auto ans = sol(p,ask);

	for(int i = 1;i <= m;i++){
		std::cout << ans[i] << '\n';
	}
}
```



### å¹³é¢å‡ ä½•



#### ç‚¹çº¿å°è£…


| ç‚¹ã€å‘é‡  Point<T>p1(x1,y1);   |                                                      |                                                              |
| ------------------------------ | ---------------------------------------------------- | ------------------------------------------------------------ |
| `p1 +- p2`                     | å‘é‡åŠ å‡                                             | $\vec{p_1} + \vec{p_2} = (x_1 + x2 , y_1 + y_2)$             |
| `p */ x`                       | å‘é‡ä¹˜é™¤æ ‡é‡                                         | $v\ \vec{p_1} = (x_1 \times v,y_1 \times v)$                 |
| `dot(p1,p2)`                   | ç‚¹ç§¯                                                 | $\vec{p_1} \cdot \vec{p_2} = x_1x_2 + y_1y_2 = |\vec{p_1} \| \vec{p_2}| cos \theta$ |
| `cross(p1,p2)`                 | å‰ç§¯                                                 | $\vec{p_1}\times  \vec{p_2} = x_1y_2 - x_2y_1 = |\vec{p_1}||\vec{p_2}|sin\theta \vec{n}$ |
| `length(p)`                    | å‘é‡çš„æ¨¡                                             | $|\vec{p_1}| = \sqrt{x_1^2 + y_1^2}$                         |
| `normalize(p)`                 | å•ä½å‘é‡                                             | $\hat{p_1} = \frac{\vec{p_1}}{|\vec{p_1}|}$                  |
| `distance(p1,p2)`              | ä¸¤ç‚¹ä¹‹é—´è·ç¦»ï¼ˆæ¬§å‡ é‡Œå¾—è·ç¦»ï¼‰                         |                                                              |
| `rotate(p)`                    | å‘é‡é€†æ—¶é’ˆæ—‹è½¬90åº¦                                   |                                                              |
| `sgn(p)`                       | åˆ¤æ–­å‘é‡æ‰€åœ¨è±¡é™ï¼ˆä¸€/å››:1ï¼ŒäºŒ/ä¸‰:-1ï¼‰                |                                                              |
| `pointInPolygon(p,vec<Point>)` | åˆ¤æ–­$ç‚¹$æ˜¯å¦åœ¨$å¤šè¾¹å½¢$å†…éƒ¨æˆ–å¤šè¾¹å½¢è¾¹ä¸Š(å°„çº¿æ³•,0_idx) | å¤šè¾¹å½¢çš„ç‚¹éœ€è¦æŒ‰é¡º/é€†æ—¶é’ˆé¡ºåºæ’åˆ—ï¼Œä»…æ”¯æŒç®€å•å¤šè¾¹å½¢(ä¸è‡ªäº¤)  |

| çº¿  Line<T>l1({x1,y1},{x2,y2});  |                                                       |                                                              |
| -------------------------------- | ----------------------------------------------------- | ------------------------------------------------------------ |
| `length(l)`                      | $çº¿æ®µ$é•¿åº¦                                            |                                                              |
| `distancePS(p,l)`                | $ç‚¹$åˆ°$çº¿æ®µ$Segmentè·ç¦»                               |                                                              |
| `pointOnSegment(p,l)`            | åˆ¤æ–­$ç‚¹$æ˜¯å¦åœ¨$çº¿æ®µ$ä¸Š                                |                                                              |
| `distanceSS(l1,l2)`              | ä¸¤$çº¿æ®µ$æœ€çŸ­è·ç¦»                                      |                                                              |
| `segmentIntersection(l1,l2)`     | $çº¿æ®µ$ç›¸äº¤åˆ¤å®š <br/>è¿”å›å€¼:`tuple(ç±»å‹,äº¤ç‚¹1,äº¤ç‚¹2)`  | 0:ä¸ç›¸äº¤<br/>1:ä¸¥æ ¼ç›¸äº¤(äº¤ç‚¹åœ¨ä¸¤çº¿æ®µå†…éƒ¨)<br/>2:é‡å (è¿”å›é‡å éƒ¨åˆ†çš„ä¸¤ä¸ªç«¯ç‚¹)<br/>3:ç«¯ç‚¹ç›¸äº¤(äº¤ç‚¹ä¸ºçº¿æ®µç«¯ç‚¹) |
| `segmentInPolygon(l,vec<Point>)` | $çº¿æ®µ$æ˜¯å¦åœ¨$å¤šè¾¹å½¢$å†…éƒ¨                              | (éœ€æ»¡è¶³:ç«¯ç‚¹åœ¨å†…ä¸”ä¸ä¸ä»»ä½•è¾¹$ä¸¥æ ¼ç›¸äº¤$)ã€‚å¤šå˜å½¢çš„ç‚¹éœ€è¦æŒ‰é¡º/é€†æ—¶é’ˆé¡ºåºæ’åˆ— |
| `distancePL(p,l)`                | $ç‚¹$åˆ°$ç›´çº¿$Lineè·ç¦»                                  |                                                              |
| `parallel(l1,l2)`                | åˆ¤æ–­ä¸¤$ç›´çº¿$æ˜¯å¦å¹³è¡Œæˆ–å…±çº¿(å‰ç§¯ä¸º0)                   | 1:å…±çº¿  2:å¹³è¡Œ  0:ç›¸äº¤                                       |
| `lineIntersection(l1,l2)`        | æ±‚ä¸¤$ç›´çº¿$äº¤ç‚¹  (éœ€è¦ä¿è¯ä¸å¹³è¡Œ/å…±çº¿)                 |                                                              |
| `pointOnLineLeft(p,l)`           | $ç‚¹$æ˜¯å¦åœ¨$ç›´çº¿$ï¼ˆ$\vec{ab}$ï¼‰å·¦ä¾§(å‰ç§¯ä¸ºæ­£)          | ä»¥ç›´çº¿çš„æ–¹å‘å‘é‡$\vec{ab}$æ–¹å‘ä¸ºåŸºå‡†                         |
| `hp(vec<Line>)`                  | è¿”å›$å‡¸å¤šè¾¹å½¢$é¡¶ç‚¹é›†(åŠå¹³é¢äº¤S&Iç®—æ³•ï¼Œå¹¶æŒ‰é€†æ—¶é’ˆæ’åˆ—) | ä¼ å…¥çš„å‚æ•°ä¸éœ€è¦é¢„å…ˆæ’åˆ—                                     |



```cpp
template<typename T>
struct Point {
	T x,y;
	Point (const T &_x = 0,const T &_y = 0) : x(_x),y(_y){}

    template<typename U>//è‡ªåŠ¨ç±»å‹è½¬æ¢
    operator Point<U>() {
        return Point<U>(U(x), U(y));
    }

    Point &operator+=(const Point &p) & {
        x += p.x; y += p.y;
        return *this;
    }
    Point &operator-=(const Point &p) & {
        x -= p.x; y -= p.y;
        return *this;
    }
    Point &operator*=(const T &v) & {
        x *= v; y *= v;
        return *this;
    }
    Point &operator/=(const T &v) & {
        x /= v; y /= v;
        return *this;
    }
    Point operator-() const { return Point(-x, -y); }
    friend Point operator+(Point a, const Point &b) { return a += b; }
    friend Point operator-(Point a, const Point &b) { return a -= b; }
    friend Point operator*(Point a, const T &b) { return a *= b; }
    friend Point operator/(Point a, const T &b) { return a /= b; }
    friend Point operator*(const T &a, Point b) { return b *= a; }
    friend bool operator==(const Point &a, const Point &b) { return a.x == b.x && a.y == b.y; }
    friend bool operator!=(const Point &a,const Point &b) { return !(a == b);}
    
	friend std::istream &operator>>(std::istream &is, Point &p) {
		return is >> p.x >> p.y;
	}
	friend std::ostream &operator<<(std::ostream &os, const Point &p) {
		return os << "(" << p.x << "," << p.y << ")";
	}
};

template<typename T>//ç‚¹ä¹˜
T dot(const Point<T> &p1,const Point<T>&p2){
	return p1.x*p2.x + p1.y*p2.y;
}

template<typename T>//å‰ä¹˜
T cross(const Point<T> &p1,const Point<T>&p2){
	return p1.x*p2.y - p1.y*p2.x;
}

template<typename T>//å‘é‡çš„æ¨¡
double length(const Point<T> &p){
	return std::sqrt(dot(p,p));
}

template<typename T>//å•ä½å‘é‡
Point<T> normalize(const Point<T> &p) {
	return p/length(p);
}

template<typename T>//ä¸¤ç‚¹ä¹‹é—´è·ç¦»(æ¬§å‡ é‡Œå¾—è·ç¦»)
double distance(const Point<T> &p1,const Point<T> &p2){
	return length(p1-p2);
}

template<typename T>//å‘é‡é€†æ—¶é’ˆæ—‹è½¬90åº¦
Point<T> rotate(const Point<T> &p){
	return Point(-p.y,p.x);
}

template<typename T>// åˆ¤æ–­å‘é‡æ‰€åœ¨è±¡é™(ç¬¬ä¸€/å››è±¡é™ä¸º1ï¼Œç¬¬äºŒ/ä¸‰è±¡é™ä¸º-1)
int sgn(const Point<T> &a) {
    return a.y > 0 || (a.y == 0 && a.x > 0) ? 1 : -1;
}


template<typename T>
struct Line{
	Point<T>a,b;
	Line (const Point<T> &_a = Point<T>(),const Point<T> &_b = Point<T>()) : a(_a),b(_b){}
	
	template<typename U> 
	operator Line<U>(){
		return Line<U>(Point<U>(a),Point<U>(b));
	}
};

template<typename T>//çº¿æ®µé•¿åº¦
double length(const Line<T> &l){
	return length(l.a-l.b);
}

template<typename T>//åˆ¤æ–­ä¸¤ç›´çº¿æ˜¯å¦å¹³è¡Œ(å‰ç§¯ä¸º0)
int parallel(const Line<T> &l1,const Line<T> &l2){
	if(cross(l1.b-l1.a,l2.b-l2.a) == 0){
		if(distancePL(l2.b,l1) == 0) return 1;//å…±çº¿
		else return 2;//å¹³è¡Œ
	}
	return 0;
}

template<typename T>//ç‚¹åˆ°ç›´çº¿è·ç¦»
double distancePL(const Point<T> &p,const Line<T> &l){
	return std::abs(cross(l.a-l.b,l.a-p)) / length(l);
}

template<typename T>//ç‚¹åˆ°çº¿æ®µè·ç¦»
double distancePS(const Point<T> &p, const Line<T> &l) {
    if (dot(p - l.a, l.b - l.a) < 0) { return distance(p, l.a); }
    if (dot(p - l.b, l.a - l.b) < 0) { return distance(p, l.b); }
    return distancePL(p, l);
}

template<typename T>//ç‚¹æ˜¯å¦åœ¨ç›´çº¿å·¦ä¾§
bool pointOnLineLeft(const Point<T> &p, const Line<T> &l) {
    return cross(l.b - l.a, p - l.a) > 0;
}

template<typename T>//æ±‚ä¸¤ç›´çº¿äº¤ç‚¹(éœ€ç¡®ä¿ä¸å¹³è¡Œ)
Point<T> lineIntersection(const Line<T> &l1, const Line<T> &l2) {
    return l1.a + (l1.b - l1.a) * (cross(l2.b - l2.a, l1.a - l2.a) / cross(l2.b - l2.a, l1.a - l1.b));
}

template<typename T>//åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Š
bool pointOnSegment(const Point<T> &p, const Line<T> &l) {
    return cross(p - l.a, l.b - l.a) == 0 && std::min(l.a.x, l.b.x) <= p.x && p.x <= std::max(l.a.x, l.b.x)
        && std::min(l.a.y, l.b.y) <= p.y && p.y <= std::max(l.a.y, l.b.y);
}

template<typename T>//åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…éƒ¨(æˆ–å¤šè¾¹å½¢ä¸Š) 0_idx,å¤šè¾¹å½¢ç‚¹é›†éœ€è¦æŒ‰é¡ºåºæ’åˆ—
bool pointInPolygon(const Point<T> &a, const std::vector<Point<T>> &p) {
    int n = p.size();
    for (int i = 0; i < n; i++) {
        if (pointOnSegment(a, Line(p[i], p[(i + 1) % n]))) {
            return true;
        }
    }
    
    int t = 0;
    for (int i = 0; i < n; i++) {
        auto u = p[i];
        auto v = p[(i + 1) % n];
        if (u.x < a.x && v.x >= a.x && pointOnLineLeft(a, Line(v, u))) {
            t ^= 1;
        }
        if (u.x >= a.x && v.x < a.x && pointOnLineLeft(a, Line(u, v))) {
            t ^= 1;
        }
    }
    return t == 1;
}

/*
çº¿æ®µç›¸äº¤åˆ¤å®š
è¿”å›å€¼:tuple(ç±»å‹,äº¤ç‚¹1,äº¤ç‚¹2)
ç±»å‹:
	0:ä¸ç›¸äº¤
	1:ä¸¥æ ¼ç›¸äº¤(äº¤ç‚¹åœ¨ä¸¤çº¿æ®µå†…éƒ¨)
	2:é‡å (è¿”å›é‡å éƒ¨åˆ†çš„ä¸¤ä¸ªç«¯ç‚¹)
	3:ç«¯ç‚¹ç›¸äº¤(äº¤ç‚¹ä¸ºçº¿æ®µç«¯ç‚¹)
*/
template<typename T>
std::tuple<int, Point<T>, Point<T>> segmentIntersection(const Line<T> &l1, const Line<T> &l2) {
    if (std::max(l1.a.x, l1.b.x) < std::min(l2.a.x, l2.b.x)) {
        return {0, Point<T>(), Point<T>()};
    }
    if (std::min(l1.a.x, l1.b.x) > std::max(l2.a.x, l2.b.x)) {
        return {0, Point<T>(), Point<T>()};
    }
    if (std::max(l1.a.y, l1.b.y) < std::min(l2.a.y, l2.b.y)) {
        return {0, Point<T>(), Point<T>()};
    }
    if (std::min(l1.a.y, l1.b.y) > std::max(l2.a.y, l2.b.y)) {
        return {0, Point<T>(), Point<T>()};
    }
    if (cross(l1.b - l1.a, l2.b - l2.a) == 0) {
        if (cross(l1.b - l1.a, l2.a - l1.a) != 0) {
            return {0, Point<T>(), Point<T>()};
        } 
		else {
            auto maxx1 = std::max(l1.a.x, l1.b.x);
            auto minx1 = std::min(l1.a.x, l1.b.x);
            auto maxy1 = std::max(l1.a.y, l1.b.y);
            auto miny1 = std::min(l1.a.y, l1.b.y);
            auto maxx2 = std::max(l2.a.x, l2.b.x);
            auto minx2 = std::min(l2.a.x, l2.b.x);
            auto maxy2 = std::max(l2.a.y, l2.b.y);
            auto miny2 = std::min(l2.a.y, l2.b.y);
            Point<T> p1(std::max(minx1, minx2), std::max(miny1, miny2));
            Point<T> p2(std::min(maxx1, maxx2), std::min(maxy1, maxy2));
            if (!pointOnSegment(p1, l1)) { std::swap(p1.y, p2.y); }
            if (p1 == p2)  return {3, p1, p2};
            else  return {2, p1, p2}; 
        }
    }
    auto cp1 = cross(l2.a - l1.a, l2.b - l1.a);
    auto cp2 = cross(l2.a - l1.b, l2.b - l1.b);
    auto cp3 = cross(l1.a - l2.a, l1.b - l2.a);
    auto cp4 = cross(l1.a - l2.b, l1.b - l2.b);
    
    if ((cp1 > 0 && cp2 > 0) || (cp1 < 0 && cp2 < 0) || (cp3 > 0 && cp4 > 0) || (cp3 < 0 && cp4 < 0)) {
        return {0, Point<T>(), Point<T>()};
    }
    
    Point p = lineIntersection(l1, l2);
    if (cp1 != 0 && cp2 != 0 && cp3 != 0 && cp4 != 0)  return {1, p, p};
    else return {3, p, p};
}

template<typename T>//è¿”å›ä¸¤çº¿æ®µæœ€çŸ­è·ç¦»
double distanceSS(const Line<T> &l1, const Line<T> &l2) {
    if (std::get<0>(segmentIntersection(l1, l2)) != 0) {
        return 0.0;
    }
    return std::min({distancePS(l1.a, l2), distancePS(l1.b, l2), distancePS(l2.a, l1), distancePS(l2.b, l1)});
}

template<typename T>//çº¿æ®µæ˜¯å¦åœ¨å¤šè¾¹å½¢å†…éƒ¨(éœ€æ»¡è¶³:ç«¯ç‚¹åœ¨å†…ä¸”ä¸ä¸ä»»ä½•è¾¹ä¸¥æ ¼ç›¸äº¤),å¤šè¾¹å½¢ç‚¹é›†éœ€è¦æŒ‰é¡ºåºæ’åˆ—
bool segmentInPolygon(const Line<T> &l, const std::vector<Point<T>> &p) {
	int n = p.size();
	if (!pointInPolygon(l.a, p)) { return false; }
	if (!pointInPolygon(l.b, p)) { return false; }
	for (int i = 0; i < n; i++) {
		auto u = p[i];
		auto v = p[(i + 1) % n];
		auto w = p[(i + 2) % n];
		auto [t, p1, p2] = segmentIntersection(l, Line(u, v));

		if (t == 1) { return false; }
		if (t == 0) { continue; }
		if (t == 2) {
			if (pointOnSegment(v, l) && v != l.a && v != l.b) {
				if (cross(v - u, w - v) > 0) {
					return false;
				}
			}
		} 
		else {
			if (p1 != u && p1 != v) {
				if (pointOnLineLeft(l.a, Line(v,u)) || pointOnLineLeft(l.b, Line(v,u))) {
					return false;
				}
			} 
			else if (p1 == v) {
				if (l.a == v) {
					if (pointOnLineLeft(u, l)) {
						if (pointOnLineLeft(w, l) && pointOnLineLeft(w, Line(u, v))) {
							return false;
						}
					} 
					else {
						if (pointOnLineLeft(w, l) || pointOnLineLeft(w, Line(u, v))) {
							return false;
						}
					}
				} 
				else if (l.b == v) {
					if (pointOnLineLeft(u, Line(l.b, l.a))) {
						if (pointOnLineLeft(w, Line(l.b, l.a)) && pointOnLineLeft(w,Line(u,v))) {
							return false;
						}
					} 
					else {
						if (pointOnLineLeft(w, Line(l.b,l.a)) || pointOnLineLeft(w,Line(u,v))) {
							return false;
						}
					}
				} 
				else {
					if (pointOnLineLeft(u, l)) {
						if (pointOnLineLeft(w, Line(l.b,l.a)) || pointOnLineLeft(w,Line(u,v))) {
							return false;
						}
					} 
					else {
						if (pointOnLineLeft(w, l) || pointOnLineLeft(w, Line(u, v))) {
							return false;
						}
					}
				}
			}
		}
	}
	return true;
}

template<typename T>//è¿”å›å‡¸å¤šè¾¹å½¢é¡¶ç‚¹é›† 0_idx
std::vector<Point<T>> hp(std::vector<Line<T>> lines) {
    std::sort(lines.begin(), lines.end(), [&](auto l1, auto l2) {
        auto d1 = l1.b - l1.a;
        auto d2 = l2.b - l2.a;
        
        if (sgn(d1) != sgn(d2)) {
            return sgn(d1) == 1;
        }
        
        return cross(d1, d2) > 0;
    });
    
    std::deque<Line<T>> ls;
    std::deque<Point<T>> ps;
    for (auto l : lines) {
        if (ls.empty()) {
            ls.push_back(l);
            continue;
        }
        
        while (!ps.empty() && !pointOnLineLeft(ps.back(), l)) {
            ps.pop_back();
            ls.pop_back();
        }
        
        while (!ps.empty() && !pointOnLineLeft(ps[0], l)) {
            ps.pop_front();
            ls.pop_front();
        }
        
        if (cross(l.b - l.a, ls.back().b - ls.back().a) == 0) {
            if (dot(l.b - l.a, ls.back().b - ls.back().a) > 0) {
                if (!pointOnLineLeft(ls.back().a, l)) {
                    assert(ls.size() == 1);
                    ls[0] = l;
                }
                continue;
            }
            return {};
        }
        
        ps.push_back(lineIntersection(ls.back(), l));
        ls.push_back(l);
    }
    
    while (!ps.empty() && !pointOnLineLeft(ps.back(), ls[0])) {
        ps.pop_back();
        ls.pop_back();
    }
    if (ls.size() <= 2) { return {}; }

    ps.push_back(lineIntersection(ls[0], ls.back()));
    
    return std::vector(ps.begin(), ps.end());
}
```





## å…¶å®ƒ



### ä¸­ä½æ•°

ä¸€èˆ¬è¦æ±‚æœ€å¤§åŒ–ä¸­ä½æ•°ä¹‹ç±»çš„é¢˜ç›®ï¼Œå¯ä»¥äºŒåˆ†ä¸€ä¸ªæ•°xï¼Œè¯ºa[i] >= xåˆ™èµ‹æƒå€¼w[i]ä¸º1ï¼Œå¦åˆ™ä¸º-1ï¼Œåˆ¤æ–­æŸä¸€åŒºé—´ä¸­ä½æ•°æ˜¯å¦å¤§äºç­‰äºxï¼Œå³æ±‚è¯¥åŒºé—´å’Œæ˜¯å¦å¤§äº0ã€‚



#### å¯¹é¡¶å †

åŠ¨æ€ç»´æŠ¤ä¸­ä½æ•°ï¼Œæ’å…¥/åˆ é™¤O(log),æŸ¥æ‰¾O(1)

se1çš„æœ«å°¾å…ƒç´ å³ä¸ºä¸­ä½æ•°

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240924013344229.png" alt="image-20240924013344229" style="zoom:50%;" /> 

```cpp
multiset<int>se1,se2;

void balance(){//æ¯æ¬¡æ’å…¥/åˆ é™¤åå¹³è¡¡ä¸¤ä¸ªé›†åˆ
	while(se1.size() > se2.size()){
		se2.insert(*se1.rbegin());
		se1.erase(prev(se1.end()));
	}
	while(se1.size() < se2.size()){
		se1.insert(*se2.begin());
		se2.erase(se2.begin());
	}
}

void add(int x){//æ’å…¥å…ƒç´ 
	se1.insert(x);
	balance();
}

void del(int x){//åˆ é™¤å…ƒç´ 
	if(x <= *se1.rbegin()) se1.erase(se1.find(x));
	else se2.erase(se2.find(x));
	balance();
}

int query(){//æŸ¥æ‰¾ä¸­ä½æ•°
	return *se1.rbegin();
}
```



ä¾‹é¢˜ï¼š

> é¢˜æ„ï¼šå®šä¹‰ä¸€ä¸ªæ•°ç»„çš„è¿ç»­å­æ•°ç»„(a[l] ~ a[r])æ¯ä¸€é¡¹æ»¡è¶³ $a_{i+1} =a_i + 1$ ä¸ºä¸€ä¸ªå½©è™¹å­æ•°ç»„ï¼Œå¯ä»¥è‡³å¤šè¿›è¡Œ k æ¬¡æ“ä½œä½¿ä»»æ„$a_i+1$æˆ–$a_i-1$ï¼Œæ±‚èƒ½æ„é€ å‡ºçš„æœ€é•¿å½©è™¹å­æ•°ç»„
>
> æ€è·¯ï¼šè€ƒè™‘$a_{i+1} =a_i + 1$å¯ä»¥è½¬åŒ–ä¸º$a_{i+1} - (i + 1) = a_i - i $ï¼Œæ‰€ä»¥å…ˆé¢„å¤„ç†æŠŠæ‰€æœ‰çš„$a_i$å‡å»è‡ªå·±ä¸‹æ ‡ï¼Œé—®é¢˜å°±å˜æˆäº†ï¼šæŠŠä¸€ä¸ªåŒºé—´çš„æ‰€æœ‰æ•°å­—å…¨éƒ¨å˜æˆä¸€ä¸ªç›¸åŒçš„æ•°å­—ï¼Œå¾ˆå®¹æ˜“çŸ¥é“ï¼Œæœ€å°ä»£ä»·å°±æ˜¯æŠŠæ‰€æœ‰æ•°å˜æˆä¸­ä½æ•°å³å¯ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±ç”¨ä¸€ä¸ªåŒæŒ‡é’ˆæ»‘åŠ¨çª—å£æ¥ç»´æŠ¤ï¼Œæ±‚æœ€å¤§çš„åŒºé—´é•¿åº¦ï¼Œè¿™é‡ŒåŠ¨æ€ç»´æŠ¤æ»‘åŠ¨çª—å£çš„ä¸­ä½æ•°ç”¨ä¸¤ä¸ªmultiset

```cpp
//https://codeforces.com/gym/104901/problem/K
#include <iostream>
#include <vector>
#include <set>
using namespace std;
using ll = long long;
int n;

multiset<int>se1,se2;
ll sum1,sum2;//sum1ç»Ÿè®¡se1çš„å’Œï¼Œsum2ç»Ÿè®¡se2çš„å’Œ

void balance(){
	while(se1.size() > se2.size()){
		sum2 += *se1.rbegin();
		sum1 -= *se1.rbegin();
		se2.insert(*se1.rbegin());
		se1.erase(prev(se1.end()));
	}
	while(se1.size() < se2.size()){
		sum1 += *se2.begin();
		sum2 -= *se2.begin();
		se1.insert(*se2.begin());
		se2.erase(se2.begin());
	}
}

void add(int x){
	se1.insert(x);
	sum1 += x;
	balance();
}

void del(int x){
	if(x <= *se1.rbegin()) {se1.erase(se1.find(x)),sum1 -= x;}
	else {se2.erase(se2.find(x)),sum2 -= x;}
	balance();
}

ll query(){
	return *se1.rbegin();
}

ll all(){//è¿”å› ä½¿æ‰€æœ‰æ•°å˜ä¸ºä¸­ä½æ•°æ‰€éœ€è¦çš„æ“ä½œæ¬¡æ•°
	return (se1.size()*query()-sum1) + (sum2-se2.size()*query());
}

void sol(){
	se1.clear();se2.clear();
	sum1 = sum2 = 0;
	ll n,k;cin >> n >> k;
	vector<ll>a(n+1);
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		a[i] -= i;
	}
	int ans = 1;
	ll sum = 0;
	for(int l = 0,r = 0;r <= n;){
		while(sum <= k){
			ans = max(ans,r-l+1);
			r++;
			if(r > n) break;
			add(a[r]);
			sum = all();
		}
		while(sum > k){
			l++;
			del(a[l]);
			sum = all();
		}
	}
	cout << ans-1 << endl;
}

int main(){
	int tt;cin >> tt;
	while(tt--){ sol(); }
	return 0;
}
```



**ç¬¬kå°æ•°æ±‚ä¸­ä½æ•°**

æŸ¥æ‰¾O(N)

[å¿«æ’](#ksort) æˆ–STLå‡½æ•°nth_element()







#### ~~ä¸»å¸­æ ‘~~

å¯æŒä¹…åŒ–æƒå€¼çº¿æ®µæ ‘

æ±‚åŒºé—´ç¬¬kå°ï¼Œä¸æ”¯æŒä¿®æ”¹

```cpp
//https://ac.nowcoder.com/acm/contest/91177/F
#include <iostream>
#include <algorithm>
#include <cstring>
using namespace std;
constexpr int MAXN = 1e5;
int tot, n, m;
int sum[(MAXN << 5) + 10], rt[MAXN + 10], ls[(MAXN << 5) + 10],rs[(MAXN << 5) + 10];
int a[MAXN + 10], ind[MAXN + 10], len;

int getid(const int &val) {  // ç¦»æ•£åŒ–
	return lower_bound(ind + 1, ind + len + 1, val) - ind;
}

int build(int l, int r) {  // å»ºæ ‘
	int root = ++tot;
	if (l == r) return root;
	int mid = l + r >> 1;
	ls[root] = build(l, mid);
	rs[root] = build(mid + 1, r);
	return root;  // è¿”å›è¯¥å­æ ‘çš„æ ¹èŠ‚ç‚¹
}

int update(int k, int l, int r, int root) {  // æ’å…¥æ“ä½œ
	int dir = ++tot;
	ls[dir] = ls[root], rs[dir] = rs[root], sum[dir] = sum[root] + 1;
	if (l == r) return dir;
	int mid = l + r >> 1;
	if (k <= mid)
		ls[dir] = update(k, l, mid, ls[dir]);
	else
		rs[dir] = update(k, mid + 1, r, rs[dir]);
	return dir;
}

int query(int u, int v, int l, int r, int k) {  // æŸ¥è¯¢æ“ä½œ
	int mid = l + r >> 1,
		x = sum[ls[v]] - sum[ls[u]];  // é€šè¿‡åŒºé—´å‡æ³•å¾—åˆ°å·¦å„¿å­ä¸­æ‰€å­˜å‚¨çš„æ•°å€¼ä¸ªæ•°
	if (l == r) return l;
	if (k <= x)  // è‹¥ k å°äºç­‰äº x ï¼Œåˆ™è¯´æ˜ç¬¬ k å°çš„æ•°å­—å­˜å‚¨åœ¨åœ¨å·¦å„¿å­ä¸­
		return query(ls[u], ls[v], l, mid, k);
	else  // å¦åˆ™è¯´æ˜åœ¨å³å„¿å­ä¸­
		return query(rs[u], rs[v], mid + 1, r, k - x);
}

void init() {
	scanf("%d%d", &n, &m);
	for (int i = 1; i <= n; ++i) scanf("%d", a + i);
	memcpy(ind, a, sizeof ind);
	sort(ind + 1, ind + n + 1);
	len = unique(ind + 1, ind + n + 1) - ind - 1;
	rt[0] = build(1, len);
	for (int i = 1; i <= n; ++i) rt[i] = update(getid(a[i]), 1, len, rt[i - 1]);
}

int l, r, k;

void work() {
	while (m--) {
		cin >> l >> r;//æŸ¥è¯¢åŒºé—´[l,r]ä¸­ç¬¬kå°
         //cin >> k;
		k = (r-l+2) >> 1;
		printf("%d\n", ind[query(rt[l - 1], rt[r], 1, len, k)]);
	}
}

int main() {
	init();
	work();
}
```





### å‡å€¼ä¸ç­‰å¼

$$
\frac{a_1+a_2+...+a_n}{n} >= \sqrt[n]{a_1*a_2*...*a_n}
$$

$$
\frac{2}{\frac{1}{a}+\frac{1}{b}} <= \sqrt{ab} <= \frac{a+b}{2} <= \sqrt{\frac{a^2+b^2}{2}}
$$





### çº¦ç‘Ÿå¤«ç¯

> n ä¸ªäººæ ‡å· $0,1,\cdots, n-1$ã€‚é€†æ—¶é’ˆç«™ä¸€åœˆï¼Œä» $0$ å·å¼€å§‹ï¼Œæ¯ä¸€æ¬¡ä»å½“å‰çš„äººé€†æ—¶é’ˆæ•° $k$ ä¸ªï¼Œç„¶åè®©è¿™ä¸ªäººå‡ºå±€ã€‚é—®æœ€åå‰©ä¸‹çš„äººæ˜¯è°ã€‚

```cpp
//O(N)
int josephus(int n, int k) {
    int res = 0;
    for (int i = 1; i <= n; ++i) res = (res + k) % i;
    return res;
}
```

```cpp
//O(KlogN)
int josephus(int n, int k) {
    if (n == 1) return 0;
    if (k == 1) return n - 1;
    if (k > n) return (josephus(n - 1, k) + k) % n;  // çº¿æ€§ç®—æ³•
    int res = josephus(n - n / k, k);
    res -= n % k;
    if (res < 0) res += n;  // mod n
    else res += res / (k - 1);  // è¿˜åŸä½ç½®
    return res;
}
```





### å‰å§†æ‹‰å°”æ£®æ—¥æœŸå…¬å¼

ç»™å®šå…·ä½“æ—¥æœŸï¼Œæ¨å½“å¤©æ˜¯æ˜ŸæœŸå‡ ã€‚ä¹Ÿå¯ä»¥æ±‚ä¸¤ä¸ªæ—¥æœŸçš„å¤©æ•°ä¹‹å·®ç­‰ç­‰ã€‚

```cpp
const int d[] = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};

bool isLeap(int y) {//åˆ¤æ–­å½“å‰å¹´æ˜¯å¦ä¸ºé—°å¹´
    return y % 400 == 0 || (y % 4 == 0 && y % 100 != 0);
}

int daysInMonth(int y, int m) {
    return d[m - 1] + (isLeap(y) && m == 2);
}

int getDay(int y, int m, int d) {
    int ans = 0;
    for (int i = 1970; i < y; i++) {
        ans += 365 + isLeap(i);
    }
    for (int i = 1; i < m; i++) {
        ans += daysInMonth(y, i);
    }
    ans += d;
	//return ans;    //è¿”å›ä»Šå¤©æ˜¯ä»1970.1.1èµ·çš„ç¬¬å‡ å¤©ï¼Ÿ(1970.1.1ä¸ºç¬¬1å¤©,æ˜ŸæœŸ4)
    return (ans + 2) % 7 + 1;//è¿”å›ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼Ÿ[1,2,3,4,5,6,7]
}
```



### äºŒç»´å’Œä¸€ç»´åæ ‡è½¬åŒ–

**ä¸‹æ ‡ä»0å¼€å§‹**

> nè¡Œmåˆ—
>
> `idx = i*m + j`
>
> `(i,j) = (idx/m,idx%m)`

| 0    | 1    | 2    | 3    | 4    |
| ---- | ---- | ---- | ---- | ---- |
| 5    | 6    | 7    | 8    | 9    |
| 10   | 11   | 12   | 13   | 14   |
| 15   | 16   | 17   | 18   | 19   |



**ä¸‹æ ‡ä»1å¼€å§‹**

> nè¡Œmåˆ—
>
> `idx = (i-1)*m + j `
>
> `(i,j) = ((idx+m-1)/m,(idx%m)? idx%m : m)`

| 1    | 2    | 3    | 4    | 5    |
| ---- | ---- | ---- | ---- | ---- |
| 6    | 7    | 8    | 9    | 10   |
| 11   | 12   | 13   | 14   | 15   |
| 16   | 17   | 18   | 19   | 20   |





------



# åŸºç¡€ç®—æ³•

## å‰ç¼€å’Œ&å·®åˆ†

> åœ¨å¤´æ–‡ä»¶<numeric>ä¸­ä¹ŸåŒ…å«äº†ä¸€ç»´å‰ç¼€å’Œ/å·®åˆ†å‡½æ•°
> int a[6] = {1,2,3,4,5,6},s[6];
> partial_sum(a,a+6,s); //s = {1,3,6,10,15,21}
> adjacent_difference(a,a+6,s); //s = {1,1,1,1,1,1}

### ä¸€ç»´å‰ç¼€å’Œ

> pre[i] = a[1]+a[2] +...+a[i] = pre[i-1]+a[i]
> å‰ç¼€å’Œæ•°ç»„ä¸€èˆ¬ä¸‹æ ‡ä»1å¼€å§‹ï¼Œæ–¹ä¾¿å†™

```cpp
//æ±‚ç¬¬aä¸ªæ•°åˆ°ç¬¬bä¸ªæ•°çš„å’Œ
#include<iostream>
using namespace std;
int arr[1000006]; int pre[1000006];
int  main() {
	int k; cin >> k;
	for (int i = 1;i <= k;i++){
		scanf("%d", &arr[i]);
		pre[i] += pre[i - 1] + arr[i];
	}
	int a, b; cin >> a >> b;
	cout << pre[b] - pre[a - 1] << endl;
	return 0;
}
```

```cpp
//å¼‚æˆ–å‰ç¼€å’Œ
for(int i = 1;i <= n;i++){
    s[i] = s[i-1]^a[i];
}
ans = s[r]^s[l-1];
```



### äºŒç»´å‰ç¼€å’Œ

å­çŸ©é˜µçš„å’Œï¼š

```cpp
//æ¯ä¸ªç‚¹çš„Sçš„æ±‚æ³•,å¯ä»¥ç›´æ¥æ¨
s[i][j] = s[i-1][j] + s[i][j-1] - s[i-1][j-1] + a[i][j];
    
//ä¹Ÿå¯ä»¥å…ˆæšä¸¾ç»´ï¼Œç„¶åå¯¹æ¯ä¸€ç»´åšå‰ç¼€å’Œ
s[i][j]=s[i][j-1]+a[i][j];
s[i][j]=s[i-1][j]+a[i][j];
```

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20231118215947288.png" alt="image-20231118215947288" style="zoom:33%;" /> 

```cpp
//æŸä¸€å—Sçš„æ±‚æ³•ï¼šs[x1][y1]~s[x2][y2]
s[x2][y2] - s[x1-1][y2] - s[x2][y1-1] + s[x1-1][y1-1];
```



|      |      |           |      |           |      |      |
| ---- | ---- | --------- | ---- | --------- | ---- | ---- |
|      |      |           |      |           |      |      |
|      |      | **x1,y1** |      |           |      |      |
|      |      |           |      |           |      |      |
|      |      |           |      | **x2,y2** |      |      |
|      |      |           |      |           |      |      |
|      |      |           |      |           |      |      |
|      |      |           |      |           |      |      |

 

```cpp
#include<iostream>
using namespace std;
const int N = 10006;
int arr[N][N]; int s[N][N];
int n, m;

int query(int x1,int y1,int x2,int y2){
    return s[x2][y2] - s[x1-1][y2] - s[x2][y1-1] + s[x1-1][y1-1];
}

int main() {
	cin >> n >> m;
	for (int i = 1; i <= n; i++)
		for (int j = 1; j <= m; j++)
			scanf("%d", &arr[i][j]);
	for (int i = 1; i <= n; i++)	//åˆ©ç”¨å‰ç¼€å’Œæ±‚æ¯ä¸€ç‚¹çš„S
		for (int j = 1; j <= m; j++)
			s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + arr[i][j];
	
	int x1, y1, x2, y2;
	cin >> x1 >> y1 >> x2 >> y2;//æ±‚å­çŸ©é˜µx1ï¼Œy1 ~ x2ï¼Œy2çš„S
	cout << query(x1,y1,x2,y2) << endl;
	return 0;
}
```



### ä¸€ç»´å·®åˆ†

> dif[1] + dif[2] + ... + dif[i] = a[i];
> å¾€å¾€ä¸å‰ç¼€å’Œè”ç³»

> dif[i] = arr[i] - arr[i-1];

```cpp
//https://www.luogu.com.cn/problem/P2367
#include <iostream>
using namespace std;
int arr[5000006], dif[5000006];
int main() {
	int n, p; cin >> n >> p;
	for (int i = 1; i <= n; i++){
		scanf("%d", &arr[i]);//è¾“å…¥æ•°æ®è¾ƒå¤šæ—¶å»ºè®®scanf/printf  æ¯”cin/coutå¿«ï¼Œ
		dif[i] = arr[i] - arr[i - 1];
	}
	while (p--){
		int x, y, z;
		scanf("%d%d%d", &x, &y, &z);//åŒºé—´[x,y]åŠ x
		dif[x] += z;
		dif[y + 1] -= z;
	}
	int low = 1e9;
	for (int i = 1; i <= n; i++){
		arr[i] = arr[i - 1] + dif[i];
		low = low < arr[i] ? low : arr[i];
	}
	cout << low << endl;
	return 0;
}
```

```cpp
//å¢å‡åºåˆ—ï¼šhttps://www.acwing.com/problem/content/102/
//ç»™å®šæ•°ç»„a[n],æ¯æ¬¡å¯é€‰ä¸€ä¸ªåŒºé—´[l,r]å†…çš„æ•°éƒ½+1æˆ–-1ï¼Œæ±‚ä½¿æ‰€æœ‰æ•°éƒ½ä¸€æ ·çš„æœ€å°æ“ä½œæ¬¡æ•°å’Œæœ€ç»ˆåºåˆ—æœ‰å¤šå°‘ç§
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 100005;
using ll = long long;
int n;

ll a[N],dif[N];

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		dif[i] = a[i] - a[i-1];
	}

	ll pos = 0,neg = 0;
    
	//å¦‚æœè¿™ä¸ªæ•°åˆ—çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„,æœ€åæˆ‘ä»¬çš„å·®åˆ†æ•°ç»„ä¸€å®šæ˜¯b[1]=ä¸€ä¸ªå¸¸æ•°,b[2]~b[n]éƒ½ç­‰äº0
	for(int i = 2;i <= n;i++){
		if(dif[i] > 0) pos += dif[i];//posè¡¨ç¤ºsum(æ­£æ•°->0)
		if(dif[i] < 0) neg += -dif[i];//negè¡¨ç¤ºsum(è´Ÿæ•°->0)
	}//æ­£è´Ÿä¸¤ä¸ªæ•°å¯ä»¥ç›¸æ¶ˆäºŒè€…å–æœ€å°min,æœ€åå·®åˆ†å°±åªå‰©åŒç¬¦å·çš„æ•°abs(pos-neg)
	cout << min(pos,neg) + abs(pos - neg) << endl;
	cout << abs(pos - neg) + 1;
	return 0;
}
```





### äºŒç»´å·®åˆ†



```cpp
//https://www.acwing.com/problem/content/800/
//ç»™å®šn*mçš„çŸ©é˜µå’Œqæ¬¡æ’å…¥æ“ä½œ,æ¯æ¬¡æ“ä½œå°†å­çŸ©é˜µ(x1,y1,x2,y2)çš„å€¼åŠ ä¸Šc,æ±‚qæ¬¡æ“ä½œåçš„çŸ©é˜µ
#include <iostream>
using namespace std;
int a[1006][1006]; int dif[1006][1006];
int n, m, q;

void insert(int x1, int y1, int x2, int y2, int c) {
	dif[x1][y1] += c;
	dif[x2 + 1][y1] -= c;
	dif[x1][y2 + 1] -= c;
	dif[x2 + 1][y2 + 1] += c;
}

int main() {
	cin >> n >> m >> q;
	for (int i = 1; i <= n; i++){
		for (int j = 1; j <= m; j++){
			scanf("%d", &a[i][j]);
			insert(i, j, i, j, a[i][j]);//åˆå§‹åŒ–æ’å…¥a[i][j]
		}
	}

	while (q--) {
		int x1, y1, x2, y2, c;	//è¿›è¡Œqæ¬¡æ’å…¥æ“ä½œ
		scanf("%d%d%d%d%d", &x1, &y1, &x2, &y2, &c);
		insert(x1, y1, x2, y2, c);
	}

	for (int i = 1; i <= n; i++)//åˆ©ç”¨å‰ç¼€å’Œæ±‚æ”¹å˜åçš„æ•°ç»„
		for (int j = 1; j <= m; j++)
			dif[i][j] += dif[i-1][j] + dif[i][j-1] - dif[i-1][j-1];

	for (int i = 1; i <= n; i++) {
		for (int j = 1; j <= m; j++)
			printf("%d ", dif[i][j]);
		printf("\n");
	}
}
```









## äºŒåˆ†

### äºŒåˆ†æŸ¥æ‰¾

> ç›®æ ‡æ•°ç»„éœ€è¦ä¸ºéé™åºæ’åˆ—

```cpp
#include <iostream>
using namespace std;
int n, x, arr[1000006];
bool check1(int mid) {	
	return arr[mid] >= x;
}
bool check2(int mid) {
	return arr[mid] <= x;
}

int main() {
	scanf("%d%d", &n, &x);
	for (int i = 0; i < n; i++) {
		scanf("%d", &arr[i]);
	}

	int l = 0, r = n - 1;//æ‰¾åˆ°ç¬¬ä¸€ä¸ª>=xå€¼çš„ä¸‹æ ‡    ï¼ˆä¸lower_boundç•¥æœ‰ä¸åŒï¼‰
	while (l < r) {	//0000x1111å‹ ï¼ˆxä¸ºç›®æ ‡ï¼‰	
		int mid = l + r >> 1;
		if (check1(mid)) r = mid;
		else l = mid + 1;
	}
    if(arr[l] < x) cout << -1 << endl;//è¯ºä¸å­˜åœ¨>=xçš„å€¼ï¼Œè¿”å›çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ä¸‹æ ‡ï¼Œè€Œlbè¿”å›çš„æ˜¯end()
	else cout << l << endl;

	l = 0, r = n - 1;//æ‰¾åˆ°æœ€åä¸€ä¸ª<=xå€¼çš„ä¸‹æ ‡    (ä¸upper_boundä¸åŒ)
	while (l < r) {	//1111x0000å‹  ï¼ˆxä¸ºç›®æ ‡ï¼‰
		int mid = l + r + 1 >> 1;
		if (check2(mid)) l = mid;
		else r = mid - 1;
	}
    if(arr[l] > x) cout << -1 << endl;//è¯ºä¸å­˜åœ¨<=xçš„å€¼,è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡
	cout << l << endl;

	return 0;
}
```





### äºŒåˆ†ç­”æ¡ˆ

å•è°ƒåŒºé—´ä¸­ï¼Œæ¯æ¬¡æŸ¥æ‰¾å»æ‰ä¸ç¬¦åˆæ¡ä»¶çš„ä¸€åŠåŒºé—´ï¼Œç›´åˆ°æ‰¾åˆ°ç­”æ¡ˆï¼ˆæ•´æ•°äºŒåˆ†ï¼‰æˆ–è€…å’Œç­”æ¡ˆååˆ†æ¥è¿‘

```cpp
//æ¨¡ç‰ˆä¸äºŒåˆ†æŸ¥æ‰¾ä¸€æ ·
//check(mid)ä¸ºï¼š...00001111...å‹ ï¼ˆç¬¬ä¸€ä¸ª1ä¸ºç›®æ ‡ï¼‰
int l = 0, r = 1e9;
	while (l < r) {
		int mid = l + r >> 1;
		if (check(mid)) r = mid;
		else l = mid + 1;
	}
cout << l;


//check(mid)ä¸ºï¼š...111110000...å‹  ï¼ˆæœ€åä¸€ä¸ª1ä¸ºç›®æ ‡ï¼‰
int l = 0, r = 1e9;
	while (l < r){
		int mid = l + r + 1 >> 1;
		if (check(mid)) l = mid ;
		else r = mid - 1;
	}
cout << l;
```



```cpp
//æœ€å°åŒ–æå€¼ï¼šhttps://codeforces.com/contest/2013/problem/D
//é¢˜æ„:å¯¹äºæ•°ç»„a,å¯ä»¥ä»»æ„æ¬¡é€‰æ‹©i(1~n-1),ä½¿a[i]--,a[i+1]++,è¯·æœ€å°åŒ–æå·®
//æ€è·¯ï¼šåˆ†åˆ«äºŒåˆ†æœ€å°çš„æœ€å¤§å€¼ï¼Œæœ€å¤§çš„æœ€å°å€¼ï¼ŒäºŒè€…ä¹‹å·®å³ä¸ºç­”æ¡ˆ
#include <bits/stdc++.h>
using ll = long long;
using namespace std;
const int N = 200005;
int n;

bool check1(ll mid,vector<ll>&a){
	ll cnt = 0;
	for(int i = 1;i <= n;i++){
		if(a[i] > mid) cnt+=a[i]-mid;
		if(a[i] < mid) cnt = max((ll)0,cnt - (mid-a[i]));
	}
	return cnt == 0;
}

bool check2(ll mid,vector<ll>&a){
	ll cnt = 0;
	for(int i = 1;i <= n;i++){
		if(a[i] > mid) cnt += a[i]-mid;
		if(a[i] < mid) cnt -= mid-a[i];
		if(cnt < 0) return 0;
	}
	return 1;
}

void sol(){
	cin >> n;
	vector<ll>a(n+1);
	for_each(a.begin()+1,a.begin()+n+1,[](auto &x){cin >> x;});
    
	ll l = 0,r = 1e18;
	while(l < r){
		ll mid = l+r>> 1;
		if(check1(mid,a)) r=mid;
		else l=mid+1;
	}
	ll ans1 = l;

	l = 0,r = 1e18;
	while(l < r){
		ll mid = l+r+1 >> 1;
		if(check2(mid,a)) l = mid;
		else r = mid-1;
	}
	ll ans2 = l;
	cout << ans1 - ans2 << endl;
}

int main() {
	int T = 1; //fastio;
	cin >> T;
	while(T--){ sol(); }
	return 0;
}
```





### å®æ•°åŸŸäºŒåˆ†

```cpp
//ä¸€èˆ¬å®ç°ä¸ºé™åˆ¶äºŒåˆ†æ¬¡æ•°,æˆ–è¾¾åˆ°æŸä¸ªç²¾åº¦å°±åœæ­¢
for(int ti = 1;ti <= 100;ti++){
    double mid = (l + r) / 2;
    if(check(mid)) r = mid;
    else l = mid;
}
std::cout << l << '\n';
```



```cpp
//ä¾‹å¦‚ï¼šæ±‚ä¸€ä¸ªæ•°çš„å¼€ä¸‰æ¬¡æ–¹
const double eps = 1e-8;

double n;cin >> n;
double l = -10000,r = 10000;
while(r-l >= eps){
    double mid = (l+r)/2;
    if(mid*mid*mid >= n) r = mid;
    else l = mid;
}
printf("%.6lf",r);
```



### åˆ†æ•°è§„åˆ’

[åˆ†æ•°è§„åˆ’ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/misc/frac-programming/)

> åˆ†æ•°è§„åˆ’ç”¨æ¥æ±‚ä¸€ä¸ªåˆ†å¼çš„æå€¼ã€‚
> æ¯ç§ç‰©å“æœ‰ä¸¤ä¸ªæƒå€¼aiå’Œbiï¼Œæ±‚ä¸€ç»„w$\in${0,1}ï¼Œé€‰å‡ºè‹¥å¹²ä¸ªç‰©å“ä½¿å¾—$\frac{\sum_{i=1}^nai*wi}{\sum_{i=1}^nbi*wi}$æœ€å°/æœ€å¤§ã€‚
> ä¸€èˆ¬åˆ†æ•°è§„åˆ’é—®é¢˜è¿˜ä¼šæœ‰ä¸€äº›å¥‡æ€ªçš„é™åˆ¶ï¼Œæ¯”å¦‚ã€åˆ†æ¯è‡³å°‘ä¸ºkã€ã€‚

> å‡å¦‚æˆ‘ä»¬è¦æ±‚æœ€å¤§å€¼ï¼ŒäºŒåˆ†checkä¸€ä¸ªmidï¼Œç„¶åæ¨æŸ¿å­
> $\frac{\sum ai*wi}{\sum bi*wi} > mid$
> ==>$\sum ai*wi  - mid * \sum bi*wi > 0$
> ==>$\sum wi*(ai-mid*bi) > 0$   //è¯ºä¸ç­‰å¼å¤§äº0è¯´æ˜midå¯è¡Œ
>
> ä¸»è¦éš¾ç‚¹åœ¨äºå¦‚ä½•æ±‚$\sum wi*(ai-mid*bi)$çš„æœ€å¤§å€¼/æœ€å°å€¼

```cpp
//https://vjudge.net/problem/POJ-2976#author=0
//né—¨è¯¾è‡³å°‘é€‰ké—¨,ä½¿å¾—å¹³å‡å­¦åˆ†æœ€å¤§
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
const int N = 1003;
int n,k;
vector<double>a(N),b(N);

bool cmp(double x,double y){
	return x > y;
}

bool check(double mid){//åˆ¤æ–­æ˜¯å¦å­˜åœ¨kä¸ªç‰©å“ï¼Œå…¶ç´¯è®¡å¹³å‡åˆ†>mid
	double s = 0;
	vector<double>c(n);

	for(int i = 0;i < n;i++){
		c[i] = a[i]-mid*b[i];//æŠŠc[i] = a[i]-mid*b[i]ä½œä¸ºç¬¬iä¸ªç‰©å“çš„æƒå€¼
	}
	sort(c.begin(),c.begin()+n,cmp);
	for(int i = 0;i < k;i++){
		s+=c[i];//è´ªå¿ƒåœ°é€‰æ‹©æƒå€¼æœ€å¤§çš„kä¸ª
	}
	return s > 0;
}

void uuz(){
	for(int i = 0;i < n;i++){cin >> a[i];}
	for(int i = 0;i < n;i++){cin >> b[i];}
	double l = 0,r = 1e9;
	while(r-l > 1e-6){
		double mid = (l+r)/2;
		//cout << mid << endl;
		if(check(mid)) l = mid;
		else r = mid;
	}
	int ans = r*100;
	cout << ans+(r*100-ans >= 0.5) << endl;
}

int main(){
	while(cin >> n >> k,n||k){
		k = n-k;
		uuz();
	}
}
```



#### å­æ®µå’Œé—®é¢˜



**æ— é•¿åº¦é™åˆ¶**

> æ±‚ä¸€ä¸ªå­æ®µï¼Œå®ƒçš„å’Œæœ€å¤§ï¼Œæ²¡æœ‰â€œé•¿åº¦å¤§äºç­‰äºFâ€è¿™ä¸ªé™åˆ¶
> æ— é•¿åº¦é™åˆ¶çš„æœ€å¤§å­æ®µå’Œé—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œåªéœ€è¦O(n)æ‰«æè¯¥åºåˆ—ï¼Œä¸æ–­
> åœ°æŠŠæ–°æ•°åŠ å…¥å­æ®µï¼Œå½“å­æ®µå’Œå˜ä¸ºè´Ÿæ•°çš„æ—¶å€™ï¼Œå°±æŠŠå½“å‰æ•´ä¸ªå­æ®µæ¸…ç©ºã€‚æ‰«æè¿‡ç¨‹
> ä¸­å‡ºç°è¿‡çš„æœ€å¤§çš„å­æ®µå’Œå³ä¸ºæ‰€æ±‚



> åŒºé—´[l,r]çš„æœ€å¤§å­æ®µå’Œï¼šè¯¦è§çº¿æ®µæ ‘





**æœ‰é•¿åº¦é™åˆ¶**



æ±‚ä¸€ä¸ªå­æ®µï¼Œä»–çš„å’Œæœ€å¤§ï¼Œ**é•¿åº¦ä¸è¶…è¿‡k**ï¼š[135. æœ€å¤§å­æ®µå’Œ](https://www.acwing.com/problem/content/137/)

>   è¯¦è§ [å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–](#sub_max_queue)






æ±‚ä¸€ä¸ªå­æ®µï¼Œä»–çš„å’Œæœ€å¤§ï¼Œ**é•¿åº¦ä¸å°äºk**ï¼š

> å­æ®µå¯ä»¥è½¬åŒ–ä¸ºå‰ç¼€å’Œç›¸å‡çš„å½¢å¼ï¼Œåˆ™æœ‰
>
> $$
> \max_{i-j>=k}\{A_{j+1}+A_{j+2}+...+A_i\} = \max_{k<=i<=n}\{sum_i-\min_{0<=j<=i-k}\{sum_j\}\}
> $$

```cpp
//æœ€ä½³ç‰›å›´æ ï¼šhttps://www.acwing.com/problem/content/104/
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
const int N = 100005;
int n,f;
int a[N];
double s[N];

bool check(double mid){//åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿ç»­å­æ®µ(é•¿åº¦>=f)ï¼Œå…¶æœ€å¤§å¹³å‡æ•°max_avg >= å½“å‰mid
	for(int i = 1;i <= n;i++){//ç›¸å½“äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨ max_avg - mid >= 0
		s[i] = s[i-1]+(a[i] - mid);//a[i]-mid çš„å‰ç¼€å’Œ
	}
	double avg = 0;
	for(int i = f;i <= n;i++){
		avg = min(avg,s[i-f]);
		if(s[i]-avg >= 0) return 1;//è¯ºs[i]-mins >= 0,è¯´æ˜å­˜åœ¨å­æ®µå…¶å¹³å‡æ•°>mid
	}
	return 0;
}

int main(){
	cin >> n >> f;
	for(int i = 1;i <= n;i++){cin >> a[i];}
	double l = 0,r = 2000;
	while(r-l > 1e-6){
		double mid = (l+r)/2;
		if(check(mid)) l = mid;//å°†é—®é¢˜è½¬å˜ä¸ºåˆ¤å®šé—®é¢˜
		else r = mid;
	}
	r*=1000;//rä¸ºç»“æœ
	cout << (int)r << endl;
}
```







### ä¸‰åˆ†

å¦‚æœéœ€è¦æ±‚å‡º**å•å³°å‡½æ•°**çš„æå€¼ç‚¹ï¼Œé€šå¸¸ä½¿ç”¨äºŒåˆ†æ³•è¡ç”Ÿå‡ºçš„ä¸‰åˆ†æ³•æ±‚å•å³°å‡½æ•°çš„æå€¼ç‚¹

ä¸‰åˆ†æ³•æ¯æ¬¡æ“ä½œä¼šèˆå»ä¸¤ä¾§åŒºé—´ä¸­çš„å…¶ä¸­ä¸€ä¸ªã€‚ä¸ºå‡å°‘ä¸‰åˆ†æ³•çš„æ“ä½œæ¬¡æ•°ï¼Œåº”ä½¿ä¸¤ä¾§åŒºé—´å°½å¯èƒ½å¤§ã€‚å› æ­¤ï¼Œæ¯ä¸€æ¬¡æ“ä½œæ—¶çš„ $lmid$ å’Œ $rmid$ åˆ†åˆ«å– $mid-\varepsilon$ å’Œ $mid+\varepsilon$ æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚



```cpp
//https://www.luogu.com.cn/problem/P3382
//ç»™å‡ºä¸€ä¸ªNæ¬¡å‡½æ•°ï¼Œä¿è¯åœ¨èŒƒå›´[ğ‘™,ğ‘Ÿ]å†…å­˜åœ¨ä¸€ç‚¹ğ‘¥ï¼Œä½¿å¾—[l,ğ‘¥]ä¸Šå•è°ƒå¢ï¼Œ[ğ‘¥,ğ‘Ÿ]ä¸Šå•è°ƒå‡ã€‚è¯•æ±‚å‡ºğ‘¥çš„å€¼ã€‚
#include <iostream>
#include <cmath>
using namespace std;
const int N = 20;
const double eps = 1e-7;
int n;
double l,r,a[N];

double f(double x){
	double ans = 0;
	for(int i = n;i >= 0;i--){
		ans+=a[i]*powl(x,i);
	}
	return ans;
}

int main(){
	cin >> n >> l >> r;
	for(int i = n;i >= 0;i--){ cin >> a[i]; }
	while(r-l > eps){
		double mid = (l+r)/2;
		double lmid = mid - eps;
		double rmid = mid + eps;
		if(f(lmid) > f(rmid)) r = mid;//è¯ºè¦æ±‚å‡¹å‡½æ•°å³°å€¼,æŠŠç¬¦å·æ¢æˆ < å³å¯
		else l = mid;
	}
	printf("%.6lf",l);
    
	return 0;
}
```





## åŒæŒ‡é’ˆ

> for(int i = 0,j = 0;i < n;i++){
> 	while(j < i && check[i] [j]) {
> 		j++;
> 		//æ¯é“é¢˜çš„é€»è¾‘
> 	}
> }
> å¯ä»¥å°†O(n^2)ä¼˜åŒ–åˆ°O(n);

```cpp
//æœ€é•¿è¿ç»­æ— é‡å¤å­åºåˆ—
#include <iostream>
using namespace std;
const int N = 1000006;
int a[N], s[N];//s[a[i]]åˆ¤æ–­a[i]å‡ºç°çš„æ¬¡æ•°
int n, res;
int main() {
	cin >> n;
	for (int i = 0;i < n;i++)
		cin >> a[i];

	for (int i = 0,j = 0;i < n;i++){
		s[a[i]] ++;
		while (s[a[i]] > 1) {
            //å½“å³ç«¯ç‚¹içš„æ•°å‡ºç°æ¬¡æ•°>1ï¼Œs[a[j]]--ï¼Œå·¦ç«¯ç‚¹jå³ç§»
			s[a[j]]--;
			j++;	
		}
		res = max(res, i - j + 1);	
	}
	cout << res << endl;
	return 0;
}
```







## æ’åº

### sort

> éœ€åŒ…å«å¤´æ–‡ä»¶<algorithm>
>
> å¹³å‡å¤æ‚åº¦ä¸ºO(NlogN)ï¼Œä¸ä¿è¯ç¨³å®šæ€§
>
> è¯­æ³•ï¼šsort(begin, end, cmp);
>
> å…¶ä¸­beginä¸ºæŒ‡å‘å¾…sort()çš„æ•°ç»„çš„`ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ`ï¼Œendä¸ºæŒ‡å‘å¾…sort()çš„æ•°ç»„çš„`æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®çš„æŒ‡é’ˆ`ï¼Œcmpå‚æ•°ä¸ºæ’åºå‡†åˆ™(ä¸å†™é»˜è®¤ä»å°åˆ°å¤§è¿›è¡Œæ’åº); 

```cpp
//é»˜è®¤ä»å°åˆ°å¤§ï¼š
sort(arr, arr+n);//æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹
sort(arr+1,arr+n+1)//æ•°ç»„ä¸‹æ ‡ä»1å¼€å§‹
sort(v.begin(),v.end());


//ä»å¤§åˆ°å°ï¼š
sort(str.begin(),str.end()ï¼Œgreater<int>());
sort(str.rbegin(),str.rend());
sort(str.begin(),str.end()ï¼Œcmp);//bool cmp(int a,int b){return a > b;}ä»¥a,bå¤§å°ä¸ºä¾æ®æ’åº
								//è¿”å›å€¼ä¸ºçœŸï¼Œåˆ™aæ’åœ¨bå‰é¢
sort(e+1,e+n+1,[](auto &x,auto &y){return x.a > y.b;});//lambdaè¡¨è¾¾å¼ï¼Œç»“æ„ä½“æ•°ç»„ä»¥aä¸ºæƒé‡æ’åº
```



stable_sort()

> stable_sort() ä¹Ÿæ˜¯ä¸€ç§O(n log n)æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•ï¼Œä½†å®ƒä¿è¯ç¨³å®šæ€§ï¼Œå³ç›¸ç­‰çš„å…ƒç´ å°†ä¿æŒå…¶åŸå§‹é¡ºåºã€‚è¿™ä½¿å¾—å®ƒåœ¨éœ€è¦ä¿æŒç›¸ç­‰å…ƒç´ é¡ºåºçš„åœºæ™¯ä¸­å¾ˆæœ‰ç”¨ã€‚æ³¨æ„ï¼Œç¨³å®šæ’åºçš„ä»£ä»·æ˜¯é¢å¤–çš„ç©ºé—´å¤æ‚åº¦ã€‚







### å¿«é€Ÿæ’åº

ä¸ç¨³å®š

å¿«é€Ÿæ’åºçš„æœ€ä¼˜æ—¶é—´å¤æ‚åº¦å’Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º $O(n\log n)$ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ã€‚

```cpp
#include<iostream>
using namespace std;
const int N = 1e6 + 5;
int n;
int q[N];
void quick_sort(int q[], int l, int r) {
	if (l >= r) return;
	int x = q[l], i = l - 1, j = r + 1;
	while (i < j) {
		do i++; while (q[i] < x);
		do j--; while (q[j] > x);
		if (i < j) swap(q[i], q[j]);
	}
	quick_sort(q, l, j);	//æ³¨æ„è¾¹ç•Œé—®é¢˜
	quick_sort(q, j + 1, r);
}
int main() {
	scanf("%d", &n);
	for (int i = 0; i < n; i++) scanf("%d", &q[i]);
    
	quick_sort(q, 0, n - 1);

	for (int i = 0; i < n; i++)printf("%d", q[i]);
}
```



#### <span id="ksort">ç¬¬kå°çš„æ•°</span>

```cpp
//https://www.luogu.com.cn/problem/P1923
//kä»ç¬¬0å°å¼€å§‹ï¼Œè¯ºè¦ä»1å¼€å§‹åˆ™++kå³å¯ï¼Œæ—¶é—´å¤æ‚åº¦O(N)
#include<iostream>
using namespace std;
const int N = 5e6 + 5;
int n,k;
int q[N];
void quick_sort(int q[], int l, int r) {
	if (l >= r) return;
	int x = q[l], i = l - 1, j = r + 1;
	while (i < j) {
		do i++; while (q[i] < x);
		do j--; while (q[j] > x);
		if (i < j) swap(q[i], q[j]);
	}
	if(k <= j)quick_sort(q, l, j);//æ¯æ¬¡åˆ¤æ–­æ¡ä»¶,åªéœ€æ’ä¸€è¾¹
	else quick_sort(q, j + 1, r);
}
int main() {
	scanf("%d %d", &n,&k);
	for (int i = 0; i < n; i++) scanf("%d", &q[i]);
	quick_sort(q, 0, n - 1);
    //stlå‡½æ•°å®ç°äº†ç±»ä¼¼åŠŸèƒ½:nth_element(q,q+k,q+n);
	//è¯ºä¸‹æ ‡ä»1å¼€å§‹:++k; nth_element(a+1,a+k,a+n+1);
	cout << q[k];
}
```



### å½’å¹¶æ’åº

ç¨³å®š

æ—¶é—´å¤æ‚åº¦åœ¨æœ€ä¼˜ã€æœ€åä¸å¹³å‡æƒ…å†µä¸‹å‡ä¸º $\Theta (n \log n)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $\Theta (n)$ã€‚

å…ˆæ’å·¦åŠè¾¹ï¼Œå†æ’å³åŠè¾¹ï¼Œæœ€ååˆå¹¶ã€‚

```cpp
void merge_sort(int q[], int l, int r){
    //é€’å½’çš„ç»ˆæ­¢æ¡ä»¶
    if(l >= r) return;

    //ç¬¬ä¸€æ­¥ï¼šåˆ†æˆå­é—®é¢˜
    int mid = l + r >> 1;

    //ç¬¬äºŒæ­¥ï¼šé€’å½’å¤„ç†å­é—®é¢˜
    merge_sort(q, l, mid ), merge_sort(q, mid + 1, r);

    //ç¬¬ä¸‰æ­¥ï¼šåˆå¹¶å­é—®é¢˜
    int i = l, j = mid + 1, k = 0, tmp[r - l + 1];
    while(i <= mid && j <= r){
        if(q[i] <= q[j]) tmp[k++] = q[i++];
        else tmp[k++] = q[j++];
    }
    while(i <= mid) tmp[k++] = q[i++];
    while(j <= r) tmp[k++] = q[j++];

    for(k = 0, i = l; i <= r; k++, i++) q[i] = tmp[k];
}
```



#### é€†åºå¯¹

```cpp
//https://www.luogu.com.cn/problem/P1908
//O(NlogN)å½’å¹¶æ’åºæ±‚é€†åºå¯¹æ•°é‡ã€å†’æ³¡æ’åºéœ€è¦äº¤æ¢çš„æ¬¡æ•°
//ä¹Ÿå¯ç¦»æ•£åŒ–åç”¨æ ‘çŠ¶æ•°ç»„æˆ–çº¿æ®µæ ‘æ±‚é€†åºå¯¹
#include <iostream>
using namespace std;
const int N = 500005;
int n,a[N];
long long ans;

void merge_sort(int a[],int l,int r){
	if(l == r) return;
	int mid = l + r >> 1;
	merge_sort(a,l,mid);merge_sort(a,mid+1,r);
	int i = l,j = mid+1,t[r-l+1],k = 0;
	while(i <= mid && j <= r){
		if(a[i] <= a[j]) t[k++] = a[i++];
		else t[k++] = a[j++],ans += mid-i+1;//æ ¸å¿ƒä»£ç 
	}
	while(i <= mid) t[k++] = a[i++];
	while(j <= r) t[k++] = a[j++];
	for(k = 0,i = l;i <= r;k++,i++){
		a[i] = t[k];
	}
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){ scanf("%d",&a[i]); }
	merge_sort(a,1,n);
	cout << ans;
}
```

```cpp
//å¥‡æ•°ç é—®é¢˜ https://www.acwing.com/problem/content/110/
//n*n (nä¸ºå¥‡æ•°)  äºŒç»´æŒ‰è¡ŒåŒ–ä¸ºä¸€ç»´(ä¸åŒ…æ‹¬0),å½’å¹¶æ’åº1 ~ n*n-1æ±‚é€†åºå¯¹æ•°é‡;
//è¯ºä¸¤ä¸ªæ•°ç é€†åºå¯¹å¥‡å¶æ€§ç›¸åŒåˆ™å¯ä»¥è½¬å˜ã€‚
```

å¯¹äºä¸€ä¸ªæ’åˆ—ï¼Œäº¤æ¢ä»»æ„ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œå¿…ç„¶æ”¹å˜é€†åºå¯¹å¥‡å¶æ€§ã€‚



## åˆ†æ²»

å°±æ˜¯æŠŠä¸€ä¸ªå¤æ‚çš„é—®é¢˜åˆ†æˆä¸¤ä¸ªæˆ–æ›´å¤šçš„ç›¸åŒæˆ–ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œç›´åˆ°æœ€åå­é—®é¢˜å¯ä»¥ç®€å•çš„ç›´æ¥æ±‚è§£ï¼ŒåŸé—®é¢˜çš„è§£å³å­é—®é¢˜çš„è§£çš„åˆå¹¶ã€‚

å¤§æ¦‚çš„æµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼šåˆ†è§£ -> è§£å†³ -> åˆå¹¶ã€‚

1. åˆ†è§£åŸé—®é¢˜ä¸ºç»“æ„ç›¸åŒçš„å­é—®é¢˜ã€‚
2. åˆ†è§£åˆ°æŸä¸ªå®¹æ˜“æ±‚è§£çš„è¾¹ç•Œä¹‹åï¼Œè¿›è¡Œé€’å½’æ±‚è§£ã€‚
3. å°†å­é—®é¢˜çš„è§£åˆå¹¶æˆåŸé—®é¢˜çš„è§£ã€‚

åˆ†æ²»æ³•èƒ½è§£å†³çš„é—®é¢˜ä¸€èˆ¬æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š

- è¯¥é—®é¢˜çš„è§„æ¨¡ç¼©å°åˆ°ä¸€å®šçš„ç¨‹åº¦å°±å¯ä»¥å®¹æ˜“åœ°è§£å†³ã€‚
- è¯¥é—®é¢˜å¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè§„æ¨¡è¾ƒå°çš„ç›¸åŒé—®é¢˜ï¼Œå³è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼Œåˆ©ç”¨è¯¥é—®é¢˜åˆ†è§£å‡ºçš„å­é—®é¢˜çš„è§£å¯ä»¥åˆå¹¶ä¸ºè¯¥é—®é¢˜çš„è§£ã€‚
- è¯¥é—®é¢˜æ‰€åˆ†è§£å‡ºçš„å„ä¸ªå­é—®é¢˜æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³å­é—®é¢˜ä¹‹é—´ä¸åŒ…å«å…¬å…±çš„å­é—®é¢˜ã€‚





[P7883 å¹³é¢æœ€è¿‘ç‚¹å¯¹ï¼ˆåŠ å¼ºåŠ å¼ºç‰ˆï¼‰ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P7883)

> ç»™å®šå¹³é¢å†…nä¸ªç‚¹å¯¹p(x,y)ï¼Œæ±‚è·ç¦»æœ€è¿‘çš„ä¸¤ä¸ªç‚¹çš„è·ç¦»(çš„å¹³æ–¹)ã€‚ç”±äºè¾“å…¥çš„ç‚¹ä¸ºæ•´ç‚¹ï¼Œå› æ­¤è¿™ä¸ªå€¼ä¸€å®šæ˜¯æ•´æ•°ã€‚

å°†æ‰€æœ‰ç‚¹æ’åºåï¼Œå°†æ•´ä¸ªåŒºé—´ä¸€åˆ†ä¸ºäºŒï¼Œåˆ†åˆ«é€’å½’å¤„ç†ï¼Œ$d = min(sol(S1),sol(S2))$ï¼Œå†å¤„ç†ä¸¤ä¸ªåŒºé—´äº¤ç•ŒèŒƒå›´çš„ç‚¹ï¼Œå‡è®¾å½“å‰äº¤ç•Œç‚¹xåæ ‡ä¸ºmidxï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç†$x\in[midx-d,midx+d]$èŒƒå›´å†…çš„ç‚¹å³å¯ã€‚å°†è¿™ä¸ªåŒºåŸŸçš„ç‚¹æŒ‰ç…§yåæ ‡å‡åºæ’åˆ—ï¼Œç„¶åäºŒé‡å¾ªç¯æšä¸¾$(p_i,p_j)$ï¼Œ$d = min(d,dist(p_i,p_j))$ï¼Œå¦‚æœå½“å‰ä¸¤ä¸ªç‚¹ä¹‹é—´çš„$\Delta y$ >= dï¼Œåˆ™å¯ä»¥åœæ­¢æšä¸¾ç¬¬äºŒä¸ªç‚¹ã€‚

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 400005;
int b[N];

struct node{
	long long x,y;
	bool operator < (const node& e2){
		return x != e2.x ? x < e2.x : y < e2.y;
	}
}a[N];

long long pow2(long long x) {return x*x;}

long long dist(node p1,node p2){
	return pow2(p1.x-p2.x) + pow2(p1.y-p2.y);
}

void merge(int l,int r){
	int mid = l + r >> 1;
	int i = l,j = mid+1,k = 0;
	node temp[r-l+1];

	while(i <= mid && j <= r){
		if(a[i].y < a[j].y) temp[k++] = a[i++];
		else temp[k++] = a[j++];
	}
	while(i <= mid) temp[k++] = a[i++];
	while(j <= r) temp[k++] = a[j++];

	for(i = l,k = 0;i <= r;i++,k++){
		a[i] = temp[k];
	}
}

long long sol(int l,int r){
	if(l >= r) return 8e18;
	if(l+1 == r){//è¾¹ç•Œï¼šå½“å‰åŒºé—´ä»…æœ‰ä¸¤ä¸ªç‚¹ï¼Œç›´æ¥è®¡ç®—å³å¯ã€‚
		merge(l,r);
		return dist(a[l],a[r]);
	}
	int mid = l + r >> 1;
	long long midx = a[mid].x,cnt = 0;//å› ä¸ºåˆå¹¶æ—¶a[mid]ä¼šå˜,éœ€è¦æå‰è®°å½•
	long long d = min(sol(l,mid),sol(mid+1,r));
	merge(l,r);
	for(int i = l;i <= r;i++){
		if(pow2(a[i].x - midx) < d){
			b[++cnt] = i;
		}
	}
	for(int i = 1;i <= cnt;i++){
		for(int j = i+1;j <= cnt && pow2(a[b[i]].y - a[b[j]].y) < d;j++){
			d = min(d,dist(a[b[i]],a[b[j]]));
		}
	}
	return d;
}

int main(){
	int n;cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> a[i].x >> a[i].y;
	}
	sort(a+1,a+n+1);
	cout << sol(1,n);
//	printf("%.4lf",sqrt(sol(1,n)));
}
```





## äºŒè¿›åˆ¶

```cpp
//æ±‚nçš„äºŒè¿›åˆ¶ç¬¬kä½  ä»0å¼€å§‹æ•°
#include <iostream>
using namespace std;
//10 = (1010)2
int main() {
	int n, k;
	cin >> n >> k;
	cout << (n >> k & 1); //å³kç§»ä½ï¼Œå†&1ï¼Œkçš„å€¼ä¸ä¼šæ”¹å˜
	return 0;
}
```



### lowbit

æ±‚nçš„äºŒè¿›åˆ¶ ç¬¬ä¸€æ¬¡å‡ºç°çš„1å¯¹åº”çš„å€¼ï¼š

368ï¼š
 n      = 1011==1==0000
-n     = 010001111
-n+1 = 0100==1==0000	//ä»¥è¡¥ç å½¢å¼å‚¨å­˜
n&-n =        10000 = 16

```cpp
int lowbit(int n) {return n&-n;}
```



lowbitçš„åº”ç”¨:

```cpp
//æ±‚nçš„äºŒè¿›åˆ¶ä¸­å‡ºç°äº†å¤šå°‘ä¸ª1
int lowbit(int n)  { return n & -n; }

int main() {
	int n,res = 0;cin >> n;
	while (n) {
        n -= lowbit(n)ï¼›
        res++;
    }
	cout << res << endl;
}
```



```cpp
//åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å€æ•°
int lowbit(int n) {return n&-n;}

int main(){
    if(n == lowbit(n)) "yes"
	else "no"
}
```



æ±‚æ­£æ•´æ•°nçš„äºŒè¿›åˆ¶é•¿åº¦

$(100101)_2 = 6$

```cpp
int len = log2(n)+1;
```



æ±‚æ­£æ•´æ•°nçš„äºŒè¿›åˆ¶ç¬¬kä½ä»£è¡¨çš„åè¿›åˆ¶æ•°ï¼ˆ$2^k$æˆ–0ï¼‰

```cpp
long long deg(long long num, int deg) { return num & (1LL << deg); }
//25 = {1,0,0,8,16}
```



### çŠ¶æ€å‹ç¼©

> ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçŠ¶æ€
> ä¾‹å¦‚ï¼Œa[ ] = {1,2,3,4,5,6,7,8};
> åˆ™v[22]è¡¨ç¤º10110 = a[5]+a[3]+a[2]

```cpp
const int N = 1 << 10;
int a[] = {1,2,3,4,5,6,7,8};
for(int i = 1;i < 1 << 10;i++){
    for(int k = 0;k < 10;k++){
        if(i >> k & 1) v[i]+=a[k];
    }
}
```





```cpp
//è´¹è§£çš„5*5å¼€å…³:https://www.acwing.com/problem/content/97/
//å…ˆå›ºå®šç¬¬ä¸€è¡ŒçŠ¶æ€ï¼ˆæš´åŠ›æšä¸¾00000~11111ï¼‰ï¼Œæ¯ä¸€è¡Œçš„æš—ç¯éƒ½ç”±ä¸‹é¢ä¸€è¡Œå»ç‚¹äº®ï¼Œæ­¤æ—¶å·²ç»å›ºå®šäº†å½“å‰çŠ¶æ€çš„æœ€ç»ˆç­”æ¡ˆ
//å†æšä¸¾ç¬¬i=(2,3,4,5)è¡Œ,è¯ºç¬¬a[i-1][j]ä¸º0,åˆ™éœ€è¦turn[i][j]å¼€å…³ï¼Œç»Ÿè®¡èƒ½å¦ç‚¹äº®æ‰€æœ‰ç¯å’Œturnçš„æ¬¡æ•°å³å¯
#include <iostream>
#include <cstring>
using namespace std;
const int N = 7;
bool a[N][N],b[N][N];
int di[] = {0,-1,1,0,0},dj[] = {0,0,0,-1,1};
int cnt,ans;

void turn(int i,int j){
	for(int w = 0;w < 5;w++){
		int x = i + di[w],y = j + dj[w];
		if(x >= 1 && x <= 5 && y >= 1 && y <= 5){
			if(a[x][y]){cnt--;}
			else {cnt++;}
			a[x][y]^=1;
		}
	}
}

void sol(){
	ans = 0x3f3f3f3f,cnt = 0;
	for(int i = 1;i <= 5;i++){
		string s;cin >> s;
		for(int j = 1;j <= 5;j++){
			a[i][j] = s[j-1] - '0';
			if(a[i][j]) cnt++;
		}
	}
	memcpy(b,a,sizeof b);
	int temp = cnt;

	for(int q = 0;q < 1 << 5;q++){//qè¡¨ç¤ºç¬¬ä¸€è¡ŒçŠ¶æ€,ä»00000~11111
		cnt = temp;//cntç»Ÿè®¡äº®ç¯çš„ä¸ªæ•°
		int step = 0;//stepè®°å½•å¼€å…³æ“ä½œæ¬¡æ•°

		for(int k = 0;k < 5;k++){
			if(q >> k & 1){ step++;turn(1,k+1); }
		}//ç”¨å½“å‰çŠ¶æ€qå›ºå®šç¬¬ä¸€è¡Œ

		for(int i = 2;i <= 5;i++){//æšä¸¾ç¬¬2~5è¡Œ
		    if(step > 6) break;
			for(int j = 1;j <= 5;j++){
				if(a[i-1][j] == 0){ step++; turn(i,j); }//æ¯ä¸€è¡Œçš„æš—ç¯éƒ½ç”±ä¸‹é¢ä¸€è¡Œå»ç‚¹äº®
				if(cnt == 25){ans = min(ans,step);}//æ›´æ–°ç­”æ¡ˆ
			}
		}
		memcpy(a,b,sizeof a);//è¿˜åŸæ•°ç»„a
	}

	if(ans > 6) cout << -1 << endl;
	else cout << ans << endl;
}

int main(){
	int tt; cin >> tt;
	while(tt--) {sol();}
	return 0;
}
```





## ä½è¿ç®—



`a+b = a|b + a&b = a^b + (a&b)*2`



### ^ å¼‚æˆ–

> ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1ï¼Œå¯ä»¥çœ‹åšä¸è¿›ä½åŠ æ³•
> `0^0 = 0`
> `1^0 = 1`
> `0^1 = 1`
> `1^1 = 0`

> `A ^ A = 0`
> `A ^ 0 = A`
> `a ^ b ^ b = a`			  						 è‡ªåæ€§
> `a ^ b ^ c ^ d = b ^ d ^ a ^ c`			æ— åºæ€§
> `a^b = c` å¯ç§»é¡¹ä¸º `a = b^c`ï¼Œç§»é¡¹æ—¶æ— éœ€æ”¹å˜ç¬¦å·

> å¦‚æœiä¸ºå¶æ•°ï¼Œåˆ™æœ‰ `i^(i+1) = 1`

> æ¯”è¾ƒä¸¤æ•°å€¼æ˜¯å¦åŒå·ï¼Œ`a^b > 0`  æ›¿æ¢æ‰  `a*b > 0`

> `a ^= b ^= a ^= b`  ç›¸å½“äº `swap(a,b)`





**åˆ¤æ–­æˆå¯¹çš„æ•°ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°**

```cpp
//ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°**ä¸¤æ¬¡**ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚
int ans = 0;
for(int i = 1;i <= n;i++) {ans ^= a[i];}
cout << ans;
```



**å¼‚æˆ–å‰ç¼€å’Œ**

```cpp
for(int i = 1;i <= n;i++){
    s[i] = s[i-1]^a[i];
}

int query(int l,int r){
    return s[r]^s[l-1];
}
```

> å¦‚æœ`(n-1)%4 == 0`ï¼Œåˆ™`0~n-1`çš„å¼‚æˆ–å‰ç¼€å’Œä¸º`0`ï¼Œ`S[0,3,7,11,15...] = 0`
>









### & ä¸

åˆ¤æ–­å¥‡å¶

```cpp
int n;cin >> n;
if(n&1) //åˆ™ä¸ºå¥‡æ•°
```







### >>  ç§»ä½

n >> k ç›¸å½“äº $n/2^k$

n << k ç›¸å½“äº $n\times 2^k$

```cpp
//åè¿›åˆ¶è½¬äºŒè¿›åˆ¶
int n; cin >> n;//32ä½
for (int i = 31; i >= 0;i--) {
	cout << (n >> i & (1));
}
```







## ç¦»æ•£åŒ–

> æ•°ç»„ä¸‹æ ‡è·¨åº¦é•¿ï¼Œä½†åªç”¨åˆ°äº†éƒ¨åˆ†ä¸‹æ ‡

```cpp
vector<int>arr;	//å‚¨å­˜æ‰€æœ‰å¾…ç¦»æ•£åŒ–çš„å€¼
sort(arr.begin(),arr.end()); //å°†æ‰€æœ‰å€¼æ’åº
arr.erase(unique(arr.begin(),arr.end()),arr.end()); //å»æ‰é‡å¤å…ƒç´ 

int find(int x){
    return lower_bound(arr.begin(),arr.end(),x)-arr.begin()+1;//åŠ 1ä»ä¸‹æ ‡ä¸º1å¼€å§‹æ˜ å°„ï¼Œä¸åŠ åˆ™ä»0å¼€å§‹
}
```

```cpp
for(int i = 1;i <= n;i++){
    cin >> a[i];
    hs[i] = a[i];
}
sort(hs+1,hs+n+1);
int m = unique(hs+1,hs+n+1) - hs - 1;//a[1~m]å³ä¸ºå»é‡åçš„å…ƒç´ (ç¦»æ•£è‡³1~m(<=n)),ä¸å»é‡ä¹Ÿæ²¡å…³ç³»(ç¦»æ•£è‡³1~n)
for(int i = 1;i <= n;i++){
    a[i] = lower_bound(hs+1,hs+m+1,a[i]) - hs + 1;//a[i]å³ä¸ºç¦»æ•£åçš„æ•°å€¼,hs[a[i]]ä¸ºa[i]åŸæ¥çš„å€¼
}
```



éƒ¨åˆ†æ¶‰åŠåŒºé—´æŸ“è‰²çš„é¢˜ç›®ï¼Œå¯¹äºåŒºé—´`[l,r]`ç¦»æ•£åŒ–æ—¶ï¼Œéœ€è¦å°†`[l-1,r-1]`ä¹Ÿä¸€èµ·åŠ å…¥ç¦»æ•£åŒ–æ•°ç»„å¹¶å»é‡ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µï¼šä¾‹å¦‚ç”¨åŒºé—´`[1,3]`å’Œ`[6,10]`è¦†ç›–åŒºé—´`[1,10]`æ—¶ï¼Œå¸¸è§„ç¦»æ•£åŒ–ä¼šå¯¼è‡´`[1,10]`æ•´ä¸ªåŒºé—´è¢«è¦†ç›–ã€‚ä¾‹é¢˜ï¼š[P3740 [HAOI2014\] è´´æµ·æŠ¥ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P3740)





## æœç´¢

### DFS

æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œ**é€’å½’**å®ç°

åœ¨æ·±åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œå¯¹äºæœ€æ–°å‘ç°çš„é¡¶ç‚¹ï¼Œå¦‚æœå®ƒè¿˜æœ‰ä»¥æ­¤ä¸ºé¡¶ç‚¹è€Œæœªæ¢æµ‹åˆ°çš„è¾¹ï¼Œå°±æ²¿æ­¤è¾¹ç»§ç»­æ¢æµ‹ä¸‹å»ï¼Œå½“é¡¶ç‚¹vçš„æ‰€æœ‰è¾¹éƒ½å·²è¢«æ¢å¯»è¿‡åï¼Œæœç´¢å°†å›æº¯åˆ°å‘ç°é¡¶ç‚¹væœ‰èµ·å§‹ç‚¹çš„é‚£äº›è¾¹ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€ç›´è¿›è¡Œåˆ°å·²å‘ç°ä»æºé¡¶ç‚¹å¯è¾¾çš„æ‰€æœ‰é¡¶ç‚¹ä¸ºæ­¢ã€‚å¦‚æœè¿˜å­˜åœ¨æœªè¢«å‘ç°çš„é¡¶ç‚¹ï¼Œåˆ™é€‰æ‹©å…¶ä¸­ä¸€ä¸ªä½œä¸ºæºé¡¶ç‚¹ï¼Œå¹¶é‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚æ•´ä¸ªè¿‡ç¨‹åå¤è¿›è¡Œï¼Œç›´åˆ°æ‰€æœ‰çš„é¡¶ç‚¹éƒ½è¢«å‘ç°æ—¶ä¸ºæ­¢ã€‚

**æ‹¬å·åºåˆ—**

```cpp
//æŒ‰å­—å…¸åºè¾“å‡ºé•¿åº¦ä¸ºnçš„æ‰€æœ‰åˆæ³•æ‹¬å·åºåˆ— 1 <= n <= 20
//https://vjudge.net/problem/AtCoder-typical90_b#author=DeepSeek_zh
#include <iostream>
using namespace std;
int n;

void dfs(string s,int l,int r){//å½“å‰åºåˆ—ä¸ºs,ä¸”ç”¨äº†lä¸ªå·¦æ‹¬å·çš„rä¸ªå³æ‹¬å·
	if(l == n && r == n){
		cout << s << '\n';
		return ;
	}
	if(l < n) dfs(s+'(',l+1,r);
	if(r < l) dfs(s+')',l,r+1);//å¯¹äºæ‰€æœ‰ä½ç½®iè€Œè¨€,å…¶å·¦æ‹¬å·çš„æ•°é‡>=å³æ‹¬å·çš„æ•°é‡
}

int main(){
	cin >> n;
	if(n&1) return 0;
	n/=2;
	dfs("",0,0);
}
```

**å…¨æ’åˆ—**

```cpp
//né€‰mçš„å…¨æ’åˆ—,æ ‡è®°æ•°ç»„å†™æ³•
void dfs(int cnt){//dfs(1)
	if(cnt > m){
		for(int i = 1;i <= m;i++){
			cout << path[i] << ' ';
		}
		cout << '\n';
		return;
	}
	for(int i = 1;i <= n;i++){
		if(!st[i]){
			path[cnt] = i;
			st[i] = 1;
			dfs(cnt+1);
			st[i] = 0;
		}
	}
}
```

```cpp
//né€‰mçš„å…¨æ’åˆ—,uè¡¨ç¤ºäºŒè¿›åˆ¶çŠ¶æ€æ›¿æ¢æ ‡è®°æ•°ç»„
void dfs(int u,int cnt){//dfs(1,1)
	if(cnt > m){
		for(int i = 1;i <= m;i++){
			cout << path[i] << ' ';
		}
		cout << '\n';
		return;
	}
	for(int i = 1;i <= n;i++){
		if(u>>i&1) continue;
		path[cnt] = i;
		dfs(u|1<<i,cnt+1);
	}
}

//né€‰mçš„å…¨ç»„åˆ
void dfs(int u,int cnt){//dfs(1,1)
	if(cnt > m){
		for(int i = 1;i <= m;i++){
			cout << path[i] << ' ';
		}
		cout << '\n';
		return;
	}
	for(int i = u;i <= n;i++){
		path[cnt] = i;
		dfs(i+1,cnt+1);
	}
}
```



```cpp
//né€‰mçš„å…¨æ’åˆ—&å…¨ç»„åˆ(1~n)
//(t.path[]å¯ä»¥ä»ä»»æ„åˆæ³•æ’åˆ—å¼€å§‹)
#include <iostream>
#include <vector>
using namespace std;

struct PC{//PC t(n,m);   1_idx
	int n,m;
	vector<int>path;
	PC(int n,int m){
		this->n = n;this->m = m;
		path.resize(n+1);
		for(int i = 1;i <= n;i++) path[i] = i;
	}
    
    bool next_comb(){
        int j = m;
        while (j >= 1 && path[j] == n - m + j) j--;
        if (j == 0) return 0;
        path[j]++;
        for (int i = j + 1; i <= m; i++) path[i] = path[i - 1] + 1;
        return 1;
    }
    
	bool next_perm(){
        for (int i = m,used = 0; i >= 1; i--,used = 0) {
            for (int j = 1; j < i; ++j)  used |= 1 << path[j];
            for (int x = path[i]+1;x <= n;x++){
				if((used >> x & 1)) continue;
				path[i] = x; used = ~ (used | 1 << x) ^ 1;
				for(int j = i+1;j <= m;j++){
					int w = __builtin_ctz(used);
					path[j] = w;
					used ^= 1 << w;
				}
				return 1;
			}
        }
        return 0;
    }
};

int main(){
	int n,m; cin >> n >> m;
	PC t(n,m);//åˆå§‹åŒ–
	do{
		for(int i = 1;i <= t.m;i++){
			cout << t.path[i] << ' ';
		}
		cout << '\n';
	}while(t.next_perm());
}
```





#### å‰ªæ

**ä¼˜åŒ–æœç´¢é¡ºåº**

> æœç´¢å‰æ’åº,å‡å°æœç´¢è§„æ¨¡ã€ä¼˜å…ˆæœç´¢åˆ†æ”¯è¾ƒå°‘çš„èŠ‚ç‚¹

**æ’é™¤ç­‰æ•ˆå†—ä½™**

> å¦‚æœæ²¿ç€å‡ æ¡ä¸åŒåˆ†æ”¯åˆ°è¾¾çš„å­æ ‘æ˜¯ç­‰æ•ˆçš„ï¼Œé‚£ä¹ˆåªéœ€è¦å¯¹å…¶ä¸­ä¸€æ¡åˆ†æ”¯è¿›è¡Œæœç´¢

**å¯è¡Œæ€§å‰ªæ**   ï¼ˆä¸Šä¸‹ç•Œå‰ªæï¼‰

> å¯¹å½“å‰çŠ¶æ€è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå½“å‰åˆ†æ”¯å·²ç»æ— æ³•åˆ°è¾¾é€’å½’çš„è¾¹ç•Œï¼Œå°±è¿›è¡Œå›æº¯

**æœ€ä¼˜åŒ–å‰ªæ**

> åœ¨æœ€ä¼˜åŒ–é—®é¢˜çš„æœç´¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰èŠ±è´¹çš„ä»£ä»·è¶…è¿‡äº†å·²ç»æœåˆ°çš„æœ€ä¼˜è§£ï¼Œæ­¤æ—¶å¯ä»¥åœæ­¢æœç´¢ï¼Œç›´æ¥å›æº¯

**è®°å¿†åŒ–**

> è®°å½•æ¯ä¸ªçŠ¶æ€çš„æœç´¢ç»“æœï¼Œåœ¨é‡å¤éå†ä¸€ä¸ªçŠ¶æ€æ—¶ç›´æ¥æ£€ç´¢å¹¶è¿”å›

**å…¶å®ƒä¼˜åŒ–**

> ä½¿ç”¨æ•°æ®ç»“æ„ã€çŠ¶æ€å‹ç¼©ã€ä½è¿ç®—ç­‰ä¼˜åŒ–



```cpp
//å¯¼å¼¹é˜²å¾¡ç³»ç»Ÿ https://www.luogu.com.cn/problem/P10490
//dfs+å‰ªæ+å…¨å±€æœ€å°å€¼
#include <iostream>
using namespace std;
const int N = 55;
int n;
int arr[N];
int up[N],down[N];
int ans;

void dfs(int u,int su,int sd){//å‰uä¸ªå¯¼å¼¹,å·²ç»ä½¿ç”¨suä¸ªupç³»ç»Ÿ,sdä¸ªdownç³»ç»Ÿ
	if(su + sd >= ans) return;//å¦‚æœå·²ç»è¶…è¿‡äº†å½“å‰æœ€ä¼˜ç­”æ¡ˆï¼Œç›´æ¥å‰ªæ
	if(u == n){ans = su + sd;return;}//æ‰€æœ‰å¯¼å¼¹éƒ½è€ƒè™‘è¿‡äº†,å¹¶ä¸”æ²¡æœ‰è¶…è¿‡å½“å‰æœ€ä¼˜ç­”æ¡ˆ,åˆ™æ›´æ–°æœ€ä¼˜ç­”æ¡ˆ

    //æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨upç³»ç»Ÿæ‹¦æˆªç¬¬uä¸ªå¯¼å¼¹
	int i = 0;
	while(i < su && up[i] >= arr[u]) i++;//è´ªå¿ƒæ‰¾åˆ°å½“å‰ä½äºuå¯¼å¼¹çš„æœ€é«˜çš„upç³»ç»Ÿi (up[]ä¸ºé™åºæ•°ç»„)
	int temp = up[i];//tempç”¨äºå›æº¯æ—¶æ¢å¤ç°åœº
	up[i] = arr[u];
	if(i >= su)dfs(u+1,su+1,sd);//è¯ºiæ²¡æ‰¾åˆ°åˆ™æ–°å»ºä¸€ä¸ªupç³»ç»Ÿæ‹¦æˆª
	else dfs(u+1,su,sd);//å¦åˆ™ä½¿ç”¨åŸæ¥çš„upç³»ç»Ÿæ‹¦æˆª
	up[i] = temp;//æ¢å¤ç°åœº

    //æ–¹æ¡ˆäºŒï¼šä½¿ç”¨downç³»ç»Ÿæ‹¦æˆªç¬¬uä¸ªå¯¼å¼¹
	i = 0;
	while(i < sd && down[i] <= arr[u]) i++;
	temp = down[i];
	down[i] = arr[u];
	if(i >= sd)dfs(u+1,su,sd+1);
	else dfs(u+1,su,sd);
	down[i] = temp;
}

int main(){
	while(cin >> n,n){
		ans = n;
		for(int i = 0;i < n;i++){ cin >> arr[i]; }
		dfs(0,0,0);
		cout << ans <<endl;
	}
}
```



```cpp
//æ•°ç‹¬  https://www.luogu.com.cn/problem/P10481
#include <iostream>
using namespace std;
const int N = 9,M = 1 << N;
int a[N][N];
int mp[M];//é¢„å¤„ç†æ¯ä¸ªlowbitå¯¹åº”çš„æ•°
int ones[M];//é¢„å¤„ç†æ¯ä¸ªçŠ¶æ€å¯å¡«çš„æ•°,ä¼˜å…ˆæœç´¢åˆ†æ”¯æœ€å°çš„çŠ¶æ€
int sx[N],sy[N],sz[N];//çŠ¶æ€å‹ç¼©,è¡¨ç¤ºæ¯è¡Œã€æ¯åˆ—ã€æ¯å—æ–¹æ ¼è¿˜èƒ½å¡«çš„æ•°

int get(int x,int y){
	return sx[x]&sy[y]&sz[x/3*3+y/3];
}

bool dfs(int cnt){
	if(!cnt) return 1;
	int mn = 10;
	int x,y;
	for(int i = 0;i < N;i++){//ä¼˜å…ˆæ‰¾åˆ†æ”¯è¾ƒå°‘çš„è¿›è¡Œæ‹“å±•
		for(int j = 0;j < N;j++){
			if(a[i][j] == 0){
				int now = ones[get(i,j)];
				if(now < mn){
					mn = now;
					x = i,y = j;
				}
			}
		}
	}
	for(int i = get(x,y);i;i -= i&-i){
		int k = mp[i&-i];
		a[x][y] = k+1;
		sx[x] ^= 1 << k;
		sy[y] ^= 1 << k;
		sz[x/3*3+y/3] ^= 1 << k;

		if(dfs(cnt-1)) return 1;

		a[x][y] = 0;
		sx[x] ^= 1 << k;
		sy[y] ^= 1 << k;
		sz[x/3*3+y/3] ^= 1 << k;
	}
	return 0;
}

void sol(){
	for(int i = 0;i < N;i++) sx[i] = sy[i] = sz[i] = (1<<N)-1;
	int cnt = 0;
	for(int i = 0;i < N;i++){
		for(int j = 0;j < N;j++){
			if(a[i][j]){
				int k = a[i][j]-1;
				sx[i] ^= 1 << k;
				sy[j] ^= 1 << k;
				sz[i/3*3+j/3] ^= 1 << k;
			}
			else cnt++;
		}
	}
	dfs(cnt);
}

int main(){
	for(int i = 0;i < N;i++) mp[1<<i] = i;
	for(int i = 0;i < 1 << N;i++){
		for(int j = i;j;j -= j&-j){
			ones[i]++;
		}
	}
	int mt;cin >> mt;
	while(mt--) {
		for(int i = 0;i < N;i++){
			string s;cin >> s;
			for(int j = 0;j < N;j++){
				char x = s[j];
				if(x == '.') a[i][j] = 0;
				else a[i][j] = x - '0';
			}
		}
		sol();
		for(int i = 0;i < N;i++){
			for(int j = 0;j < N;j++){
				cout << a[i][j];
			}cout << '\n';
		}
	}
}
```





#### è¿­ä»£åŠ æ·±

å³**æ¯æ¬¡é™åˆ¶æœç´¢æ·±åº¦**çš„æ·±åº¦ä¼˜å…ˆæœç´¢ã€‚

è¿­ä»£åŠ æ·±æœç´¢çš„æœ¬è´¨è¿˜æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œåªä¸è¿‡åœ¨æœç´¢çš„åŒæ—¶å¸¦ä¸Šäº†ä¸€ä¸ªæ·±åº¦ ![d](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)ï¼Œå½“ ![d](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7) è¾¾åˆ°è®¾å®šçš„æ·±åº¦æ—¶å°±è¿”å›ï¼Œä¸€èˆ¬ç”¨äºæ‰¾æœ€ä¼˜è§£ã€‚å¦‚æœä¸€æ¬¡æœç´¢æ²¡æœ‰æ‰¾åˆ°åˆæ³•çš„è§£ï¼Œå°±è®©è®¾å®šçš„æ·±åº¦åŠ ä¸€ï¼Œé‡æ–°ä»æ ¹å¼€å§‹ã€‚

å½“çŠ¶æ€éšç€æ·±åº¦å¢åŠ æ¯”è¾ƒå¤šæ—¶ï¼ŒBFSé˜Ÿåˆ—çš„ç©ºé—´å¤æ‚åº¦ä¼šå¾ˆå¤§ã€‚å½“BFSåœ¨ç©ºé—´ä¸Šä¸å¤Ÿä¼˜ç§€ï¼Œè€Œä¸”é—®é¢˜è¦æ‰¾æœ€ä¼˜è§£æ—¶ï¼Œåº”è¯¥è€ƒè™‘è¿­ä»£åŠ æ·±æœç´¢ï¼Œè¿­ä»£åŠ æ·±ä¹Ÿå¯ä»¥è¿‘ä¼¼çœ‹åšBFSã€‚



**è¿‡ç¨‹**

é¦–å…ˆè®¾å®šä¸€ä¸ªè¾ƒå°çš„æ·±åº¦ä½œä¸ºå…¨å±€å˜é‡ï¼Œè¿›è¡Œ DFSã€‚æ¯è¿›å…¥ä¸€æ¬¡ DFSï¼Œå°†å½“å‰æ·±åº¦åŠ ä¸€ï¼Œå½“å‘ç° $d$ å¤§äºè®¾å®šçš„æ·±åº¦ $\textit{limit}$ å°±è¿”å›ã€‚å¦‚æœåœ¨æœç´¢çš„é€”ä¸­å‘ç°äº†ç­”æ¡ˆå°±å¯ä»¥å›æº¯ï¼ŒåŒæ—¶åœ¨å›æº¯çš„è¿‡ç¨‹ä¸­å¯ä»¥è®°å½•è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰å‘ç°ç­”æ¡ˆï¼Œå°±è¿”å›åˆ°å‡½æ•°å…¥å£ï¼Œå¢åŠ è®¾å®šæ·±åº¦ï¼Œç»§ç»­æœç´¢ã€‚

```cpp
IDDFS(u,d)
    if (d > limit) return
    for each edge (u,v){
        IDDFS(v,d+1)        
    }
	return
```





### BFS

å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œ**é˜Ÿåˆ—**å®ç°ï¼Œæ±‚æœ€çŸ­è·¯å¾„

æ¯æ¬¡éƒ½å°è¯•è®¿é—®åŒä¸€å±‚çš„èŠ‚ç‚¹ã€‚ å¦‚æœåŒä¸€å±‚éƒ½è®¿é—®å®Œäº†ï¼Œå†è®¿é—®ä¸‹ä¸€å±‚ã€‚

```cpp
//èµ°è¿·å®«	https://www.acwing.com/problem/content/description/846/
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 110;
int n,m;
int g[N][N];//å­˜å›¾
int d[N][N];//å­˜ç‚¹åˆ°èµ·ç‚¹çš„è·ç¦»
queue<pair<int, int>>q;//é˜Ÿåˆ—å®ç°

int dfs() {
	memset(d, -1, sizeof d);//åˆå§‹åŒ–ä¸º-1è¡¨ç¤ºæ²¡æœ‰èµ°è¿‡
	q.push({ 0,0 });//è¡¨ç¤ºèµ·ç‚¹èµ°è¿‡äº†
	d[0][0] = 0;

	int dx[4] = { -1,1,0,0 }, dy[4] = { 0,0,-1,1 };
	while (q.size()) {//é˜Ÿåˆ—ä¸ä¸ºç©º
		auto t = q.front();//å–é˜Ÿå¤´
		q.pop();
		for (int i = 0; i < 4;i++) {//æšä¸¾å››ä¸ªæ–¹å‘,æ‰©å±•t
			int x = t.first + dx[i], y = t.second + dy[i];
			if (x >= 0 && x < n && y >= 0 && y < m && d[x][y] == -1 && g[x][y] == 0) {
				//åœ¨è¾¹ç•Œå†… æ˜¯ç©ºåœ° ä¸”ä¹‹å‰æ²¡æœ‰èµ°è¿‡
				d[x][y] = d[t.first][t.second] + 1;//åˆ™åˆ°èµ·ç‚¹çš„è·ç¦»+1
				q.push({ x,y });//æ–°åæ ‡å…¥é˜Ÿ
			}
		}
	}
	return d[n - 1][m - 1];
}
int main() {
	cin >> n >> m;
	for (int i = 0; i < n;i++) {
		for (int j = 0; j < m;j++) {
			cin >> g[i][j];
		}
	}
	cout << dfs();
}
```







#### åŒç«¯é˜Ÿåˆ—BFS

æ—¶é—´å¤æ‚åº¦ä¸ºä¸¥æ ¼çš„O(N+M)

å¯¹äºä¸€å¼ è¾¹æƒä¸º0æˆ–1çš„æ— å‘å›¾ã€‚æœç´¢æ—¶å¦‚æœè¾¹æƒä¸º0åˆ™å°†è¯¥æ–°èŠ‚ç‚¹ä»é˜Ÿå¤´å…¥é˜Ÿï¼Œå¦‚æœä¸º1åˆ™ä»é˜Ÿå°¾å…¥é˜Ÿ

```cpp
//ç”µè½¦ https://www.acwing.com/problem/content/4252/
#include <iostream>
#include <cstring>
#include <deque>

const int N = 105,M = N*N;
int n,s,t;
int h[N],e[M],ne[M],w[M],idx;
int dist[N];
bool vis[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void uuz(){
	std::memset(dist,0x3f,sizeof dist);
	std::deque<int>dq;
	dq.push_back(s);
	dist[s] = 0;
	while(dq.size()){
		int x = dq.front();
		dq.pop_front();
		if(x == t) return;
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(dist[y] > dist[x] + w[i]){
				dist[y] = dist[x] + w[i];
				if(w[i] == 0) { dq.push_front(y); }
				else { dq.push_back(y); }
			}
		}
	}
}

int main(){
	std::memset(h,-1,sizeof h);
	std::cin >> n >> s >> t;
	for(int i = 1;i <= n;i++){
		int k;
		std::cin >> k;
		for(int j = 1;j <= k;j++){
			int x;std::cin >> x;
			if(j == 1) add(i,x,0);
			else add(i,x,1);
		}
	}
	uuz();
	if(dist[t] == 0x3f3f3f3f) std::cout << -1;
	else std::cout << dist[t];
}
```



[P1948 [USACO08JAN\] Telephone Lines S - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P1948)

> æ±‚å‡ºä¸€æ¡è·¯å¾„ï¼Œä½¿ç‚¹1åˆ°nä¸­ç¬¬k+1é•¿çš„è¾¹æœ€çŸ­ï¼Œè¾“å‡ºè¿™æ¡è¾¹çš„é•¿åº¦ã€‚
> äºŒåˆ†ä¸€ä¸ªç­”æ¡ˆxï¼Œæœç´¢æ—¶è¯ºå½“å‰w > xåˆ™æƒå€¼çœ‹ä½œ1ï¼Œä»£è¡¨ç”±é€šä¿¡å…¬å¸å…è´¹æŠ¥é”€ã€‚
> è¯ºæœ€ç»ˆéœ€è¦æŠ¥é”€çš„è¾¹æ•°  <= k åˆ™è¯´æ˜å½“å‰ x ç¬¦åˆæ¡ä»¶ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <deque>
using namespace std;
const int N = 1003,M = 20004;
int n,m,k;
int h[N],e[M],ne[M],w[M],idx;
int dist[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool check(int x){
	memset(dist,0x3f,sizeof dist);
	dist[1] = 0;
	deque<int>q;
	q.push_back(1);
	while(q.size()){
		int t = q.front();
		q.pop_front();
		for(int i = h[t];~i;i = ne[i]){
			int k = e[i];
			int val = w[i] > x ? 1 : 0;
			if(dist[k] > dist[t] + val){
				dist[k] = dist[t] + val;
				if(val) q.push_back(k);
				else q.push_front(k);
			}
		}
	}
	return dist[n] <= k;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m >> k;

	for(int i = 1;i <= m;i++){
		int a,b,c;cin >> a >> b >> c;
		add(a,b,c);add(b,a,c);
	}

	int l = 0,r = 1e6;
	while(l < r){
		int mid = l + r >> 1;
		if(check(mid)) r = mid;
		else l = mid + 1;
	}
	if(dist[n] == 0x3f3f3f3f) cout << -1;
	else cout << l;
}
```



[Maze Challenge with Lack of Sleepï¼ˆâ˜…4ï¼‰ - AtCoder typical90_aq - Virtual Judge (vjudge.net)](https://vjudge.net/problem/AtCoder-typical90_aq#author=DeepSeek_zh)

> ç»™å®šä¸€ä¸ªN*Mçš„ç½‘æ ¼ï¼Œ`#`ä»£è¡¨éšœç¢ï¼Œ`.`ä»£è¡¨è·¯å¾„ï¼Œæ±‚ä»èµ·ç‚¹`(rs,cs)`åˆ°ç»ˆç‚¹`(rt,ct)`ï¼Œæœ€å°‘è½¬å‘æ¬¡æ•°ã€‚

è®¾å®šçŠ¶æ€`(x,y,dir)`è¡¨ç¤ºå½“å‰ä½ç½®ä¸º(x,y),æ–¹å‘ä¸ºdirï¼Œæ‹“å±•åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹`(nx,ny,i)`æ—¶ï¼Œå¦‚æœdirä¸iæ–¹å‘ä¸€è‡´ï¼Œåˆ™å…¥é˜Ÿé¦–ï¼Œå¦åˆ™å…¥é˜Ÿå°¾ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 1003;
int n,m,rs,cs,rt,ct;
string s[N];
int dx[] = {-1,0,1,0},dy[] = {0,1,0,-1};
int dist[N][N][4];
int ans = 0x3f3f3f3f;

struct node{
	int x,y,dir;
};

void uuz(){
	memset(dist,0x3f,sizeof dist);
	deque<node>q;
	for(int i = 0;i < 4;i++){
		q.push_back(node{rs,cs,i});
		dist[rs][cs][i] = 0;
	}
	while(q.size()){
		auto [x,y,dir] = q.front();
		q.pop_front();

		if(x == rt && y == ct) ans = min(ans,dist[x][y][dir]);

		for(int i = 0;i < 4;i++){
			int nx = x + dx[i],ny = y + dy[i];
			if(nx < 1 || nx > n || ny < 1 || ny > m || s[nx][ny] == '#') continue;
			if(dist[nx][ny][i] > dist[x][y][dir] + (i != dir)){
				dist[nx][ny][i] = dist[x][y][dir] + (i != dir);
				if(i == dir)q.push_front(node{nx,ny,i});
				else q.push_back(node{nx,ny,i});
			}
		}
	}
}

int main(){
	cin >> n >> m;
	cin >> rs >> cs >> rt >> ct;
	for(int i = 1;i <= n;i++){
		cin >> s[i];s[i] = ' ' + s[i];
	}
	uuz();
	cout << ans;
}
```





#### ä¼˜å…ˆé˜Ÿåˆ—BFS

æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºå½“å‰ä»£ä»·çŠ¶æ€æœ€å°çš„è¿›è¡Œæ‰©å±•ï¼Œå½“æ¯ä¸ªçŠ¶æ€ç¬¬ä¸€æ¬¡ä»é˜Ÿåˆ—ä¸­è¢«å–å‡ºæ—¶ï¼Œå°±å¾—åˆ°äº†èµ·ç‚¹åˆ°è¯¥çŠ¶æ€çš„æœ€å°çŠ¶æ€ï¼Œä¹‹åå†è¢«å–å‡ºæ—¶åˆ™å¯ç›´æ¥å¿½ç•¥ã€‚

[UVA11367 Full Tank? - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/UVA11367)

> æœ‰Nä¸ªåŸå¸‚Mæ¡æ— å‘è¾¹ï¼Œæ¯ä¸ªåŸå¸‚éƒ½æœ‰ä¸€ä¸ªåŠ æ²¹ç«™ï¼ŒåŠ æ¯å•ä½æ²¹èŠ±è´¹p[i]ã€‚
> å›ç­”qæ¬¡è¯¢é—®ï¼Œæ¯æ¬¡ç»™å®šæ²¹ç®±å®¹é‡ä¸ºcï¼Œèµ·å§‹ç‚¹ä¸ºstï¼Œç»ˆç‚¹ä¸ºedã€‚æ±‚ståˆ°edçš„æœ€å°èŠ±è´¹ï¼Ÿ

```cpp
#include <iostream>
#include <vector>
#include <cstring>
#include <queue>
using namespace std;
const int N = 1003,M = 20004;
int n,m,q;
int p[N];
int h[N],e[M],ne[M],w[M],idx;

struct node{
	int x,oil,cost;
	bool operator < (const node &e2)const{
		return cost > e2.cost;//å°æ ¹å †,costå°çš„åœ¨å †é¡¶,æ¯æ¬¡ç”¨èŠ±è´¹æœ€å°çš„è¿›è¡Œæ‹“å±•,ç±»ä¼¼dijkstra
	}
};

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void query(){
	int c,st,ed;cin >> c >> st >> ed;//dist[x][oil]è¡¨ç¤ºå½“å‰ä½äºç‚¹xï¼Œæ²¹é‡ä¸ºoilçš„æœ€å°èŠ±è´¹
	vector<vector<int>>dist(n+2,vector<int>(c+2,0x3f3f3f3f)),vis(n+2,vector<int>(c+2));
	priority_queue<node>pq;
	pq.push({st,0,0});
	dist[st][0] = 0;
	while(pq.size()){
		auto [x,oil,cost] = pq.top();
		pq.pop();
		if(x == ed){cout << cost << '\n';return;}
		if(oil < c){//è¯ºæ²¹é‡æ²¡æ»¡,åˆ™å¯ä»¥é€‰æ‹©åŸåœ°ä¸åŠ¨åŠ æ²¹
			if(dist[x][oil+1] > dist[x][oil] + p[x]){
				dist[x][oil+1] = dist[x][oil] + p[x];
				pq.push({x,oil+1,dist[x][oil+1]});
			}
		}
		for(int i = h[x];~i;i = ne[i]){
			if(oil < w[i]) continue;//è¯ºoil < w[i],åˆ™å¯ä»¥æ›´æ–°å…¶å®ƒç‚¹
			int y = e[i];
			if(dist[y][oil-w[i]] > dist[x][oil]){
				dist[y][oil-w[i]] = dist[x][oil];
				pq.push({y,oil-w[i],dist[y][oil-w[i]]});
			}
		}
	}
	cout << "impossible\n";
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 0;i < n;i++) cin >> p[i];
	for(int i = 1;i <= m;i++){
		int a,b,c;cin >> a >> b >> c;
		add(a,b,c);add(b,a,c);
	}
	cin >> q;
	while(q--) query();
}
```





### åŒå‘æœç´¢

è¯ºé—®é¢˜æœ‰æ˜ç¡®çš„â€œåˆæ€â€å’Œâ€œç»ˆæ€â€ï¼Œå¯ä»¥ä»ä¸¤ç«¯åŒæ—¶è¿›è¡ŒBFSæˆ–DFSï¼Œåœ¨ä¸­é—´äº¤æ±‡ï¼Œç»„æˆæœ€ç»ˆç­”æ¡ˆã€‚

**åŒå‘BFS**

[P10487 Nightmare II - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10487)

> ç»™å®šä¸€ä¸ªN*Mçš„ç½‘æ ¼ï¼Œâ€œMâ€ä»£è¡¨ç”·å­©æ¯ç§’å¯ä»¥èµ°3æ ¼ï¼Œâ€œGâ€ä»£è¡¨å¥³å­©æ¯ç§’å¯ä»¥èµ°1æ ¼ï¼Œâ€œZâ€ä»£è¡¨é¬¼æ¯ç§’æ‹“å±•2æ ¼ï¼Œâ€œXâ€ä»£è¡¨å¢™ï¼Œæ±‚åœ¨ä¸è¿›å…¥é¬¼çš„å é¢†åŒºçš„å‰æä¸‹ï¼Œç”·å­©å’Œå¥³å­©èƒ½å¦ä¼šåˆï¼Œè¯ºèƒ½åˆ™è¾“å‡ºæœ€çŸ­ä¼šåˆæ—¶é—´ã€‚
>
> ä»èµ·å§‹çŠ¶æ€å’Œç›®æ ‡çŠ¶æ€åˆ†åˆ«å¼€å§‹ï¼Œä¸¤è¾¹è½®æµè¿›è¡Œï¼Œæ¯æ¬¡å„æ‰©å±•ä¸€æ•´å±‚ï¼Œå½“ä¸¤è¾¹å„è‡ªæœ‰ä¸€ä¸ªçŠ¶æ€å‘ç”Ÿé‡å¤æ—¶ï¼Œå°±è¯´æ˜è¿™ä¸¤ä¸ªæœç´¢è¿‡ç¨‹ç›¸é‡äº†ï¼Œå°±å¯ä»¥åˆå¹¶å‡ºèµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€å°‘æ­¥æ•°ã€‚



```cpp
#include <iostream>
#include <queue>
#include <vector>
using namespace std;
const int N = 805;
string s[N];

int dx[] = {-1,1,0,0},dy[] = {0,0,-1,1};

int sol(){
	int n,m,time = 0;cin >> n >> m;
	vector<pair<int,int>>z;
	vector<vector<int>>vis1(n+5,vector<int>(m+5)),vis2(n+5,vector<int>(m+5));//åˆ†åˆ«è¡¨ç¤ºç”·å­©å’Œå¥³å­©è®¿é—®è¿‡ç‚¹çš„çŠ¶æ€,è¯ºåŒæ—¶ä¸º1åˆ™è¯´æ˜ç›¸é‡äº†ã€‚
	queue<pair<int,int>>q1,q2;
	auto check = [&](int x,int y,int time)->bool{//åˆ¤æ–­å½“å‰ç‚¹æ˜¯å¦åˆæ³•(æœªè¿›å…¥é¬¼åŒº)
		auto dis = [&](int x1,int y1,int x2,int y2){
			return abs(x1-x2) + abs(y1-y2);
		};
		for(int i = 0;i < 2;i++){
			if(2*time >= dis(x,y,z[i].first,z[i].second)) return 0;
		}
		return 1;
	};
	for(int i = 1;i <= n;i++){
		cin >> s[i];s[i] = ' ' + s[i];
		for(int j = 1;j <= m;j++){
			if(s[i][j] == 'M') {q1.push({i,j});vis1[i][j] = 1;}
			if(s[i][j] == 'G') {q2.push({i,j});vis2[i][j] = 1;}
			if(s[i][j] == 'Z') z.push_back({i,j});
		}
	}
	while(q1.size() || q2.size()){
		time++;
		for(int t = 1;t <= 3;t++){//q1æ¯æ¬¡æ‹“å±•3å±‚
			int siz = q1.size();
			while(siz--){
				auto [x,y] = q1.front();
				q1.pop();
				if(!check(x,y,time)) continue;
				for(int i = 0;i < 4;i++){
					int nx = x + dx[i],ny = y + dy[i];
					if(nx < 1 || nx > n || ny < 1 || ny > m || s[nx][ny] == 'X' || vis1[nx][ny]) continue;
					if(vis2[nx][ny]) return time;
					vis1[nx][ny] = 1;
					q1.push({nx,ny});
				}
			}
		}
		for(int t = 1;t <= 1;t++){//q2æ¯æ¬¡æ‹“å±•ä¸€å±‚
			int siz = q2.size();
			while(siz--){
				auto [x,y] = q2.front();
				q2.pop();
				if(!check(x,y,time)) continue;
				for(int i = 0;i < 4;i++){
					int nx = x + dx[i],ny = y + dy[i];
					if(nx < 1 || nx > n || ny < 1 || ny > m || s[nx][ny] == 'X' || vis2[nx][ny]) continue;
					if(vis1[nx][ny])return time;
					vis2[nx][ny] = 1;
					q2.push({nx,ny});
				}
			}
		}
	}
	return -1;
}

int main(){
	int t;cin >> t;
	while(t--) cout << sol() << '\n';
}
```





**åŒå‘DFS**

[P10484 é€ç¤¼ç‰© - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10484)

> ç»™å®šNä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“ä½“ç§¯ä¸ºa[i]ï¼Œå’Œä¸€ä¸ªå®¹é‡ä¸ºMèƒŒåŒ…ï¼Œè¯·é—®æœ€å¤šèƒ½è£…å¤šå°‘ä½“ç§¯çš„ç‰©å“?
> å…¶ä¸­$N \leqslant 45,1 \leqslant a[i],M \leqslant 2^{31-1}$

æœ¬é¢˜ä½¿ç”¨èƒŒåŒ…æ±‚è§£çš„è¯ä½“ç§¯è¿‡å¤§ï¼ŒæŒ‡æ•°å‹æšä¸¾çš„è¯å¤æ‚åº¦è¿‡é«˜$2^{45}$ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠç¤¼ç‰©åˆ†æˆä¸¤åŠï¼Œå¯¹æ¯ä¸€åŠåˆ†åˆ«æœç´¢ï¼Œå°†å…¶èƒ½è¾¾åˆ°çš„ä½“ç§¯åˆ†åˆ«å­˜æ”¾äºä¸¤ä¸ªæ•°ç»„A,Bä¸­ï¼Œå¯¹Bæ•°ç»„è¿›è¡Œæ’åºï¼Œç„¶åéå†Aæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ x1ï¼Œåœ¨Bæ•°ç»„ä¸­äºŒåˆ†æ‰¾åˆ°x2ï¼Œä½¿å¾—`x1+x2 <= m`ï¼Œç”¨äºŒè€…ä¹‹å’Œæ›´æ–°ç­”æ¡ˆã€‚æ—¶é—´å¤æ‚åº¦ä¸º$O(2^{\frac{n}{2}+1})$

```cpp
#include <iostream>
#include <set>
#include <vector>
#include <algorithm>
using namespace std;
int n,m;

void dfs(vector<int>&v,vector<long long>&w,int id,long long sum){
	if(sum > m) return;
	if(id == v.size()){
		w.emplace_back(sum);
		return;
	}
	dfs(v,w,id+1,sum+v[id]);
	dfs(v,w,id+1,sum);
}

int main(){
	cin >> m >> n;
	vector<int>v1,v2;
	vector<long long>w1,w2;
	int mid = (n+1)/2;
	for(int i = 1;i <= mid;i++){
		int x;cin >> x;
		v1.emplace_back(x);
	}
	for(int i = mid+1;i <= n;i++){
		int x;cin >> x;
		v2.emplace_back(x);
	}
	dfs(v1,w1,0,0);
	dfs(v2,w2,0,0);
	sort(w2.begin(),w2.end());
	long long ans = 0;
	for(auto x1:w1){
		auto x2 = --upper_bound(w2.begin(),w2.end(),m-x1);
		ans = max(ans,x1+*x2);
	}
	cout << ans;
}
```







### A*

ä¸ºäº†æé«˜æœç´¢æ•ˆç‡ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªâ€œä¼°ä»·å‡½æ•°â€ï¼Œå°†â€œå½“å‰ä»£ä»·+æœªæ¥ä¼°ä»·â€çš„æœ€å°çŠ¶æ€ä½œä¸ºå †é¡¶è¿›è¡Œæ‹“å±•ã€‚
ä¸ºäº†ä¿è¯ç¬¬ä¸€æ¬¡ä»å †ä¸­å–å‡ºç›®æ ‡çŠ¶æ€æ—¶å¾—åˆ°çš„å°±æ˜¯æœ€ä¼˜è§£ï¼Œæˆ‘ä»¬è®¾è®¡çš„ä¼°ä»·å‡½æ•°f(state)ä¸èƒ½å¤§äºæœªæ¥çš„å®é™…ä»£ä»·g(state)ã€‚
è¿™ç§å¸¦æœ‰ä¼°ä»·å‡½æ•°çš„ä¼˜å…ˆé˜Ÿåˆ—BFSå°±ç§°ä¸ºA*ç®—æ³•ã€‚



[178. ç¬¬KçŸ­è·¯ - AcWingé¢˜åº“](https://www.acwing.com/problem/content/180/)

> ç»™å®šNä¸ªç‚¹ï¼ŒMæ¡è¾¹çš„æœ‰å‘å›¾ï¼Œæ±‚ä»èµ·ç‚¹ståˆ°ç»ˆç‚¹edçš„ç¬¬kçŸ­è·¯ï¼ˆå…è®¸ç»è¿‡é‡å¤ç‚¹æˆ–è¾¹ï¼‰ã€‚

åœ¨ä¼˜å…ˆé˜Ÿåˆ—BFSä¸­ï¼Œå½“èŠ‚ç‚¹xç¬¬kæ¬¡è¢«å–å‡ºæ—¶ï¼Œå½“å‰ä»£ä»·å³ä¸ºç¬¬kå°ä»£ä»·ã€‚è€ƒè™‘A*ä¼˜åŒ–ã€‚

1. æˆ‘ä»¬ä»¥ç‚¹xåˆ°ç»ˆç‚¹edçš„æœ€çŸ­è·ç¦»ä½œä¸ºä¼°ä»·å‡½æ•°f(x)ï¼Œå»ºåå›¾ä»¥edä¸ºèµ·ç‚¹æ±‚å•æºæœ€çŸ­è·¯å³å¯æ±‚å¾—f(x)ã€‚
2. å»ºç«‹äºŒå‰å †ï¼Œå­˜å‚¨äºŒå…ƒç»„`(x,dist + f(x))`ï¼Œxè¡¨ç¤ºå½“å‰èŠ‚ç‚¹ï¼Œdistä»£è¡¨å½“å‰å®é™…ä»£ä»·ï¼Œf(x)è¡¨ç¤ºé¢„ä¼°ä»£ä»·ã€‚æœ€åˆå †ä¸­åªæœ‰`(st,0+f(st))`
3. ä»å †é¡¶å–å‡º`dist + f(x)`çš„æœ€å°äºŒå…ƒç»„è¿›è¡Œæ‹“å±•ï¼Œå¦‚æœèŠ‚ç‚¹yè¢«å–å‡ºçš„æ¬¡æ•°å°šæœªè¾¾åˆ°kæ¬¡ï¼Œå°±æŠŠæ–°çš„äºŒå…ƒç»„`(y,(dist+w[i])+f(y))`æ’å…¥å †ä¸­ã€‚
4. é‡å¤3æ“ä½œï¼Œç›´åˆ°ç»ˆç‚¹edè¢«å–å‡ºäº†kæ¬¡ï¼Œæ­¤æ—¶çš„distå³ä¸ºä»ståˆ°edçš„ç¬¬kçŸ­è·¯ã€‚

A*ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸Šç•Œä»ä¸ä¼˜å…ˆé˜Ÿåˆ—BFSç›¸åŒ$O(K(N+M)log(N+M))$ï¼Œä¸è¿‡ç”±äºä¼°ä»·å‡½æ•°çš„ä½œç”¨ï¼Œå›¾ä¸­å¾ˆå¤šèŠ‚ç‚¹è®¿é—®çš„æ¬¡æ•°éƒ½è¿œå°äºkï¼Œå¯¹äºå¤§å¤šæ•°æ•°æ®ï¼Œèƒ½æ¯”è¾ƒå¿«åœ°æ±‚å‡ºç»“æœï¼Œä½†èƒ½æ„é€ å‡ºæ•°æ®ï¼Œä½¿å¾—ç®—æ³•è¶…æ—¶/è¶…ç©ºé—´ï¼Œæ­£è§£åº”ä¸ºå¯æŒä¹…åŒ–å¯å¹¶å †åšæ³•ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 1003,M = 10004;
int n,m,st,ed,k;
int h[N],e[M],ne[M],w[M],idx;
int f[N];
int vis[N];

struct edge{
	int a,b,c;
}in[M];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dijkstra(){
	memset(f,0x3f,sizeof f);
	priority_queue<pair<int,int>,vector<pair<int,int>>,greater<pair<int,int>>>pq;
	pq.push({0,ed});
	f[ed] = 0;
	while(pq.size()){
		int x = pq.top().second;
		pq.pop();
		if(vis[x]) continue;
		else vis[x] = 1;
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(f[y] > f[x] + w[i]){
				f[y] = f[x] + w[i];
				pq.push({f[y],y});
			}
		}
	}
}

struct node{
	int x,dist;
	bool operator < (const node &e2)const{
		return dist + f[x] > e2.dist + f[e2.x];
	}
};

int astar(){
	memset(vis,0,sizeof vis);
	priority_queue<node>pq;
	pq.push({st,0});
	while(pq.size()){
		auto [x,dist] = pq.top();
		pq.pop();
		vis[x]++;
		if(vis[ed] == k) return dist;

		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(vis[y] <= k) pq.push({y,dist+w[i]});
		}
	}
	return -1;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		auto &[a,b,c] = in[i]; cin >> a >> b >> c;
		add(b,a,c);
	}
	cin >> st >> ed >> k;
	if(st == ed) k++;

	dijkstra();

	idx = 0;
	memset(h,-1,sizeof h);
	for(int i = 1;i <= m;i++){
		auto [a,b,c] = in[i];
		add(a,b,c);
	}

	cout << astar();
}
```



#### IDA*

IDA* ä¸ºé‡‡ç”¨äº†è¿­ä»£åŠ æ·±ç®—æ³•çš„ A* ç®—æ³•ã€‚





### Dancing Links

æ—¶é—´å¤æ‚åº¦ä¸çŸ©é˜µä¸­1çš„ä¸ªæ•°æœ‰å…³ï¼Œä¸çŸ©é˜µrï¼Œcç­‰å‚æ•°æ— å…³ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯æŒ‡æ•°çº§çš„$O(c^n)$ï¼Œå…¶ä¸­cä¸ºæŸä¸ªéå¸¸æ¥è¿‘1çš„å¸¸æ•°ï¼Œnä¸ºçŸ©é˜µä¸­1çš„ä¸ªæ•°ï¼Œå°¤å…¶æ“…é•¿å¤„ç†ç¨€ç–çŸ©é˜µã€‚

<img src="https://oi-wiki.org/search/images/dlx-2.svg" alt="dlx-2.svg" style="zoom:50%;" /> 

#### ç²¾ç¡®è¦†ç›–

[P4929 ã€æ¨¡æ¿ã€‘èˆè¹ˆé“¾ï¼ˆDLXï¼‰ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4929)

> ç»™å®šNè¡ŒMåˆ—çš„çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ è¦ä¹ˆæ˜¯1ï¼Œè¦ä¹ˆæ˜¯0ã€‚è¯·ä»ä¸­æŒ‘é€‰è¯ºå¹²è¡Œï¼Œä½¿å¾—æ¯åˆ—æœ‰ä¸”ä»…æœ‰ä¸€è¡Œæœ‰1ã€‚è¾“å‡ºä»»æ„ä¸€ä¸ªæ–¹æ¡ˆå³å¯ï¼Œé¡ºåºéšæ„ã€‚$N,M \le 500$ï¼Œä¿è¯1çš„ä¸ªæ•°ä¸è¶…è¿‡5000ã€‚

```cpp
#include <iostream>
#include <vector>

std::vector<int>res;

struct DLX{//1_idx
	int n,m,idx;
	std::vector<int>first,siz,stk;//siz[c]å­˜ç¬¬cåˆ—çš„å…ƒç´ ä¸ªæ•°,stkå­˜ç­”æ¡ˆ,first[r]æŒ‡å‘ç¬¬rè¡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
	std::vector<int>L,R,U,D;//åå­—å¾ªç¯é“¾è¡¨
	std::vector<int>col,row;//å­˜æ”¾ç¬¬idxä¸ªå…ƒç´ çš„åˆ—å·¦è¾¹å’Œè¡Œåæ ‡

	int ans;

	void init(const int &r,const int &c){
		ans = 1e9;
		n = r,m = c;
		first.resize(n+1),siz.resize(m+1);
		L.resize(m+1),R.resize(m+1),U.resize(m+1),D.resize(m+1);
		col.resize(m+1),row.resize(m+1);
		for(int i = 0;i <= m;i++){
			L[i] = i-1,R[i] = i+1;
			U[i] = D[i] = i;
		}
		L[0] = m,R[m] = 0;
		idx = m+1;
	}

	void remove(const int &c){//åˆ é™¤ç¬¬cåˆ—,ä»¥åŠå…¶å®ƒä¸å®ƒç›¸å…³çš„è¡Œ
		L[R[c]] = L[c],R[L[c]] = R[c];
		for(int i = D[c];i != c;i = D[i]){
			for(int j = R[i];j != i;j = R[j]){
				U[D[j]] = U[j];
				D[U[j]] = D[j];
				siz[col[j]]--;
			}
		}
	}

	void recover(const int &c){//è¿˜åŸç¬¬cåˆ—,ä»¥åŠå…¶å®ƒä¸å®ƒç›¸å…³çš„è¡Œ,å³removeçš„é€†æ“ä½œ
		for(int i = U[c];i != c;i = U[i]){
			for(int j = L[i];j != i;j = L[j]){
				U[D[j]] = D[U[j]] = j;
				siz[col[j]]++;
			}
		}
		L[R[c]] = R[L[c]] = c;
	}

	bool dance(){//ç²¾ç¡®è¦†ç›–
		if(stk.size() >= ans) return 0;//å‰ªæ:å¦‚æœå½“å‰å·²ç»è¶…è¿‡æœ€ä¼˜è§£,ç›´æ¥è¿”å›
		if(!R[0]){//å¦‚æœ0å·èŠ‚ç‚¹æ²¡æœ‰å³èŠ‚ç‚¹,é‚£ä¹ˆçŸ©é˜µä¸ºç©º,è®°å½•ç­”æ¡ˆå¹¶è¿”å›
			ans = stk.size(); //å½“å‰stk[]å³ä¸ºä¸€ç»„è§£
			res = stk;
			return 1;
		}
		int c = R[0];
		for(int i = R[0];i != 0;i = R[i]){
			if(siz[i] < siz[c]) c = i;
		}
		remove(c);//ä¼˜å…ˆé€‰æ‹©å…ƒç´ ä¸ªæ•°æœ€å°‘å¾—ä¸€åˆ—c,å¹¶åˆ é™¤è¿™ä¸€åˆ—
		for(int i = D[c];i != c;i = D[i]){//éå†è¿™ä¸€åˆ—å…¶å®ƒæ‰€æœ‰æœ‰1çš„è¡Œ,é€’å½’æšä¸¾æ˜¯å¦é€‰æ‹©å®ƒ
			stk.push_back(row[i]);
			for(int j = R[i];j != i;j = R[j]) remove(col[j]);
			if(dance()) return 1;  //ä»»æ„è§£
//			dance();//æœ€å°è§£
			for(int j = L[i];j != i;j = L[j]) recover(col[j]);
			stk.pop_back();
		}
		recover(c);
		return 0;
	}
    
	void remove2(const int &c){//é‡å¤è¦†ç›–é—®é¢˜ä¸­åªéœ€è¦åˆ é™¤å½“å‰åˆ—
		for(int i = D[c];i != c;i = D[i]){ 
            L[R[i]] = L[i]; R[L[i]] = R[i]; 
        }
	}

	void recover2(const int &c){
		for(int i = U[c];i != c;i = U[i]){ 
            L[R[i]] = R[L[i]] = i; 
        }
	}

	int f(){//ä¼°ä»·å‡½æ•°
		int res = 0;
		std::vector<int>vis(m+1);
		for(int i = R[0];i != 0;i = R[i]){
			if(vis[i]) continue;
			vis[i] = 1;
			res++;
			for(int j = D[i];j != i;j = D[j]){
				for(int k = R[j];k != j;k = R[k]){
					vis[col[k]] = 1;
				}
			}
		}
		return res;
	}

	bool dance2(){//é‡å¤è¦†ç›–
		if(stk.size() + f() >= ans) return 0;
		if(!R[0]) {
			ans = stk.size();
			return 1;
		}
		int c = R[0];
		for(int i = R[0];i != 0;i = R[i]){
			if(siz[i] < siz[c]) c = i;
		}
		for(int i = D[c];i != c;i = D[i]){
			for(int j = R[i];j != i;j = R[j]) remove2(j);
			remove2(i);
			stk.push_back(row[i]);
//			if(dance2()) return 1;  ä»»æ„è§£
			dance2();//æœ€å°è§£
			stk.pop_back();
			recover2(i);
			for(int j = L[i];j != i;j = L[j]) recover2(j);
		}
		return 0;
	}

	void insert(const int &r,const int &c){//åœ¨ç¬¬rè¡Œ,ç¬¬cåˆ—æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹
		col.push_back(c),row.push_back(r);
		siz[c]++;
		U.push_back(c),D.push_back(D[c]);
		U[D[c]] = idx; D[c] = idx;
		if(first[r] == 0){//å¦‚æœç¬¬rè¡Œæ²¡æœ‰å…ƒç´ ,é‚£ä¹ˆç›´æ¥æ’å…¥ä¸€ä¸ªå…ƒç´ ,å¹¶ä½¿first[r]æŒ‡å‘è¯¥å…ƒç´ 
			first[r] = idx;
			L.push_back(idx),R.push_back(idx);
		}
		else{//å¦åˆ™æŠŠidxæ’å…¥åˆ°cçš„æ­£ä¸‹æ–¹,æŠŠidxæ’å…¥åˆ°first(r)çš„æ­£å³æ–¹
			R.push_back(R[first[r]]);
			L[R[first[r]]] = idx;
			L.push_back(first[r]);
			R[first[r]] = idx;
		}
		idx++;
	}
};


int main() {
	int n,m; std::cin >> n >> m;
	DLX dlx;
	dlx.init(n,m);
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			int x;std::cin >> x;
			if(x) dlx.insert(i,j);
		}
	}
	dlx.dance();
	if(dlx.ans == 1e9) {
		std::cout << "No Solution!";
	}
	else{
		for(auto x:res){
			std::cout << x << ' ';
		}
	}
}
```



[P1784 æ•°ç‹¬ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P1784)

> æ±‚è§£å¤§å°ä¸ºw*wçš„æ•°ç‹¬

```cpp
#include <iostream>
#include <vector>

const int N = 10;
int w = 9;
int sw = 3;//sqrt(w)
int a[N][N];

int main(){
	DLX dlx;
	dlx.init(w*w*w,w*w*4);
	for(int i = 0;i < w;i++){
		for(int j = 0;j < w;j++){
			std::cin >> a[i][j];
			for(int k = 1;k <= w;k++){
				if(a[i][j] != 0 && a[i][j] != k) continue;
				int id = i*w*w + j*w + k;
				dlx.insert(id,i*w + j + 1);
				dlx.insert(id,i*w + w*w + k);
				dlx.insert(id,j*w + w*w*2 + k);
				dlx.insert(id,w*w*3 + (i/sw*sw + j/sw)*w + k);
			}
		}
	}

	dlx.dance();

	for(int i = 0;i < w;i++){
		for(int j = 0;j < w;j++){
			std::cout << a[i][j] << ' ';
		}
		std::cout << '\n';
	}
}
```



#### é‡å¤è¦†ç›–

removeã€recoverã€danceæ“ä½œç•¥æœ‰ä¸åŒã€‚
è°ƒç”¨dlx.dance2()å³å¯ã€‚

å› ä¸ºé‡å¤è¦†ç›–é—®é¢˜æ–¹æ¡ˆä¸€èˆ¬æ¯”ç²¾ç¡®è¦†ç›–å¤šï¼Œæœç´¢åŸºäºIDA*ä¼˜åŒ–ï¼ŒåŠ å…¥äº†ä¼°ä»·å‡½æ•°f()ã€‚

[Luogu è“æ¡¥æ¯2019çœA ç³–æœ)](https://www.luogu.com.cn/record/221885738)





## å€å¢

> å€å¢æ³•ï¼ˆè‹±è¯­ï¼šbinary liftingï¼‰ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç¿»å€ã€‚å®ƒèƒ½å¤Ÿä½¿çº¿æ€§çš„å¤„ç†è½¬åŒ–ä¸ºå¯¹æ•°çº§çš„å¤„ç†ï¼Œå¤§å¤§åœ°ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ã€‚
>
> è¿™ä¸ªæ–¹æ³•åœ¨å¾ˆå¤šç®—æ³•ä¸­å‡æœ‰åº”ç”¨ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ RMQ é—®é¢˜å’Œæ±‚ LCA(æœ€è¿‘å…¬å…±ç¥–å…ˆ)ã€‚





### STè¡¨

STè¡¨(Sparse Table,ç¨€ç–è¡¨)åŸºäºå€å¢æ€æƒ³,ç”¨äºè§£å†³[å¯é‡å¤è´¡çŒ®é—®é¢˜][åŒºé—´é‡åˆåŒºåŸŸä¸å½±å“ç»“æœï¼Œå¦‚ã€ŒRMQ ã€ã€ã€ŒåŒºé—´æŒ‰ä½ä¸ã€ã€ã€ŒåŒºé—´æŒ‰ä½æˆ–ã€ã€ã€ŒåŒºé—´ GCDã€]çš„æ•°æ®ç»“æ„ï¼Œ**ä¸æ”¯æŒä¿®æ”¹**
O($N\log N$)é¢„å¤„ç†  O(1)æŸ¥è¯¢

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240814143114839.png" alt="image-20240814143114839" style="zoom:50%;" />  

ä»¤$st(i,j)$è¡¨ç¤ºåŒºé—´$[i,i+2^j-1]$çš„æœ€å¤§å€¼ï¼Œæ˜¾ç„¶$st(i,0)=a_i$
æ ¹æ®å®šä¹‰å¼ï¼Œç¬¬äºŒç»´å°±ç›¸å½“äºå€å¢çš„æ—¶å€™ã€Œè·³äº† $2^j-1$ æ­¥ã€ï¼Œä¾æ®å€å¢çš„æ€è·¯ï¼Œå†™å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š$st(i,j)=\max(st(i,j-1),st(i+2^{j-1},j-1))$

å¯¹äºæ¯ä¸ªè¯¢é—® $[l,r]$ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†æˆä¸¤éƒ¨åˆ†ï¼š$[l,l+2^s-1]$ ä¸ $[r-2^s+1,r]$ï¼Œå…¶ä¸­ $s=\left\lfloor\log_2(r-l+1)\right\rfloor$ã€‚ä¸¤éƒ¨åˆ†çš„ç»“æœçš„æœ€å¤§å€¼å°±æ˜¯å›ç­”ã€‚

```cpp
//https://www.luogu.com.cn/problem/P2880
#include <bits/stdc++.h>
using namespace std;

namespace S_T{ //1_idx
	const int N = 1000006;
	int lg2[N];

	struct info{
		long long mx,mn; //mn,gcd,and,or;

		info(){}
		info(const int &x) { //init_info
			mx = mn = x;
		}

		info friend operator + (const info &e1,const info &e2) { //updaet_info
			info ans;
			ans.mx = std::max(e1.mx,e2.mx);
			ans.mn = std::min(e1.mn,e2.mn);
			return ans;
		}
	};


	void init_lg2(){ //ä¸‹å–æ•´
		lg2[0] = -1;
		for(int i = 1;i < N;i++){
			lg2[i] = lg2[i>>1]+1;
		}
	}

	template<typename T>
	struct ST{
		int n,m;
		std::vector<std::vector<info>>st;

		ST(){}
		ST(const T &v) {
			if(~lg2[0]) init_lg2();
			n = v.size()-1,m = lg2[v.size()];
			st = std::vector<std::vector<info>>(n+1,std::vector<info>(m+1));

			for(int i = 1;i < v.size();i++){ st[i][0] = v[i]; }
			for(int j = 1;(1<<j) < v.size();j++){
				int pj = 1 << (j-1);
				for(int i = 1;i+(1<<j)-1 < v.size();i++){
					st[i][j] = st[i][j-1] + st[i+pj][j-1];
				}
			}
		}

		info query(int l,int r) {
			int x = lg2[r-l+1];
			info ans = st[l][x] + st[r-(1<<x)+1][x];
			return ans;
		}
	};
}
using S_T::ST,S_T::info;

int main() {
	int n,q; std::cin >> n >> q;
	vector<int> a(n+1);
	for(int i = 1;i <= n;i++){
		std::cin >> a[i];
	}
	ST t(a);
	while(q--){
		int l,r; std::cin >> l >> r;
		auto ans = t.query(l,r);
		std::cout << ans.mx - ans.mn << '\n';
	}
}
```







## æ ¹å·åˆ†æ²»

æ ¹å·åˆ†æ²»ï¼Œæ˜¯ä¸€ç§å¯¹æ•°æ®è¿›è¡Œç‚¹åˆ†æ²»çš„åˆ†æ²»æ–¹å¼ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¼˜åŒ–æš´åŠ›ç®—æ³•ï¼Œç±»ä¼¼ä¸åˆ†å—ï¼Œä½†åº”ç”¨èŒƒå›´æ¯”åˆ†å—æ›´å¹¿ã€‚

å…·ä½“æ¥è¯´ï¼Œå¯¹äºæ‰€è¿›è¡Œçš„æ“ä½œï¼ŒæŒ‰ç…§æŸä¸ªç‚¹Båˆ’åˆ†ï¼Œåˆ†ä¸ºå¤§äºBä»¥åŠå°äºBä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸¤éƒ¨åˆ†ä½¿ç”¨ä¸åŒçš„æ–¹å¼å¤„ç†ã€‚ï¼ˆä¸€èˆ¬ä»¥æ ¹å·ä¸ºåˆ†ç•Œ$B = \sqrt{N}$ï¼Œè¿™æ ·å¤æ‚åº¦æœ€å¹³è¡¡ï¼‰ã€‚å°†ä¸¤ä¸ªæš´åŠ›ç®—æ³•â€œæ‹¼æ¥åœ¨ä¸€èµ·â€ï¼Œå®ç°ä¼˜åŒ–å¤æ‚åº¦çš„ä½œç”¨ã€‚



[Colorful Graphï¼ˆâ˜…6ï¼‰ - AtCoder typical90_ce - Virtual Judge (vjudge.net)](https://vjudge.net/problem/AtCoder-typical90_ce#author=GPT_zh)

> ç»™å®šNä¸ªç‚¹Mæ¡è¾¹çš„æ— å‘å›¾ï¼Œåˆå§‹æ—¶æ¯ä¸ªç‚¹é¢œè‰²ä¸º1ã€‚å†ç»™å®šQæ¬¡æŸ¥è¯¢ï¼Œæ¯æ¬¡æŸ¥è¯¢ç»™å®šä¸¤ä¸ªæ•´æ•°{x,c}ï¼Œè¾“å‡ºå½“å‰ç‚¹xçš„é¢œè‰²ï¼Œç„¶åå°†ç‚¹xåŠå…¶æ‰€æœ‰ç›¸é‚»çš„ç‚¹é¢œè‰²æ”¹ä¸ºcã€‚$1 \le N,M,Q \le 2e5$

`ans[x]={time,color}`è¡¨ç¤ºå½“å‰ç‚¹æœ€åè¢«æ›´æ–°æ—¶çš„æ—¶é—´æˆ³å’Œé¢œè‰²ï¼Œ`flag[x]={time,color}`flagçŠ¶æ€æ ‡è®°ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹åœ¨timeæ—¶æ›´æ–°åº”å‘¨å›´èŠ‚ç‚¹ä¸ºcolorã€‚
ä»¥åº¦æ•°æ˜¯å¦å¤§äº$\sqrt{N}$ä¸ºåˆ†ç•Œï¼Œå°†ç‚¹åˆ’åˆ†ä¸ºé‡ç‚¹å’Œè½»ç‚¹ã€‚è½»ç‚¹ç›´æ¥æšä¸¾ï¼Œé‡ç‚¹æ‰“æ ‡è®°ã€‚
æŸ¥è¯¢å½“å‰ç‚¹ï¼šå¯¹äºè½»ç‚¹ï¼Œç›´æ¥æšä¸¾æ‰€æœ‰é‚»æ¥ç‚¹æ›´æ–°è‡ªèº«ã€‚å¯¹äºé‡ç‚¹ï¼Œæœ¬èº«å·²ç»è¢«å…¶å®ƒç‚¹æ›´æ–°ã€‚
æ›´æ–°é‚»æ¥ç‚¹ï¼šåªéœ€è¦æ›´æ–°å‘¨å›´çš„é‡ç‚¹ã€‚

```cpp
#include <bits/stdc++.h>

int main(){
	int n,m;std::cin >> n >> m;
	int sn = sqrt(m<<1);

	std::vector<std::vector<int>>e(n+1);
	std::vector<int>du(n+1);
	for(int i = 1;i <= m;i++){
		int x,y;std::cin >> x >> y;
		e[x].emplace_back(y);
		e[y].emplace_back(x);
		du[x]++; du[y]++;
	}

	for(int i = 1;i <= n;i++){
		std::sort(e[i].begin(),e[i].end(),[&](int x,int y){return du[x] > du[y];});
	}

	std::vector<std::pair<int,int>>ans(n+1,{0,1}),flag(n+1,{0,1});

	int q;std::cin >> q;
	for(int i = 1;i <= q;i++){
		int x,c;std::cin >> x >> c;
		if(du[x] <= sn){
			for(auto& y:e[x]){
				ans[x] = std::max(ans[x],flag[y]);
			}
		}
		std::cout << ans[x].second << '\n';
		ans[x] = flag[x] = {i,c};
		for(auto& y:e[x]){
			if(du[y] <= sn) break;
			ans[y] = flag[x];
		}
	}
}
```



------



# æ•°æ®ç»“æ„

## åŸºæœ¬æ•°æ®ç»“æ„

### é“¾è¡¨

#### å•é“¾è¡¨

```cpp
const int N = 100010;
//head è¡¨ç¤ºå¤´èŠ‚ç‚¹çš„ä¸‹æ ‡
//e[i] è¡¨ç¤ºèŠ‚ç‚¹içš„å€¼
//ne[i] è¡¨ç¤ºèŠ‚ç‚¹içš„nextæŒ‡é’ˆæ˜¯å¤šå°‘
//idx å‚¨å­˜å½“å‰å·²ç»ç”¨åˆ°äº†å“ªä¸ªç‚¹
int head, e[N], ne[N], idx;                                                                                                                              
//åˆå§‹åŒ–
void init() {
	head = -1;
	idx = 0;
}
```

```cpp
//å°†xæ’åˆ°å¤´èŠ‚ç‚¹
void add_to_head(int x) {
	e[idx] = x;
	ne[idx] = head;	//xæŒ‡å‘å¼€å¤´
	head = idx;		//xçš„ä½ç½®å˜ä¸ºæ–°çš„å¼€å¤´
	idx++;
}
```

```cpp
//å°†xæ’åˆ°ä¸‹æ ‡æ˜¯kçš„ç‚¹çš„åé¢(æ³¨æ„ä¸‹æ ‡ä»0å¼€å§‹)
void add(int k, int x) {
	e[idx] = x;
	ne[idx] = ne[k];  //xæŒ‡å‘kçš„åä¸€ä½
	ne[k] = idx;	  //kå†æŒ‡å‘x
	idx++;
}
```

```cpp
//å°†ä¸‹æ ‡æ˜¯kçš„ç‚¹çš„åé¢ä¸€ä¸ªç‚¹åˆ æ‰
void remove(int k) {
	ne[k] = ne[ne[k]];//åŸæ¥æŒ‡å‘kçš„åä½æ”¹ä¸ºæŒ‡å‘kåä½çš„åä½
}
```

```cpp
//éå†é“¾è¡¨
for(int i = head;i != -1;i = ne[i]){
    cout << e[i] << " ";
}
```



```cpp
//https://www.acwing.com/problem/content/828/
#include <bits/stdc++.h>
using namespace std;
const int N = 100005;
int e[N], ne[N], idx,h = -1;

void add_to_head(int x) {
	e[idx] = x;
	ne[idx] = h;
	h = idx++;
}

void add(int k, int x) {
	e[idx] = x;
	ne[idx] = ne[k];
	ne[k] = idx++;
}

void del(int k) {
	ne[k] = ne[ne[k]];
}

int main() {

	int t; cin >> t;
	for (int i = 1; i <= t;i++) {
		char op; cin >> op;
		if (op == 'I') {
			int k, x; cin >> k >> x;
			add(k - 1, x);//ç¬¬kä¸ªæ•°ï¼Œä¸‹æ ‡ä¸ºk-1
		}
		if (op == 'H') {
			int x; cin >> x;
			add_to_head(x);
		}
		if (op == 'D') {
			int k; cin >> k;
			if (k == 0) h = ne[h];//k == 0 è¡¨ç¤ºåˆ é™¤å¤´ç»“ç‚¹
			else del(k-1);
		}
	}

	for (int i = h; i != -1; i = ne[i]) cout << e[i] << " ";
	
	return 0;
}
```



#### åŒé“¾è¡¨

```cpp
const int N = 100010;
int e[N], l[N], r[N], idx;

//åˆå§‹åŒ–
void init() {
	//0è¡¨ç¤ºå·¦ç«¯ç‚¹ï¼Œ1è¡¨ç¤ºå³ç«¯ç‚¹
	r[0] = 1, l[1] = 0;
    idx = 2;	//ä»2å¼€å§‹
}
```

```cpp
//åœ¨ä¸‹æ ‡ä¸ºkçš„å³è¾¹æ’å…¥å€¼x
void addr(int k, int x) {
	e[idx] = x;		
	r[idx] = r[k];	//xçš„å³è¾¹æŒ‡å‘kçš„ä¸‹ä¸€ä½
	l[idx] = k;		//xçš„å·¦è¾¹æŒ‡å‘k
	l[r[k]] = idx;	//kçš„ä¸‹ä¸€ä½çš„å·¦è¾¹æŒ‡å‘x (æ³¨æ„ä¸ä¸‹ä¸€æ¡è¯­å¥é¡ºåºä¸èƒ½å†™å)
	r[k] = idx;		//kçš„å³è¾¹æŒ‡å‘x
}
```

```cpp
//åœ¨ä¸‹æ ‡ä¸ºkçš„å·¦è¾¹æ’å…¥å€¼x
void addl(int k, int x) {
	addr(l[k], x); 	//ç›¸å½“äºåœ¨kå·¦è¾¹ä¸€ä¸ªæ•°çš„å³è¾¹æ’å…¥x
}
```

```cpp
//åˆ é™¤ä¸‹æ ‡ä¸ºkçš„ç‚¹
void remove(int k) {
	r[l[k]] = r[k]; //è®©åŸæ¥å³è¾¹æŒ‡å‘kçš„æŒ‡é’ˆ æŒ‡å‘kçš„å³è¾¹
	l[r[k]] = l[k];	//è®©åŸæ¥å·¦è¾¹æŒ‡å‘kçš„æŒ‡é’ˆ æŒ‡å‘kçš„å·¦è¾¹
}
```



[APIO/CTSC2007(æ•°æ®å¤‡ä»½)](https://www.luogu.com.cn/problem/P3620)

é—®é¢˜è½¬åŒ–ä¸ºå·®åˆ†æ•°ç»„ $a_1$ ~ $a_{n-1}$  ä¸­é€‰åˆ™å„ä¸ç›¸é‚»çš„kä¸ªæ•°   

```cpp
#include <iostream>
#include <queue>
using ll = long long;
using namespace std;
const ll inf = 1e18;
const int N = 100005;
int n,k;
ll a[N];
ll ne[N],la[N],s[N];//åŒé“¾è¡¨
bool del[N];//æ ‡è®°å½“å‰èŠ‚ç‚¹æ˜¯å¦å·²ç»åˆ é™¤
ll ans;

struct Edge{
	ll id,x;
	bool operator < (const Edge &e) const {
		return x > e.x;//ä¼˜å…ˆé˜Ÿåˆ—å°æ ¹å †
	}
};

int main(){
	cin >> n >> k;
	priority_queue<Edge>pq;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		if(i > 1) s[i-1] = a[i] - a[i-1];
	}

	s[0] = s[n] = inf;//å·¦å³ä¸¤è¾¹è®¾ç½®å“¨å…µ
	for(int i = 1;i < n;i++){
		pq.push({i,s[i]});
		ne[i] = i+1;
		la[i] = i-1;
	}
	
	while(k--){
		while(del[pq.top().id]) pq.pop();//è¯ºè¯¥ç‚¹å·²ç»è¢«åˆ é™¤ï¼Œåˆ™ç›´æ¥å¼¹å‡º
		auto [id,x] = pq.top();
		pq.pop();
		ans += x;//é€‰æ‹©å½“å‰èŠ‚ç‚¹

		//åˆ é™¤å½“å‰èŠ‚ç‚¹å’Œå·¦å³ä¸¤è¾¹çš„èŠ‚ç‚¹ï¼Œåœ¨å½“å‰èŠ‚ç‚¹ä½ç½®æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹
		//è¯ºæœªæ¥é€‰äº†è¯¥æ–°èŠ‚ç‚¹ï¼Œåˆ™ç›¸å½“äºä¸é€‰å½“å‰èŠ‚ç‚¹ï¼Œé€‰æ‹©å½“å‰èŠ‚ç‚¹å·¦å³ä¸¤è¾¹çš„èŠ‚ç‚¹
		s[id] = s[la[id]] + s[ne[id]] - s[id];
		Edge e = {id,s[id]};
		pq.push(e);

		del[ne[id]] = del[la[id]] = 1;//åˆ é™¤å·¦å³ä¸¤è¾¹çš„èŠ‚ç‚¹
		la[id] = la[la[id]];
		ne[id] = ne[ne[id]];
		ne[la[id]] = id;
		la[ne[id]] = id;
	}
	cout << ans;
}
```







### æ ˆ

> å…ˆè¿›åå‡º

```cpp
#include <iostream>
using namespace std;
const int N = 100010;
//ttè¡¨ç¤ºæ ˆå°¾
int stk[N], tt;

//æ’å…¥
stk[++tt] = x;

//å¼¹å‡º
tt--;

//åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º
if (tt > 0) not empty
else empty

//æ ˆé¡¶
stk[tt];
```

```cpp
//å¸¦æœ€å°å€¼çš„æ ˆ
//æ–°å»ºä¸€ä¸ªæ ˆB,æ¯æ¬¡Aå…¥æ ˆxæ—¶,Bå…¥æ ˆmin(B.top(),x);
stack<int>A,B;

void push(int x){
	A.push(x);
	if(B.empty()) B.push(x);
	else B.push(min(x,B.top()));
}

void pop(){
	A.pop();
	B.pop();
}

int top(){
	return A.top();
}

int getmin(){
	return B.top();
}
```



```cpp
//ç«è½¦è¿›ç«™æ–¹æ¡ˆ  https://www.acwing.com/problem/content/131/
#include <iostream>
#include <vector>
#include <stack>
using namespace std;
const int N = 30;
int n,rest;
vector<int>p;//på­˜å·²ç»å‡ºç«™çš„åºåˆ—
stack<int>st;//æ ˆ

void dfs(int u){
	if(rest >= 20) return;
	if(p.size() == n){//è¾¹ç•Œæ¡ä»¶ï¼Œå¦‚æœå…¨éƒ¨å‡ºç«™åˆ™è¾“å‡ºåºåˆ—
		rest++;
		for(auto &x:p) cout << x;
		cout << endl;
		return;
	}
	if(st.size()){//æƒ…å†µä¸€ï¼šæ ˆä¸­å…ƒç´ å‡ºç«™
		p.push_back(st.top());
		st.pop();
		dfs(u);
		st.push(p.back());//è¿˜åŸç°åœº
		p.pop_back();
	}
	if(u <= n){//æƒ…å†µäºŒï¼šç«è½¦å…¥æ ˆ
		st.push(u);
		dfs(u+1);
		st.pop();//è¿˜åŸç°åœº
	}
}

int main(){
	cin >> n;
	dfs(1);
	return 0;
}
```



#### è¡¨è¾¾å¼è®¡ç®—

ä¸­ç¼€è¡¨è¾¾å¼ï¼šA op B
å‰ç¼€è¡¨è¾¾å¼ï¼šop A B		ï¼ˆæ³¢å…°å¼ï¼‰
åç¼€è¡¨è¾¾å¼ï¼šA B op		ï¼ˆé€†æ³¢å…°å¼ï¼‰

**åç¼€è¡¨è¾¾å¼æ±‚å€¼**

åç¼€è¡¨è¾¾å¼å¯¹äºè®¡ç®—æœºæ¥è®²å®¹æ˜“å®ç°

> å»ºç«‹ä¸€ä¸ªç”¨äºå­˜å‚¨æ•°çš„æ ˆï¼Œé€ä¸€æ‰«æè¯¥åç¼€è¡¨è¾¾å¼ä¸­çš„å…ƒç´ 
>
> 1. å¦‚æœé‡åˆ°ä¸€ä¸ªæ•°ï¼Œåˆ™æŠŠè¯¥æ•°å…¥æ ˆã€‚
>
> 2. å¦‚æœé‡åˆ°è¿ç®—ç¬¦ï¼Œåˆ™å–å‡ºæ ˆé¡¶ä¸¤ä¸ªæ•°è¿›è¡Œè®¡ç®—ï¼ŒæŠŠç»“æœå…¥æ ˆã€‚
>
> æ‰«æå®Œæˆåï¼Œæ ˆä¸­æ°å¥½å‰©ä¸‹ä¸€ä¸ªæ•°ï¼Œå³ä¸ºè¯¥åç¼€è¡¨è¾¾å¼çš„ç­”æ¡ˆ

```cpp
if(c[k]>='0' && c[k]<='9') q.push(c[k]-'0');  //å‡è®¾è¡¨è¾¾å¼éƒ½æ˜¯1ä½æ•°
if(c[k]=='-') i=q.top(),q.pop(),j=q.top(),q.pop(), q.push(j-i);
if(c[k]=='+') i=q.top(),q.pop(),j=q.top(),q.pop(), q.push(j+i);
if(c[k]=='*') i=q.top(),q.pop(),j=q.top(),q.pop(), q.push(j*i);
if(c[k]=='/') i=q.top(),q.pop(),j=q.top(),q.pop(), q.push(j/i);
```







### å•è°ƒæ ˆ



```cpp
//è¾“å‡ºæ¯ä¸ªæ•°å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æ•°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º-1ï¼›
#include <iostream>
#include <stack>
using namespace std;
const int N = 100005;
int n,a[N];
stack<int>sk;
int ans[N];

int main(){
	cin >> n;
    for(int i = 1;i <= n;i++) { cin >> a[i]; }
    
	for(int i = 1;i <= n;i++){
		while(sk.size() && sk.top() >= a[i]) sk.pop();
		if(sk.size()) ans[i] = sk.top();
		else ans[i] = -1;

		sk.push(a[i]);
	}

	for(int i = 1;i <= n;i++){ cout << ans[i] << ' '; }
}
```



[ç›´æ–¹å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://www.acwing.com/problem/content/133/)

```cpp
//https://www.acwing.com/problem/content/133/
#include <iostream>
#include <stack>
using namespace std;
using ll = long long;
const int N = 100005;
ll a[N];
ll l[N],r[N];//l[i]è®°å½•å·¦è¾¹æœ€åä¸€ä¸ªå¤§äºç­‰äºæœ¬èº«çš„ä¸‹æ ‡,r[i]è®°å½•å³è¾¹æœ€åä¸€ä¸ªå¤§äºç­‰äºæœ¬èº«çš„ä¸‹æ ‡
//å¯¹äºæ¯ä¸€ä¸ªé«˜åº¦a[i]ï¼Œèƒ½ç»„æˆçš„æœ€å¤§é¢ç§¯ä¸ºa[i]*(r[i]-l[i]+1)

int main(){
	int n;
	while(cin >> n,n){
		a[0] = a[n+1] = -1;//åœ¨è¾¹ç•Œè®¾ç½®å“¨å…µ
		for(int i = 1;i <= n;i++) cin >> a[i];

		stack<ll>sk;
		for(int i = 0;i <= n+1;i++){
			while(sk.size() && a[sk.top()] >= a[i]) sk.pop();
			if(sk.size()) l[i] = sk.top()+1;
			else l[i] = i;
			sk.push(i);
		}

		sk = stack<ll>();
		for(int i = n+1;i >= 0;i--){
			while(sk.size() && a[sk.top()] >= a[i]) sk.pop();
			if(sk.size()) r[i] = sk.top()-1;
			else r[i] = i;
			sk.push(i);
		}

		ll ans = 0;
		for(int i = 1;i <= n;i++){
			ans = max(ans,a[i]*(r[i] - l[i] + 1));
		}
		cout << ans << endl;
	}
	return 0;
}
```



### é˜Ÿåˆ—

| ql   | â†    | â†    | â†    | â†    | qr   |
| ---- | ---- | ---- | ---- | ---- | ---- |
| hh   |      |      |      |      | tt   |



> å…ˆè¿›å…ˆå‡º

```cpp
//åŒç«¯é˜Ÿåˆ—
//hhè¡¨ç¤ºé˜Ÿé¦–frontï¼Œttè¡¨ç¤ºé˜Ÿå°¾back
int q[N], hh = 0, tt = -1;

//å…¥é˜Ÿ(é˜Ÿå°¾)
q[++tt] = x;

//å¼¹å‡º(é˜Ÿé¦–)
hh++;

//åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦éç©º
if (hh <= tt)  return 1;


q[hh]//é˜Ÿé¦–å…ƒç´ 
q[tt]//é˜Ÿå°¾å…ƒç´ 
```



### å•è°ƒé˜Ÿåˆ—

#### æ»‘åŠ¨çª—å£

| çª—å£ä½ç½®            | æœ€å°å€¼ | æœ€å¤§å€¼ |
| ------------------- | ------ | ------ |
| [1 3 -1] -3 5 3 6 7 | -1     | 3      |
| 1 [3 -1 -3] 5 3 6 7 | -3     | 3      |
| 1 3 [-1 -3 5] 3 6 7 | -3     | 5      |
| 1 3 -1 [-3 5 3] 6 7 | -3     | 5      |
| 1 3 -1 -3 [5 3 6] 7 | 3      | 6      |
| 1 3 -1 -3 5 [3 6 7] | 3      | 7      |

> æ­¤å¤„çš„ "é˜Ÿåˆ—" è·Ÿæ™®é€šé˜Ÿåˆ—çš„ä¸€å¤§ä¸åŒå°±åœ¨äºå¯ä»¥ä»é˜Ÿå°¾è¿›è¡Œæ“ä½œï¼ŒSTL ä¸­æœ‰ç±»ä¼¼çš„æ•°æ®ç»“æ„ deque

```cpp
//æ»‘åŠ¨çª—å£ä¹‹æœ€å€¼
#include <iostream>
using namespace std;
const int N = 1000010;
int a[N], q[N]; //a[N]ä¸ºæ•°ç»„ï¼Œq[N]é˜Ÿåˆ—å­˜ä¸‹æ ‡
int main() {
	int n, k;
	cin >> n >> k;
	for (int i = 1; i <= n; i++) scanf("%d", &a[i]);

	int hh = 0, tt = -1;
	for (int i = 1;i <= n;i++){//hh<=ttåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œç›¸å½“äº!q.empty()æˆ–q.size()
		if (hh <= tt && i-k >= q[hh]) hh++;//i-k>=q[hh]çª—å£å·²ç»å½¢æˆ,åˆ™æ¯æ¬¡å¾ªç¯é˜Ÿé¦–å³ç§»
		while (hh <= tt && a[q[tt]] > a[i]) tt--;//æ±‚æœ€å°ï¼ŒæŠŠé˜Ÿåˆ—ä¸­>a[i]çš„æ•°éƒ½å¼¹å‡º
		q[++tt] = i;
		if (i >= k) printf("%d ", a[q[hh]]);//é˜Ÿé¦–å³ä¸ºæœ€å°å€¼
	}
	puts("");

	hh = 0, tt = -1;
	for (int i = 1; i <= n; i++){
		if (hh <= tt && i-k >= q[hh]) hh++;
		while (hh <= tt && a[q[tt]] < a[i]) tt--;//æ±‚æœ€å¤§ç±»ä¼¼
		q[++tt] = i;
		if (i >= k) printf("%d ", a[q[hh]]);
	}
	return 0;
}
```

```cpp
//STLçš„dequeå®ç°ï¼Œæ¯”æ•°ç»„æ¨¡æ‹Ÿè¦æ…¢
#include <iostream>
#include <deque>
using namespace std;
const int N = 1000006;
int a[N];

int main(){
	int n,k;cin >> n >> k;
	for(int i = 1;i <= n;i++) {cin >> a[i];}

	deque<int>dq;
	for(int i = 1;i <= n;i++){
		if(dq.size() && i - k >= dq.front()) dq.pop_front();
		while(dq.size() && a[dq.back()] >= a[i]) dq.pop_back();
		dq.push_back(i);
		if(i >= k) cout << a[dq.front()] << ' ';
	}
	cout << '\n';

	dq.clear();
	for(int i = 1;i <= n;i++){
		if(dq.size() && i - k >= dq.front()) dq.pop_front();
		while(dq.size() && a[dq.back()] <= a[i]) dq.pop_back();
		dq.push_back(i);
		if(i >= k) cout << a[dq.front()] << ' ';
	}
}
```



#### [æœ€å¤§å­æ®µå’Œ](https://www.acwing.com/problem/content/137/)

<span id="sub_max_queue"> </span>

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°åºåˆ—ï¼Œä»ä¸­æ‰¾å‡ºä¸€æ®µé•¿åº¦ä¸è¶…è¿‡ m çš„è¿ç»­å­åºåˆ—ï¼Œä½¿å¾—å­åºåˆ—ä¸­æ‰€æœ‰æ•°çš„å’Œæœ€å¤§ã€‚

æœ€ä¼˜ç­–ç•¥æ˜¯ï¼Œä¸‹æ ‡é€’å¢ï¼Œå¯¹åº”å‰ç¼€å’Œä¹Ÿé€’å¢

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 300005;
int n,m,a[N];
int q[N],hh,tt;//tt = -1ï¼›q[++tt] = 0;

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		a[i] += a[i-1];
	}

	int ans = 0x80000000;  //åˆå§‹åŒ–ä¸ºè´Ÿæ— ç©·
	for(int i = 1;i <= n;i++){
		ans = max(ans,a[i]-a[q[hh]]);
		if(hh <= tt && i - q[hh] >= m) hh++;
		while(hh <= tt && a[q[tt]] >= a[i]) tt--;//å•è°ƒé€’å¢é˜Ÿåˆ—,é˜Ÿé¦–a[q[hh]]ä¸ºæœ€å°å€¼
		q[++tt] = i;
	}
	cout << ans;

	return 0;
}
```





### å †

å †æ˜¯ä¸€æ£µæ ‘ï¼Œå…¶æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé”®å€¼ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼éƒ½å¤§äºç­‰äº/å°äºç­‰äºå…¶çˆ¶äº²çš„é”®å€¼ã€‚

å †ä¸»è¦æ”¯æŒçš„æ“ä½œæœ‰ï¼šæ’å…¥ä¸€ä¸ªæ•°ã€æŸ¥è¯¢æœ€å°å€¼ã€åˆ é™¤æœ€å°å€¼ã€åˆå¹¶ä¸¤ä¸ªå †ã€å‡å°ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚

ä¸€äº›åŠŸèƒ½å¼ºå¤§çš„å †ï¼ˆå¯å¹¶å †ï¼‰è¿˜èƒ½ï¼ˆé«˜æ•ˆåœ°ï¼‰æ”¯æŒ merge ç­‰æ“ä½œã€‚

ä¸€äº›åŠŸèƒ½æ›´å¼ºå¤§çš„å †è¿˜æ”¯æŒå¯æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯å¯¹ä»»æ„å†å²ç‰ˆæœ¬è¿›è¡ŒæŸ¥è¯¢æˆ–è€…æ“ä½œï¼Œäº§ç”Ÿæ–°çš„ç‰ˆæœ¬ã€‚









#### äºŒå‰å †

//ä¸‹æ ‡ä»1å¼€å§‹æ¯”è¾ƒæ–¹ä¾¿ï¼šç¬¬kä¸ªæ•°ï¼Œå·¦å„¿å­ä¸º2kï¼Œå³å„¿å­ä¸º2k+1

| æ“ä½œ                                                         | å®ç°                                          |
| ------------------------------------------------------------ | --------------------------------------------- |
| 1.æ’å…¥ä¸€ä¸ªæ•°                                                 | heap[++size] = x; up(size);                   |
| 2.æ±‚é›†åˆå½“ä¸­æœ€å°å€¼                                           | heap[1];                                      |
| 3.[åˆ é™¤æœ€å°å€¼][å°†ç¬¬ä¸€ä¸ªæ•°ç­‰äºæœ€åä¸€ä¸ªæ•°ï¼Œåˆ æ‰æœ€åä¸€ä¸ªæ•°ï¼Œå†ä¸‹æ²‰ç¬¬ä¸€ä¸ªæ•°] | heap[1] = heap[size]; size--; down[1];        |
| 4.[åˆ é™¤ä»»æ„ä¸€ä¸ªå…ƒç´ ][å°†ç¬¬kä¸ªæ•°ç­‰äºæœ€åä¸€ä¸ªæ•°ï¼Œåˆ æ‰æœ€åä¸€ä¸ªæ•°ï¼Œå†ä¸Šä¸‹è¿™ä¸ªæ•°] | heap[k] = heap[size]; size--; down[k]; up[k]; |
| 5.ä¿®æ”¹ä»»æ„ä¸€ä¸ªå…ƒç´                                            | heap[k] = x; down[k]; up[k];                  |

```cpp
int h[100010],cnt;
void down(int u) {
	int t = u;
	if (u * 2 <= cnt && h[u * 2] < h[t]) t = u * 2;
	if (u * 2 + 1 <= cnt && h[u * 2 + 1] < h[t]) t = u * 2 + 1;//ä»¤tä¸ºuåŠå…¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°èŠ‚ç‚¹
	if (u != t) {//åˆ¤æ–­uæ˜¯ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œä¸æ˜¯åˆ™ä¸æœ€å°èŠ‚ç‚¹täº¤æ¢ï¼Œç»§ç»­ä¸‹æ²‰(é€’å½’å¤„ç†)
		swap(h[u], h[t]);
		down(t);
	}
}
```

```cpp
void up(int u) {
	if (u / 2 && h[u / 2] > h[u]) {//è¯ºæ¯”çˆ¶èŠ‚ç‚¹å°ï¼Œåˆ™äºŒè€…äº¤æ¢
		swap(h[u / 2], h[u]);
		u /= 2;
	}
}
```



[146. åºåˆ— ](https://www.acwing.com/problem/content/description/148/)

ç»™å®š m ä¸ªåºåˆ—ï¼Œæ¯ä¸ªåŒ…å« n ä¸ªéè´Ÿæ•´æ•°ã€‚
ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»æ¯ä¸ªåºåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæ•°å­—ä»¥å½¢æˆå…·æœ‰ m ä¸ªæ•´æ•°çš„åºåˆ—ã€‚
å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¸€å…±å¯ä»¥å¾—åˆ° n^m ä¸ªè¿™ç§åºåˆ—ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªåºåˆ—ä¸­çš„æ•°å­—ä¹‹å’Œï¼Œå¹¶å¾—åˆ° n^m ä¸ªå€¼ã€‚
æ±‚å‡ºè¿™äº›åºåˆ—å’Œä¹‹ä¸­æœ€å°çš„ n ä¸ªå€¼ã€‚

> æ€è·¯ï¼šç¬¬ä¸€ä¸ªæ•°ç»„a[]ä¾æ¬¡ä¸å…¶ä»–æ•°ç»„åˆå¹¶ï¼Œæ¯æ¬¡å°†a[]æ›´æ–°æœ€å°çš„nä¸ªæ•°

```cpp
#include <iostream>
#include <algorithm>
#include <queue>
using namespace std;
using pii = pair<int,pair<int,int>>;
const int N = 2003;
int n,m;
int a[N],b[N],c[N];

struct Edge{
	int s,x,y;//sä¸ºa[x]+b[y]çš„å€¼
	bool operator < (const Edge &e)const {
		return s > e.s;//è¿ç®—ç¬¦é‡è½½ï¼Œå°æ ¹å †
	}
};

void merge(){//æ•°ç»„a[]ä¸æ•°ç»„b[]åˆå¹¶
	priority_queue<Edge>pq;//a[]ä¸ºæœ‰åºæ•°ç»„ï¼Œa[x],b[y]ä¸ºn*nçš„ç»„åˆï¼Œyä¸€å®šæ—¶a[x]+b[y]æœ‰åº
	for(int i = 1;i <= n;i++){
		pq.push({a[1]+b[i],1,i});
	}
	vector<int>ans;
	for(int i = 1;i <= n;i++){
		auto [s,x,y] = pq.top();//a[x]+b[y]å‡ºé˜Ÿï¼Œa[x+1]+b[y]å…¥é˜Ÿ
		pq.pop();
		c[i] = s;
		x++;
		pq.push({a[x]+b[y],x,y});
	}
	for(int i = 1;i <= n;i++){
		a[i] = c[i];
	}
}

void sol(){
	cin >> m >> n;
	for(int i = 1;i <= n;i++){ cin >> a[i]; }
	sort(a+1,a+n+1);
    
	m--;
	while(m--){
		for(int i = 1;i <= n;i++){ cin >> b[i]; }
		merge();
	}
	for(int i = 1;i <= n;i++){ cout << a[i] << ' '; }
	cout << endl;
}

int main(){
	int T;cin >> T;
	while(T--){ sol(); }
}
```



#### ~~å·¦åæ ‘~~

å·¦åæ ‘(leftist tree)æ˜¯ä¸€ç§å¯å¹¶å †ï¼Œå…·æœ‰å †çš„æ€§è´¨ï¼Œå¯ä»¥å¿«é€Ÿåˆå¹¶ï¼Œæ”¯æŒå¯æŒä¹…åŒ–ã€‚

| æ’å…¥    | æŸ¥è¯¢æœ€å°å€¼ | åˆ é™¤æœ€å°å€¼ | åˆå¹¶    |      |
| ------- | ---------- | ---------- | ------- | ---- |
| O(logN) | O(1)       | O(logN)    | O(logN) |      |







#### é…å¯¹å †

é…å¯¹å †æ˜¯ä¸€ä¸ªæ”¯æŒæ’å…¥ï¼ŒæŸ¥è¯¢/åˆ é™¤æœ€å°å€¼ï¼Œåˆå¹¶ï¼Œä¿®æ”¹å…ƒç´ ç­‰æ“ä½œçš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§**å¯å¹¶å †**ã€‚æœ‰é€Ÿåº¦å¿«å’Œç»“æ„ç®€å•çš„ä¼˜åŠ¿ï¼Œä½†ç”±äºå…¶ä¸ºåŸºäºåŠ¿èƒ½åˆ†æçš„å‡æ‘Šå¤æ‚åº¦ï¼Œä¸æ”¯æŒå¯æŒä¹…åŒ–ã€‚

| æ’å…¥ | æŸ¥è¯¢æœ€å°å€¼ | åˆ é™¤æœ€å°å€¼ | åˆå¹¶ |      |
| ---- | ---------- | ---------- | ---- | ---- |
| O(1) | O(1)       | O(logN)    | O(1) |      |

é…å¯¹å †æ˜¯ä¸€æ£µæ»¡è¶³å †æ€§è´¨çš„å¸¦æƒå¤šå‰æ ‘ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹çš„æƒå€¼éƒ½å°äºæˆ–ç­‰äºä»–çš„æ‰€æœ‰å„¿å­ã€‚æ¯ä¸ªèŠ‚ç‚¹å‚¨å­˜ç¬¬ä¸€ä¸ªå„¿å­çš„æŒ‡é’ˆï¼Œå³é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼›å’Œä»–çš„å³å…„å¼Ÿçš„æŒ‡é’ˆã€‚

<img src="https://oi-wiki.org/ds/images/pairingheap2.jpg" alt="img" style="zoom: 50%;" /> 

**æŸ¥è¯¢æœ€å°å€¼**ï¼šæ ¹èŠ‚ç‚¹å³ä¸ºæœ€å°å€¼ã€‚

**åˆå¹¶**ï¼šä»¤ä¸¤ä¸ªæ ¹èŠ‚ç‚¹è¾ƒå°çš„ä½œä¸ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹ï¼Œç„¶åå°†è¾ƒå¤§çš„ä½œä¸ºå®ƒçš„å„¿å­æ’è¿›å»ã€‚

**æ’å…¥**ï¼šæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ç„¶åä¸åŸå †åˆå¹¶å³å¯ã€‚

**åˆ é™¤**ï¼šåˆ é™¤æ“ä½œè¾ƒä¸ºéº»çƒ¦ï¼Œä¸ºäº†ä¿è¯æ€»çš„å‡æ‘Šå¤æ‚åº¦ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸¤æ­¥èµ°çš„åˆå¹¶æ–¹æ³•

1. æŠŠå„¿å­ä»¬ä¸¤ä¸¤é…æˆä¸€å¯¹ï¼Œåœ¨æŠŠé…æˆä¸€å¯¹çš„å„¿å­åˆå¹¶åˆ°ä¸€èµ·ã€‚
2. å°†æ–°äº§ç”Ÿçš„å †ä»å³å¾€å·¦ï¼ˆå³è€å„¿å­åˆ°æ–°å„¿å­çš„æ–¹å‘ï¼‰æŒ¨ä¸ªåˆå¹¶åˆ°ä¸€èµ·ã€‚
   <img src="https://oi-wiki.org/ds/images/pairingheap4.jpg" alt="img" style="zoom:33%;" /> <img src="https://oi-wiki.org/ds/images/pairingheap5.jpg" alt="img" style="zoom: 25%;" /> 

```cpp
//å°è£…å®ç°,å †é¡¶ä¸ºæœ€å°å€¼. æœªç»è¿‡ä¸¥è°¨æµ‹è¯•,å¯èƒ½å°šå­˜bug
template<typename type>
class heap{
	size_t heap_size;
	struct node{
		node *s,*t;//sæŒ‡å‘è¯¥èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå„¿å­,tæŒ‡å‘è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿ
		type val;
	}*root;

	node *merge_bros(node *p){//è¾…åŠ©å‡½æ•°,åˆå¹¶ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å…„å¼Ÿ
		if(p==nullptr || p->t==nullptr) return p;//å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºç©ºæˆ–å®ƒæ²¡æœ‰ä¸‹ä¸€ä¸ªå…„å¼Ÿ,å°±ä¸éœ€è¦åˆå¹¶äº†
		node *q=p->t;node *d=q->t;p->t=q->t=nullptr;
		return merge(merge_bros(d),merge(p,q));
	}

	inline node *merge(node *p,node *q){//åˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹
		if(p==nullptr) return q;
		if(q==nullptr) return p;
		if(p->val > q->val) swap(p,q);
		q->t=p->s,p->s=q;
		return p;
	}
    
	public:
	inline heap<type>(){root=nullptr;}

	inline void merge(node *p){
		if(root==nullptr){root=p;return;}
		if(p==nullptr) return;
		if(root->val > p->val) swap(p,root);
		p->t=root->s,root->s=p;
	}

	inline void merge(heap x){//åˆå¹¶ä¸¤ä¸ªå †,å°†å †xå¹¶å…¥å½“å‰å †(ä¸ä¼šæ¸…ç©ºx)
		node *p=x.root;
		heap_size += x.size();
		if(root==nullptr){root=p;return;}
		if(p==nullptr) return;
		if(root->val > p->val) swap(p,root);
		p->t=root->s,root->s=p;
	}

	inline void push(type x){
		heap_size++;
		node *p=new node;
		p->val=x;p->s=nullptr,p->t=nullptr;
		merge(p);
	}

	inline void pop(){
		heap_size--;
		node *T=root;
		root=merge_bros(root->s);
		delete T;
	}

	inline type top(){return root->val;}
	inline bool empty(){return !heap_size;}
	inline size_t size(){return heap_size;}
	inline void clear(){root=nullptr;}
};

int main(){
    heap<int> pq1,pq2;
    pq1.push(2);pq2.push(1);
    pq1.merge(pq2);
    std::cout << pq1.top() << ' ' << pq1.size() << '\n';
}
```





## å“ˆå¸Œ

### å¼€æ”¾å¯»å€æ³•

```cpp
#include <iostream>
using namespace std;
const int N = 2000003, null = 0x3f3f3f3f;//Nå–å¤§äºæ‰€ç»™èŒƒå›´ä¸¤~ä¸‰å€çš„ä¸€ä¸ªè´¨æ•°ï¼Œnullå–ä¸€ä¸ªå–ä¸åˆ°çš„æ•°
int h[N];
int find(int x) {
	int k = (x % N + N) % N;
	//å¦‚æœxå­˜åœ¨åˆ™è¿”å›xåœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ï¼Œå¦åˆ™è¿”å›xåº”è¯¥åœ¨å“ˆå¸Œè¡¨ä¸­æ’å…¥çš„ä½ç½®
	while (h[k] != null && h[k] != x) {//å¦‚æœè¿™ä¸ªä½ç½®æœ‰å€¼ä¸”ä¸æ˜¯xï¼Œåˆ™k++ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºä½(null)
		k++;
		if (k == N) k = 0;//è¯ºkä¸ºNï¼Œåˆ™é‡æ–°ä»0å¼€å§‹æ‰¾
	}
	return k;
}
int main() {
	memset(h, 0x3f, sizeof h);//åˆå§‹åŒ–,memsetæŒ‰å­—èŠ‚åˆå§‹åŒ–ï¼Œintç±»å‹åªè¦å¡«ä¸€ä¸ª0x3f
	int x; cin >> x;
	int k = find(x);
	//æ’å…¥x
	h[k] = x;

	//æŸ¥è¯¢xæ˜¯å¦å­˜åœ¨
	if (h[k] == x) cout << "YES";
	else cout << "NO";

	return 0;;
}
```



### æ‹‰é“¾æ³•

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100003;//Nå–å¤§äºæ‰€ç»™èŒƒå›´çš„ç¬¬ä¸€ä¸ªè´¨æ•°
int h[N], e[N], ne[N],idx;//e,neä¸ºå•é“¾è¡¨ç”¨æ³•ï¼Œhä¸ºå¤´ç»“ç‚¹

void insert(int x) {
	int k = (x % N + N) % N;//kä¸ºå“ˆå¸Œå€¼
	e[idx] = x;
	ne[idx] = h[k]; 
	h[k] = idx++;
}
bool find(int x) {
	int k = (x % N + N) % N;
	for (int i = h[k]; i != -1;i = ne[i]) {
		if (e[i] == x) return true;
	}
	return false;
}

int main() {
	memset(h, -1, sizeof h);//åˆå§‹åŒ–ä¸º-1ï¼ˆç©ºæŒ‡é’ˆä¸€èˆ¬ç”¨-1è¡¨ç¤ºï¼‰

}
```



[é›ªèŠ±åŒ¹é…](https://www.acwing.com/problem/content/description/139/)

å®šä¹‰Hashå‡½æ•°$H(a_1...a_6) = (\sum_{i=1}^6a_i + \prod_{i=1}^6a_i)\%mod$

```cpp
#include <iostream>
#include <cstring>
using namespace std;
using ll = long long;
const int N = 100005,mod = 100003;//å–æ¥è¿‘Nçš„è´¨æ•°
int h[N],ne[N],idx;
int snow[N][6];//ç¬¬idxä¸ªä½ç½®å¯¹åº”çš„é›ªèŠ±snow[idx][6]
int n;

int hs(int a[]){//å“ˆå¸Œå‡½æ•°
	ll sum = 0,mul = 1;
	for(int i = 0;i < 6;i++){
		sum = (sum+a[i])%mod;
		mul = mul*a[i]%mod;
	}
	return (sum+mul)%mod;
}

bool equal(int a[],int b[]){//åˆ¤æ–­ä¸¤ç‰‡é›ªèŠ±æ˜¯å¦ç›¸ç­‰
	for(int i = 0;i < 6;i++){
		for(int j = 0;j < 6;j++){
			bool eq = 1;
			for(int k = 0;k < 6;k++){
				if(a[(i+k)%6] != b[(j+k)%6]) eq = 0;
			}
			if(eq) return 1;
			eq = 1;
			for(int k = 0;k < 6;k++){
				if(a[(i+k)%6] != b[(j-k+6)%6]) eq = 0;
			}
			if(eq) return 1;
		}
	}
	return 0;
}

bool insert(int a[]){
	int key = hs(a);

	for(int i = h[key];i != -1;i = ne[i]){//è¯ºå‘ç”Ÿå“ˆå¸Œå†²çª
		if(equal(snow[i],a)) return 1;//ä¸”å‡ºç°ä¸¤ç‰‡é›ªèŠ±ç›¸ç­‰ï¼Œè¿”å›1
	}
    //å¦åˆ™åœ¨å“ˆå¸Œå€¼å¯¹åº”é“¾è¡¨ä½ç½®æ¥ä¸Šè¯¥é›ªèŠ±
	memcpy(snow[idx],a,6*sizeof(int));
	ne[idx] = h[key];
	h[key] = idx++;
	return 0;
}

int main(){
	cin >> n;
	memset(h,-1,sizeof h);
	for(int i = 1;i <= n;i++){
		int a[10];
		for(int j = 0;j < 6;j++) cin >> a[j];
		if(insert(a)){
			cout << "Twin snowflakes found.";
			return 0;
		}
	}
	cout << "No two snowflakes are alike.";
}
```









## å¹¶æŸ¥é›†

å¹¶æŸ¥é›†(DSU)æ˜¯ä¸€ç§ç”¨äºç®¡ç†å…ƒç´ æ‰€å±é›†åˆçš„æ•°æ®ç»“æ„ï¼Œå®ç°ä¸ºä¸€ä¸ªæ£®æ—ï¼Œå…¶ä¸­æ¯æ£µæ ‘è¡¨ç¤ºä¸€ä¸ªé›†åˆï¼Œæ ‘ä¸­çš„èŠ‚ç‚¹è¡¨ç¤ºå¯¹åº”é›†åˆä¸­çš„å…ƒç´ 

```cpp
int p[N],siz[N];//p[i]å­˜èŠ‚ç‚¹içš„æ ¹èŠ‚ç‚¹ï¼Œsiz[i]å­˜ä»¥iä¸ºæ ¹çš„é›†åˆå¤§å°

int find(int x){//æŸ¥æ‰¾xçš„æ ¹èŠ‚ç‚¹+è·¯å¾„å‹ç¼©
	if(p[x] != x) p[x] = find(p[x]);
	return p[x];
}

void merge(int a,int b){//å°†aæ‰€åœ¨é›†åˆå¹¶å…¥bæ‰€åœ¨é›†åˆ
	int pa = find(a),pb = find(b);
	if(pa == pb) return;
	p[pa] = pb;
	siz[pb] += siz[pa];
}

int main(){
    for(int i = 1;i <= n;i++) p[i] = i,siz[i] = 1;//åˆå§‹åŒ–æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºè‡ªèº«
}
```

`i == p[i]` çˆ¶èŠ‚ç‚¹ç­‰äºè‡ªèº«çš„æ•°é‡å³ä¸ºè¿é€šå—çš„æ•°é‡[How Many Tables - HDU 1213 - Virtual Judge (vjudge.net)](https://vjudge.net/problem/HDU-1213)



```cpp
//äºŒç»´çŸ©é˜µç±»å‹å¹¶æŸ¥é›†(ä¹Ÿå¯ä»¥æ”¹ç”¨pair<int,int>,æˆ–è€…å°†äºŒç»´åæ ‡[x,y]æ˜ å°„ä¸ºä¸€ç»´)
struct node {
	int x,y;
	bool operator == (const node&e2)const{
		return x == e2.x && y == e2.y;
	}
	bool operator != (const node&e2)const{
		return x != e2.x || y != e2.y;
	}
}p[N][N];

node  find(node x){
	if(p[x.x][x.y] != x) p[x.x][x.y] = find(p[x.x][x.y]);
	return p[x.x][x.y];
}

void merge(node x1,node x2){
	node  pa = find(x1),pb = find(x2);
	if(pa == pb) return;
	else p[pa.x][pa.y] = pb;
}
```





### è¾¹å¸¦æƒå¹¶æŸ¥é›†

å¹¶æŸ¥é›†å®é™…ä¸Šæ˜¯ç”±è¯ºå¹²æ£µæ ‘æ„æˆçš„æ£®æ—ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ‘ä¸­çš„æ¯æ¡è¾¹ä¸Šè®°å½•ä¸€ä¸ªæƒå€¼ï¼Œå³ç»´æŠ¤ä¸€ä¸ªæ•°ç»„d[ ]ï¼Œç”¨d[x]ä¿å­˜èŠ‚ç‚¹xåˆ°çˆ¶äº²èŠ‚ç‚¹p[x]ä¹‹é—´çš„è¾¹æƒã€‚åœ¨æ¯æ¬¡è·¯å¾„å‹ç¼©åï¼Œæ¯ä¸ªè®¿é—®è¿‡çš„èŠ‚ç‚¹éƒ½ä¼šç›´æ¥æŒ‡å‘æ ‘æ ¹ï¼Œå¦‚æœæˆ‘ä»¬åŒæ—¶æ›´æ–°è¿™äº›èŠ‚ç‚¹çš„då€¼ï¼Œå°±å¯ä»¥åˆ©ç”¨è·¯å¾„å‹ç¼©è¿‡ç¨‹æ¥ç»Ÿè®¡æ¯ä¸ªèŠ‚ç‚¹åˆ°æ ‘æ ¹ä¹‹é—´çš„è·¯å¾„ä¸Šçš„ä¸€äº›ä¿¡æ¯ã€‚

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250703094151359.png" alt="image-20250703094151359" style="zoom:50%;" /> 

å…³ç³»çš„ä¼ é€’å¯ä»¥çœ‹åšå‘é‡ã€‚
å¦‚æœ`pa == pb`é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ£€æŸ¥`d[a] + s`æ˜¯å¦ç­‰äº`d[b]`æ¥åˆ¤æ–­æ˜¯å¦çŸ›ç›¾ï¼Œæˆ–è€…æ±‚å‡ºç›¸å¯¹å…³ç³»å¤§å°`s`ã€‚
å¦åˆ™å¯ä»¥åˆå¹¶ä¸¤è€…ï¼š`p[pb] = pb, d[pb] = d[a] + s - d[b]`ã€‚



[P1196 [NOI2002\] é“¶æ²³è‹±é›„ä¼ è¯´ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P1196)

> æœ‰Nåªé£èˆ¹ï¼ŒMæ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤ä¸ºä»¥ä¸‹ä¹‹ä¸€ï¼š
>
> 1.`M i j`  ï¼Œè¡¨ç¤ºè®©iå·é£èˆ¹æ‰€åœ¨çš„é˜Ÿåˆ—å…¨éƒ¨é£èˆ¹ä¿æŒåŸæœ‰é¡ºåºï¼Œæ¥åœ¨ç¬¬jå·é£èˆ¹æ‰€åœ¨é˜Ÿåˆ—çš„å°¾éƒ¨
> 2.`C i j`  ï¼Œè¡¨ç¤ºè¯¢é—®ç¬¬iå·é£èˆ¹ä¸ç¬¬jå·é£èˆ¹å½“å‰æ˜¯å¦å¤„äºåŒä¸€åˆ—ä¸­ï¼Œå¦‚æœåœ¨ï¼Œè¾“å‡ºä»–ä»¬ä¹‹é—´é—´éš”äº†å¤šå°‘é£èˆ¹



```cpp
#include <iostream>

const int N = 30004;
int n = 30000,q;
int p[N],d[N],siz[N];//d[x]ä»£è¡¨xä¸å…¶çˆ¶èŠ‚ç‚¹(è·¯å¾„å‹ç¼©åå³æ ¹ç»“ç‚¹)ä¹‹é—´çš„è¾¹çš„æƒå€¼ï¼Œå³ä½äºxä¹‹å‰çš„é£èˆ¹æ•°é‡

int find(int x){//å¸¦æƒå¹¶æŸ¥é›†æ¨¡ç‰ˆ,è·¯å¾„å‹ç¼©æ—¶ç»´æŠ¤d[]
	if(p[x] != x) {
		int root = find(p[x]);
		d[x] += d[p[x]];
		p[x] = root;
	}
	return p[x];
}

int main(){
	for(int i = 1;i <= n;i++) p[i] = i,siz[i] = 1;
	std::cin >> q;
	while(q--){
		char op;int a,b;std::cin >> op >> a >> b;
		int pa = find(a),pb = find(b);
		if(op == 'M'){
			if(pa == pb) continue;
			else{
				p[pa] = pb;//å°†aæ‰€åœ¨é˜Ÿåˆ—å¹¶å…¥bæ‰€åœ¨é˜Ÿåˆ—
				int s = siz[pb]-d[b] + d[a];//så³ä¸º(båˆ°é˜Ÿåˆ—pbå°¾éƒ¨çš„è·ç¦»)+(é˜Ÿåˆ—paå¤´éƒ¨åˆ°açš„è·ç¦»)
				d[pa] = d[b] + s - d[a];
				siz[pb] += siz[pa];
			}
		}
		if(op == 'C'){
			if(pa == pb) std::cout << std::max(0,std::abs(d[b] - d[a])-1) << '\n'; 
			else std::cout << -1 << '\n'; 
		}
	}
}
```



### æ‹“å±•åŸŸå¹¶æŸ¥é›†

ç”¨äºè§£å†³å…·æœ‰å¤šä¸ªç›¸äº’å…³ç³»é›†åˆçš„é—®é¢˜ã€‚å®ƒæ˜¯ä¼ ç»Ÿå¹¶æŸ¥é›†çš„æ‰©å±•ï¼Œèƒ½å¤Ÿå¤„ç†é›†åˆé—´çš„ä¸åŒå…³ç³»ï¼Œå¦‚ç›¸äº’æ’æ–¥æˆ–ç›¸äº’ç‹¬ç«‹çš„å…³ç³»ã€‚



[P1525 [NOIP 2010 æé«˜ç»„\] å…³æŠ¼ç½ªçŠ¯ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P1525)

> *n* ä¸ªç‚¹æœ‰ *m* å¯¹å…³ç³»ï¼ŒæŠŠ *n* ä¸ªèŠ‚ç‚¹æ”¾å…¥ä¸¤ä¸ªé›†åˆé‡Œï¼Œè¦æ±‚æ¯å¯¹å­˜åœ¨å…³ç³»çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¸èƒ½æ”¾åœ¨åŒä¸€ä¸ªé›†åˆã€‚é—®èƒ½å¦æˆåŠŸå®Œæˆï¼Ÿ

æˆ‘ä»¬ä½¿ç”¨æ‹“å±•åŸŸå¹¶æŸ¥é›†ï¼Œå°†uå’Œu+nåˆ†åˆ«è¡¨ç¤ºuçš„ä¸¤ä¸ªç›¸åçŠ¶æ€ï¼Œå°†`(u,v+n)`è¿è¾¹è¡¨ç¤º`(u,v)`ä¸åº”åœ¨ä¸€ä¸ªé›†åˆé‡Œ(ä¹Ÿå¯ä»¥çœ‹ä½œuå’Œvçš„åçŠ¶æ€åœ¨ä¸€ä¸ªé›†åˆé‡Œ)ã€‚ç›¸åº”çš„`(v,u+n)`ä¹Ÿåº”è¯¥è¿è¾¹ã€‚è¯º`(u,u+n)`åœ¨åŒä¸€ä¸ªé›†åˆé‡Œåˆ™è¯´æ˜å‘ç”Ÿäº†çŸ›ç›¾ã€‚

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 40004,M = 100005;
int n,m;
int p[N];

struct node{
	int a,b,c;
	bool operator < (const node &e2)const{
		return c > e2.c;
	}
}e[M];

int find(int x){
	if(p[x] != x) p[x] = find(p[x]);
	return p[x];
}

void merge(int x,int y){
	int px = find(x),py = find(y);
	if(px != py) p[px] = py;
}

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n << 1;i++) p[i] = i;

	for(int i = 1;i <= m;i++){
		cin >> e[i].a >> e[i].b >> e[i].c;
	}
	sort(e+1,e+m+1);

	for(int i = 1;i <= m;i++){
		auto [a,b,c] = e[i];
		merge(a,b+n); merge(a+n,b);
		if(find(a) == find(a+n) || find(b) == find(b+n)) {//å‘ç”ŸçŸ›ç›¾
			cout << c;
			return 0;
		}
	}
	cout << 0;
}
```



[P2024 [NOI2001\] é£Ÿç‰©é“¾ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P2024)

> æ¯ä¸ªåŠ¨ç‰©éƒ½æ˜¯Aï¼ŒBï¼ŒCçš„ä¸€ç§ï¼Œä¸‰è€…å½¢æˆç¯å½¢é£Ÿç‰©é“¾ï¼Œä¾æ¬¡ç»™å‡ºmä¸ªå¥è¯ï¼Œä¸ºä»¥ä¸‹ä¸¤ç§å½¢å¼ä¹‹ä¸€
> `1 x y`è¡¨ç¤º`x`å’Œ`y`æ˜¯åŒç±»
> `2 x y `è¡¨ç¤º`x`åƒ`y`
> è¯ºå½“å‰è¯ä¸å‰é¢çš„è¯äº§ç”ŸçŸ›ç›¾ï¼Œåˆ™å½“å‰è¯ä¸ºå‡è¯ã€‚æ±‚æœ‰å¤šå°‘å‡è¯ã€‚

æˆ‘ä»¬ç”¨(x)è¡¨ç¤ºåŒç±»åŸŸï¼Œ(x+n)è¡¨ç¤ºæ•é£ŸåŸŸï¼Œ(x+2n)è¡¨ç¤ºå¤©æ•ŒåŸŸ

```cpp
#include <iostream>

const int N = 50004*3;
int n,q;
int p[N],d[N];

int find(int x){
	if(p[x] != x) {
		int root = find(p[x]);
		d[x] += d[p[x]];
		p[x] = root;
	}
	return p[x];
}

void merge(int x,int y){
	int px = find(x),py = find(y);
	if(px == py) return;
	p[px] = py;
}

int main(){
	int ans = 0;
	std::cin >> n >> q;
	for(int i = 1;i <= n*3;i++) p[i] = i;
	while(q--){
		int op,x,y;std::cin >> op >> x >> y;
		if(x > n || y > n) {ans++;continue;}
		if(op == 1){//xä¸yæ˜¯åŒç±»
			if(find(x) == find(y+n) || find(x) == find(y+n+n)) ans++;//å¦‚æœyæ˜¯xçš„é£Ÿç‰©æˆ–yæ˜¯xçš„å¤©æ•Œ,çŸ›ç›¾
			else{
				merge(x,y);
				merge(x+n,y+n);
				merge(x+n+n,y+n+n);
			}
		}
		else{//xåƒy
			if(find(x) == find(y+n+n) || find(x) == find(y)) ans++;//å¦‚æœyæ˜¯xçš„å¤©æ•Œæˆ–yæ˜¯xçš„åŒç±»,çŸ›ç›¾
			else{
				merge(x,y+n);
				merge(x+n,y+n+n);
				merge(x+n+n,y);
			}
		}
	}
	std::cout << ans;
}
```





## åˆ†å—

[åˆ†å—æ€æƒ³ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/ds/decompose/)

[ä¾‹é¢˜ï¼šåˆ†å—å…¥é—¨ (loj.ac)](https://loj.ac/p?keyword=åˆ†å—å…¥é—¨)

O($N$)é¢„å¤„ç†ï¼ŒO($\sqrt N$)ä¿®æ”¹/æŸ¥è¯¢ï¼Œæ”¯æŒåŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æ’å…¥ï¼ŒåŒºé—´æŸ¥è¯¢ç­‰æ“ä½œï¼Œè¾ƒä¸ºçµæ´»


| å…ƒç´ ä¸ªæ•°n (1~n)                   |                                    |
| --------------------------------- | ---------------------------------- |
| æ¯ä¸€å—çš„æœ€é•¿é•¿åº¦m                 | m = sqrt(n)                        |
| å—çš„ä¸ªæ•°num                       | num = (n/m)+bool(n%m)              |
| ç¬¬iä¸ªå…ƒç´ æ‰€åœ¨çš„å—id[i]            | id[i] = (i-1)/m + 1                |
| ç¬¬iä¸ªå…ƒç´ æ‰€åœ¨å—çš„å·¦ç«¯ç‚¹b[id[i]].l | if(b[id[i]].l == 0) b[id[i]].l = i |
| ç¬¬iä¸ªå…ƒç´ æ‰€åœ¨å—çš„å³ç«¯ç‚¹b[id[i]].r | b[id[i]].r = max( b[id[i]].r , i ) |


```cpp
//æ•°æ®å®šä¹‰
int id[N];//ç¬¬iä¸ªå…ƒç´ åœ¨å“ªä¸ªå—ä¸­
struct Block{//å­˜æ¯ä¸€å—çš„å±æ€§
    int l,r;//è¯¥å—çš„å·¦å³ç«¯ç‚¹
    ll lazy;//lazyæ ‡è®°
    ll sum;//åŒºé—´å’Œ
    ll add;//åŒºé—´åŠ æ ‡è®°
    ll mul;//åŒºé—´ä¹˜æ ‡è®°
    ll cnt;//å—ä¸­å…ƒç´ ä¸ªæ•°æ ‡è®°
    //...
}b[N];

vector<int>v[N]; //å¦‚æœéœ€è¦å¯¹å—è¿›è¡Œæ’åºã€æ‹·è´ç­‰æ“ä½œï¼Œå¯ä»¥å¼€vectoræ•°ç»„å°†æ¯ä¸€ä¸ªå…ƒç´ æ”¾å…¥å¯¹åº”å—ä¸­
```



```cpp
//åˆå§‹åŒ–
void initi(){
	m = sqrt(n);
	for(int i = 1;i <= n;i++){
		id[i] = (i-1)/m + 1;//ç¬¬iä¸ªå…ƒç´ åœ¨ç¬¬id[i]å—
		if(b[id[i]].l == 0) b[id[i]].l = i;//ç¬¬id[i]å—çš„å·¦å³ç«¯ç‚¹
		b[id[i]].r = max(b[id[i]].r,(ll)i);
		//v[id[i]].emplace_back(a[i]);
	}
}
```



```cpp
//ä¿®æ”¹/æŸ¥è¯¢

//å¦‚æœlå’Œråœ¨åŒä¸€å—
if(id[l] == id[r]){
    for(int i = l;i <= r;i++){
        //ç›´æ¥æšä¸¾l~ræ‰€æœ‰å…ƒç´ 
    }
}

//å¦‚æœlå’Œrä¸åœ¨åŒä¸€å—
else{
    for(int i = l;id[i] == id[l];i++){
        //æšä¸¾læ‰€åœ¨å—
    }
    for(int i = r;id[i] == id[r];i--){
        //æšä¸¾ræ‰€åœ¨å—
    }   
    for(int i = id[l]+1;i < id[r];i++){
        //l~rä¹‹é—´æ‰€æœ‰å®Œæ•´å—åˆ©ç”¨åŒºé—´å±æ€§å¿«é€Ÿæ“ä½œ
    }
}
```






```cpp
//åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æ±‚å°äºxçš„æ•°çš„ä¸ªæ•°ï¼šhttps://loj.ac/p/6278
//åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æ±‚å¤§äºç­‰äºxçš„æ•°çš„ä¸ªæ•°ï¼šhttps://www.luogu.com.cn/problem/P2801
#include <iostream>
#include <algorithm>
#include <cmath>
#include <vector>
using namespace std;
using ll = long long;
const ll N = 100005;
ll n,m,cnt;
ll a[N];

ll id[N];
vector<ll>v[N];//v[i]å­˜ç¬¬iå—æ’åºåçš„åºåˆ—
struct Bolck{
	ll l,r,lazy;
}b[N];

void initi(){
	m = sqrt(n);
	for(int i = 1;i <= n;i++){
		id[i] = (i-1)/m + 1;
		v[id[i]].emplace_back(a[i]);
		if(b[id[i]].l == 0) b[id[i]].l = i;
		b[id[i]].r = max(b[id[i]].r,(ll)i);
	}
	for(int i = 1;i <= id[n];i++){
		sort(v[i].begin(),v[i].end());
	}
}

void bsort(int i){//å—æ’åº
	v[i].clear();
	for(int j = b[i].l;j <= b[i].r;j++){
		v[i].emplace_back(a[j]);
	}
	sort(v[i].begin(),v[i].end());
}

void add(ll l,ll r,ll c){
	if(id[l] == id[r]){
		for(int i = l;i <= r;i++){
			a[i]+=c;
		}
		bsort(id[l]);
	}
	else{
		for(int i = l;id[i] == id[l];i++){
			a[i]+=c;
		}
		for(int i = r;id[i] == id[r];i--){
			a[i]+=c;
		}
		for(int i = id[l]+1;i < id[r];i++){
			b[i].lazy += c;
		}
		bsort(id[l]);
		bsort(id[r]);
	}
}

ll query(int l,int r,int c){
	ll ans = 0;
	if(id[l] == id[r]){
		for(int i = l;i <= r;i++){
			ans+=(a[i] < c-b[id[i]].lazy);
		}
	}
	else{
		for(int i = l;id[i] == id[l];i++){
			ans+=(a[i] < c-b[id[i]].lazy);
		}
		for(int i = r;id[i] == id[r];i--){
			ans+=(a[i] < c-b[id[i]].lazy);
		}
		for(int i = id[l]+1;i < id[r];i++){//l~rä¹‹é—´æ¯ä¸ªå®Œæ•´å—v[i]äºŒåˆ†æŸ¥æ‰¾
			ans+=lower_bound(v[i].begin(),v[i].end(),c-b[i].lazy)-v[i].begin();
		}
	}
	return ans;
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){ cin >> a[i]; }
	initi();
	for(int i = 1;i <= n;i++){
		ll op,l,r,c;cin >> op >> l >> r >> c;
		if(op == 0){ add(l,r,c);}
		else{ cout << query(l,r,c*c) <<endl; }
	}
}
```

```cpp
//å•ç‚¹æ’å…¥ï¼Œå•ç‚¹æŸ¥è¯¢
#include <iostream>
#include <vector>
#include <cmath>
using namespace std;
const int N = 100005<<1;
int n,m,all,num;//nï¼šåˆå§‹å…ƒç´ æ•°é‡ï¼Œallï¼šæ’å…¥åå…ƒç´ æ•°é‡ï¼Œmï¼šå—é•¿åº¦ï¼Œnumï¼šå—æ•°é‡
int a[N];

vector<int>v[N];
int id[N];

void initi(){
	m = sqrt(all);
	num = all/m + bool (all%m);
	for(int i = 1;i <= all;i++){
		id[i] = (i-1)/m + 1;
		v[id[i]].emplace_back(a[i]);
	}
}

void reint(){//é‡æ–°åˆ†å—,ä¿è¯æ¯å—éƒ½æ¥è¿‘sqrt(all),å¦åˆ™å¯èƒ½é€€åŒ–ä¸ºæ™®é€šæ•°ç»„
	int cnt = 1;
	for(int i = 1;i <= num;i++){
		for(int j = 0;j < v[i].size();j++){
			a[cnt++] = v[i][j];
		}
		v[i].clear();
	}
}

void ins(int l,int x){
	int cnt = 1;
	while(l > v[cnt].size()){//æ ¹æ®æ¯ä¸ªå—çš„é•¿åº¦æ¨å‡ºç¬¬lä¸ªå…ƒç´ çš„ä½ç½®
		l -= v[cnt].size();
		cnt++;
	}
	v[cnt].insert(v[cnt].begin()+ l-1,x);
	all++;

	if(v[id[l]].size() > 2*m){//å¦‚æœæ’å…¥åï¼Œå—çš„é•¿åº¦>2*m,åˆ™æ¸…ç©ºv[]è¿˜åŸåˆ°a[],é‡æ–°åˆå§‹åŒ–åˆ†å—
		reint();
		initi();
	}
}

int query(int r){
	int cnt = 1;
	while(r > v[cnt].size()){
		r -= v[cnt].size();
		cnt++;
	}
	return v[cnt][r-1];
}

int main(){
	cin >> n;
	all = n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}
	initi();
	for(int i = 1;i <= n;i++){
		int op,l,r,c;cin >> op >> l >> r >> c;
		if(op == 0){ ins(l,r); }
		else{ cout << query(r) << endl; }
	}
}
```







## æ ‘çŠ¶æ•°ç»„



æ ‘çŠ¶æ•°ç»„æ˜¯(Fenwick Tree)ä¸€ç§æ”¯æŒ**å•ç‚¹ä¿®æ”¹**å’Œ**åŒºé—´æŸ¥è¯¢**ï¼Œä»£ç é‡å°çš„æ•°æ®ç»“æ„ï¼Œæ ‘çŠ¶æ•°ç»„èƒ½è§£å†³çš„é—®é¢˜æ˜¯çº¿æ®µæ ‘èƒ½è§£å†³çš„é—®é¢˜çš„å­é›†

æ™®é€šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤çš„ä¿¡æ¯åŠè¿ç®—è¦æ»¡è¶³ **ç»“åˆå¾‹** ä¸” **å¯å·®åˆ†**ï¼Œå¦‚åŠ æ³•ã€ä¹˜æ³•ã€å¼‚æˆ–ç­‰ã€‚

### ä¸€ç»´æ ‘çŠ¶æ•°ç»„

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20241118121146793.png" alt="image-20241118121146793" style="zoom: 50%;" /> 



```cpp
template<typename T>
struct Fenwick{
	int n;
	vector<T>t;

	Fenwick(int n_ = 0){
		init(n_);
	}

	void init(int n_){
		n = n_ + 1;
		t.assign(n,T{});
	}

	void add(int i,const T &x){
		while(i <= n){
			t[i] += x;
			i += i&-i;
		}
	}

	T sum(int i){
		T ans = 0;
		while(i){
			ans += t[i];
			i -= i&-i;
		}
		return ans;
	}

	T sum(int l,int r){
		return sum(r) - sum(l-1);
	}

	int kth(int k){
		int sum = 0,x = 0;
		for(int i = log2(n);i >= 0;i--){
			int nx = x + (1 << i);
			if(nx < n && sum + t[nx] < k){
				x = nx;
				sum += t[x];
			}
		}
		return x + 1;
	}
};

Fenwick<int>t(n);
```





**åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢**

```cpp
//åˆ©ç”¨å·®åˆ†åŠå‰ç¼€å’Œæ•°ç»„ï¼Œt[]å»ºæ ‘ä¸ºå·®åˆ†æ•°ç»„
#include <iostream>
using namespace std;
using ll = long long;
const int N = 1000006;
int n,q;
ll a[N],t[N];

ll lowbit(ll x){return x&-x;}

void add(ll i,ll x){
	while(i <= n){
		t[i] += x;
		i += lowbit(i);
	}
}

ll getsum(int i){
	ll ans = 0;
	while(i > 0){
		ans += t[i];
		i -= lowbit(i);
	}
	return ans;
}

int main(){
	cin >> n >> q;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}

	while(q--){
		int op;cin >> op;
		if(op == 1){//åŒºé—´l~råŠ ä¸Šx
			int l,r,x;cin >> l >> r >> x;
			add(l,x);add(r+1,-x);
		}
		else{//æŸ¥è¯¢ä¸‹æ ‡ä¸ºxçš„æ•°æ‰€åœ¨çš„å€¼
			int x;cin >> x;
			cout << a[x] + getsum(x) << '\n';
		}
	}
}
```





### æƒå€¼æ ‘çŠ¶æ•°ç»„

è¯ºé¢˜ç›®å…è®¸ç¦»çº¿ï¼Œåˆ™ç¦»æ•£åŒ–åç©ºé—´å¤æ‚åº¦ä¸ºO(N)ï¼Œå¦åˆ™éœ€è¦å¼€åˆ°O(å€¼åŸŸ)çš„å¤§å°ã€‚



â€‹	**å•ç‚¹ä¿®æ”¹ï¼Œå…¨å±€ç¬¬kå°**

```cpp
// æƒå€¼æ ‘çŠ¶æ•°ç»„æŸ¥è¯¢å…¨å±€ç¬¬ k å°ï¼Œå€å¢ä»£æ›¿äºŒåˆ†ï¼ŒO(logN)
int kth(int k){
    int sum = 0,x = 0;
    for(int i = log2(n);i >= 0;i--){//è¦æ³¨æ„nåº”ä¸ºb[]çš„å€¼åŸŸè€Œéæ•°ç»„å¤§å°
        int nx = x + (1 << i);
        if(nx < n && sum + t[nx] < k){//è¯ºæˆåŠŸæ‰©å±•
            x = nx;
            sum += t[x];
        }
    }
    return x + 1;
}
```



[P3369 ã€æ¨¡æ¿ã€‘æ™®é€šå¹³è¡¡æ ‘ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P3369)

> æ‚¨éœ€è¦åŠ¨æ€åœ°ç»´æŠ¤ä¸€ä¸ªå¯é‡é›†åˆ $M$ï¼Œå¹¶ä¸”æä¾›ä»¥ä¸‹æ“ä½œï¼š
>
> 1. å‘ $M$ ä¸­æ’å…¥ä¸€ä¸ªæ•° $x$ã€‚
> 2. ä» $M$ ä¸­åˆ é™¤ä¸€ä¸ªæ•° $x$ï¼ˆè‹¥æœ‰å¤šä¸ªç›¸åŒçš„æ•°ï¼Œåº”åªåˆ é™¤ä¸€ä¸ªï¼‰ã€‚
> 3. æŸ¥è¯¢ $M$ ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ¯” $x$ å°ï¼Œå¹¶ä¸”å°†å¾—åˆ°çš„ç­”æ¡ˆåŠ ä¸€ã€‚
> 4. æŸ¥è¯¢å¦‚æœå°† $M$ ä»å°åˆ°å¤§æ’åˆ—åï¼Œæ’åä½äºç¬¬ $x$ ä½çš„æ•°ã€‚
> 5. æŸ¥è¯¢ $M$ ä¸­ $x$ çš„å‰é©±ï¼ˆå‰é©±å®šä¹‰ä¸ºå°äº $x$ï¼Œä¸”æœ€å¤§çš„æ•°ï¼‰ã€‚
> 6. æŸ¥è¯¢ $M$ ä¸­ $x$ çš„åç»§ï¼ˆåç»§å®šä¹‰ä¸ºå¤§äº $x$ï¼Œä¸”æœ€å°çš„æ•°ï¼‰ã€‚
>
> å¯¹äºæ“ä½œ 3,5,6ï¼Œ**ä¸ä¿è¯**å½“å‰å¯é‡é›†ä¸­å­˜åœ¨æ•° $x$ã€‚

æœ¬é¢˜ä¸­æˆ‘ä»¬åªéœ€è¦å…³å¿ƒçš„æ˜¯æ¯ä¸ªæ•°ä¹‹é—´çš„ç›¸å¯¹å…³ç³»ï¼Œä¸”å…è®¸ç¦»çº¿ï¼Œå› æ­¤å¯ä»¥ç¦»æ•£åŒ–å¤„ç†ã€‚

```cpp
#include <iostream>
#include <cmath>
#include <algorithm>
#include <vector>
using namespace std;
const int N = 100005;
int op[N],a[N];
int n;
vector<int>hs;

template<typename T>
struct Fenwick{
	int n;
	vector<T>t;

	Fenwick(int n_ = 0){
		init(n_);
	}

	void init(int n_){
		n = n_ + 1;
		t.assign(n,T{});
	}

	void add(int i,const T &x){
		while(i <= n){
			t[i] += x;
			i += i&-i;
		}
	}

	T sum(int i){
		T ans = 0;
		while(i){
			ans += t[i];
			i -= i&-i;
		}
		return ans;
	}

	T sum(int l,int r){
		return sum(r) - sum(l-1);
	}

	int kth(int k){
		int sum = 0,x = 0;
		for(int i = log2(n);i >= 0;i--){
			int nx = x + (1 << i);
			if(nx < n && sum + t[nx] < k){
				x = nx;
				sum += t[x];
			}
		}
		return x + 1;
	}
};

int main(){
	int q;cin >> q;
	for(int i = 1;i <= q;i++){
		cin >> op[i] >> a[i];
		if(op[i] != 4) hs.emplace_back(a[i]);
	}

	hs.emplace_back(-1e9);
	sort(hs.begin(),hs.end());
	hs.erase(unique(hs.begin(),hs.end()),hs.end());
	n = hs.size()-1;
	for(int i = 1;i <= q;i++){
		if(op[i] != 4) a[i] = lower_bound(hs.begin(),hs.end(),a[i])-hs.begin();
	}

	Fenwick<int>t(n+5);
	for(int i = 1;i <= q;i++){
		if(op[i] == 1) t.add(a[i],1);//æ’å…¥ä¸€ä¸ªæ•°x
		if(op[i] == 2) t.add(a[i],-1);//åˆ é™¤ä¸€ä¸ªæ•°x
		if(op[i] == 3) cout << t.sum(a[i]-1)+1 << '\n';//a[i]çš„æ’å,å³åŒºé—´[1,q[i]-1]çš„æ•°çš„ä¸ªæ•°å†åŠ 1
		if(op[i] == 4) cout << hs[t.kth(a[i])] << '\n';//æŸ¥è¯¢å…¨å±€ç¬¬kå°çš„æ•°(ä¸‹æ ‡ä»1å¼€å§‹)
		if(op[i] == 5) cout << hs[t.kth(t.sum(a[i]-1))] << '\n';//å‰é©±(è¯ºä¸å­˜åœ¨åˆ™è¿”å›x)
		if(op[i] == 6) cout << hs[t.kth(t.sum(a[i])+1)] << '\n';//åç»§(è¯ºä¸å­˜åœ¨åˆ™è¿”å›x)
	}
}
```





### é™æ€åŒºé—´é¢œè‰²æ•°

> ç»™ç‚¹ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„a[ ]ï¼Œqä¸ªè¯¢é—®ï¼šåŒºé—´[l,r]ä¸åŒå…ƒç´ çš„ä¸ªæ•°ã€‚

æ€è·¯ï¼šå¯¹äºè¯¢é—®å¤šä¸ªåŒºé—´ [L,R] ä¸­å‡ºç°ä¸åŒæ•°å­—ä¸ªæ•°ï¼Œå½“ R ç›¸åŒæ—¶ï¼Œå¦‚æœåŒºé—´å‡ºç°äº†é‡å¤æ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å…³å¿ƒæœ€å³ç«¯çš„è¿™ä¸ªæ•°å­—å°±å¯ä»¥äº†ã€‚æ¢è¨€ä¹‹ï¼Œé‡å¤å‡ºç°çš„æ•°å­—åœ¨å·¦ç«¯å°†æ— ä»»ä½•è´¡çŒ®ã€‚ä¾‹å¦‚ {1 2 3 1 4}ï¼Œåœ¨è¯¢é—® åŒºé—´[1,4] æ—¶ï¼Œç¬¬ä¸€ä¸ª 1 æ— ä»»ä½•è´¡çŒ®ï¼Œå¹¶ä¸”å½“è¯¢é—®çš„ R ä¸æ–­å³ç§»çš„è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€ä¸ª 1 éƒ½æ— ä»»ä½•æ„ä¹‰ï¼Œè¢«ç¬¬å››ä½ç½®çš„æ›¿ä»£æ‰ã€‚

äºæ˜¯æŠŠ**è¯¢é—®ç¦»çº¿**ä¸‹æ¥ï¼ŒæŒ‰ç…§è¯¢é—®çš„å³ç«¯ç‚¹æ’åºã€‚

å½“å‡ºç°ä¸€ä¸ªæ•°å­—æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—æ›¾ç»å‡ºç°ï¼Œåˆ™ `add(lst[pos[i]],-1)`ï¼ŒæŠŠè¿™ä¸ªæ•°åœ¨ä¸Šä¸€ä¸ªä½ç½®çš„æ ‡è®°æ¸…æ‰ï¼Œ`add(pos[i],1)` æ¥æ›´æ–°è¿™ä¸ªæ•°å­—çš„æ–°ä½ç½®ã€‚åªéœ€è¦ç»´æŠ¤ç¬¬`i`ä¸ªä½ç½®ä¸Šæœ‰æ²¡æœ‰æ•°ï¼Œæ±‚åŒºé—´`[l,r]`å†…æœ‰å¤šå°‘ä¸ªæ•°ã€‚

ç”¨æ ‘çŠ¶æ•°ç»„å•ç‚¹ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢ã€‚ç”¨å‰ç¼€å’Œ `query(R)-query(L-1)` æŠŠåŒºé—´`[L,R]`çš„æ•°çš„ä¸ªæ•°å‡ºæ¥ã€‚

```cpp
//HHçš„é¡¹é“¾ https://www.luogu.com.cn/problem/P1972
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 1000006;
int n,q;
int a[N];//æœ¬é¢˜a[i] <= 1e6,ä¸ç”¨ç¦»æ•£åŒ–
int pos[N];
int ans[N];

struct Ask{
	int l,r,id;
	bool operator < (Ask &e2){
		return r < e2.r;
	}
}ask[N];

int t[N];

void add(int i,int x){
	while(i <= n){
		t[i] += x;
		i += i&-i;
	}
}

int query(int i){
	int ans = 0;
	while(i > 0){
		ans += t[i];
		i -= i&-i;
	}
	return ans;
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++) cin >> a[i];
	cin >> q;
	for(int i = 1;i <= q;i++){
		cin >> ask[i].l >> ask[i].r;
		ask[i].id = i;
	}
	sort(ask+1,ask+q+1);//æŒ‰å³ç«¯ç‚¹å‡åºæ’åº

	for(int i = 1,j = 1;i <= q;i++){//å¤„ç†æ¯ä¸ªè¯¢é—®ask[i],jä¸ºå½“å‰å³ç«¯ç‚¹ã€‚
		auto &[l,r,id] = ask[i];
		while(j <= r){//æ›´æ–°jåˆ°ask[i].rçš„å€¼
			if(pos[a[j]]) add(pos[a[j]],-1);//è¯ºa[j]ä¹‹å‰å·²ç»å‡ºç°è¿‡åˆ™åˆ å»
			pos[a[j]] = j;
			add(j,1);
			j++;
		}
		ans[id] = query(r) - query(l-1);
	}
	for(int i = 1;i <= q;i++) cout << ans[i] << '\n';
}
```





## çº¿æ®µæ ‘

çº¿æ®µæ ‘æ˜¯å¸¸ç”¨çš„ç”¨æ¥ç»´æŠ¤ **åŒºé—´ä¿¡æ¯** çš„æ•°æ®ç»“æ„ã€‚

å¯ä»¥åœ¨ $O(\log N)$ çš„æ—¶é—´å¤æ‚åº¦å†…å®ç°å•ç‚¹/åŒºé—´ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢ï¼ˆsumã€maxã€minï¼‰ç­‰æ“ä½œã€‚

 <img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20241118222217276.png" alt="image-20241118222217276" style="zoom: 33%;" /> 



**å»ºæ ‘**

```cpp
struct ST{
    int l,r;
    int dat;//lazy,mx,mn,sum,gcd...
}t[N<<2];//è‡³å°‘è¦å¼€ 4*N ç©ºé—´

void build(int p,int l,int r){//build(1,1,n);
    t[p] = {l,r,0};
    if(l == r){t[p].dat = a[l];return;}
    int mid = l + r >> 1;
    build(p+p,l,mid);build(p+p+1,mid+1,r);//é€’å½’å»ºæ ‘
    //t[p].dat = f(t[p+p].dat,t[p+p+1].dat);
}
```



### å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢

> å•ç‚¹ä¿®æ”¹ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œé€’å½’æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åä¿®æ”¹ï¼Œç„¶åå‘ä¸Šä¼ é€’ä¿¡æ¯ã€‚

> åŒºé—´æŸ¥è¯¢ï¼š
> 1.è‹¥å½“å‰èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„åŒºé—´å·²ç»è¢«è¯¢é—®åŒºé—´æ‰€å®Œå…¨è¦†ç›–ï¼Œåˆ™ç«‹å³å›æº¯ï¼Œå¹¶ä¼ å›è¯¥ç‚¹çš„ä¿¡æ¯ã€‚
> 2.è‹¥å½“å‰èŠ‚ç‚¹çš„å·¦å„¿å­æ‰€è¡¨ç¤ºçš„åŒºé—´å·²ç»è¢«è¯¢é—®åŒºé—´æ‰€å®Œå…¨è¦†ç›–ï¼Œå°±é€’å½’è®¿é—®å®ƒçš„å·¦å„¿å­ã€‚
> 3.è‹¥å½“å‰èŠ‚ç‚¹çš„å³å„¿å­æ‰€è¡¨ç¤ºçš„åŒºé—´å·²ç»è¢«è¯¢é—®åŒºé—´æ‰€å®Œå…¨è¦†ç›–ï¼Œå°±é€’å½’è®¿é—®å®ƒçš„å³å„¿å­ã€‚

```cpp
//å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æœ€å€¼   http://acm.hdu.edu.cn/showproblem.php?pid=1754
void change(int p,int i,int x){//change(1,i,x);
	if(t[p].l == t[p].r) {t[p].mx = x;return;}
	int mid = t[p].l + t[p].r >> 1;
	if(i <= mid) change(p+p,i,x);
	else change(p+p+1,i,x);
	t[p].mx = max(t[p+p].mx,t[p+p+1].mx);
}

int query_max(int p,int l,int r){//query(1,l,r);
    if(l <= t[p].l && r >= t[p].r) return t[p].mx;
    int mid = t[p].l + t[p].r >> 1;
    int ans = -1e9;
    if(l <= mid) ans = max(ans,query(p+p,l,r));
    if(r > mid) ans = max(ans,query(p+p+1,l,r));
    return ans;
}

int query(int p,int i){//å•ç‚¹æŸ¥è¯¢
    if(t[p].l == t[p].r) return t[p].mx;
    int mid = t[p].l + t[p].r >> 1;
    if(i <= mid) return query(p<<1,i);
    else return query(p<<1|1,i);
}
```



```cpp
//å•ç‚¹ä¿®æ”¹ï¼Œæ±‚åŒºé—´æœ€å¤§å­æ®µå’Œ   https://www.luogu.com.cn/problem/SP1716
//å•ç‚¹ä¿®æ”¹ï¼Œæ±‚åŒºé—´æœ€å¤§å€¼å‡ºç°æ¬¡æ•°  https://ac.nowcoder.com/acm/contest/90296/E
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 50004;
int n,q;
int a[N];

struct ST{
	int l,r;
	int ls,rs;//ç´§é å·¦ç«¯ç‚¹å’Œç´§é å³ç«¯ç‚¹çš„æœ€å¤§å­æ®µå’Œ
    int ans,sum;//sumä¸ºåŒºé—´å’Œï¼Œansä¸ºæœ€é•¿å­æ®µå’Œ
}t[N<<2];

void pushup(ST &p,ST &pl,ST &pr){
	p.sum = pl.sum + pr.sum;
	p.ls = max(pl.ls,pl.sum+pr.ls);//ç´§é å·¦ç«¯ç‚¹ä¸è·¨è¶Šä¸­é—´å’Œè·¨è¶Šä¸­é—´å–æœ€å¤§å€¼
	p.rs = max(pr.rs,pr.sum+pl.rs);
	p.ans = max({pl.ans,pr.ans,pl.rs+pr.ls});//ç­”æ¡ˆåœ¨{å·¦åŒºé—´ç­”æ¡ˆï¼Œå³åŒºé—´ç­”æ¡ˆï¼Œè·¨ä¸­é—´çš„æœ€é•¿å­æ®µ}å–æœ€å€¼
}

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		t[p].ls = t[p].rs = t[p].ans = t[p].sum = a[l];
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

void change(int p,int i,int x){
	if(t[p].l == t[p].r){
		t[p].ls = t[p].rs = t[p].ans = t[p].sum = x;
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(i <= mid) change(p<<1,i,x);
	else change(p<<1|1,i,x);
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

ST query(int p,int l,int r){//æ›´åŠ é€šç”¨çš„queryå†™æ³•,è¿”å›çš„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åŒ…å«äº†åŒºé—´[l,r]çš„ansã€sumç­‰ä¿¡æ¯
	if(l <= t[p].l && r >= t[p].r){
		return t[p];
	}
	int mid = t[p].l + t[p].r >> 1;
	if(r <= mid) return query(p<<1,l,r);//è¦æŸ¥è¯¢çš„åŒºé—´åœ¨midå·¦è¾¹,ç­”æ¡ˆåœ¨å·¦åŒºé—´,æ³¨æ„l,rä½ç½®
	if(l > mid) return query(p<<1|1,l,r);//è¦æŸ¥è¯¢çš„åŒºé—´åœ¨midå³è¾¹,ç­”æ¡ˆåœ¨å³åŒºé—´
	ST pl = query(p<<1,l,r);
	ST pr = query(p<<1|1,l,r);
	ST ans;
	pushup(ans,pl,pr);
	return ans;
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}
	build(1,1,n);
	cin >> q;
	while(q--){
		int op,l,r;cin >> op >> l >> r;
		if(op == 0){
			change(1,l,r);
		}
		else{
			cout << query(1,l,r).ans << '\n';
		}
	}
}
```



[F - Palindrome Query (atcoder.jp)](https://atcoder.jp/contests/abc331/tasks/abc331_f)

> å•ç‚¹ä¿®æ”¹ï¼ŒæŸ¥è¯¢åŒºé—´æ˜¯å¦ä¸ºå›æ–‡ä¸²(å­—ç¬¦ä¸²å“ˆå¸Œ)
>
> $h(abcd) = s[0]*p^3 + s[1]*p^2 + s[2]*p^1 + s[3]$
>
> æˆ‘ä»¬åªéœ€è¦å•ç‚¹ä¿®æ”¹ï¼Œæ±‚åŒºé—´å’Œå³å¯å¾—åˆ°å­ä¸²å“ˆå¸Œå€¼ã€‚æ¯”è¾ƒæ­£åä¸²çš„å“ˆå¸Œå€¼æ˜¯å¦ä¸€è‡´åˆ¤æ–­å›æ–‡ä¸²ã€‚

```cpp
#include <iostream>
using namespace std;
using ull = unsigned long long;
const ull P = 131;
const int N = 1000006;
int n,q;
ull f[N];
string s;

struct ST{
	int l,r;
	ull kl,kr;
}t[N<<2];

void pushup(ST &p,ST &pl,ST &pr){
	p.kl = pl.kl + pr.kl;
	p.kr = pl.kr + pr.kr;
}

void pushup(int p){
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

void update(ST &p,char x){
	p.kl = f[n-p.l]*x;
	p.kr = f[p.l-1]*x;
}

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		update(t[p],s[l-1]);
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
	pushup(p);
}

void modify(int p,int i,char x){
	if(t[p].l == t[p].r){
		update(t[p],x);
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(i <= mid) modify(p<<1,i,x);
	else modify(p<<1|1,i,x);
	pushup(p);
}

ST query(int p,int l,int r){
	if(l <= t[p].l && r >= t[p].r){
		return t[p];
	}
	int mid = t[p].l + t[p].r >> 1;
	if(r <= mid) return query(p<<1,l,r);
	if(l > mid) return query(p<<1|1,l,r);
	ST pl = query(p<<1,l,r);
	ST pr = query(p<<1|1,l,r);
	ST ans;
	pushup(ans,pl,pr);
	return ans;
}

int main(){
	f[0] = 1;
	for(int i = 1;i < N;i++){
		f[i] = f[i-1]*P;
	}

	cin >> n >> q;
	cin >> s;
	build(1,1,n);

	while(q--){
		int op;cin >> op;
		if(op == 1){
			int x; char op; cin >> x >> op;
			modify(1,x,op);
		}
		else{
			int l,r;cin >> l >> r;
			auto ans = query(1,l,r);
			ull kl = ans.kl,kr = ans.kr;

			int k1 = l-1,k2 = n-r;
			if(k1 > k2) kl *= f[k1-k2];
			else kr *= f[k2-k1];

			if(kl == kr){ cout << "Yes\n"; }
			else{ cout << "No\n"; }
		}
	}
}
```



```cpp
//åŒºé—´ä¿®æ”¹,åŒºé—´å…¬çº¦æ•°  https://www.luogu.com.cn/problem/P10463
//åˆ©ç”¨gcdè¾—è½¬ç›¸å‡æ³•æ€§è´¨ï¼Œå°†a[]æ•°ç»„å˜ä¸ºå·®åˆ†æ•°ç»„d[]ï¼ŒåŒºé—´ä¿®æ”¹(a[l~r]+x)å˜ä¸ºå•ç‚¹ä¿®æ”¹(a[l]+x,d[r-1]-x)
//ç­”æ¡ˆä¸º gcd(a[l],d[l+1],...,d[r]) çš„ç»å¯¹å€¼
#include <iostream>
using namespace std;
using ll = long long;
const int N = 500005;
int n,q;
ll a[N];

ll gcd(ll a,ll b){return b?gcd(b,a%b):a;}

struct ST{
	int l,r;
	ll dat,sum;
}t[N<<2];

void pushup(ST &p,ST &pl,ST &pr){
	p.dat = gcd(pl.dat,pr.dat);
	p.sum = pl.sum + pr.sum;
}

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		t[p].dat = t[p].sum = a[l] - a[l-1];
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

void add(int p,int i,ll x){
	if(t[p].l == t[p].r){
		t[p].dat += x;
		t[p].sum += x;
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(i <= mid) add(p<<1,i,x);
	else add(p<<1|1,i,x);
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

ll query_sum(int p,int l,int r){
	if(l <= t[p].l && r >= t[p].r){
		return t[p].sum;
	}
	ll ans = 0;
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) ans += query_sum(p<<1,l,r);
	if(r > mid) ans += query_sum(p<<1|1,l,r);
	return ans;
}

ll query_gcd(int p,int l,int r){
	if(l <= t[p].l && r >= t[p].r){
		return t[p].dat;
	}
	ll ans = 0;
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) ans = gcd(ans,query_gcd(p<<1,l,r));
	if(r > mid) ans = gcd(ans,query_gcd(p<<1|1,l,r));
	return ans;
}

int main(){
	cin >> n >> q;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}
	build(1,1,n);
	while(q--){
		char op;cin >> op;
		if(op == 'C'){
			ll l,r,x;cin >> l >> r >> x;
			add(1,l,x);
			if(r+1 <= n) add(1,r+1,-x);
		}
		else{
			int l,r;cin >> l >> r;
			cout << abs(gcd(query_gcd(1,l+1,r),query_sum(1,1,l))) << '\n';
		}
	}
}
```



### åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢ï¼Œlazyæ ‡è®°

é€šè¿‡å»¶è¿Ÿå¯¹èŠ‚ç‚¹ä¿¡æ¯çš„æ›´æ”¹ï¼Œä»è€Œå‡å°‘å¯èƒ½ä¸å¿…è¦çš„æ“ä½œæ¬¡æ•°ã€‚æ¯æ¬¡æ‰§è¡Œä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡æ‰“æ ‡è®°çš„æ–¹æ³•è¡¨æ˜è¯¥èŠ‚ç‚¹å¯¹åº”çš„åŒºé—´åœ¨æŸä¸€æ¬¡æ“ä½œä¸­è¢«æ›´æ”¹ï¼Œä½†ä¸æ›´æ–°è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚å®è´¨æ€§çš„ä¿®æ”¹åˆ™åœ¨ä¸‹ä¸€æ¬¡è®¿é—®å¸¦æœ‰æ ‡è®°çš„èŠ‚ç‚¹æ—¶æ‰è¿›è¡Œã€‚å¶å­ç»“ç‚¹æ— éœ€ä¸‹æ”¾æ ‡è®°ã€‚

[Transformation - HDU 4578 - Virtual Judge (vjudge.net)](https://vjudge.net/problem/HDU-4578)

> å¯¹æ•°ç»„`a[]`å®ç°ä»¥ä¸‹æ“ä½œ
> `1 x y z`å°†åŒºé—´`[x,y]`ä¹‹é—´çš„æ¯ä¸ªå…ƒç´ å¢åŠ `z`ã€‚$1\le z \le 10000$
> `2 x y z`å°†åŒºé—´`[x,y]`ä¹‹é—´çš„æ¯ä¸ªå…ƒç´ ä¹˜ä»¥`z`ã€‚$1\le z \le 10000$
> `3 x y z`å°†åŒºé—´`[x,y]`ä¹‹é—´çš„æ¯ä¸ªå…ƒç´ å˜ä¸º`z`ã€‚$1\le z \le 10000$
> `4 x y z`è¾“å‡º$a_x^z + a_{x+1}^z + \dots + a_y^z$å¯¹10007å–æ¨¡åçš„ç»“æœã€‚$1\le z\le3$

```cpp
#include <iostream>

const int mod = 10007;
const int N = 100005;
int n,m;

struct ST{
	int l,r;
	long long d[4];
	long long add,mul;
}t[N<<2];

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		t[p].add = 0;
		t[p].mul = 1;
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
}

void pushup(ST &p,ST &pl,ST &pr){
	p.d[1] = (pl.d[1] + pr.d[1]) % mod;
	p.d[2] = (pl.d[2] + pr.d[2]) % mod;
	p.d[3] = (pl.d[3] + pr.d[3]) % mod;
}

void pushup(int p){
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

void update(ST &p,long long add,long long mul){//æ³¨æ„ç­”æ¡ˆã€æ•°æ®çš„æ›´æ–°é¡ºåº
	int len = p.r - p.l + 1;
	p.add = (p.add * mul + add) % mod;
	p.mul = (p.mul * mul) % mod;
	p.d[3] = (mul*mul%mod*mul%mod*p.d[3]%mod + 3*mul*mul%mod*add%mod*p.d[2]%mod + 3*add*add%mod*mul%mod*p.d[1]%mod + add*add%mod*add%mod*len%mod) % mod;
	p.d[2] = (p.d[2]*mul%mod*mul%mod + 2*mul*add%mod*p.d[1]%mod + add*add%mod*len%mod) % mod;
	p.d[1] = (p.d[1]*mul + len*add) % mod;
}

void pushdown(int p){
	auto &add = t[p].add,&mul = t[p].mul;
	if(add || mul != 1){//åŒæ—¶ä¸‹ä¼ æ‰€æœ‰æ ‡è®°
		update(t[p<<1],add,mul);
		update(t[p<<1|1],add,mul);
		add = 0,mul = 1;
	}
}

void modify(int p,int l,int r,int x,int op){//ç”¨å½“å‰æ ‡è®°æ›´æ–°ç­”æ¡ˆ(å’Œæ›´æ–°å…¶å®ƒæ ‡è®°(å¦‚æœæœ‰ä¸”éœ€è¦æ›´æ–°))
	if(l <= t[p].l && r >= t[p].r){
		if(op == 1){//add
			update(t[p],x,1);
		}
		if(op == 2){//mul
			update(t[p],0,x);
		}
		if(op == 3){//same  ç›¸å½“äºåŒºé—´ä¹˜0å†åŠ x
			update(t[p],x,0);
		}
		return;
	}
	pushdown(p);
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) modify(p<<1,l,r,x,op);
	if(r > mid) modify(p<<1|1,l,r,x,op);
	pushup(p);
}

ST query(int p,int l,int r){//æ¯”è¾ƒé€šç”¨çš„queryå†™æ³•
	if(l <= t[p].l && r >= t[p].r){
		return t[p];
	}
	pushdown(p);
	int mid = t[p].l + t[p].r >> 1;
	if(r <= mid) return query(p<<1,l,r);
	if(l > mid) return query(p<<1|1,l,r);
	ST pl = query(p<<1,l,r),pr = query(p<<1|1,l,r),ans;
	pushup(ans,pl,pr);
	return ans;
}

void sol(){
	build(1,1,n);
	while(m--){
		int op,x,y,z;std::cin >> op >> x >> y >> z;
		if(op == 4)std::cout << query(1,x,y).d[z] << '\n';	
		else modify(1,x,y,z,op);
	}
}

int main(){
	std::ios::sync_with_stdio(false);std::cin.tie(0);
	while(std::cin >> n >> m,n|m) sol();
}
```



[SP2713 GSS4 - Can you answer these queries IV - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/SP2713)

> åŒºé—´å¼€å¹³æ–¹ï¼Œæ±‚åŒºé—´å’Œ

å¯¹äºåŒºé—´å¼€å¹³æ–¹ï¼Œç”±äºæˆ‘ä»¬æ— æ³•åœ¨ä¸æ›´æ–°å¶å­èŠ‚ç‚¹æ—¶æ›´æ–°åŒºé—´ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨lazyæ ‡è®°ä¼˜åŒ–åŒºé—´ä¿®æ”¹ã€‚è€ƒè™‘åˆ°æ¯ä¸ªæ•°æœ€å¤šè¢«å¼€å¹³æ–¹æœ‰é™æ¬¡ä¹‹åå°±ä¼šå˜ä¸º1ï¼Œäºæ˜¯æˆ‘ä»¬åœ¨ä¿®æ”¹æ—¶ï¼Œä¸€ç›´ä¿®æ”¹åˆ° å¶å­èŠ‚ç‚¹ æˆ–è€… å½“å‰åŒºé—´æ‰€æœ‰æ•°éƒ½ä¸º1ã€‚

```cpp
const int N = 100005;
int n,q;
long long a[N];

struct ST{
	int l,r;
	long long dat;
}t[N<<2];

void pushup(ST &p,ST &pl,ST &pr){
	p.dat = pl.dat + pr.dat;
}

void pushup(int p){
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		t[p].dat = a[l];
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
	pushup(p);
}

void modify(int p,int l,int r){
	if(t[p].dat == t[p].r - t[p].l + 1) {//å½“å‰åŒºé—´æ‰€æœ‰æ•°éƒ½ä¸º1æ—¶,ç›´æ¥è¿”å›
		return;
	}
	if(t[p].l == t[p].r) {//å½“å‰ä¸ºå¶å­èŠ‚ç‚¹æ—¶,ç›´æ¥ä¿®æ”¹
		t[p].dat = std::sqrt(t[p].dat);
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) modify(p<<1,l,r);
	if(r > mid) modify(p<<1|1,l,r);
	pushup(p);
}

ST query(int p,int l,int r){
	if(l <= t[p].l && r >= t[p].r){
		return t[p];
	}
	int mid = t[p].l + t[p].r >> 1;
	if(r <= mid) return query(p<<1,l,r);
	if(l > mid) return query(p<<1|1,l,r);
	ST pl = query(p<<1,l,r),pr = query(p<<1|1,l,r),ans;
	pushup(ans,pl,pr);
	return ans;
}

void sol(){
	for(int i = 1;i <= n;i++) std::cin >> a[i];
	build(1,1,n);
	std::cin >> q;
	while(q--){
		int op,l,r;std::cin >> op >> l >> r;
		if(l > r) std::swap(l,r);
		if(op == 0) modify(1,l,r);
		else std::cout << query(1,l,r).dat << '\n';
	}
}
```



### æƒå€¼çº¿æ®µæ ‘

å¯¹æƒå€¼ä½œä¸ºç»´æŠ¤å¯¹è±¡è€Œå¼€çš„çº¿æ®µæ ‘ï¼Œæ¯ä¸ªç‚¹å­˜çš„æ˜¯åŒºé—´å†…å¯¹åº”æ•°å­—çš„æŸç§å€¼(å¦‚å‡ºç°æ¬¡æ•°ç­‰)ï¼Œæ“ä½œè·Ÿçº¿æ®µæ ‘ç±»ä¼¼ã€‚

è¯ºé¢˜ç›®å…è®¸ç¦»çº¿ï¼Œåˆ™ç¦»æ•£åŒ–åç©ºé—´å¤æ‚åº¦ä¸ºO(N)ï¼Œå¦åˆ™éœ€è¦å¼€åˆ°O(max_val)çš„å¤§å°ã€‚



[P3369 ã€æ¨¡æ¿ã€‘æ™®é€šå¹³è¡¡æ ‘ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P3369)

ä¸æƒå€¼æ ‘çŠ¶æ•°ç»„å®ç°ç±»ä¼¼ã€‚

```cpp
#include <iostream>
#include <algorithm>
#include <vector>
using namespace std;
const int N = 100005;
int op[N],a[N];
vector<int>hs;

struct st{
	int l,r;
	int dat;
}t[N<<2];

void pushup(int p){
	t[p].dat = t[p<<1].dat + t[p<<1|1].dat;
}

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		t[p].dat = 0;
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
	pushup(p);
}

void modify(int p,int l,int r,int x){//å•ç‚¹ä¿®æ”¹
	if(l <= t[p].l && r >= t[p].r){
		if(t[p].dat + x >= 0) t[p].dat += x;
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) modify(p<<1,l,r,x);
	if(r > mid) modify(p<<1|1,l,r,x);
	pushup(p);
}


int rnk(int p,int l,int r){//æŸ¥è¯¢åŒºé—´[l,r]çš„å’Œ
	if(l <= t[p].l && r >= t[p].r){
		return t[p].dat;
	}
	int mid = t[p].l + t[p].r >> 1;
	int ans = 0;
	if(l <= mid) ans += rnk(p<<1,l,r);
	if(r > mid) ans += rnk(p<<1|1,l,r);
	return ans;
}

int kth(int p,int k){//çº¿æ®µæ ‘ä¸ŠäºŒåˆ†,æŸ¥è¯¢å…¨å±€ç¬¬kå°çš„æ•°çš„ä¸‹æ ‡(åªèƒ½æŸ¥å…¨å±€)
	if(t[p].l == t[p].r){
		return t[p].l;
	}
	if(k <= t[p<<1].dat) return kth(p<<1,k);
	else return kth(p<<1|1,k-t[p<<1].dat);
}

int main(){
	int q;cin >> q;
	for(int i = 1;i <= q;i++){
		cin >> op[i] >> a[i];
		if(op[i] == 4) continue;
		hs.emplace_back(a[i]);
	}
    
	hs.emplace_back(-1e9);
	sort(hs.begin(),hs.end());
	hs.erase(unique(hs.begin(),hs.end()),hs.end());
	int m = hs.size()-1;
	for(int i = 1;i <= q;i++){
		if(op[i] == 4) continue;
		a[i] = lower_bound(hs.begin(),hs.end(),a[i])-hs.begin();
	}
    
	build(1,1,m);
	for(int i = 1;i <= q;i++){
		if(op[i] == 1){//æ’å…¥ä¸€ä¸ªæ•°x
			modify(1,a[i],a[i],1);
		}
		if(op[i] == 2){//åˆ é™¤ä¸€ä¸ªæ•°x(å¦‚æœ‰å¤šä¸ª,åªåˆ é™¤ä¸€ä¸ª)
			modify(1,a[i],a[i],-1);
		}
		if(op[i] == 3){//a[i]çš„æ’å,å³åŒºé—´[1,a[i]-1]çš„æ•°çš„ä¸ªæ•°å†åŠ 1
			if(a[i] == 1) {cout << 1 << '\n';continue;}
			cout << rnk(1,1,a[i]-1)+1 << '\n';
		}
		if(op[i] == 4){//æŸ¥è¯¢å…¨å±€ç¬¬kå°çš„æ•°(ä¸‹æ ‡ä»1å¼€å§‹)
			cout << hs[kth(1,a[i])] << '\n';
		}
		if(op[i] == 5){//æŸ¥æ‰¾xçš„å‰é©±(è¯ºä¸å­˜åœ¨åˆ™è¿”å›x)
			int rk = rnk(1,1,a[i]-1);
			cout << hs[kth(1,rk)] << '\n';
		}
		if(op[i] == 6){//æŸ¥æ‰¾xçš„åç»§(è¯ºä¸å­˜åœ¨åˆ™è¿”å›x)
			int rk = rnk(1,1,a[i])+1;
			cout << hs[kth(1,rk)] << '\n';
		}
	}
}
```










## éœå¤«æ›¼æ ‘

ä»æ ¹ç»“ç‚¹åˆ°å„å¶ç»“ç‚¹çš„è·¯å¾„é•¿åº¦ä¸ç›¸åº”å¶èŠ‚ç‚¹æƒå€¼çš„ä¹˜ç§¯ä¹‹å’Œç§°ä¸º **æ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦ï¼ˆWeighted Path Length of Treeï¼ŒWPLï¼‰**ã€‚

è®¾ $w_i$ ä¸ºäºŒå‰æ ‘ç¬¬ $i$ ä¸ªå¶ç»“ç‚¹çš„æƒå€¼ï¼Œ$l_i$ ä¸ºä»æ ¹ç»“ç‚¹åˆ°ç¬¬ $i$ ä¸ªå¶ç»“ç‚¹çš„è·¯å¾„é•¿åº¦ï¼Œåˆ™ WPL è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

$$
WPL=\sum_{i=1}^nw_il_i
$$

ï¼ˆä¹Ÿç­‰äºæ‰€æœ‰éå¶å­èŠ‚ç‚¹ä¹‹å’Œï¼‰å¯¹äºç»™å®šä¸€ç»„å…·æœ‰ç¡®å®šæƒå€¼çš„å¶ç»“ç‚¹ï¼Œå¯ä»¥æ„é€ å‡ºä¸åŒçš„æ ‘ï¼Œå…¶ä¸­ï¼Œ**WPL æœ€å°çš„æ ‘** ç§°ä¸º **éœå¤«æ›¼æ ‘ï¼ˆHuffman Treeï¼‰**ã€‚éœå¤«æ›¼æ ‘**ä¸å”¯ä¸€**ã€‚

å¦‚æœæ¯ä¸ªå­—ç¬¦çš„ **ä½¿ç”¨é¢‘ç‡ç›¸ç­‰**ï¼Œé‚£ä¹ˆç­‰é•¿ç¼–ç æ— ç–‘æ˜¯ç©ºé—´æ•ˆç‡æœ€é«˜çš„ç¼–ç æ–¹æ³•ï¼Œè€Œå¦‚æœå­—ç¬¦å‡ºç°çš„é¢‘ç‡ä¸åŒï¼Œåˆ™å¯ä»¥è®©é¢‘ç‡é«˜çš„å­—ç¬¦é‡‡ç”¨å°½å¯èƒ½çŸ­çš„ç¼–ç ï¼Œé¢‘ç‡ä½çš„å­—ç¬¦é‡‡ç”¨å°½å¯èƒ½é•¿çš„ç¼–ç ï¼Œæ¥æ„é€ å‡ºä¸€ç§ ä¸ç­‰é•¿ç¼–ç ï¼Œä»è€Œè·å¾—æ›´å¥½çš„ç©ºé—´æ•ˆç‡ã€‚

åœ¨è®¾è®¡ä¸ç­‰é•¿ç¼–ç æ—¶ï¼Œè¦è€ƒè™‘è§£ç çš„å”¯ä¸€æ€§ï¼Œå¦‚æœä¸€ç»„ç¼–ç ä¸­ä»»ä¸€ç¼–ç éƒ½ä¸æ˜¯å…¶ä»–ä»»ä½•ä¸€ä¸ªç¼–ç çš„å‰ç¼€ï¼Œé‚£ä¹ˆç§°è¿™ç»„ç¼–ç ä¸º **å‰ç¼€ç¼–ç **ï¼Œå…¶ä¿è¯äº†ç¼–ç è¢«è§£ç æ—¶çš„å”¯ä¸€æ€§ã€‚

éœå¤«æ›¼æ ‘å¯ç”¨äºæ„é€  **æœ€çŸ­çš„å‰ç¼€ç¼–ç **ï¼Œå³ **éœå¤«æ›¼ç¼–ç ï¼ˆHuffman Codeï¼‰**





**ä¸å»ºæ ‘ç›´æ¥æ±‚nä¸ªèŠ‚ç‚¹kå‰æ ‘çš„æœ€å°WPL**

è®©næ»¡è¶³==(n-1)%(k-1) == 0==ï¼Œå¦åˆ™ä¸æ–­å¡«0ï¼Œn++
å»ºç«‹å°æ ¹å †ï¼Œæ¯æ¬¡å–å †é¡¶çš„kä¸ªæ±‚å’Œsï¼Œå†å°†så…¥å †ï¼Œç›´åˆ°å°æ ¹å †åªå‰©ä¸€ä¸ªå…ƒç´ 

```cpp
#include <iostream>
#include <queue>
using namespace std;
priority_queue<int,vector<int>,greater<int>>pq;

int main(){
	int n,k;cin >> n >> k;
	for(int i = 1;i <= n;i++){
		int x;cin >> x;
		pq.push(x);
	}
	while((n-1)%(k-1) != 0){
		pq.push(0);
		n++;
	}

	int ans = 0;
	while(pq.size() > 1){
		int sum = 0;
		for(int i = 0;i < k;i++){
			int x = pq.top();
			pq.pop();
			sum += x;
		}
		pq.push(sum);
		ans += sum;
	}
	cout << ans;
}
```



```cpp
//åˆå¹¶æœå­åŠ å¼ºç‰ˆï¼šhttps://www.luogu.com.cn/problem/P6033
//ç®€åŒ–ç‰ˆä¸ºnä¸ªèŠ‚ç‚¹2å‰æ ‘çš„WPLï¼›n<=1e5
//åŠ å¼ºç‰ˆn<=1e7ï¼Œä½†a[i]æ¯”è¾ƒå°ï¼Œå¯ä»¥ç”¨O(N)çš„æ¡¶æ’
//ä½¿ç”¨ä¸¤ä¸ªqueueä»£æ›¿ä¼˜å…ˆé˜Ÿåˆ—(ä¿è¯å•è°ƒæ€§)
#include <iostream>
#include <queue>
using namespace std;
using ll = long long;
const int N = 100005;
int a[N],idx;
queue<ll>q1,q2;//q1ä¸ºæ’åºåçš„åŸæ•°ç»„ï¼Œq2ä¸ºåˆå¹¶çš„æœå­æ•°ç»„ï¼Œå¯ä»¥è¯æ˜q2ä¸ºå•è°ƒé€’å¢

int read(){
	int x = 0,f = 1;
	char ch = getchar();
	while(!isdigit(ch)){ if(ch == '-') f = -1; ch = getchar(); }
	while(isdigit(ch)){ x = x*10 + ch - '0'; ch = getchar(); }
	return x*f;
}

ll get_top(){
	ll x;
	if(q2.empty() || (q1.size() && q1.front() < q2.front())){
		x = q1.front(); q1.pop();
	}
	else{
		x = q2.front(); q2.pop();
	}
	return x;
}

int main(){
	int n;cin >> n;
	for(int i = 1;i <= n;i++){
		int x = read();
		a[x]++;//ç›´æ¥ä½¿ç”¨O(N)çš„æ¡¶æ’
	}
	for(int i = 1;i < N;i++){
		for(int j = 0;j < a[i];j++){
			q1.emplace(i);
		}
	}

	ll ans = 0;
	while(q1.size() + q2.size() > 1){
		ll x = get_top();//æ¯æ¬¡ä»q1å’Œq2ä¸­é€‰æœ€å°çš„ä¸¤ä¸ªå–å‡º
		ll y = get_top();
		ans += x+y;
		q2.push(x+y);//ç´¯åŠ åˆ°ç­”æ¡ˆåï¼ŒåŠ å…¥q2é˜Ÿå°¾
	}
	cout << ans;
}
```



[NOI2015 è·é©¬å²è¯—](https://www.luogu.com.cn/problem/P2168)

æ±‚æœ€çŸ­WPLï¼Œå¹¶ä¸”è¦è®©æœ€é•¿çš„éœå¤«æ›¼ç¼–ç æœ€çŸ­

åªéœ€åœ¨åˆå¹¶æ—¶ï¼Œå¯¹äºæƒå€¼ç›¸åŒçš„èŠ‚ç‚¹ï¼Œä¼˜å…ˆè€ƒè™‘å½“å‰æ·±åº¦æœ€å°(å·²åˆå¹¶æ¬¡æ•°æœ€å°‘)çš„è¿›è¡Œåˆå¹¶å³å¯

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20241010130102837.png" alt="image-20241010130102837" style="zoom: 67%;" />    ä¸¤ç§éœå¤«æ›¼æ ‘WPLå‡ä¸º12ï¼Œä½†å³å›¾æœ€é•¿ç¼–ç æ›´å°

```cpp
#include <iostream>
#include <queue>
using namespace std;
using ll = long long;
using pii = pair<ll,ll>;
int n,k;
priority_queue<pii,vector<pii>,greater<pii>>pq;
ll ans;

int main(){
	cin >> n >> k;
	for(int i = 1;i <= n;i++){
		ll x;cin >> x;
		pq.push({x,0});
	}

	while((n-1)%(k-1) != 0){
		pq.push({0,0});
		n++;
	}

	while(pq.size() > 1){
		ll sum = 0;
		ll dep = 0;
		for(int i = 0;i < k;i++){
			auto [x,y] = pq.top();
			pq.pop();
			sum += x;
			dep = max(dep,y);
		}
		pq.push({sum,dep+1});
		ans += sum;
	}
	cout << ans << endl << pq.top().second << endl;
}
```











------



# å­—ç¬¦ä¸²

**string s = â€œABCDEâ€**

**å­ä¸²**(substring)ï¼šs[i]~s[j]  è¿ç»­çš„ä¸€æ®µ,å¦‚:BCD
**å­åºåˆ—**(subsequence)ï¼šs[i]~s[j]  å°†è‹¥å¹²å…ƒç´ æå–å‡ºæ¥å¹¶ä¸æ”¹å˜ç›¸å¯¹ä½ç½®å½¢æˆçš„åºåˆ—ï¼Œå¦‚:ACD

**å‰ç¼€s[0~i]**ï¼šAã€ABã€ABCã€ABCDã€ABCDE
**çœŸå‰ç¼€**ï¼šä¸åŒ…æ‹¬æœ¬èº«çš„å‰ç¼€  Aã€ABã€ABCã€ABCD

**åç¼€s[i~n-1]**ï¼šEã€DEã€CDEã€BCDEã€ABCDE
**çœŸåç¼€**ï¼šä¸åŒ…æ‹¬æœ¬èº«çš„åç¼€   Eã€DEã€CDEã€BCDE

**å›æ–‡ä¸²** ï¼šæ˜¯æ­£ç€å†™å’Œå€’ç€å†™ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¦‚abaã€aaã€abcba

**å­—å…¸åº**ï¼šä»¥ç¬¬`i`ä¸ªå­—ç¬¦ä½œä¸ºç¬¬`i`å…³é”®å­—è¿›è¡Œå¤§å°æ¯”è¾ƒï¼Œç©ºå­—ç¬¦å°äºå­—ç¬¦é›†å†…ä»»ä½•å­—ç¬¦
				å¦‚ï¼šabc < adcã€a < aaã€abcd < adcd

**border**ï¼šå­—ç¬¦ä¸²ä¸­çœŸå‰ç¼€å’ŒçœŸåç¼€ç›¸ç­‰çš„ä¸€æ®µï¼š
â€‹				å¦‚f[a] = 0ã€f[aba] = aã€f[abab] = abã€f[ababa] = a,abaã€f[aaaa] = a,aa,aaa



## å­—ç¬¦ä¸²å“ˆå¸Œ

[å­—ç¬¦ä¸²å“ˆå¸Œ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/string/hash/)

åªèƒ½åŒ¹é…å­ä¸²ï¼Œä¸èƒ½åŒ¹é…å­åºåˆ—

> å…¨ç§°å­—ç¬¦ä¸²å‰ç¼€å“ˆå¸Œæ³•,æŠŠå­—ç¬¦ä¸²å˜æˆä¸€ä¸ªpè¿›åˆ¶æ•°å­—ï¼ˆå“ˆå¸Œå€¼ï¼‰,å®ç°ä¸åŒçš„å­—ç¬¦ä¸²æ˜ å°„åˆ°ä¸åŒçš„æ•°å­—ã€‚
> å¯¹å½¢å¦‚ $X_1X_2X_3Â·Â·Â·X_{n-1}X_n$çš„å­—ç¬¦ä¸², é‡‡ç”¨å­—ç¬¦çš„asciiç ä¹˜ä¸Š P çš„æ¬¡æ–¹æ¥è®¡ç®—å“ˆå¸Œå€¼ã€‚
> æ˜ å°„å…¬å¼ï¼š $(X_1 Ã— P^{n-1} + X_2 Ã— P^{n-2} +...+ X_{n-1} Ã— P^1 + X_n Ã— P^0)mod\ Q$
> $$
> h(S) := (\sum_{i=0}^{n-1}{P^{n-i-1}*s[i]})\ mod\ Q
> $$
> æ³¨æ„ç‚¹ï¼š 
> 1.ä»»æ„å­—ç¬¦ä¸å¯ä»¥æ˜ å°„æˆ0ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸åŒçš„å­—ç¬¦ä¸²éƒ½æ˜ å°„æˆ0çš„æƒ…å†µï¼Œæ¯”å¦‚A, AA, AAAçš†ä¸º0 
> 2.å†²çªé—®é¢˜ï¼šé€šè¿‡å·§å¦™è®¾ç½®åº•æ•°P(131æˆ– 13331)ï¼Œæ¨¡æ•°[Q(2^64)][ull,è‡ªç„¶æº¢å‡º]çš„å€¼ï¼Œå‡å°‘å†²çª
>
> é—®é¢˜æ˜¯æ¯”è¾ƒä¸åŒåŒºé—´çš„å­ä¸²æ˜¯å¦ç›¸åŒï¼Œå°±è½¬åŒ–ä¸ºå¯¹åº”çš„å“ˆå¸Œå€¼æ˜¯å¦ç›¸åŒã€‚
> æ±‚ä¸€ä¸ªå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼å°±ç›¸å½“äºæ±‚å‰ç¼€å’Œï¼Œæ±‚ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²å“ˆå¸Œå€¼å°±ç›¸å½“äºæ±‚éƒ¨åˆ†å’Œã€‚
>
> å‰ç¼€å’Œå…¬å¼ $h[i+1] = h[i] Ã— P ï¼‹ s[i]ï¼Œ0 <=i<=n-1$ï¼Œhä¸ºå‰ç¼€å’Œæ•°ç»„ï¼Œsä¸ºå­—ç¬¦ä¸²æ•°ç»„
> åŒºé—´å’Œå…¬å¼$h[l,r] = h[r+1] - h[l] Ã— P^{r-l+1}$ 
>
> åŒºé—´å’Œå…¬å¼çš„ç†è§£ï¼šABCDE ä¸ ABC çš„å‰ä¸‰ä¸ªå­—ç¬¦å€¼æ˜¯ä¸€æ ·ï¼Œåªå·®ä¸¤ä½, ä¹˜ä¸Š PÂ² æŠŠ ABC å˜ä¸º ABC00ï¼Œå†ç”¨ ABCDE-ABC00å¾—åˆ° DE çš„å“ˆå¸Œå€¼ã€‚



```cpp
#include <iostream>
#include <set>
#include <vector>

namespace Hash{
	const unsigned long long base = 131,mod = 1e9+7;
	std::vector<unsigned long long>p(1,1),p2(1,1);//p[]å»ºè®®å¼€å®šé•¿æ•°ç»„æå‰é¢„å¤„ç†

	template<typename T>
	struct hx{
		std::vector<unsigned long long>h;

		hx(){}
		hx(const T &s){
			init(s.size());
			h = std::vector<unsigned long long>(s.size()+1);
			for(int i = 0;i < s.size();i++){
				h[i+1] = h[i] * base + s[i];
			}
		}
		unsigned long long query(int l,int r){
			return h[r+1] - h[l]*p[r-l+1];
		}

		void init(int id){
			while(p.size() <= id){
				p.emplace_back(p.back()*base);
			}
		}
	};

	template<typename T>
	struct hx2{
		std::vector<unsigned long long>h,h2;

		hx2(){}
		hx2(const T &s){
			int n = s.size();
			init(s.size());
			h.resize(n+1);h2.resize(n+1);
			for(int i = 0;i < s.size();i++){
				h[i+1] = h[i]*base + s[i];
				h2[i+1] = (h2[i]*base + s[i]) % mod;
			}
		}

		std::pair<unsigned long long,unsigned long long> query(int l,int r){
			unsigned long long k1 = h[r+1] - h[l]*p[r-l+1];
			unsigned long long k2 = (h2[r+1] - h2[l]*p2[r-l+1]%mod + mod) % mod;
			return std::pair{k1,k2};
		}

		void init(int id){
			while(p.size() <= id){
				p.emplace_back(p.back()*base);
				p2.emplace_back(p2.back()*base%mod);
			}
		}
	};
};
using Hash::hx,Hash::hx2;

int main(){
	std::ios::sync_with_stdio(false); std::cin.tie(0);
	int n,q; std::cin >> n >> q;
	std::string s; std::cin >> s;
	s = ' ' + s;
	hx hs(s);
	while(q--){
		int l1,r1,l2,r2; std::cin >> l1 >> r1 >> l2 >> r2;
		if(hs.query(l1,r1) == hs.query(l2,r2)) {
			std::cout << "Yes\n";
		}
		else std::cout << "No\n";
	}
}
```



```cpp
//ç®€å•æ±‚æ•´ä¸ªå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼
const ull mod = 212370440130137957;
ull hs(string &s){ // 0_idx
	ull ans = 0;
	for(auto &x:s){
		ans = (ans*131+x)%mod;
	}
	return ans;
}
```



### åŒå“ˆå¸Œ

> å•å“ˆå¸Œå¦‚å¤§æ¨¡æ•°å“ˆå¸Œ/è‡ªç„¶æº¢å‡ºå“ˆå¸Œä»ç„¶å¯èƒ½ä¼šè¢«hack
> ä½¿ç”¨ä¸¤ä¸ªæ¨¡æ•°è¿›è¡Œå“ˆå¸Œå¾—å‡ºä¸¤ä¸ªä¸åŒå“ˆå¸Œå€¼ï¼Œå‡å°‘å†²çªæ¦‚ç‡
>
> ```cpp
> //å¸¸ç”¨æ¨¡æ•°å–å€¼
> 1e9+7
> ullè‡ªç„¶æº¢å‡º
> 212370440130137957
> 1111111111111111111   //19ä¸ª1
> (1LL << 31) - 1
> 998244353
> ```

```cpp
//å­—ç¬¦ä¸²å“ˆå¸Œ æ•°æ®åŠ å¼ºç‰ˆ https://www.luogu.com.cn/problem/U461211
//è¯ºTLE,åˆ™å°½é‡å¼€å›ºå®šæ•°ç»„ä¸”é¢„å¤„ç†p[]å’Œp2[]ï¼Œå‡å°å¸¸æ•°
//query(l,r)è¿”å›å­ä¸²s[l~r]çš„å“ˆå¸Œå€¼
namespace Hash{
	const unsigned long long base = 131,mod = 1e9+7;
	std::vector<unsigned long long>p(1,1),p2(1,1);

	template<typename T>
	struct hx{ //å•å“ˆå¸Œ hx hs(s);
		std::vector<unsigned long long>h;

		hx(){}
		hx(const T &s){
			init(s.size());
			h = std::vector<unsigned long long>(s.size()+1);
			for(int i = 0;i < s.size();i++){
				h[i+1] = h[i] * base + s[i];
			}
		}
		unsigned long long query(int l,int r){
			return h[r+1] - h[l]*p[r-l+1];
		}

		void init(int id){
			while(p.size() <= id){
				p.emplace_back(p.back()*base);
			}
		}
	};

	template<typename T>
	struct hx2{//åŒå“ˆå¸Œ hx2 hs(s);
		std::vector<unsigned long long>h,h2;

		hx2(){}
		hx2(const T &s){
			int n = s.size();
			init(s.size());
			h.resize(n+1);h2.resize(n+1);
			for(int i = 0;i < s.size();i++){
				h[i+1] = h[i]*base + s[i];
				h2[i+1] = (h2[i]*base + s[i]) % mod;
			}
		}

		std::pair<unsigned long long,unsigned long long> query(int l,int r){
			unsigned long long k1 = h[r+1] - h[l]*p[r-l+1];
			unsigned long long k2 = (h2[r+1] - h2[l]*p2[r-l+1]%mod + mod) % mod;
			return std::pair{k1,k2};
		}

		void init(int id){
			while(p.size() <= id){
				p.emplace_back(p.back()*base);
				p2.emplace_back(p2.back()*base%mod);
			}
		}
	};
};
using Hash::hx,Hash::hx2;
```





## KMP

ä¸€ä¸ªæ¨¡å¼ä¸²åŒ¹é…ä¸€ä¸ª/å¤šä¸ªæ–‡æœ¬ä¸²

èƒ½å¤Ÿåœ¨çº¿æ€§æ—¶é—´å†…åˆ¤å®šå­—ç¬¦ä¸² A[1~N] æ˜¯å¦ä¸ºå­—ç¬¦ä¸² B[1~M] çš„å­ä¸²ï¼Œå¹¶æ±‚å‡ºå­—ç¬¦ä¸²Aåœ¨å­—ç¬¦ä¸²Bä¸­å„æ¬¡å‡ºç°çš„ä½ç½®ã€‚èƒ½æ¯”å­—ç¬¦ä¸²å“ˆå¸Œæ›´é«˜æ•ˆå‡†ç¡®åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”èƒ½æä¾›ä¸€äº›é¢å¤–çš„ä¿¡æ¯

next[i]æ•°ç»„æ±‚çš„æ˜¯å­ä¸²s[1~i]çš„æœ€é•¿border(çœŸå‰ç¼€==çœŸåç¼€)

```cpp
//ä¸‹æ ‡ä»1å¼€å§‹
#include <iostream>
using namespace std;
const int N = 1000006;
int ne[N],f[N];

int main(){
    string a,b;
    int n,m;
    cin >> n >> a >> m >> b;
    a = ' ' + a;b = ' ' +b;
    
    ne[0] = 0;
    for(int i = 2,j = 0;i <= n;i++){//è‡ªèº«åŒ¹é…ï¼Œiä»2å¼€å§‹
        while(j > 0 && a[i] != a[j+1]) j = ne[j];
        if(a[i] == a[j+1]) j++;
        ne[i] = j;
    }
    
    for(int i = 1,j = 0;i <= m;i++){//å¯¹ç›®æ ‡å­—ç¬¦ä¸²åŒ¹é…,æ±‚aåœ¨bçš„æ‰€æœ‰å‡ºç°ä¸‹æ ‡
        while(j > 0 && b[i] != a[j+1]) j = ne[j];
        if(b[i] == a[j+1]) j++;
        f[i] = j;//f[i]è¡¨ç¤ºæ–‡æœ¬ä¸²ä»¥b[i]ç»“å°¾çš„å­ä¸²çš„åç¼€å’Œæ¨¡å¼ä¸²çš„å‰ç¼€çš„æœ€é•¿åŒ¹é…é•¿åº¦
        if(f[i] == n){ cout << i - n << ' '; }
    }
}
```

```cpp
//https://vjudge.net/problem/HDU-1711
#include <iostream>
#include <vector>

template<typename T>
struct KMP{
	T a;
	std::vector<int> ne;

	KMP(){}
	KMP(const T&v){ init(v); }

	void init(const T&v){//1_idx
		a = v;
		ne.assign(a.size(),{});
		for(int i = 2,j = 0;i < a.size();i++){
			while(j > 0 && a[i] != a[j+1]) j = ne[j];
			if(a[i] == a[j+1]) j++;
			ne[i] = j;
		}
	}

	std::vector<int> kmp(const T&b){
		std::vector<int>ans;
		for(int i = 1,j = 0;i < b.size();i++){
			while(j > 0 && b[i] != a[j+1]) j = ne[j];
			if(b[i] == a[j+1]) j++;
			//f[i] = j;
			if(j == a.size()-1) ans.push_back(i-a.size()+2);//æ­¤å¤„å†ä»¤j=0,å³ä¸ºæ±‚ä¸å¯é‡å¤çš„åŒ¹é…
		}
		return ans;
	}
};


void sol(){
	int n,m; std::cin >> n >> m;
	std::vector<int>a(n+1),b(m+1);
	for(int i = 1;i <= n;i++){ std::cin >> a[i]; }
	for(int i = 1;i <= m;i++){ std::cin >> b[i]; }

	KMP<std::vector<int>> kmp(b);

	auto ans = kmp.kmp(a);//æ±‚aä¸­å‡ºç°æ¨¡ç‰ˆä¸²çš„æ‰€æœ‰ä¸‹æ ‡
	if(ans.size()) std::cout << ans[0] << '\n';
	else std::cout << -1 << '\n';
}

int main(){
	std::ios::sync_with_stdio(false);std::cin.tie(0);
	int t; std::cin >> t;
	while(t--) sol();
}
```



### å‰ç¼€ç»Ÿè®¡

**ç»Ÿè®¡æ¯ä¸ªå‰ç¼€çš„å‡ºç°æ¬¡æ•°**

string s = abab; f(s) = a* 2 + ab*2 + aba + abab = 6

```cpp
//åŸé¢˜æ•°æ®è¾ƒå¼± https://acm.hdu.edu.cn/showproblem.php?pid=3336
#include <iostream>
#include <vector>

template<typename T>
struct KMP{ //1_idx
	T a;
	std::vector<int> ne;

	KMP(){}
	KMP(const T&v){ init(v); }

	void init(const T&v){
		a = v;
		ne.assign(a.size(),{});
		for(int i = 2,j = 0;i < a.size();i++){
			while(j > 0 && a[i] != a[j+1]) j = ne[j];
			if(a[i] == a[j+1]) j++;
			ne[i] = j;
		}
	}

	std::vector<int> kmp(const T&b){
		std::vector<int>ans;
		for(int i = 1,j = 0;i < b.size();i++){
			while(j > 0 && b[i] != a[j+1]) j = ne[j];
			if(b[i] == a[j+1]) j++;
			//f[i] = j;
			if(j == a.size()-1) ans.push_back(i-a.size()+2);
		}
		return ans;
	}
};

const int mod = 10007;

void sol(){
	int n; std::cin >> n;
	std::string s; std::cin >> s;
	s = ' ' + s;
	KMP<std::string>t(s);

	auto ne = t.ne;

	std::vector<int>f(n+1);
	for(int i = 1;i <= n;i++) {
		f[i] = f[ne[i]] + 1;
	}

	int ans = 0;
	for(int i = 1;i <= n;i++) {
		ans = (ans + f[i]) % mod;
	}
	std::cout << ans << '\n';
}

int main(){
	std::ios::sync_with_stdio(false); std::cin.tie(0);
	int t; std::cin >> t;
	while(t--) sol();
}
```





### å¾ªç¯èŠ‚

**å­—ç¬¦ä¸²çš„å¾ªç¯èŠ‚**

è¯ºå­—ç¬¦ä¸²Så¯ä»¥ç”±å­ä¸²Aå¾ªç¯è€Œæˆï¼Œåˆ™å­ä¸²Aæ˜¯Sçš„å‘¨æœŸï¼Œå¦‚S = â€œababababâ€ï¼Œåˆ™å‘¨æœŸ=`ab` ã€`abab`

å¦‚æœï¼ˆ`ne[i] > 0 && i%[i-ne[i]] == 0`ï¼‰ï¼Œåˆ™å‰ç¼€`s[1~i]`çš„æœ€å°å¾ªç¯èŠ‚`k = i-ne[i] `

```cpp
//https://www.acwing.com/problem/content/143/
//ç»™å®šå­—ç¬¦ä¸²s,æ±‚å…·æœ‰å¾ªç¯èŠ‚çš„å‰ç¼€é•¿åº¦iå’Œå…¶æœ€å°å¾ªç¯èŠ‚å¯¹åº”çš„å¾ªç¯æ¬¡æ•°
#include <iostream>
using namespace std;
const int N = 1000006;
int ne[N];

int main(){
	int n,idx = 0;;
	while(cin >> n,n){
		cout << "Test case #" << ++idx << endl;
		string s;cin >> s;
		s = ' ' + s;
		for(int i = 2,j = 0;i <= n;i++){
			while(j > 0 && s[i] != s[j+1]) j = ne[j];
			if(s[i] == s[j+1]) j++;
			ne[i] = j;
		}

		for(int i = 1;i <= n;i++){
			if(ne[i] && i%(i-ne[i]) == 0){
				cout << i << ' ' << i/(i-ne[i]) << endl;//å­ä¸²s[1~i]çš„æœ€çŸ­å¾ªç¯èŠ‚å¾ªç¯çš„æ¬¡æ•°
			}
		}
		cout << endl;
	}
}
```



### æœ€é•¿å…¬å…±å­ä¸²

**æ±‚å¤šä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­ä¸²**

äºŒåˆ†+KMP

```cpp
//https://vjudge.net/problem/HDU-2328
//æ±‚é•¿å…¬å…±å­ä¸²,è¯ºä¸å”¯ä¸€,è¾“å‡ºå­—å…¸åºæœ€å°çš„
#include <iostream>
#include <algorithm>
#include <vector>

template<typename T>
struct KMP{ //1_idx
    T a;
    std::vector<int> ne;

    KMP(){}
    KMP(const T&v){ init(v); }

    void init(const T&v){
        a = v;
        ne.assign(a.size(),{});
        for(int i = 2,j = 0;i < a.size();i++){
            while(j > 0 && a[i] != a[j+1]) j = ne[j];
            if(a[i] == a[j+1]) j++;
            ne[i] = j;
        }
    }

    std::vector<int> kmp(const T&b){
        std::vector<int>ans;
        for(int i = 1,j = 0;i < b.size();i++){
            while(j > 0 && b[i] != a[j+1]) j = ne[j];
            if(b[i] == a[j+1]) j++;
            //f[i] = j;
            if(j == a.size()-1) {
                ans.push_back(i-a.size()+2);
                return ans;//åŒ¹é…æˆåŠŸä¸€æ¬¡ç›´æ¥è¿”å›å³å¯
            }
        }
        return ans;
    }
};

const int N = 4003;
int n;
std::string s[N];
std::string ans;

bool check(int len){
    bool ok = 0;
    for(int i = 1;i+len-1 < s[1].size();i++){
        auto now = s[1].substr(i,len);
        if(ok && (ans <= now)) continue;//å‰ªæ

        KMP<std::string>t(' ' + now);
        bool flag = 1;
        for(int j = 2;j <= n;j++){
            if(t.kmp(s[j]).empty()) {
                flag = 0;
                break;
            }
        }
        if(flag) {
            ok = 1;
            if(ans.size() < now.size()) ans = now;
            else if(ans.size() == now.size()) ans = std::min(ans,now);
        }
    }
    return ok;
}

void sol(){
    ans = "";
    int mn = N,p = 1;
    for(int i = 1;i <= n;i++) {
        std::cin >> s[i];
        if(s[i].size() < mn) {
            mn = s[i].size();
            p = i;
        }
        s[i] = ' ' + s[i];
    }
    std::swap(s[1],s[p]);
    int l = 0,r = mn;
    while(l < r){
        int mid = l + r + 1 >> 1;
        if(check(mid)) l = mid;
        else r = mid - 1;
    }
    if(ans.size()) std::cout << ans << '\n';
    else std::cout << "IDENTITY LOST\n";
}

int main(){
    std::ios::sync_with_stdio(false); std::cin.tie(0);
    while(std::cin >> n,n) sol();
}
```





### exKMP

ä¹Ÿè¢«ç§°ä¹‹ä¸º $Z Algorithm$ æˆ– $æ‰©å±•KMP$ ã€‚

å¯¹äºä¸€ä¸ªé•¿åº¦ä¸ºnçš„å­—ç¬¦ä¸²`s`(1_idx)ï¼Œå®šä¹‰`z[i]`è¡¨ç¤º`s`å’Œ`s[i,n]`(å³ä»¥`s[i]`å¼€å¤´çš„åç¼€)çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼Œæˆ‘ä»¬å°†`z`ç§°ä¹‹ä¸º`s`çš„`z`å‡½æ•°ã€‚è€ƒè™‘åˆ°`z[1]`çš„ç‰¹æ®Šæ€§è´¨ï¼Œä¸€èˆ¬å°†å…¶è®¾ç½®ä¸º`z[1]=0`ã€‚ ä¾‹å¦‚`z("aaaba") = {0,2,1,0,1}`ã€‚

æ—¶é—´å¤æ‚åº¦$O(N)$

```cpp
template<typename T>
struct EXKMP{ //1_idx
	T a;
	std::vector<int>z;

	EXKMP(){}
	EXKMP(const T&v){ init(v); }

	void init(const T &v) {
		a = v;
		z = std::vector<int>(a.size());
		for(int i = 2,k = 1;i < a.size();i++){
			if(k+z[k]-i <= z[i-k+1]) {
				z[i] = k+z[k]-i;
				if(z[i] < 0) z[i] = 0;
				while(i+z[i] < a.size() && a[z[i]+1] == a[z[i]+i]) ++z[i];
				k = i;
			}
			else{
				z[i] = z[i-k+1];
			}
		}
		z[1] = 0; //or a.size()-1?
	}

	std::vector<int> exkmp(const T&v){//ans[i]è¡¨ç¤ºvçš„åç¼€å­ä¸²v.substr(i)ä¸å­—ç¬¦ä¸²açš„æœ€é•¿å…¬å…±å‰ç¼€
		std::vector<int>ans(v.size());
		for(int i = 1,k = 1;i < v.size();i++){
			if(k+ans[k]-i <= z[i-k+1]) {
				ans[i] = k+ans[k]-i;
				if(ans[i] < 0) ans[i] = 0;
				while(i+ans[i] < v.size() && ans[i] < a.size() && a[ans[i]+1] == v[ans[i]+i]) ++ans[i];
				k = i;
			}
			else{
				ans[i] = z[i-k+1];
			}
		}
		return ans;
	}
};
```



## Trieå­—å…¸æ ‘

> é«˜æ•ˆåœ°å­˜å‚¨å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²é›†åˆçš„æ•°æ®ç»“æ„

<img src="https://oi-wiki.org/string/images/trie1.png" alt="trie1" style="zoom:33%;" /> 

### å­—ç¬¦ä¸²ç»Ÿè®¡

```cpp
#include <iostream>
#include <cstring>

namespace TRIE{//0_idx
	const int N = 100005,M = 26;//max_s.length
	int son[N][M],cnt[N],idx;

	struct Trie{

		Trie(){idx = 0;init(idx);}

		void init(int p){
			cnt[p] = 0;
			memset(son[p], 0, sizeof(son[p]));
		}

		int get(char x){//
			if(x >= 'a' && x <= 'z') return x - 'a';
			if(x >= 'A' && x <= 'Z') return x - 'A' + 26;
			if(x >= '0' && x <= '9') return x - '0' + 52;
			return -1;
		}

		void insert(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) {
					son[p][u] = ++idx;
					init(idx);
				}
				p = son[p][u];
				//cnt[p]++; //å‰ç¼€++
			}
			cnt[p]++; //å­—ç¬¦ä¸²++;
		}

		int query(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) return 0;
				p = son[p][u];
			}
			return cnt[p];
		}
	};
};
using TRIE::Trie;


int main(){
	Trie t;
	int q; std::cin >> q;
	while(q--){
		char op; std::string s;
		std::cin >> op >> s;
		if(op == 'I') { t.insert(s); }
		else { std::cout << t.query(s) << '\n'; }
	}
}
```



### å‰ç¼€ç»Ÿè®¡

ç»™å®š N ä¸ªå­—ç¬¦ä¸² $S_1,S_2â€¦S_N$ï¼Œæ¥ä¸‹æ¥è¿›è¡Œ M æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² Tï¼Œæ±‚ $S_1âˆ¼S_N$ ä¸­å¤šå°‘ä¸ªå­—ç¬¦ä¸²æ˜¯ T çš„å‰ç¼€ã€‚

```cpp
//https://www.acwing.com/problem/content/144/
#include <iostream>
#include <cstring>

namespace TRIE{//0_idx
	const int N = 1000006,M = 26;//max_s.length
	int son[N][M],cnt[N],idx;

	struct Trie{

		Trie(){init();}

		void init(){
			idx = cnt[0] = 0;
			memset(son[0], 0, sizeof(son[0]));
		}

		int get(char x){
			if(x >= 'a' && x <= 'z') return x - 'a';
			if(x >= 'A' && x <= 'Z') return x - 'A' + 26;
			if(x >= '0' && x <= '9') return x - '0' + 52;
			return 0;
		}

		void insert(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) {
					son[p][u] = ++idx;
					cnt[idx] = 0;
					std::memset(son[idx],0,sizeof son[idx]);
				}
				p = son[p][u];
				//cnt[p]++; //suff++
			}
			cnt[p]++; //string++;
		}

		int query(const std::string &s){
			int ans = 0;
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) return ans;
				p = son[p][u];
				ans += cnt[p];
			}
//			return cnt[p];
			return ans;
		}
	};
};
using TRIE::Trie;

int main(){
	Trie t;
	int n,q; std::cin >> n >> q;
	while(n--){
		std::string s; std::cin >> s;
		t.insert(s);
	}
	while(q--){
		std::string s; std::cin >> s;
		std::cout << t.query(s) << '\n';
	}
}
```



ç»™å®š N ä¸ªå­—ç¬¦ä¸² $S_1,S_2â€¦S_N$ï¼Œæ¥ä¸‹æ¥è¿›è¡Œ M æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² Tï¼Œæ±‚ $S_1âˆ¼S_N$ ä¸­ T æ˜¯å¤šå°‘ä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€ 

```cpp
//https://www.luogu.com.cn/problem/P8306
#include <iostream>
#include <cstring>

namespace TRIE{//0_idx
	const int N = 3000006,M= 70;//max_s.length
	int son[N][M],cnt[N],idx;

	struct Trie{

		Trie(){init();}

		void init(){
			cnt[0] = 0;
			memset(son[0], 0, sizeof(son[0]));
			idx = 0;
		}

		int get(char x){
			if(x >= 'a' && x <= 'z') return x - 'a';
			if(x >= 'A' && x <= 'Z') return x - 'A' + 26;
			if(x >= '0' && x <= '9') return x - '0' + 52;
			return 0;
		}

		void insert(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) {
					son[p][u] = ++idx;
					cnt[idx] = 0;
					std::memset(son[idx],0,sizeof son[idx]);
				}
				p = son[p][u];
				cnt[p]++;
			}
		}

		int query(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) return 0;
				p = son[p][u];
			}
			return cnt[p];
		}
	};
};
using TRIE::Trie;

void sol(){
	Trie t;
	int n,q; std::cin >> n >> q;
	while(n--){
		std::string s; std::cin >> s;
		t.insert(s);
	}
	while(q--){
		std::string s; std::cin >> s;
		std::cout << t.query(s) << '\n';
	}
}

int main(){
	std::ios::sync_with_stdio(false); std::cin.tie(0);
	int t; std::cin >> t;
	while(t--) sol();
}
```





### æœ€å¤§å¼‚æˆ–å¯¹

> åœ¨ç»™å®šçš„ ğ‘ ä¸ªæ•´æ•° ğ´1ï¼Œğ´2â€¦â€¦ğ´ğ‘ ä¸­é€‰å‡ºä¸¤ä¸ªè¿›è¡Œ ğ‘¥ğ‘œğ‘Ÿï¼ˆå¼‚æˆ–ï¼‰è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœæœ€å¤§æ˜¯å¤šå°‘ï¼Ÿ

```cpp
//https://www.luogu.com.cn/problem/P10471
#include <iostream>
#include <cstring>

namespace TRIE{//0_idx
	const int N = 100005*32;
	int son[N][2],cnt[N],idx;

	struct Trie{

		Trie(){init();}

		void init(){
			idx = cnt[0] = 0;
			memset(son[0], 0, sizeof(son[0]));
		}

		int get(char x){
			if(x >= 'a' && x <= 'z') return x - 'a';
			if(x >= 'A' && x <= 'Z') return x - 'A' + 26;
			if(x >= '0' && x <= '9') return x - '0' + 52;
			return 0;
		}

		void insert(const int &x){
			int p = 0;
			for(int i = 30;i >= 0;i--){
				bool u = x >> i & 1;
				if(!son[p][u]) {
					son[p][u] = ++idx;
					cnt[idx] = 0;
					std::memset(son[idx],0,sizeof son[idx]);
				}
				p = son[p][u];
			}
			cnt[p]++;
		}

		int query(const int &x){
			int ans = 0;
			int p = 0;
			for(int i = 30;i >= 0;i--){
				bool u = x >> i & 1;
				if(son[p][!u]) {//é«˜ä½å¼€å§‹ï¼Œæ¯æ¬¡æ‰¾ä¸å½“å‰ä½ç›¸åçš„
					ans = ans<<1|1;
					p = son[p][!u];
				}
				else{
					ans = ans<<1;
					p = son[p][u];
				}
			}
			return ans;
		}
	};
};
using TRIE::Trie;

int main(){
	Trie t;
	int n; std::cin >> n;
	int ans = 0;
	while(n--){
		int x; std::cin >> x;
		ans = std::max(ans,t.query(x));
		t.insert(x);
	}
	std::cout << ans;
}
```



[P4551 æœ€é•¿å¼‚æˆ–è·¯å¾„](https://www.luogu.com.cn/problem/P4551)

ç»™å®šä¸€æ£µ n ä¸ªç‚¹çš„å¸¦è¾¹æƒæ ‘ï¼Œæ±‚æ ‘ä¸­æœ€å¤§çš„å¼‚æˆ–è·¯å¾„å€¼ã€‚

æ€è·¯ï¼šè®¾d[x]è¡¨ç¤ºæ ¹èŠ‚ç‚¹åˆ°xçš„è·¯å¾„å¼‚æˆ–å€¼ï¼Œåˆ™æœ‰d[x] = d[father[x]] ^ weight(x,father[x])ï¼ŒDFSä¸€éå¯ä»¥æ±‚å‡ºæ‰€æœ‰d[i]ï¼Œxåˆ°yçš„è·¯å¾„å¼‚æˆ–å€¼å°±ç­‰äºd[x]^d[y] (xåˆ°æ ¹ å’Œ yåˆ°æ ¹ï¼Œé‡å éƒ¨åˆ†å¼‚æˆ–æŠµæ¶ˆäº†ï¼Œå°±ç›¸å½“äºxåˆ°y)ï¼Œé—®é¢˜å°±å˜ä¸ºd[N]ä¸­æ±‚æœ€å¤§å¼‚æˆ–å¯¹

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 200005;
int n;
int a[N];
int h[N],ne[N],e[N],w[N],idx;
int son[N*32][2],tot;
int d[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u,int fa){
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k != fa){
			d[k] = d[u] ^ w[i];
			dfs(k,u);
		}
	}
}

void insert(int x){
	int p = 0;
	for(int i = 31;i >= 0;i--){
		bool u = x >> i & 1;
		if(!son[p][u]) son[p][u] = ++tot;
		p = son[p][u];
	}
}

int query(int x){
	int p = 0;
	int ans = 0;
	for(int i = 31;i >= 0;i--){
		bool u = x >> i & 1;
		if(son[p][!u]) {
			ans = ans*2 + 1;
			p = son[p][!u];
		}
		else{
			ans = ans*2;
			p = son[p][u];
		}
	}
	return ans;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i < n;i++){
		int a,b,c;cin >> a >> b >> c;
		add(a,b,c);
		add(b,a,c);
	}

	dfs(1,1);

	int ans = 0;
	for(int i = 1;i <= n;i++){
		ans = max(ans,query(d[i]));
		insert(d[i]);
	}
	cout << ans;
}
```



## ACè‡ªåŠ¨æœº

å¤šä¸ªæ¨¡å¼ä¸²åŒ¹é…ä¸€ä¸ª/å¤šä¸ªæ–‡æœ¬ä¸²

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250809122848561.png" alt="image-20250809122848561" style="zoom:50%;" /> 

- æ„å»ºTrieå‰ç¼€æ ‘

- æ„å»ºå¤±é…æŒ‡é’ˆï¼šçŠ¶æ€ $u$ çš„ faileæŒ‡é’ˆ æŒ‡å‘å¦ä¸€ä¸ªçŠ¶æ€ $v$ ï¼Œå…¶ä¸­ $v\in Trie$ ï¼Œä¸” $v$ æ˜¯ $u$ çš„æœ€é•¿åç¼€ï¼ˆå³åœ¨è¯ºå¹²ä¸ªåç¼€çŠ¶æ€ä¸­å–æœ€é•¿çš„ä¸€ä¸ªä½œä¸º failæŒ‡é’ˆï¼‰ã€‚

- æŸ¥è¯¢æ–‡æœ¬ä¸²ï¼šä¾‹å¦‚ï¼Œå½“å‰è¦åŒ¹é…çš„æ–‡æœ¬ä¸²ä¸º`shers`ï¼Œåœ¨å­—å…¸æ ‘ä¸Šæ‰¾åˆ°çŠ¶æ€`9:she`æ—¶ï¼Œæ­¤æ—¶æ— åç»­èŠ‚ç‚¹ï¼Œå¤±é…ï¼Œç›´æ¥è·³è½¬åˆ°çŠ¶æ€`9:she`çš„æœ€é•¿åç¼€çŠ¶æ€`2:he`ï¼Œç„¶åç»§ç»­åŒ¹é…ã€‚

```cpp
//æ¨¡ç‰ˆé¢˜ ACè‡ªåŠ¨æœº(ç®€å•ç‰ˆ) https://www.luogu.com.cn/problem/P3808
//ç»™å®šnä¸ªæ¨¡å¼ä¸²å’Œä¸€ä¸ªæ–‡æœ¬ä¸²,æ±‚æ–‡æœ¬ä¸²ä¸­å‡ºç°äº†å¤šå°‘ä¸ªæ¨¡å¼ä¸²
#include <iostream>
#include <queue>
#include <cstring>

namespace ACAM{//0_idx
	const int N = 1000006, M = 26;//N:æ‰€æœ‰æ¨¡å¼ä¸²çš„æ€»é•¿åº¦
	int son[N][M],cnt[N],fail[N],idx;

	struct Trie{

		Trie(){idx = 0;init(idx);}

		void init(int p){
			fail[p] = cnt[p] = 0;
			std::memset(son[p], 0, sizeof(son[p]));
		}

		int get(char x){
			if(x >= 'a' && x <= 'z') return x - 'a';
			if(x >= 'A' && x <= 'Z') return x - 'A' + 26;
			if(x >= '0' && x <= '9') return x - '0' + 52;
			return -1;
		}

		void insert(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) {
					son[p][u] = ++idx;
					init(idx);
				}
				p = son[p][u];
			}
			cnt[p]++;
		}

		void get_fail(){//æ„å»ºå¤±é…æŒ‡é’ˆ
			fail[0] = 0;
			std::queue<int>q;
			for(int i = 0;i < M;i++){//ç¬¬äºŒå±‚çš„failå…¨éƒ¨æŒ‡å‘æ ¹èŠ‚ç‚¹
				if(son[0][i]) {
					fail[son[0][i]] = 0;
					q.push(son[0][i]);
				}
			}
			while(q.size()){
				int p = q.front();
				q.pop();
				for(int u = 0;u < M;u++){
					if(son[p][u]) {//å¦‚æœå­èŠ‚ç‚¹å­˜åœ¨
						fail[son[p][u]] = son[fail[p]][u];//å­èŠ‚ç‚¹çš„failæŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹çš„failæŒ‡é’ˆæŒ‡å‘çš„ç›¸åŒå­èŠ‚ç‚¹
						q.push(son[p][u]);//å­èŠ‚ç‚¹å…¥é˜Ÿ
					}
					else {//å¦‚æœå­èŠ‚ç‚¹ä¸å­˜åœ¨
						son[p][u] = son[fail[p]][u];//ç›´æ¥è®©å­èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„failæŒ‡é’ˆæŒ‡å‘çš„ç›¸åŒå­èŠ‚ç‚¹
					}
				}
			}
		}

		int query(const std::string &s){
			int p = 0,ans = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				p = son[p][u];//ä¾æ¬¡è¯»å…¥å•è¯,ç„¶åæŒ‡é’ˆè·³è½¬åˆ°å­èŠ‚ç‚¹
				ans += cnt[p];
				cnt[p] = 0;
//				for(int t = p;t && cnt[t] != -1;t = fail[t]){//ä¸æ–­è·³å¤±é…æŒ‡é’ˆå¹¶æ²¿è·¯ç»Ÿè®¡ç­”æ¡ˆ
//					ans += cnt[t];
//					cnt[t] = -1;//æ¸…ç©º,æœ¬é¢˜å‡ºç°å¤šæ¬¡åªç®—ä¸€æ¬¡,è¯ºå¤šæ–‡æœ¬ä¸²åŒ¹é…,å¯ä»¥å¼€ä¸ªvisæ•°ç»„æ ‡è®°çŠ¶æ€t
//				}
			}
			return ans;
		}
	};
};
using ACAM::Trie; //Trie t;

int main(){
	Trie t;
	int n; std::cin >> n;
	std::string s;
	for(int i = 1;i <= n;i++){
		std::cin >> s;
		t.insert(s);
	}
	t.get_fail();
	std::cin >> s;
	std::cout << t.query(s) << '\n';
}
```







**æ‹“æ‰‘æ’åºä¼˜åŒ–**

fail æŒ‡é’ˆçš„ä¸€ä¸ªæ€§è´¨ï¼šä¸€ä¸ª AC è‡ªåŠ¨æœºä¸­ï¼Œå¦‚æœåªä¿ç•™ fail è¾¹ï¼Œé‚£ä¹ˆå‰©ä½™çš„å›¾ä¸€å®šæ˜¯ä¸€æ£µæ ‘ã€‚è¿™æ · AC è‡ªåŠ¨æœºçš„åŒ¹é…å°±å¯ä»¥è½¬åŒ–ä¸ºåœ¨ fail æ ‘ä¸Šçš„é“¾æ±‚å’Œé—®é¢˜

è§‚å¯Ÿåˆ°æ—¶é—´ä¸»è¦æµªè´¹åœ¨åœ¨æ¯æ¬¡éƒ½è¦è·³ failã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥é¢„å…ˆè®°å½•ï¼Œæœ€åä¸€å¹¶æ±‚å’Œï¼Œé‚£ä¹ˆæ•ˆç‡å°±ä¼šä¼˜åŒ–ã€‚

äºæ˜¯æˆ‘ä»¬æŒ‰ç…§ fail æ ‘ï¼Œåšä¸€æ¬¡å†…å‘æ ‘ä¸Šçš„æ‹“æ‰‘æ’åºï¼Œå°±èƒ½ä¸€æ¬¡æ€§æ±‚å‡ºæ‰€æœ‰æ¨¡å¼ä¸²çš„å‡ºç°æ¬¡æ•°ã€‚

```cpp
//https://www.luogu.com.cn/problem/P5357
//ç»™å®šnä¸ªæ¨¡å¼ä¸²å’Œä¸€ä¸ªæ–‡æœ¬ä¸²,åˆ†åˆ«æ±‚å‡ºæ¯ä¸ªæ¨¡å¼ä¸²åœ¨æ–‡æœ¬ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°(å¯é‡å )
#include <bits/stdc++.h>
using namespace std;

int id;
std::vector<int>vis,mp;

namespace ACAM{//0_idx
	const int N = 200005, M = 26;
	int son[N][M],cnt[N],fail[N],idx;
	int du[N],ans[N];

	struct Trie{

		Trie(){idx = 0;init(idx);}

		void init(int p){
			ans[p] = du[p] = 0;
			fail[p] = cnt[p] = 0;
			std::memset(son[p], 0, sizeof(son[p]));
		}

		int get(char x){
			if(x >= 'a' && x <= 'z') return x - 'a';
			if(x >= 'A' && x <= 'Z') return x - 'A' + 26;
			if(x >= '0' && x <= '9') return x - '0' + 52;
			return -1;
		}

		void insert(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				if(!son[p][u]) {
					son[p][u] = ++idx;
					init(idx);
				}
				p = son[p][u];
			}
			if(!cnt[p]) cnt[p] = id;//çŠ¶æ€på¯¹åº”å­—ç¬¦ä¸²id+å»é‡
			mp[id] = cnt[p];//å­—ç¬¦ä¸²idå¯¹åº”çŠ¶æ€pçš„id
		}

		void get_fail(){
			std::queue<int>q;
			for(int i = 0;i < M;i++){
				if(son[0][i]) {
					fail[son[0][i]] = 0;
					q.push(son[0][i]);
				}
			}
			while(q.size()){
				int p = q.front();
				q.pop();
				for(int u = 0;u < M;u++){
					if(son[p][u]) {
						fail[son[p][u]] = son[fail[p]][u];
						du[son[fail[p]][u]]++;//é¢å¤–è®°å½•å…¥åº¦
						q.push(son[p][u]);
					}
					else {
						son[p][u] = son[fail[p]][u];
					}
				}
			}
		}

		int query(const std::string &s){
			int p = 0;
			for(int i = 0;i < s.size();i++){
				int u = get(s[i]);
				p = son[p][u];
				ans[p]++;
			}
			topu();
			return 0;
		}
		void topu(){//æ‹“æ‰‘æ’åºç»Ÿè®¡ç­”æ¡ˆ
			std::queue<int>q;
			for(int i = 1;i <= idx;i++){
				if(!du[i]) q.push(i);//å…¥åº¦ä¸ºé›¶çš„ç‚¹ï¼Œå¿…å®šæ˜¯ä¸€ä¸ª Fail é“¾çš„æœ«å°¾
			}
			while(q.size()){
				int p = q.front();
				q.pop();
				vis[cnt[p]] = ans[p];

				ans[fail[p]] += ans[p];
				if(!--du[fail[p]]) q.push(fail[p]);
			}
		}
	};
};
using ACAM::Trie; //Trie t;

const int N = 200005;
std::string s[N];

int main(){
	Trie t;
	int n; std::cin >> n;
	vis = mp = std::vector<int>(n+1,0);

	for(int i = 1;i <= n;i++){
		std::cin >> s[i];
		id = i;
		t.insert(s[i]);
	}
	t.get_fail();

	std::cin >> s[0];
	t.query(s[0]);

	for(int i = 1;i <= n;i++){
		std::cout << vis[mp[i]] << '\n';
	}
}
```





## å›æ–‡ä¸²

### Manacher

O(N)æ±‚å¾—å¯¹äºæ¯ä¸ªiçš„æœ€é•¿å›æ–‡é•¿åº¦ï¼Œè¿™é‡Œä¸‹æ ‡ä»0å¼€å§‹

`t = "abbba"` åˆ™å¯¹åº”`s =  " #a#b#b#b#a#"`ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¥‡å¶å›æ–‡ä¸²ï¼Œè€Œä¸å¿…åˆ†å¼€è®¨è®ºï¼Œå¯¹sæ±‚å¾—d1[ ]
`d1[i]`ä¸ºä»¥`s[i]`ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²é•¿åº¦ã€‚
å¯¹äº`t[i]`æ¥è¯´,`d1[i*2]-1` å³ä¸ºä»¥`i`ä¸ºä¸­å¿ƒï¼Œæœ€é•¿çš„å¥‡æ•°é•¿åº¦å›æ–‡ä¸²
`d1[i*2+1]-1`å³ä¸ºä»¥`(i,i+1)`ä¸­ç‚¹ä¸ºä¸­å¿ƒæœ€é•¿çš„å¶æ•°é•¿åº¦å›æ–‡ä¸²

```cpp
//https://www.luogu.com.cn/problem/P3805
//æ¨¡ç‰ˆé¢˜,ç»™å®šå­—ç¬¦ä¸²,æ±‚æœ€é•¿çš„å›æ–‡å­ä¸²é•¿åº¦
template<typename T>
struct Manacher{ //1_idx
	int n,ans;
	T s;
	std::vector<int>d;

	Manacher(){}
	Manacher(const T &v){
		init(v);
	}

	void init(const T &v){
		s = " #";
		for(int i = 1;i < v.size();i++){
			s += v[i];
			s += '#';
		}
		n = s.size()-1;
		d = std::vector<int>(n+1,0);

		ans = 0;
		for(int i = 1,l = 0,r = 0;i <= n;i++){
			if(i > r) d[i] = 1;
			else d[i] = std::min(d[l*2-i],r-i+1);
			while(i-d[i] >= 1 && i+d[i] <= n && s[i-d[i]] == s[i+d[i]]) d[i]++;
			if(i+d[i]-1 > r) l = i,r = i+d[i]-1;
			ans = std::max(ans,d[i]-1); //å‡å»åŠ å…¥çš„'#'
		}
	}

	bool query(int l,int r){ //æŸ¥è¯¢åŒºé—´æ˜¯å¦ä¸ºå›æ–‡ä¸²
		l <<= 1,r <<= 1;
		int mid = l + r >> 1;
		return d[mid]-1 >= r-mid;
	}
};

int main(){
	std::string s;
	std::cin >> s;

	Manacher t(s);
	std::cout << t.ans;
}
```









## æœ€å°è¡¨ç¤ºæ³•

æ±‚sçš„**å¾ªç¯åŒæ„**ä¸­å­—å…¸åºæœ€å°ï¼Œä¸”ä¸‹æ ‡æœ€å°çš„ä¸€ä¸ª

æ—¶é—´å¤æ‚åº¦$O(N)$

```cpp
//https://www.luogu.com.cn/problem/P1368
#include <iostream>
#include <vector>

template<typename T>
int get_min(T a){//1_idx
	int n = a.size()-1;
	for(int i = 1;i <= n;i++) a.push_back(a[i]);
	int i = 1,j = 2;
	while(i <= n && j <= n){
		int k = 0;
		while(k < n && a[i+k] == a[j+k]) k++;
		if(k == n) break;
		if(a[i+k] > a[j+k]) {//è¯ºå°†ç¬¦å·å–åå³ä¸ºæœ€å¤§è¡¨ç¤ºæ³•
			i += k+1;//è¯ºa[i+k]>a[j+k],åˆ™a[i]~a[i+k]>a[j]
			if(i == j) i++;//ä¿æŒi != j
		}
		else {//a[j]åŒç†
			j += k+1;
			if(i == j) j++;
		}
	}
	return std::min(i,j);
}


int main(){
	int n; std::cin >> n;
	std::vector<int>a(n+1);
	for(int i = 1;i <= n;i++){
		scanf("%d",&a[i]);
	}
    
	int id = get_min(a);
    
	for(int i = 0;i < n;i++){
		printf("%d ",a[(id+i-1)%n+1]);
	}
}
```

```cpp
//https://acm.hdu.edu.cn/showproblem.php?pid=2609
//è¯ºä¸¤ä¸ªå­—ç¬¦ä¸²å…·æœ‰çš„å¾ªç¯åŒæ„ï¼Œåˆ™ç§°ä¸¤ä¸ªå­—ç¬¦ä¸²æœ¬è´¨ç›¸åŒï¼Œæ±‚æœ¬è´¨ä¸åŒçš„å­—ç¬¦ä¸²çš„æœ‰å¤šå°‘ç§
//æ€è·¯ï¼šå°†æ¯ä¸ªå­—ç¬¦ä¸²çš„æœ€å°è¡¨ç¤ºæ³•ç”¨set/mapå­˜èµ·æ¥ï¼Œæœ€åå®¹å™¨çš„å¤§å°å³ä¸ºç­”æ¡ˆ
```





## åç¼€æ•°ç»„

è¿™é‡Œå‡å®šå­—ç¬¦ä¸²é•¿åº¦ä¸ºnï¼Œä¸‹æ ‡ä»1å¼€å§‹ã€‚â€œåç¼€iâ€è¡¨ç¤ºä»¥ç¬¬iä¸ªå­—ç¬¦å¼€å¤´çš„åç¼€ï¼Œå‚¨å­˜æ—¶ç”¨iè¡¨ç¤ºå­—ç¬¦ä¸²sçš„åç¼€s[i...n]ã€‚

åç¼€æ•°ç»„`sa[i]`è¡¨ç¤ºå°†æ‰€æœ‰åç¼€æ’åºåï¼Œ`ç¬¬iå°çš„åç¼€çš„ç¼–å·`ã€‚
æ’åæ•°ç»„`rk[i]`è¡¨ç¤º`åç¼€içš„æ’å`ï¼Œé‡è¦çš„è¾…åŠ©æ•°ç»„ã€‚
è¿™ä¸¤ä¸ªæ•°ç»„æ»¡è¶³æ€§è´¨ï¼š`sa[rk[i]] = rk[sa[i]] = i`ã€‚
heightæ•°ç»„`height[i]`ï¼Œå³`lcp(sa[i],sa[i-1])`

<img src="https://oi-wiki.org/string/images/sa1.png" alt="img" style="zoom:50%;" />  åç¼€æ•°ç»„ç¤ºä¾‹



[P10469 åç¼€æ•°ç»„ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10469)

### æ’åº+å“ˆå¸Œ+äºŒåˆ†

æ—¶é—´å¤æ‚åº¦$O(nlog^2n)$

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const unsigned long long base = 131;
const int N = 300005;
int n;
string s;
int sa[N],rk[N];
unsigned long long hs[N],p[N];

void init(string &s){
	hs[0] = 0;
	p[0] = 1;
	for(int i = 0;i < s.size();i++){
		p[i+1] = p[i] * base;
		hs[i+1] = hs[i] * base + s[i];
	}
}

unsigned long long query(int l,int r){
	return hs[r] - hs[l-1]*p[r-l+1];
}

int lcp(int x,int y){//äºŒåˆ†æŸ¥æ‰¾åç¼€xå’Œåç¼€yçš„æœ€é•¿å…¬å…±å‰ç¼€
	int l = 0,r = min(n-x+1,n-y+1);
	while(l < r){
		int mid = l + r + 1 >> 1;
		if(query(x,x+mid-1) == query(y,y+mid-1)) l = mid;
		else r = mid - 1;
	}
	return l;
}

bool cmp(int x,int y){
	int len = lcp(x,y);
	return s[x+len] < s[y+len];//s[x+len]å’Œs[y+len]å³ä¸ºç¬¬ä¸€ä¸ªä¸åŒçš„ä½ç½®
}

int main(){
	cin >> s; n = s.size();
	init(s);
	s = ' ' + s;

	for(int i = 1;i <= n;i++) sa[i] = i;

	stable_sort(sa+1,sa+n+1,cmp);
	
	for(int i = 1;i <= n;i++){
		cout << sa[i] - 1 << ' ';	//sa[] æœ¬é¢˜ä¸‹æ ‡ä»0å¼€å§‹,å‡1å³å¯
		rk[sa[i]] = i;//rk[]
	}
	cout << '\n';
	for(int i = 1;i <= n;i++){
		cout << lcp(sa[i],sa[i-1]) << ' ';//height[]
	}
}
```



### å€å¢å®ç°

æ—¶é—´å¤æ‚åº¦$O(NlogN)$

```cpp
//https://www.luogu.com.cn/problem/P10469
#include <bits/stdc++.h>

namespace SA{//1_idx æœªéªŒè¯å¤šæµ‹æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
	int n;
	std::vector<int>sa,c,x,y,rk,height;

	template<typename T>
	void build (const T &s) {//get:sa[]
		sa = x = y = std::vector<int>(n+1);
		int m = 300;//å­—ç¬¦å€¼åŸŸ
		c.resize(std::max(n,m)+1);
		for (int i = 1; i <= m; i++) c[i] = 0;
		for (int i = 1; i <= n; i++) c[x[i] = s[i]]++;
		for (int i = 1; i <= m; i++) c[i] += c[i-1];
		for (int i = n; i >= 1; i--) sa[c[x[i]]--] = i;
		for (int j = 1; j <= n; j <<= 1) {
			int p = 0;
			for (int i = n - j + 1; i <= n; i ++) y[++p] = i; 
			for (int i = 1; i <= n; i++) if (sa[i] > j) y[++p] = sa[i] - j;
			for (int i = 1; i <= m; i++) c[i] = 0;
			for (int i = 1; i <= n; i++) c[x[y[i]]]++;
			for (int i = 1; i <= m; i++) c[i] += c[i-1];
			for (int i = n; i >= 1; i--) sa[c[x[y[i]]]--] = y[i];
			std::swap (x, y);
			p = 1;
			x[sa[1]] = 1;
			for (int i = 2; i <= n; i ++) {
				x[sa[i]] = y[sa[i-1]] == y[sa[i]] && y[sa[i-1]+j] == y[sa[i]+j] ? p : ++p;
			}
			if (p >= n) break;
			m = p;
		}
	}

	template<typename T>
	void make (const T &s) {//get:rk[],height[]
		rk = height = std::vector<int>(n+1);
		int k = 0;
		for (int i = 1; i <= n; i ++) rk[sa[i]] = i;
		for (int i = 1; i <= n; i ++) {
			if (rk[i] == 1) continue;
			if (k) k --;
			int j = sa[rk[i] - 1];
			while (j + k <= n and i + k <= n and s[i + k] == s[j + k]) {
				++ k;
			}
			height[rk[i]] = k;
		}
	}

	template<typename T>
	std::vector<int> get_sa(const T &s){
		n = s.size()-1;
		build(s);
		make(s);
		return sa;
	}
}
using SA::get_sa,SA::sa,SA::rk,SA::height;


int main () {
	std::string s; std::cin >> s; s = ' ' + s;
	int n = s.size()-1;

	get_sa(s);

	for(int i = 1;i <= n;i++){ std::cout << sa[i]-1 << ' '; }
	std::cout << '\n';
	for(int i = 1;i <= n;i++){ std::cout << height[i] << ' '; } 
}
```





### heightæ•°ç»„

`lcp`ä¸ºæœ€é•¿å…¬å…±å‰ç¼€ï¼Œä¸‹æ–‡ä»¥`lcp(i,j)`è¡¨ç¤ºåç¼€`i`å’Œåç¼€`j`çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚

`height[ ]`æ•°ç»„çš„å®šä¹‰ï¼š`height[i] = lcp(sa[i],sa[i-1])`ï¼Œå³ç¬¬`i`åçš„åç¼€ä¸å®ƒå‰ä¸€åçš„åç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚`height[1]`å¯ä»¥è§†ä½œ`0`ã€‚



**ä¸€äº›åº”ç”¨**

> **ä¸¤å­ä¸²æœ€é•¿å…¬å…±å‰ç¼€**
> `lcp(sa[i],sa[j]) = min({height[i+1...j]})`
>
> å¦‚æœ`height`ä¸€ç›´å¤§äºæŸä¸ªæ•°ï¼Œå‰è¿™ä¹ˆå¤šä½å°±ä¸€ç›´æ²¡å˜è¿‡ï¼›åä¹‹ï¼Œç”±äºåç¼€å·²ç»æ’å¥½åºäº†ï¼Œä¸å¯èƒ½ä¹‹åå˜å›æ¥ã€‚
> æ±‚ä¸¤å­ä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€å°±è½¬åŒ–ä¸ºäº†RMQé—®é¢˜ã€‚

> **æ¯”è¾ƒä¸¤å­ä¸²çš„å¤§å°å…³ç³»**
> å‡è®¾æ¯”è¾ƒçš„å­ä¸²ä¸º`A = s[a,b]`å’Œ`B = s[c,d]`
>
> è‹¥ $lcp(a, c)\ge\min(|A|, |B|)$ï¼Œ$A<B\iff |A|<|B|$ã€‚
> å¦åˆ™ï¼Œ$A<B\iff rk[a]< rk[c]$ã€‚

> **æ±‚å­—ç¬¦ä¸²å¾ªç¯åŒæ„çš„å­—å…¸åºæ’å**  
> [P4051 [JSOI2007\] å­—ç¬¦åŠ å¯† - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4051)
> å°†så¤åˆ¶ä¸€éåï¼Œæ±‚sa[ ]

> **æ±‚ä¸åŒå­ä¸²çš„æ•°ç›®**  
> [P2408 ä¸åŒå­ä¸²ä¸ªæ•° - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P2408)
> æ¯ä¸ªå­ä¸²ä¸€å®šæ˜¯æŸä¸ªåç¼€çš„å‰ç¼€ï¼Œæ‰€ä»¥å¯ä»¥è®¡ç®—å­ä¸²æ€»æ•°ï¼Œæšä¸¾æ¯ä¸ªåç¼€ï¼Œå‡æ‰é‡å¤ã€‚
> $$
> ç­”æ¡ˆä¸ºï¼š\frac{n(n+1)}{2} - \sum_{i=2}^{n}{height[i]}
> $$

> **æ±‚è‡³å°‘å‡ºç°kæ¬¡çš„å­ä¸²(å¯é‡å )çš„æœ€å¤§é•¿åº¦**  
> [P2852 [USACO06DEC\] Milk Patterns G - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P2852)
> å‡ºç°è‡³å°‘kæ¬¡æ„å‘³ç€åæ’åºåï¼Œæœ‰è‡³å°‘è¿ç»­kä¸ªåç¼€ä»¥è¿™ä¸ªå­ä¸²ä½œä¸ºå…¬å…±å‰ç¼€ã€‚
> æ‰€ä»¥æ±‚å‡ºæ¯ç›¸é‚»k-1ä¸ªheightçš„æœ€å°å€¼ï¼Œè¿™äº›æœ€å°å€¼çš„æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆï¼Œè¿™é‡Œå¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—O(n)è§£å†³

> ç»“åˆå¹¶æŸ¥é›†/çº¿æ®µæ ‘/å•è°ƒæ ˆç­‰æ•°æ®ç»“æ„





## å…¶å®ƒ



> æ±‚å­—ç¬¦ä¸²Sä¸­é•¿åº¦ä¸ºkçš„å­åºåˆ—ä¸­ï¼Œå­—å…¸åºæœ€å°çš„ä¸€ä¸ªã€‚$1 \le K \le N \le 10^5$

è´ªå¿ƒå®ç°ï¼Œä¾æ¬¡è€ƒè™‘å­åºåˆ—çš„æ¯ä¸€ä½ï¼Œä»åˆæ³•åŒºé—´[l,r]ä¸­é€‰æ‹©å­—å…¸åºæœ€å°çš„ä¸€ä¸ªå­—æ¯ï¼Œé€‰æ‹©è¯¥å­—æ¯åï¼Œè¯¥å­—æ¯å‰é¢çš„å­—æ¯éƒ½ä¸èƒ½é€‰ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä¸æ–­ç¼©å°åˆæ³•åŒºé—´ã€‚

```cpp
//https://vjudge.net/problem/AtCoder-typical90_f#author=GPT_zh
#include <iostream>
#include <queue>
using namespace std;
int n,k;
string s;
queue<int>q[30];

int main(){
	cin >> n >> k >> s;
	for(int i = 0;i < s.size();i++){
		q[s[i]-'a'].emplace(i);
	}

	int l = 0;
	string ans;
	for(int i = 0;i < k;i++){
        int r = n - k + i;//å³ç«¯ç‚¹å¿…é¡»å°äºr,å¦åˆ™å‡‘ä¸é½é•¿åº¦kçš„åºåˆ—
		for(int c = 0;c < 26;c++){
			while(q[c].size() && q[c].front() < l){//å·¦ç«¯ç‚¹lå‰é¢çš„å­—æ¯éƒ½å¯ä»¥æ’é™¤
				q[c].pop();
			}
			if(q[c].empty()) continue;
			if(q[c].front() <= r){//é€‰æ‹©è¯¥ä½å,ç¼©å°å·¦ç«¯ç‚¹
				ans += 'a' + c;
				l = q[c].front();
				q[c].pop();
				break;
			}
		}
	}
	cout << ans;
}
```





> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºNçš„å­—ç¬¦ä¸²Sï¼Œæ±‚æœ‰å¤šå°‘ä¸ªçš„å­åºåˆ— = å­—ç¬¦ä¸²Tã€‚

è®¾dp[i]ä¸ºTçš„å‰iä¸ªå‰ç¼€å‡ºç°çš„æ¬¡æ•°ï¼Œæ—¶é—´å¤æ‚åº¦$O(NM)$

```cpp
//https://vjudge.net/problem/AtCoder-typical90_h#author=GPT_zh
#include <bits/stdc++.h>
using namespace std;
const int N = 200005,mod = 1e9+7;
string t = " atcoder";
int a[N];
long long dp[5];

int main(){
	int n;cin >> n;
	int m = t.size()-1;
	string s;cin >> s;s = ' ' + s;

	dp[0] = 1;
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			if(s[i] == t[j]){
				dp[j] = (dp[j] + dp[j-1])%mod;
			}
		}
	}
	cout << dp[m] << '\n';
}
```



------



# å›¾è®º



[å›¾è®ºéƒ¨åˆ†ç®€ä»‹ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/graph/)

[ä½œå›¾å·¥å…·Graph Editor (csacademy.com)](https://csacademy.com/app/graph_editor/)

## æ ‘å’Œå›¾çš„å­˜å‚¨

### é‚»æ¥çŸ©é˜µ

> ç©ºé—´å¤æ‚åº¦n^2ï¼Œé€‚åˆå­˜å‚¨ç¨ å¯†å›¾ï¼Œå¯ä»¥å¿«é€ŸæŸ¥è¯¢ä¸€æ¡è¾¹æ˜¯å¦å­˜åœ¨

```cpp
int arr[N][N];

void add(int a,int b){
    arr[a][b] = x;//æ— æƒå€¼åˆ™xä¸ºboolå€¼ä»£è¡¨æ˜¯å¦è¿é€šï¼Œæœ‰æƒå€¼åˆ™xä¸ºæƒå€¼
}
//å•å‘ add(a,b);
//åŒå‘ add(b,a);
```



### é‚»æ¥è¡¨

> é€‚åˆå­˜ç¨€ç–å›¾ï¼Œä¸æ”¯æŒéšæœºè®¿é—® 
>
> åˆå§‹		h[u] -> -1
> add(u,1)  h[u] ->  1 ->  -1
> add(u,2)  h[u] ->  2  ->  1 -> -1
> add(u,3)  h[u] ->  3  ->  2 ->  1 -> -1

```cpp
//æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨å®ç°  ---æ¨è
//è¯ºä¸ºæ— å‘å›¾ï¼Œåˆ™è¾¹iå’Œè¾¹i^1äº’ä¸ºä¸€æ¡åè¾¹
int h[N], e[M], ne[M], idx;

//å­˜è¾¹
void add(int a, int b) {
	e[idx] = bï¼Œne[idx] = h[a]ï¼Œh[a] = idx++;
}

//éå†è¾¹
for(int i = h[x];i != -1;i = ne[i]){
	int k = e[i];
	cout << k << ' ';
}

int main() {
	memset(h, -1, sizeof h);//æ³¨æ„héœ€è¦åˆå§‹åŒ–ä¸º-1   
}
```



```c++
//STL vectorå®ç°
//åœ¨å†…å­˜å’Œæ—¶é—´ä¸Šéƒ½æ¯”æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨èƒ½å·®ï¼Œå¯èƒ½è¢«å¡æ—¶é—´
vector<int>e[N];

void add(int a, int b) {//å­˜è¾¹
	e[a].push_back(b);
}

//éå†è¾¹
for(int i = 0;i < v[x].size();i++){
	cout << v[x][i] << ' ';
}
```

```cpp
//STL listå®ç°   ç”±äºå†…å­˜ä¸è¿ç»­éå†ä¸å¦‚vectorä½†æ”¯æŒåˆ é™¤æ“ä½œ
list<int>e[N];

//å­˜è¾¹
void add(int a, int b) {
	e[a].push_back(b);
}

//éå†è¾¹
for(int &k:e[u]){
    cout << k << " ";
}
```



## æ ‘å’Œå›¾çš„éå†

| äºŒå‰æ ‘çš„éå† |          |
| ------------ | -------- |
| å‰åºéå†     | æ ¹-å·¦-å³ |
| ä¸­åºéå†     | å·¦-æ ¹-å³ |
| ååºéå†     | å·¦-å³-æ ¹ |



### DFS

```cpp
#include <iostream>
#include <algorithm>
#include <cstring>
using namespace std;
const int N = 100010, M = N * 2;
int n;
int h[N], e[M], ne[M], idx;
bool st[N];//å­˜å“ªäº›ç‚¹å·²ç»éå†è¿‡äº†

void add(int a, int b) {
	e[idx] = b;ne[idx] = h[a];h[a] = idx++;
}

void dfs(int u) {
	st[u] = 1;//æ ‡è®°è¿™ä¸ªç‚¹éå†è¿‡äº†
	for (int i = h[u]; i != -1;i = ne[i]) {//æœç´¢ä¸‹ä¸€æ¡æœªè¢«éå†è¿‡çš„æ¡è¾¹
		int k = e[i];
		if (!st[k]) {
            dfs(k);
        }
	}
}

void dfs2(int u,int fa){//ï¼ˆæ— ç¯å›¾ï¼‰å¯ä»¥çœä¸‹ä¸€ä¸ªvisæ•°ç»„
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k != fa){
			dfs2(k,u);
		}
	}
}

int main() {
	memset(h, -1, sizeof h);

	dfs(1);
    //dfs2(1,0); è¯ºæ ¹èŠ‚ç‚¹ç¼–å·ä»0å¼€å§‹ï¼Œåˆ™åº”dfs2(0,-1)
}
```



```cpp
//dfs æ— å‘å›¾å¶å­èŠ‚ç‚¹
void dfs(int u,int fa){//uä¸ºå½“å‰èŠ‚ç‚¹ï¼Œfaä¸ºå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
	if(q[u].size() == 1 && q[u][0] == fa){
		leaf.emplace_back(u);//æ­¤æ—¶uä¸ºå¶å­èŠ‚ç‚¹
	}
	st[u] = 1;
	for(auto &k:q[u]){
		if(!st[k]){
			dfs(k,u);
			st[k] = 1;
		}
	}
}
```



#### DFSåºåˆ—

```cpp
void dfs(int u){
	d[++p] = u;
	st[u] = 1;//æ¯ä¸ªç‚¹ç¬¬ä¸€æ¬¡è¢«æ ‡è®°ä¸ºèµ°è¿‡æ—¶çš„på³ä¸ºè¯¥ç‚¹çš„æ—¶é—´æˆ³
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(!st[k]){
			dfs(k);
		}
	}
	d[++p] = u;//æ¯ä¸ªç‚¹æ¥å›ä¼šè¢«æ ‡è®°ä¸¤æ¬¡,æœ€åé•¿åº¦ä¸º2*n
}

for(int i = 1;i <= 2*n;i++) cout << d[i] << ' ';
```



æ¯ä¸ªèŠ‚ç‚¹xçš„ç¼–å·åœ¨dfsåºä¸­æ°å¥½å‡ºç°ä¸¤æ¬¡ï¼Œå‡è®¾è¿™ä¸¤æ¬¡çš„ä½ç½®ä¸ºL[x]å’ŒR[x]ï¼Œåˆ™é—­åŒºé—´ L[x] ~ R[x]  å°±æ˜¯ä»¥xä¸ºæ ¹çš„**å­æ ‘çš„dfsåº**ã€‚å¯ä»¥é€šè¿‡dfsåºæŠŠå­æ ‘ç»Ÿè®¡è½¬åŒ–ä¸ºåºåˆ—ä¸Šçš„åŒºé—´ç»Ÿè®¡ã€‚ä¾‹é¢˜ï¼šçº¿æ®µæ ‘ç»´æŠ¤å­æ ‘ä¿¡æ¯[Assign the task - HDU 3974 - Virtual Judge (vjudge.net)](https://vjudge.net/problem/HDU-3974)

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20241011010913743.png" alt="image-20241011010913743" style="zoom: 50%;" />  DFSåºï¼š1 <u>2 8 8 5 5 2</u> <u>7 7</u> <u>4 3 9 9 3 6 6 4</u> 1





#### è¿é€šå—åˆ’åˆ†

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20241014131037652.png" alt="image-20241014131037652" style="zoom:50%;" /> å¯¹ä¸€ä¸ªæ£®æ—å¤šæ¬¡dfs/bfså¯ä»¥åˆ’åˆ†å‡ºæ¯ä¸€æ£µæ ‘ï¼Œå¹¶æŸ¥é›†å¯ä»¥è¾¾åˆ°ç±»ä¼¼æ•ˆæœ

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100005;
int n,m;
int h[N],e[N],ne[N],idx;
int id[N],cnt;

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u){
	id[u] = cnt;
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(!id[k]){
			dfs(k);
		}
	}
}


int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	while(m--){
		int a,b;cin >> a >> b;
		add(a,b);
		add(b,a);
	}

	for(int i = 1;i <= n;i++){
		if(!id[i]){
			cnt++;
			dfs(i);
		}
		cout << i << ' ' << id[i] << '\n';
	}
}
```





### BFS

```cpp
//1å·ç‚¹åˆ°nå·ç‚¹çš„æœ€çŸ­è·ç¦»	https://www.acwing.com/problem/content/849/
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 100010;
int n, m;
queue<int>q;//é˜Ÿåˆ—å®ç°
int h[N], e[N], ne[N], idx,d[N];//dè®¡ç®—è·ç¦»
void add(int a,int b) {//æ’å…¥æœ‰å‘è¾¹aâ†’b
	e[idx] = b;
	ne[idx] = h[a];
	h[a] = idx++;
}

int bfs() {
	q.push(1);
	d[1] = 0;
	while (q.size()) {
		int t = q.front();//å–é˜Ÿå¤´
		q.pop();
		for (int i = h[t]; i != -1;i = ne[i]) {//æ‰©å±•t
			int k = e[i];
			if (d[k] == -1) {//å¦‚æœæ²¡èµ°è¿‡
				d[k] = d[t]+1;//åˆ™æ ‡è®°ä¸ºèµ°è¿‡ï¼Œè·ç¦»+1
				q.push(k);//è¯¥ç‚¹å…¥é˜Ÿ
			}
		}
	}
	return d[n];
}
int main() {
	memset(h, -1, sizeof h);//åˆå§‹åŒ–é‚»æ¥è¡¨æŒ‡å‘-1
	memset(d, -1, sizeof d);//åˆå§‹åŒ–è·ç¦»ä¸º-1
	cin >> n >> m;
	while (m--) {
		int a, b; cin >> a >> b;
		add(a, b);
	}
	cout << bfs();
}
```



#### æ‹“æ‰‘æ’åº

åœ¨å›¾è®ºä¸­ï¼Œæ‹“æ‰‘æ’åºï¼ˆTopological Sortingï¼‰æ˜¯ä¸€ä¸ª**æœ‰å‘æ— ç¯å›¾**ï¼ˆDAG, Directed Acyclic Graphï¼‰çš„æ‰€æœ‰é¡¶ç‚¹çš„çº¿æ€§åºåˆ—ã€‚ä¸”è¯¥åºåˆ—å¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š

1. æ¯ä¸ªé¡¶ç‚¹å‡ºç°ä¸”åªå‡ºç°ä¸€æ¬¡ã€‚
2. è‹¥å­˜åœ¨ä¸€æ¡ä»é¡¶ç‚¹ A åˆ°é¡¶ç‚¹ B çš„è·¯å¾„ï¼Œé‚£ä¹ˆåœ¨åºåˆ—ä¸­é¡¶ç‚¹ A å‡ºç°åœ¨é¡¶ç‚¹ B çš„å‰é¢ã€‚

â€‹	<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240116000247366.png" alt="image-20240116000247366" style="zoom:33%;" />

æ‰€æœ‰å…¥åº¦ä¸º0çš„ç‚¹éƒ½å¯ä»¥ä½œä¸ºèµ·ç‚¹ï¼Œä¸€ä¸ªæœ‰å‘æ— ç¯å›¾è‡³å°‘å­˜åœ¨ä¸€ä¸ªå…¥åº¦ä¸º0çš„ç‚¹ï¼Œç­”æ¡ˆä¸€èˆ¬ä¸å”¯ä¸€ 

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240116002301548.png" alt="image-20240116002301548" style="zoom: 25%;" /> 



```cpp
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 100010;
int n, m;
queue<int>q;
int h[N], e[N], ne[N], idx;
int d[N],arr[N], cnt;//d[N]å­˜æ¯æ¡è¾¹çš„å…¥åº¦,arr[cnt]è®°å½•æ¯æ¬¡å…¥é˜Ÿçš„ç‚¹
void add(int a, int b) {
	e[idx] = b, ne[idx] = h[a], h[a] = idx++;
}
bool topsort() {
	for (int i = 1; i <= n; i++) {
		if (d[i] == 0) {//å…ˆå°†æ‰€æœ‰å…¥åº¦ä¸º0çš„ç‚¹å…¥é˜Ÿ
			q.push(i); 
             arr[cnt++] = i;
		}
	}
	while (q.size()) {
		int t = q.front();//å–é˜Ÿå¤´
		q.pop();
		for (int i = h[t]; i != -1; i = ne[i]) {//æ‹“å±•t
			int k = e[i];
			d[k]--;//æŒ‡å‘çš„è¾¹åº¦æ•°-1
			if (d[k] == 0) {//å¦‚æœå…¥åº¦ä¸º0åˆ™å…¥é˜Ÿ
				q.push(k);
				arr[cnt++] = k;
			}
		}
	}
	return cnt == n;//ä¸ç›¸ç­‰è¯´æ˜å­˜åœ¨é‡è¾¹æˆ–è‡ªç¯
}
int main() {
	memset(h, -1, sizeof h);
	cin >> n >> m;
	while (m--) {
		int a, b; cin >> a >> b;
		add(a, b);
		d[b]++;//bè¾¹å…¥åº¦+1
	}
	if (topsort()) {
		for (int i = 0; i < n; i++) {
			cout << arr[i] << ' ';
		}
	}
	else cout << -1;

	return 0;
}
```



## æœ€çŸ­è·¯

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240116111717099.png" alt="image-20240116111717099" style="zoom: 25%;" /> 



**è®°å½•è·¯å¾„**

é‚»æ¥è¡¨ç”¨`pre[a] = b` è¡¨ç¤ºaæ˜¯ç”±bè¿‡æ¥çš„ï¼Œé‚»æ¥çŸ©é˜µç”¨`pre[i][j] = k` 

```cpp
//å¯¹äºé‚»æ¥è¡¨ https://codeforces.com/problemset/problem/20/C
if(dist[k] > dist[t] + w[i]){
    pq.push({dist[y],y});
    dist[k] = dist[t] + w[i];
    pre[t] = k;//æ¯æ¬¡æ›´æ–°æœ€çŸ­è·¯æ—¶è®°å½•è·¯å¾„
}

//è¾“å‡ºæœ€çŸ­è·¯æ—¶ç”±ç»ˆç‚¹å¾€å‰æ¨
for(int i = n;i != 0;i = pre[n]){
    cout << i << " ";//æ­¤è¾“å‡ºä¸ºåå‘,è¯ºè¦æ­£å‘è¾“å‡ºè·¯å¾„,å°†iè®°å½•ä¸‹æ¥é€†åºè¾“å‡ºå³å¯
}
```

```cpp
//å¯¹äºé‚»æ¥çŸ©é˜µ
if(dist[i][j] > dis[i][k] + dist[k][j]){
	dist[i][j] > dis[i][k] + dist[k][j];
	path[i][j] = k;//æ›´æ–°æ—¶è®°å½•è·¯å¾„
}

void print(int a,int b){
	if(path[a][b] == 0) return; 
	print(a,path[a][b]);//å‰åŠéƒ¨ 
	cout<< path[a][b] << " ";//è¾“å‡ºè¯¥ç‚¹ 
	print(path[a][b],b);//ååŠéƒ¨ 
}

cout << x << ' ';//è¾“å‡ºä»xåˆ°yçš„æœ€çŸ­è·¯,æ— éœ€é€†åºè¾“å‡ºã€‚
print(x,y);
cout << y;
```



**æœ€çŸ­è·¯æ¡æ•°**

æ±‚æœ€çŸ­è·¯æœ‰å¤šå°‘æ¡

```cpp
//https://www.luogu.com.cn/problem/P1144
//åˆå§‹æ—¶cnt[1] = 1;
if(dist[y] > dist[x] + w[i]){
    dist[y] = dist[x] + w[i];
    pq.push({dist[y],y});
    cnt[y] = cnt[x];//æ›´æ–°yèŠ‚ç‚¹æ—¶,æœ€çŸ­è·¯æ¡æ•°ç»§æ‰¿è‡ªx
}
else if(dist[y] == dist[x] + w[i]){
    cnt[y] = (cnt[y] + cnt[x]) % mod;//è¯ºæœ‰å¤šæ¡åˆ™ç´¯åŠ 
}
```



è¯ºè¦æ±‚æœ€å¤šåŒæ—¶åˆ’åˆ†æˆå¤šå°‘æ¡æœ€çŸ­è·¯ï¼Œä»–ä»¬ä¹‹é—´ä¸å«å…¬å…±è¾¹ã€‚åˆ™å¯ä»¥å°†æ‰€æœ‰æœ€çŸ­è·¯å¾„ä¸Šçš„è¾¹ä¿ç•™ä¸‹æ¥ï¼Œ(å¦‚ä½•ç¡®å®šä¸€æ¡è¾¹æ˜¯å¦ä¸ºæœ€çŸ­è·¯ï¼šæ­£åå›¾å„è·‘ä¸€æ¬¡ï¼Œè¯º`èµ·ç‚¹->a` + `a->b` + `b->ç»ˆç‚¹` == `æœ€çŸ­è·¯`ï¼Œåˆ™è¾¹(a,b)ä¸ºæœ€çŸ­è·¯ä¸Šçš„ä¸€æ¡è¾¹)ï¼Œè·‘æœ€å¤§æµå³ä¸ºç­”æ¡ˆã€‚[4264. è§„åˆ’æœ€çŸ­è·¯ - AcWingé¢˜åº“](https://www.acwing.com/problem/content/4267/)





### å•æºæœ€çŸ­è·¯

#### ä»…æ­£æƒè¾¹

##### Dijkstraæœ´ç´ 

> é€‚åˆç¨ å¯†å›¾ï¼Œ**é‚»æ¥çŸ©é˜µ**å­˜  O(n^2)

```cpp
//https://www.acwing.com/activity/content/problem/content/918/
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510;
int n, m;
int g[N][N];//é‚»æ¥çŸ©é˜µå­˜ç¨ å¯†å›¾
int dist[N];//è®°å½•æ¯ä¸ªç‚¹è·ç¦»ç¬¬ä¸€ä¸ªç‚¹çš„è·ç¦»
bool st[N];//è®°å½•æ¯ä¸ªç‚¹çš„æœ€çŸ­è·ç¦»æ˜¯å¦å·²ç»ç¡®è®¤

int Dijkstra() {
	memset(dist, 0x3f, sizeof dist);//åˆå§‹åŒ–è·ç¦»ä¸ºæ— é™å¤§
	dist[1] = 0;//ç¬¬ä¸€ä¸ªç‚¹åˆ°è‡ªèº«è·ç¦»ä¸º0

	for (int i = 0; i < n;i++) {//nä¸ªç‚¹è¿›è¡Œnæ¬¡è¿­ä»£
		int t = -1;//tå­˜å‚¨å½“å‰è®¿é—®çš„ç‚¹

		for (int j = 1; j <= n;j++) {//ä»1å·ç‚¹å¼€å§‹åˆ°nå·ç‚¹
			if (!st[j] && (t == -1 || dist[t] > dist[j]))//t=å¯»æ‰¾æ‰€æœ‰st=0ä¸­distæœ€å°çš„ç‚¹
				t = j;
		}
        //if(t == n) break;
		
        st[t] = 1;

		for (int j = 1; j <= n;j++) {//å†ç”¨tä¾æ¬¡æ›´æ–°æ¯ä¸ªç‚¹æ‰€åˆ°ç›¸é‚»çš„ç‚¹è·¯å¾„å€¼
			dist[j] = min(dist[j], dist[t] + g[t][j]);
            //min(1~j , 1~t + t~j)   d[j]å–æœ€çŸ­è·¯å¾„å€¼
		}
	}

	if (dist[n] == 0x3f3f3f3f) return -1;//å¦‚æœç¬¬nå·ç‚¹è·ç¦»ä¸ºæ— ç©·,åˆ™ä¸å­˜åœ¨æœ€çŸ­è·¯
	return dist[n];
}

int main() {
	memset(g, 0x3f, sizeof g);//æ±‚æœ€çŸ­,ç¨ å¯†å›¾åˆå§‹åŒ–ä¸ºæ— é™å¤§
	cin >> n >> m;
	while (m--) {
		int a, b, c; cin >> a >> b >> c;
		g[a][b] = min(g[a][b], c);//å¤„ç†é‡è¾¹,ä¿ç•™æœ€çŸ­çš„ä¸€æ¡
	}
	cout << Dijkstra();
}
```





##### Dijkstraå †ä¼˜åŒ–

> é€‚åˆç¨€ç–å›¾ ï¼Œ**ä¼˜å…ˆé˜Ÿåˆ—å°æ ¹å †**å®ç°   O(mlogn)

```cpp
//https://www.acwing.com/problem/content/description/852/
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
using PII = pair<int, int>;//firstä¸ºè·ç¦»ï¼Œé˜Ÿåˆ—æ ¹æ®è·ç¦»æ’åºï¼Œsecondä¸ºå¯¹åº”ç‚¹
const int N = 150005;
int n, m;
priority_queue<PII, vector<PII>, greater<PII>>pq;
int h[N], e[N], ne[N], idx;
int w[N];//å­˜æƒé‡
int dist[N];
bool st[N];//å¦‚æœä¸ºtrueè¯´æ˜è¿™ä¸ªç‚¹çš„æœ€çŸ­è·¯å¾„å·²ç»ç¡®å®š

void add(int a, int b, int c) {
	w[idx] = c;
	e[idx] = b;
	ne[idx] = h[a];
	h[a] = idx++;
}

int Dijkstra() {
	memset(dist, 0x3f, sizeof dist);
	dist[1] = 0;
	pq.push({ 0,1 });
	
	while (pq.size()){
		auto t = pq.top();//å–é˜Ÿå¤´t
		pq.pop();
		int ver = t.second, distance = t.first;
        
		if (st[ver])continue;//å¦‚æœè·ç¦»å·²ç»ç¡®å®šï¼Œåˆ™è·³è¿‡è¯¥ç‚¹
		st[ver] = 1;
		
		for (int i = h[ver]; i != -1;i = ne[i]) {//æ‹“å±•t
			int k = e[i];
			if (dist[k] > distance + w[i]) {
				dist[k] = distance + w[i];
				pq.push({dist[k],k});
			}
		}
	}
	if (dist[n] == 0x3f3f3f3f) return -1;//ä¸å­˜åœ¨è¾“å‡º-1
	return dist[n];
}
int main() {
	memset(h, -1, sizeof h);
	cin >> n >> m;
	while (m--){
		int a, b, c; cin >> a >> b >> c;
		add(a, b, c);
	}

	cout << Dijkstra();
}
```







#### å«è´Ÿæƒè¾¹

åœ¨å›¾ä¸­å¦‚æœå­˜åœ¨è´Ÿç¯ï¼Œåˆ™ä»è¯¥ç¯ä¸Šä»»æ„ä¸€ç‚¹å‡ºå‘ï¼Œæ²¿ç€ç¯é‡å¤è¡Œèµ°å¯ä»¥ä½¿è·¯å¾„æ€»æƒå€¼æ— é™å‡å°ï¼Œå› æ­¤é€šå¸¸æ„ä¹‰ä¸Šçš„â€œæœ€çŸ­è·¯â€åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å®šä¹‰çš„ï¼ˆè·¯å¾„é•¿åº¦å¯ä»¥æ— é™å°ï¼‰ã€‚ç„¶è€Œï¼Œæ ¹æ®å…·ä½“é—®é¢˜çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•å¤„ç†å«æœ‰è´Ÿç¯çš„æœ€çŸ­è·¯é—®é¢˜ã€‚



##### Bellman-Ford

> å¯ä»¥è§£å†³**æœ‰è¾¹æ•°é™åˆ¶**çš„é—®é¢˜ï¼ˆè¯ºé—®é¢˜å…è®¸å¿½ç•¥è´Ÿç¯ï¼Œå¦‚é™åˆ¶è·¯å¾„è¾¹æ•°æ—¶ï¼Œå¯ä»¥å¤„ç†è´Ÿæƒç¯ï¼‰
>
> æ—¶é—´å¤æ‚åº¦O(mn)  **ç»“æ„ä½“**å­˜è¾¹

```cpp
//https://www.acwing.com/problem/content/855/
//1~nå·ç‚¹ï¼Œæœ€å¤šç»è¿‡kæ¡è¾¹çš„æœ€çŸ­è·ç¦»ï¼Œè¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°
#include <iostream>
#include <cstring>
using namespace std;
const int N = 505, M = 10004;
int n, m, k;//kä»£è¡¨æœ€å¤šç»è¿‡kæ¡è¾¹,è¯ºæ˜¯æ²¡é™åˆ¶kçš„æœ€çŸ­è·¯,åˆ™å–n-1
int dist[N], backup[N];//backupå¤‡ä»½é˜²æ­¢ä¸²è”
struct Edge { int a, b, w; }edges[M];//ä½¿ç”¨ç»“æ„ä½“å­˜å‚¨

int bellman_ford() {
	memset(dist, 0x3f, sizeof dist);
	dist[1] = 0;
    
	for (int i = 0; i < k; i++) {//kæ¬¡å¾ªç¯
		memcpy(backup, dist, sizeof backup);
		for (int j = 0; j < m; j++) {//éå†æ‰€æœ‰è¾¹
			int a = edges[j].a, b = edges[j].b, w = edges[j].w;
			dist[b] = min(dist[b], backup[a] + w);//ä½¿ç”¨ä¸Šä¸€æ¬¡å¤‡ä»½æ•°æ®é˜²æ­¢èŠ‚ç‚¹æœ€çŸ­è·ç¦»ä¸²è”
		}
	}
	return dist[n];
}

int main() {
	cin >> n >> m >> k;
	for (int i = 0; i < m;i++) {
		int a, b, w; cin >> a >> b >> w;
		edges[i] = { a,b,w };
	}
	int k = bellman_ford();
	if (k > 0x3f3f3f3f/2) cout << "impossible";//æœ€åä¸€æ¬¡æ¾å¼›åå¯èƒ½ä¼šåœ¨0x3f3f3f3fé™„è¿‘
	else cout << k;
}
```





##### <span id="SPFA">SPFA</span>

ä¹Ÿç§°ä¸º é˜Ÿåˆ—ä¼˜åŒ–çš„Bellman-Ford

> ä¸€èˆ¬O(m),æœ€åO(mn)ï¼Œ**é‚»æ¥è¡¨**å­˜ï¼Œ**é˜Ÿåˆ—**å®ç°
>
> å¦‚æœä¸è¢«å¡(~~SPFAå·²ç»æ­»äº†.jpg~~)ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£Dijkstraå †ä¼˜åŒ–ç‰ˆ

```cpp
//https://www.acwing.com/problem/content/853/
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 100005;
int n, m;

int h[N], e[N], ne[N], idx;
int dist[N],w[N];
bool st[N];

void add(int a, int b,int c) {
	w[idx] = c, e[idx] = b, ne[idx] = h[a], h[a] = idx++;
}

int SPFA() {
	memset(dist, 0x3f, sizeof dist);//è·ç¦»åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
	queue<int>q;//é˜Ÿåˆ—å­˜æœ€å°è·ç¦»å˜å°çš„ç‚¹ï¼Œå†ç”¨å®ƒæ‰©å±•åˆ°é‚»æ¥è¡¨ä¸­å…¶å®ƒç›¸é‚»çš„ç‚¹
	dist[1] = 0;//èµ·ç‚¹åˆ°è‡ªèº«è·ç¦»ä¸º0
	q.push(1);
	st[1] = 1;
	
	while (q.size()){
		auto t = q.front();
		q.pop();
		st[t] = 0;//ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¥ä¹‹åè¯¥èŠ‚ç‚¹stè¢«æ ‡è®°ä¸ºfalse

		for (int i = h[t]; i != -1;i = ne[i]) {
			int k = e[i];
			if (dist[k] > dist[t] + w[i]) {
				dist[k] = dist[t] + w[i];
				if (!st[k]) {//å°†å½“å‰æœªåŠ å…¥é˜Ÿåˆ—çš„ç»“ç‚¹å…¥é˜Ÿ
					q.push(k);
					st[k] = 1;
				}				
			}
		}
	}
	return dist[n];
}

int main() {
	memset(h, -1, sizeof h);//é“¾è¡¨å¤´èŠ‚ç‚¹åˆå§‹åŒ–ä¸º-1
	cin >> n >> m;
	while (m--){
		int a, b, c; cin >> a >> b >>c;
		add(a, b, c);
	}
	int t = SPFA();
	if (t == 0x3f3f3f3f) puts("impossible");
	else cout << t;
}
```









### å¤šæºæœ€çŸ­è·¯

#### Floyd

> å¯ä»¥æœ‰è´Ÿæƒè¾¹ï¼Œä¸èƒ½æœ‰è´Ÿæƒç¯	O(n^3)
>
> é‚»æ¥çŸ©é˜µå­˜å‚¨  
> ```python
> (k:1~n) (i:1~n) (j:1~n) {d[i,j] = min(d[i,j], d[i,k] + d[k,j]);}
> ```

```cpp
//https://www.acwing.com/problem/content/description/856/
#include <iostream>
using namespace std;
const int inf = 0x3f3f3f3f;
const int N = 210;
int d[N][N];
int n, m, q;

void floyd() {
	for (int k = 1; k <= n; k++) {//åœ¨æšä¸¾ç¬¬kå±‚å‰,å·²ç»å¾—åˆ°äº†å‰k-1ä¸ªç‚¹ä¹‹é—´(è·¯å¾„ä¸åŒ…å«k)çš„æœ€çŸ­è·¯
		for (int i = 1; i <= n; i++) {
			for (int j = 1; j <= n; j++) {
				d[i][j] = min(d[i][j], d[i][k] + d[k][j]);//æ ¸å¿ƒä»£ç 
			}
		}
	}
}

int main() {
	cin >> n >> m >> q;
	for (int i = 1; i <= n; i++) {
		for (int j = 1; j <= n; j++) {
			if (i != j) d[i][j] = inf;//åˆå§‹åŒ–ä¸ºæ— ç©·,å¤„ç†è‡ªç¯
		}
	}

	while (m--) {
		int a, b, c; cin >> a >> b >> c;//aåˆ°bçš„è·ç¦»ä¸ºc
		d[a][b] = min(d[a][b], c);//å¤„ç†é‡è¾¹
	}

	floyd();

	while (q--) {
		int a, b; cin >> a >> b;
		if (d[a][b] > inf / 2) cout << "impossible" << endl;
        	//å› ä¸ºå­˜åœ¨è´Ÿæƒè¾¹,å¯èƒ½ä¼šæŠŠinfæ›´æ–°å˜å°,å¯¼è‡´d[a][b]ç•¥å°äºinf
		else cout << d[a][b] << endl;
	}
}
```



##### ä¼ é€’é—­åŒ…

åœ¨ä¸€å¼ ç‚¹æ•°ä¸º n çš„æœ‰å‘å›¾çš„é‚»æ¥çŸ©é˜µä¸­ï¼Œç»™å‡ºä»»æ„ä¸¤ç‚¹é—´æ˜¯å¦æœ‰ç›´æ¥è¿è¾¹çš„å…³ç³»ï¼Œè®©ä½ æ±‚å‡ºä»»æ„ä¸¤ç‚¹ä¹‹é—´æ˜¯å¦æœ‰ç›´æ¥è¿è¾¹æˆ–é—´æ¥è¿è¾¹çš„å…³ç³»ã€‚
å¦‚æœ`i`èƒ½åˆ°è¾¾`k`ï¼Œä¸”`k`èƒ½åˆ°è¾¾`j`ï¼Œåˆ™`i`ä¹Ÿèƒ½åˆ°è¾¾`j`

```cpp
//https://www.luogu.com.cn/problem/B3611
//ç»™å®šä¸€å¼ ç‚¹æ•°ä¸º n çš„æœ‰å‘å›¾çš„é‚»æ¥çŸ©é˜µï¼Œå›¾ä¸­ä¸åŒ…å«è‡ªç¯ï¼Œæ±‚è¯¥æœ‰å‘å›¾çš„ä¼ é€’é—­åŒ…
#include <iostream>
using namespace std;
const int N = 105;
int n;
int a[N][N];

void floyd(){
	for(int k = 1;k <= n;k++){
		for(int i = 1;i <= n;i++){
			for(int j = 1;j <= n;j++){
				a[i][j] |= a[i][k] & a[k][j];
			}
		}
	}
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			cin >> a[i][j];
		}
	}
	floyd();
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			cout << a[i][j] << ' ';
		}
		cout << '\n';
	}
}
```



#### Johnson

> å¯ä»¥æœ‰è´Ÿæƒè¾¹ï¼Œä¸èƒ½æœ‰è´Ÿæƒç¯   
>
> æ—¶é—´å¤æ‚åº¦$O(NMlogM)$

- æ–°å»ºä¸€ä¸ªè™šæ‹Ÿçš„0å·èŠ‚ç‚¹ï¼Œä»è¿™ä¸ªç‚¹å‘å…¶å®ƒç‚¹è¿ä¸€æ¡è¾¹æƒä¸º0çš„è¾¹ã€‚ç„¶åç”¨Bellman-Fordæ±‚å‡º0å·èŠ‚ç‚¹åˆ°å…¶å®ƒæ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯ï¼Œè®°ä¸º`h[ ]`ã€‚
- å‡è®¾å­˜åœ¨ä¸€æ¡ä»xåˆ°yè¾¹æƒä¸ºwçš„è¾¹ï¼Œåˆ™æˆ‘ä»¬é‡æ–°è®¾ç½®è¾¹æƒä¸º`w+p[x]-p[y]`(ç±»ä¼¼äºç‰©ç†å­¦ä¸­çš„åŠ¿èƒ½æ¦‚å¿µ)ï¼Œæ¶ˆé™¤è´Ÿæƒè¾¹çš„å½±å“ã€‚
- æ¥ä¸‹æ¥ä»¥æ¯ä¸ªç‚¹ä¸ºèµ·ç‚¹è·‘nè½®Dijkstraç®—æ³•ï¼Œå†æ¶ˆé™¤åŠ¿èƒ½å·®ï¼Œå³å¯æ±‚å‡ºä»»æ„ä¸¤ç‚¹é—´çš„æœ€çŸ­è·¯ã€‚

```cpp
//https://www.luogu.com.cn/problem/P5905
#include <iostream>
#include <queue>
#include <cstring>
using namespace std;
const long long INF = 1e9;
const int N = 3003,M = 10004;
int n,m;
int h[N],e[M],ne[M],w[M],idx;
long long dist[N][N],p[N];
bool vis[N];
int cnt[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool spfa(){
	memset(p,0x3f,sizeof p);
	queue<int>q;
	q.push(0);
	p[0] = 0;
	vis[0] = 1;
	while(q.size()){
		int t = q.front();
		q.pop();
		vis[t] = 0;
		for(int i = h[t];~i;i = ne[i]){
			int k = e[i];
			if(p[k] > p[t] + w[i]){
				p[k] = p[t] + w[i];
				if(!vis[k]){
					q.push(k);
					vis[k] = 1;
					cnt[k]++;
					if(cnt[k] == n+1) return 1;
				}
			}
		}
	}
	return 0;
}

void dijkstra(int bg){
	memset(vis,0,sizeof vis);
	priority_queue<pair<int,int>,vector<pair<int,int>>,greater<pair<int,int>>>pq;
	pq.push({0,bg});
	dist[bg][bg] = 0;
	while(pq.size()){
		auto [distance,ver] = pq.top();
		pq.pop();
		if(vis[ver]) continue;
		else vis[ver] = 1;
		for(int i = h[ver];~i;i = ne[i]){
			int k = e[i];
			if(dist[bg][k] > dist[bg][ver] + w[i]){
				dist[bg][k] = dist[bg][ver] + w[i];
				if(!vis[k]){
					pq.push({dist[bg][k],k});
				}
			}
		}
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b,c;cin >> a >> b >> c;
		add(a,b,c);
	}
	for(int i = 1;i <= n;i++) add(0,i,0);

	if(spfa()) {cout << -1;return 0;}

	for(int u = 1;u <= n;u++){
		for(int i = h[u];~i;i = ne[i]){
			w[i] += p[u] - p[e[i]];
		}
	}

	memset(dist,0x3f,sizeof dist);
	for(int i = 1;i <= n;i++) { dijkstra(i); }

	for(int i = 1;i <= n;i++){
		long long ans = 0;
		for(int j = 1;j <= n;j++){
			dist[i][j] += p[j] - p[i];//æœ€åæ¶ˆé™¤åŠ¿èƒ½å·®ï¼Œæ­¤æ—¶dist[i][j]å³ä¸ºiåˆ°jçš„æœ€çŸ­è·¯
			if(dist[i][j] < INF ) ans += j * dist[i][j];
			else ans += j * INF;
		}
		cout << ans << '\n';
	}
}
```





#### (LCA)

æ±‚**æ— å‘æ ‘**ä¸Šä»»æ„ä¸¤ç‚¹çš„è·ç¦»

O(NlogN)é¢„å¤„ç†ï¼ŒO(logN)æŸ¥è¯¢

è®¾ä¸¤ä¸ªèŠ‚ç‚¹åˆ†åˆ«ä¸ºx,yï¼Œdist[i]ä¸ºæ ¹èŠ‚ç‚¹åˆ°ç‚¹içš„è·ç¦»ï¼Œlca(x,y)è¡¨ç¤ºä¸¤ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚
åˆ™ ans = dist[x] + dist[y] - 2*dist[lca(x,y)]

```cpp
//ä¾‹é¢˜:How far away? https://vjudge.net/problem/HDU-2586#author=GPT_zh
#include <iostream>
#include <queue>
#include <vector>
using namespace std;

void sol(){
	int n,q;scanf("%d %d",&n,&q);
	vector<vector<int>>fa(n+1,vector<int>(20));
	vector<vector<pair<int,int>>>e(n+1);
	vector<int>dist(n+1,0x3f3f3f3f),st(n+1),deep(n+1);
	for(int i = 1;i < n;i++){
		int a,b,c;scanf("%d %d %d",&a,&b,&c);
		e[a].push_back({b,c});
		e[b].push_back({a,c});
	}
	auto uuz = [&](){
		priority_queue<pair<int,int>,vector<pair<int,int>>,greater<pair<int,int>>>pq;
		dist[1] = 0;
		pq.push({0,1});
		while(pq.size()){
			auto [distance,ver] = pq.top();pq.pop();
			if(st[ver]) continue;
			else st[ver] = 1;
			for(auto &[k,w]:e[ver]){
				if(dist[k] > distance + w){
					dist[k] = distance + w;
					pq.push({dist[k],k});
				}
			}
		}
	};
	auto dfs = [&](auto &dfs,int u,int father)->void{
		deep[u] = deep[father] + 1;
		fa[u][0] = father;
		for(int i = 1;(1 << i) <= deep[u];i++){
			fa[u][i] = fa[fa[u][i-1]][i-1];
		}
		for(auto [k,w]:e[u]){
			if(k == father) continue;
			dfs(dfs,k,u);
		}
	};
	auto lca = [&](int x,int y){
		if(deep[x] < deep[y]) swap(x,y);
		for(int i = 20;i >= 0;i--){
			if(deep[fa[x][i]] >= deep[y]) x = fa[x][i];
		}
		if(x == y) return x;
		for(int i = 20;i >= 0;i--){
			if(fa[x][i] != fa[y][i]){
				x = fa[x][i];
				y = fa[y][i];
			}
		}
		return fa[x][0];
	};
	uuz();
	dfs(dfs,1,0);
	while(q--){
		int a,b;scanf("%d %d",&a,&b);
		int k = lca(a,b);
		printf("%d\n",dist[a] + dist[b] - 2*dist[k]);
	}
}

int main(){
	int t;scanf("%d",&t);
	while(t--) sol();
}
```







## æ ‘ä¸Šé—®é¢˜

### æ ‘çš„é‡å¿ƒ

> é‡å¿ƒæ˜¯æŒ‡æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå¦‚æœå°†è¿™ä¸ªç‚¹åˆ é™¤åï¼Œå‰©ä½™å„ä¸ªè¿é€šå—ä¸­ç‚¹æ•°çš„æœ€å¤§å€¼æœ€å°ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹è¢«ç§°ä¸ºæ ‘çš„é‡å¿ƒã€‚
>

1. æ ‘çš„é‡å¿ƒå¦‚æœä¸å”¯ä¸€ï¼Œåˆ™**è‡³å¤šæœ‰ä¸¤ä¸ªä¸”ç›¸é‚»**
2. ä»¥æ ‘çš„é‡å¿ƒä¸ºæ ¹æ—¶ï¼Œæ‰€æœ‰å­æ ‘çš„å¤§å°éƒ½ä¸è¶…è¿‡æ•´æ£µæ ‘å¤§å°çš„ä¸€åŠã€‚
3. æ ‘ä¸­æ‰€æœ‰ç‚¹åˆ°æŸä¸ªç‚¹çš„è·ç¦»å’Œä¸­ï¼Œ**åˆ°é‡å¿ƒçš„è·ç¦»å’Œæœ€å°**ï¼›å¦‚æœæœ‰ä¸¤ä¸ªé‡å¿ƒï¼Œé‚£ä¹ˆåˆ°å®ƒä»¬çš„è·ç¦»å’Œä¸€æ ·ã€‚
4. æŠŠä¸¤æ£µæ ‘é€šè¿‡ä¸€æ¡è¾¹ç›¸è¿å¾—åˆ°ä¸€æ£µæ–°çš„æ ‘ï¼Œé‚£ä¹ˆæ–°çš„æ ‘çš„é‡å¿ƒåœ¨è¿æ¥åŸæ¥ä¸¤æ£µæ ‘çš„é‡å¿ƒçš„è·¯å¾„ä¸Šã€‚
5. åœ¨ä¸€æ£µæ ‘ä¸Šæ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªå¶å­ï¼Œé‚£ä¹ˆå®ƒçš„é‡å¿ƒæœ€å¤šåªç§»åŠ¨ä¸€æ¡è¾¹çš„è·ç¦»ã€‚

```cpp
#include <iostream>
#include <vector>
#include <cstring>
using namespace std;
const int N = 200005;
int n,m;
int h[N],e[N],ne[N],idx;
bool st[N];
int siz[N],weight[N];//siz[i]è¡¨ç¤ºdfs(x)é€‰xä¸ºæ ‘æ ¹æ—¶,æ‰€æœ‰æ ¹èŠ‚ç‚¹ä¸ºiçš„å­æ ‘çš„å¤§å°(åŒ…æ‹¬i)
					//weight[i]è¡¨ç¤ºç¬¬iä¸ªèŠ‚ç‚¹çš„æœ€å¤§çš„å­æ ‘çš„å¤§å°,ä¸dfs(x)çš„xé€‰å–æ— å…³
vector<int>cent;//é‡å¿ƒå¯èƒ½æœ‰ä¸¤ä¸ª

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u){
	st[u] = 1;
	siz[u] = 1;
	int &now = weight[u];
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(!st[k]){
			dfs(k);
			siz[u] += siz[k];
			now = max(now,siz[k]);
		}
	}
	now = max(now,n - siz[u]);
	if(now <= n/2){//æ ¹æ®å®šä¹‰2:ä»¥æ ‘çš„é‡å¿ƒä¸ºæ ¹æ—¶,æ‰€æœ‰å­æ ‘çš„å¤§å°éƒ½ä¸è¶…è¿‡æ•´æ£µæ ‘å¤§å°çš„ä¸€åŠ
		cent.emplace_back(u);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		add(a,b);
		add(b,a);
	}

	dfs(1);//ä»»é€‰ä¸€ä¸ªç‚¹å½“åšæ ‘æ ¹dfså‡å¯

	cout << cent[0] << endl;
	//cout << cent[1] << endl;//é‡å¿ƒå¯èƒ½æœ‰ä¸¤ä¸ª

	//cout << weight[cent[0]] << endl;
}
```

```cpp
//ç»™å®šä¸€æ£µæœ‰æ ¹æ ‘ï¼Œæ±‚å‡ºæ¯ä¸€æ£µå­æ ‘ï¼ˆæœ‰æ ¹æ ‘æ„ä¹‰ä¸‹ä¸”åŒ…å«æ•´é¢—æ ‘æœ¬èº«ï¼‰çš„é‡å¿ƒæ˜¯å“ªä¸€ä¸ªèŠ‚ç‚¹ã€‚O(N)
//https://codeforces.com/contest/685/problem/B
#include <iostream>
#include <cstring>
using namespace std;
const int N = 300005;
int n,q;
int h[N],e[N],ne[N],idx;
bool st[N];

int fa[N];//å­˜çˆ¶èŠ‚ç‚¹
int ans[N];//å½“å‰èŠ‚ç‚¹çš„é‡å¿ƒ
int siz[N];//å­æ ‘å¤§å°:æ‰€æœ‰å­æ ‘ä¸ŠèŠ‚ç‚¹æ•° + è¯¥èŠ‚ç‚¹
int weight[N];//èŠ‚ç‚¹é‡é‡:å³æ‰€æœ‰å­æ ‘ã€Œå¤§å°ã€çš„æœ€å¤§å€¼

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u){
	siz[u] = 1;
	ans[u] = u;
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		dfs(k);
		siz[u] += siz[k];
		weight[u] = max(weight[u],siz[k]);
	}
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		int p = ans[k];
		while(p!=u){
			if(max(weight[p],siz[u]-siz[p]) <= siz[u]/2){
				ans[u] = p;
				break;
			}
			else{
				p = fa[p];
			}
		}
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> q;
	for(int i = 2;i <= n;i++){
		int a;cin >> a;
		fa[i] = a;
		add(a,i);
	}
	dfs(1);
	while(q--){
		int u;cin >> u;
		cout << ans[u] << endl;
	}
}
```





### æ ‘çš„ä¸­å¿ƒ

åœ¨æ ‘ä¸­ï¼Œå¦‚æœèŠ‚ç‚¹ $x$ ä½œä¸ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œä» $x$ å‡ºå‘çš„æœ€é•¿é“¾æœ€çŸ­ï¼Œé‚£ä¹ˆç§° $x$ ä¸ºè¿™æ£µæ ‘çš„ä¸­å¿ƒã€‚

æ€§è´¨ï¼š

-   æ ‘çš„ä¸­å¿ƒä¸ä¸€å®šå”¯ä¸€ï¼Œä½†æœ€å¤šæœ‰ $2$ ä¸ªï¼Œä¸”è¿™ä¸¤ä¸ªä¸­å¿ƒæ˜¯ç›¸é‚»çš„ã€‚
-   æ ‘çš„ä¸­å¿ƒä¸€å®šä½äºæ ‘çš„ç›´å¾„ä¸Šã€‚
-   æ ‘ä¸Šæ‰€æœ‰ç‚¹åˆ°å…¶æœ€è¿œç‚¹çš„è·¯å¾„ä¸€å®šäº¤ä¼šäºæ ‘çš„ä¸­å¿ƒã€‚
-   å½“æ ‘çš„ä¸­å¿ƒä¸ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œå…¶åˆ°è¾¾ç›´å¾„ç«¯ç‚¹çš„ä¸¤æ¡é“¾åˆ†åˆ«ä¸ºæœ€é•¿é“¾å’Œæ¬¡é•¿é“¾ã€‚
-   å½“é€šè¿‡åœ¨ä¸¤æ£µæ ‘é—´è¿ä¸€æ¡è¾¹ä»¥åˆå¹¶ä¸ºä¸€æ£µæ ‘æ—¶ï¼Œè¿æ¥ä¸¤æ£µæ ‘çš„ä¸­å¿ƒå¯ä»¥ä½¿æ–°æ ‘çš„ç›´å¾„æœ€å°ã€‚
-   æ ‘çš„ä¸­å¿ƒåˆ°å…¶ä»–ä»»æ„èŠ‚ç‚¹çš„è·ç¦»ä¸è¶…è¿‡æ ‘ç›´å¾„çš„ä¸€åŠã€‚

```cpp
//æ ‘å½¢dpå®ç°  https://www.acwing.com/problem/content/1075/
//ç»™å®šä¸€é¢—æ ‘ï¼Œæ‰¾åˆ°ä¸€ä¸ªç‚¹ï¼Œä½¿å¾—è¯¥ç‚¹åˆ°æ ‘ä¸­å…¶å®ƒèŠ‚ç‚¹çš„æœ€è¿œè·ç¦»æœ€è¿‘
#include <iostream>
#include <cstring>
using namespace std;
const int N = 200005,INF = 0x3f3f3f3f;
int n;
int h[N],e[N],ne[N],w[N],idx;
int d1[N],d2[N],p1[N],p2[N],up[N];
//d1,d2è¡¨ç¤ºå‘ä¸‹çš„æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼ï¼Œp1,p2è¡¨ç¤ºd1,d2æ˜¯ç”±å“ªä¸ªå­èŠ‚ç‚¹æ›´æ–°è¿‡æ¥çš„
//upè¡¨ç¤ºå‘ä¸Šçš„æœ€å¤§å€¼

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs_d(int u,int fa){//å­èŠ‚ç‚¹å‘çˆ¶èŠ‚ç‚¹æ›´æ–°ï¼Œè·å¾—å‘ä¸‹çš„d1,d2
	d1[u] = d2[u] = -INF;//åˆå§‹åŒ–ä¸º-INFå¯ä»¥å¤„ç†è´Ÿæƒè¾¹
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		dfs_d(k,u);
		int t = d1[k] + w[i];
		if(t > d1[u]){
			d2[u] = d1[u]; d1[u] = t;
			p2[u] = p1[u]; p1[u] = k;
		}
		else if(t > d2[u]){
			d2[u] = t;
			p2[u] = k;
		}
	}
	if(d1[u] == -INF){ d1[u] = d2[u] = 0;}//ç‰¹æ®Šå¤„ç†å¶å­èŠ‚ç‚¹
}

void dfs_u(int u,int fa){//çˆ¶èŠ‚ç‚¹å‘å­èŠ‚ç‚¹æ›´æ–°ï¼Œè·å¾—å‘ä¸Šçš„up
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa)continue;
		if(p1[u] == k){ up[k] = max(up[u],d2[u])+w[i]; }
		else { up[k] = max(up[u],d1[u])+w[i]; }
		dfs_u(k,u);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i < n;i++){
		int a,b,c;cin >> a >> b >> c ;
		add(a,b,c);add(b,a,c);
	}

	dfs_d(1,0);
	dfs_u(1,0);

	int ans = INF;
	for(int i = 1;i <= n;i++){
		ans = min(ans,max(d1[i],up[i]));
	}
	cout << ans;
}
```





### æ ‘çš„ç›´å¾„

> æ ‘ä¸Šä»»æ„ä¸¤èŠ‚ç‚¹ä¹‹é—´æœ€é•¿çš„ç®€å•è·¯å¾„å³ä¸ºã€Œæ ‘çš„ç›´å¾„ã€ã€‚(å¯èƒ½æœ‰å¤šæ¡ï¼Œæ‰€æœ‰ç›´å¾„ç»è¿‡ç›¸åŒçš„ä¸­ç‚¹)

**æ ‘å½¢DPå®ç°**ï¼šæˆ‘ä»¬è®°å½•å½“ $1$ ä¸ºæ ‘çš„æ ¹æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºå­æ ‘çš„æ ¹å‘ä¸‹ï¼Œæ‰€èƒ½å»¶ä¼¸çš„æœ€é•¿è·¯å¾„é•¿åº¦ $d_1$ ä¸æ¬¡é•¿è·¯å¾„ï¼ˆä¸æœ€é•¿è·¯å¾„æ— å…¬å…±è¾¹ï¼‰é•¿åº¦ $d_2$ï¼Œé‚£ä¹ˆç›´å¾„å°±æ˜¯å¯¹äºæ¯ä¸€ä¸ªç‚¹ï¼Œè¯¥ç‚¹ $d_1 + d_2$ èƒ½å–åˆ°çš„å€¼ä¸­çš„æœ€å¤§å€¼ã€‚

```cpp
//https://www.acwing.com/problem/content/1074/
#include <iostream>
#include <cstring>
using namespace std;
const int N = 200005;
int n;

int h[N],e[N],ne[N],w[N],idx;
int d1[N],d2[N],ans;//d1è®°å½•æœ€é•¿è·¯å¾„ï¼Œd2è®°å½•æ¬¡é•¿è·¯å¾„ï¼Œåˆå§‹ä¸º0ï¼Œé¿å…è´Ÿæƒè¾¹çš„å½±å“

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u,int fa){
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		dfs(k,u);
		int t = d1[k] + w[i];
		if(t > d1[u]){//è¯ºt>d1åŒæ—¶æ›´æ–°d1,d2
			d2[u] = d1[u];
			d1[u] = t;
		}
		else if(t > d2[u]){//else ifè¯ºt>d2åªéœ€æ›´æ–°d2
			d2[u] = t;
		}
	}
	ans = max(ans,d1[u]+d2[u]);
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i < n;i++){
		int a,b,c;cin >> a >> b >> c;
		add(a,b,c);
		add(b,a,c);
	}
	dfs(1,0);
	cout << ans;
}
```



**ä¸¤æ¬¡DFS/BFSå®ç°**(è¾¹æƒå¿…é¡»éè´Ÿ)ï¼šé¦–å…ˆä»ä»»æ„èŠ‚ç‚¹ $y$ å¼€å§‹è¿›è¡Œç¬¬ä¸€æ¬¡ DFSï¼Œåˆ°è¾¾è·ç¦»å…¶æœ€è¿œçš„èŠ‚ç‚¹ï¼Œè®°ä¸º $z$ï¼Œç„¶åå†ä» $z$ å¼€å§‹åšç¬¬äºŒæ¬¡ DFSï¼Œåˆ°è¾¾è·ç¦» $z$ æœ€è¿œçš„èŠ‚ç‚¹ï¼Œè®°ä¸º $z'$ï¼Œåˆ™ $dist(z,z')$ å³ä¸ºæ ‘çš„ç›´å¾„ã€‚

å®šç†ï¼šåœ¨ä¸€æ£µæ ‘ä¸Šï¼Œä»ä»»æ„èŠ‚ç‚¹yå¼€å§‹è¿›è¡Œä¸€æ¬¡ DFSï¼Œåˆ°è¾¾çš„è·ç¦»å…¶æœ€è¿œçš„èŠ‚ç‚¹zå¿…ä¸ºç›´å¾„çš„ä¸€ç«¯ã€‚

```cpp
//https://www.luogu.com.cn/problem/B4016
#include <iostream>
#include <cstring>
using namespace std;
using ll = long long;
const int N = 400005;

int n;
int h[N],e[N],ne[N],w[N],idx;
ll dist[N];
ll maxn;//è®°å½•æœ€è¿œç‚¹èƒ½åˆ°çš„ç‚¹

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u,int fa){
	for(int i = h[u];i != -1;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		dist[k] = dist[u] + w[i];
		if(dist[k] > dist[maxn]){maxn = k;}//æ›´æ–°æœ€è¿œèƒ½åˆ°çš„ç‚¹
		dfs(k,u);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i < n;i++){
		int a,b,c = 1;cin >> a >> b;
		add(a,b,c);
		add(b,a,c);
	}
	dfs(1,0);
	dist[maxn] = 0;
	dfs(maxn,0);
	cout << dist[maxn] << endl;;
}
```

```cpp
//bfs(1)
void bfs(int u){
	queue<pair<int,int>>q;
	memset(st,0,sizeof st);
	q.push({u,0});
	st[u] = 1;
	while(q.size()){
		auto [v,dist] = q.front();
		q.pop();
		for(int i = h[v];~i;i = ne[i]){
			int k = e[i];
			if(st[k]) continue;
			st[k] = 1;
			q.push({k,dist+w[i]});
			if(ans < dist + w[i]){
				ans = dist + w[i];
				maxn = k;
			}
		}
	}
}
```









### æœ€è¿‘å…¬å…±ç¥–å…ˆ

**æ€§è´¨**

1.  $\text{LCA}(\{u\})=u$ï¼›
2.  $u$ æ˜¯ $v$ çš„ç¥–å…ˆï¼Œå½“ä¸”ä»…å½“ $\text{LCA}(u,v)=u$ï¼›
3.  å¦‚æœ $u$ ä¸ä¸º $v$ çš„ç¥–å…ˆå¹¶ä¸” $v$ ä¸ä¸º $u$ çš„ç¥–å…ˆï¼Œé‚£ä¹ˆ $u,v$ åˆ†åˆ«å¤„äº $\text{LCA}(u,v)$ çš„ä¸¤æ£µä¸åŒå­æ ‘ä¸­ï¼›
4.  å‰åºéå†ä¸­ï¼Œ$\text{LCA}(S)$ å‡ºç°åœ¨æ‰€æœ‰ $S$ ä¸­å…ƒç´ ä¹‹å‰ï¼Œååºéå†ä¸­ $\text{LCA}(S)$ åˆ™å‡ºç°åœ¨æ‰€æœ‰ $S$ ä¸­å…ƒç´ ä¹‹åï¼›
5.  ä¸¤ç‚¹é›†å¹¶çš„æœ€è¿‘å…¬å…±ç¥–å…ˆä¸ºä¸¤ç‚¹é›†åˆ†åˆ«çš„æœ€è¿‘å…¬å…±ç¥–å…ˆçš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œå³ $\text{LCA}(A\cup B)=\text{LCA}(\text{LCA}(A), \text{LCA}(B))$ï¼›
6.  ä¸¤ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆå¿…å®šå¤„åœ¨æ ‘ä¸Šä¸¤ç‚¹é—´çš„æœ€çŸ­è·¯ä¸Šï¼›
7.  $d(u,v)=h(u)+h(v)-2h(\text{LCA}(u,v))$ï¼Œå…¶ä¸­ $d$ æ˜¯æ ‘ä¸Šä¸¤ç‚¹é—´çš„è·ç¦»ï¼Œ$h$ ä»£è¡¨æŸç‚¹åˆ°æ ‘æ ¹çš„è·ç¦»ã€‚



**å€å¢æ±‚LCA**

> O(NlogN)é¢„å¤„ç†ï¼ŒO(logN)æŸ¥è¯¢ï¼Œç©ºé—´å¤æ‚åº¦O(NlogN)

dfsé¢„å¤„ç†`fa[i,j]`ï¼Œè¡¨ç¤ºèŠ‚ç‚¹`i`çš„ç¬¬$2^j$ä¸ªç¥–å…ˆ

æ±‚lcaæ—¶ï¼Œè®©æ·±åº¦æœ€å°çš„èŠ‚ç‚¹è·³åˆ°ä¸å¦ä¸€ä¸ªèŠ‚ç‚¹åŒä¸€ä¸ªæ·±åº¦ï¼Œè¯ºæ­¤æ—¶ä¸¤ä¸ªèŠ‚ç‚¹ç›¸åŒç›´æ¥è¿”å›å½“å‰èŠ‚ç‚¹ã€‚
å†è®©ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶å¾€ä¸Šè·³åˆ°æœ€åä¸€ä¸ªéå…¬å…±ç¥–å…ˆèŠ‚ç‚¹ï¼Œè¯¥ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹å³ä¸ºLCAèŠ‚ç‚¹

```cpp
//https://www.luogu.com.cn/problem/P3379
#include <iostream>
#include <vector>
using namespace std;
const int N = 500005;
int n,q,root;
vector<int> e[N];
int fa[N][22],deep[N];//æ·±åº¦ä»1å¼€å§‹

void dfs(int u,int father){
	fa[u][0] = father;
	deep[u] = deep[father] + 1;
	for(int i = 1;(1 << i) <= deep[u];i++){
		fa[u][i] = fa[fa[u][i-1]][i-1];
	}
	for(auto k:e[u]){
		if(k == father) continue;
		dfs(k,u);
	}
}

int lca(int x,int y){
	if(deep[x] < deep[y]) swap(x,y);//ä¸€èˆ¬ä»¥xä½œä¸ºæ·±åº¦è¾ƒæ·±çš„ç‚¹
	for(int i = 20;i >= 0;i--){//å†è®©xè·³åˆ°ä¸yåŒä¸€æ·±åº¦
		if(deep[fa[x][i]] >= deep[y]) x = fa[x][i];
	}
	if(x == y) return x;
	for(int i = 20;i >= 0;i--){
		if(fa[x][i] != fa[y][i]){
			x = fa[x][i];
			y = fa[y][i];
		}
	}
	return fa[x][0];
}

int main(){
	cin >> n >> q >> root;
	for(int i = 1;i < n;i++){
		int a,b;cin >> a >> b;
		e[a].emplace_back(b);
		e[b].emplace_back(a);
	}
	dfs(root,0);
	while(q--){
		int a,b;cin >> a >> b;
		cout << lca(a,b) << '\n';
	}
}
```



**Tarjanæ±‚LCA**

ç¦»çº¿ç®—æ³•ï¼Œä½¿ç”¨DFS+å¹¶æŸ¥é›†å®ç°

æ—¶é—´å¤æ‚åº¦O(N+Q)ï¼Œå¸¸æ•°è¾ƒå¤§

```cpp
#include <iostream>
#include <vector>
#include <cstring>
using namespace std;
const int N = 1000006;
int n,q,root;
int h[N],e[N],ne[N],idx;
int dfn[N],low[N],dn;
vector<pair<int,int>>ask[N];
int ans[N];
int p[N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

int find(int x){
	if(p[x] != x) p[x] = find(p[x]);
	return p[x];
}

void tarjan(int x,int fa){
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(y == fa) continue;
		tarjan(y,x);
		p[find(y)] = find(x);
	}
	for(auto [y,i]:ask[x]){
		ans[i] = find(y);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> q >> root;
	for(int i = 1;i <= n;i++) p[i] = i;
	for(int i = 1;i < n;i++){
		int a,b;scanf("%d %d",&a,&b);
		add(a,b);add(b,a);
	}
	for(int i = 1;i <= q;i++){
		int a,b;scanf("%d %d",&a,&b);
		if(a == b) ans[i] = a;
		else{
			ask[a].push_back({b,i});
			ask[b].push_back({a,i});
		}
	}
	tarjan(root,0);
	for(int i = 1;i <= q;i++){
		printf("%d\n",ans[i]);
	}
}
```





#### æ ‘ä¸Šå·®åˆ†

æ ‘ä¸Šå·®åˆ†å¯ä»¥ç†è§£ä¸ºå¯¹æ ‘ä¸Šçš„æŸä¸€æ®µè·¯å¾„è¿›è¡Œå·®åˆ†æ“ä½œï¼Œè¿™é‡Œçš„è·¯å¾„å¯ä»¥ç±»æ¯”ä¸€ç»´æ•°ç»„çš„åŒºé—´è¿›è¡Œç†è§£ã€‚é€‚åˆå¤šæ¬¡ä¿®æ”¹(O(logN))ï¼Œå•æ¬¡æŸ¥è¯¢(éœ€è¦O(N)dfsç»Ÿè®¡ä¿¡æ¯)ã€‚



**ç‚¹å·®åˆ†**

[P3128 [USACO15DEC\] Max Flow P - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P3128)

æ¯æ¬¡å°†aåˆ°bç®€å•è·¯å¾„ä¸Šçš„ç‚¹æƒåŠ ä¸Šxï¼Œåˆ™`val[a] += x,val[b] += x, val[lca] -= x,val[fa[lca]] -= x`ã€‚å› ä¸ºå›æº¯ç»Ÿè®¡æ—¶lcaä¼šè¢«åŠ ä¸Š2xï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©lcaå‡å»xï¼Œå†è®©lcaçš„çˆ¶èŠ‚ç‚¹å‡å»xã€‚

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 50004,M = 100005;
int n,q,ans;
int h[N],e[M],ne[M],idx;
int fa[N][22],deep[N];
int val[N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u,int father){
	fa[u][0] = father;
	deep[u] = deep[father] + 1;
	for(int i = 1;(1 << i) <= deep[u];i++){
		fa[u][i] = fa[fa[u][i-1]][i-1];
	}
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k != father) dfs(k,u);
	}
}

int lca(int x,int y){
	if(deep[x] < deep[y]) swap(x,y);
	for(int i = 20;i >= 0;i--){
		if(deep[fa[x][i]] >= deep[y]) x = fa[x][i];
	}
	if(x == y) return x;
	for(int i = 20;i >= 0;i--){
		if(fa[x][i] != fa[y][i]){
			x = fa[x][i];
			y = fa[y][i];
		}
	}
	return fa[x][0];
}

void dfs2(int u,int father){
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k != father){
			dfs2(k,u);
			val[u] += val[k];
		}
	}
	ans = max(ans,val[u]);
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> q;
	for(int i = 1;i < n;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);
	}
	dfs(1,0);
	while(q--){
		int a,b;cin >> a >> b;
		int father = lca(a,b);
		val[a]++;val[b]++;
		val[father]--;val[fa[father][0]]--;
	}
	dfs2(1,0);
	cout << ans;
}
```





**è¾¹å·®åˆ†**

ä¸ç‚¹å·®åˆ†ç•¥æœ‰ä¸åŒã€‚

è¯ºè¦å°†aåˆ°bä¸Šç®€å•è·¯å¾„çš„è¾¹æƒåŠ xï¼Œåˆ™`dist[a] += x,dist[b] += x,dist[lca] -= 2x`ã€‚







### æ ‘å“ˆå¸Œ

åˆ¤æ–­ä¸€äº›æ ‘æ˜¯å¦åŒæ„çš„æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸æŠŠè¿™äº›æ ‘è½¬æˆå“ˆå¸Œå€¼å‚¨å­˜èµ·æ¥ï¼Œä»¥é™ä½å¤æ‚åº¦ã€‚

è¿™é‡Œä»‹ç»ä¸€ä¸ªå®ç°ç®€å•ä¸”ä¸å®¹æ˜“è¢«å¡çš„åšæ³•ï¼Œè¿™ç±»æ–¹æ³•éœ€è¦ä¸€ä¸ªå¤šé‡é›†çš„å“ˆå¸Œå‡½æ•°ã€‚ä»¥æŸä¸ªç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘çš„å“ˆå¸Œå€¼ï¼Œå°±æ˜¯ä»¥å®ƒçš„æ‰€æœ‰å„¿å­ä¸ºæ ¹çš„å­æ ‘çš„å“ˆå¸Œå€¼æ„æˆçš„å¤šé‡é›†çš„å“ˆå¸Œå€¼ï¼Œå³ï¼š

$$
h_x = f(\{ h_i \mid i \in son(x) \})
$$

å…¶ä¸­ $h_x$ è¡¨ç¤ºä»¥ $x$ ä¸ºæ ¹çš„å­æ ‘çš„å“ˆå¸Œå€¼ï¼Œ$f$ æ˜¯å¤šé‡é›†çš„å“ˆå¸Œå‡½æ•°ã€‚

ä»¥ä»£ç ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ä¸ºä¾‹ï¼š

$$
f(S) = \left( c + \sum_{x \in S} g(x) \right) \bmod m
$$

å…¶ä¸­ $c$ ä¸ºå¸¸æ•°ï¼Œä¸€èˆ¬ä½¿ç”¨ $1$ å³å¯ã€‚$m$ ä¸ºæ¨¡æ•°ï¼Œä¸€èˆ¬ä½¿ç”¨ $2^{32}$ æˆ– $2^{64}$ è¿›è¡Œè‡ªç„¶æº¢å‡ºï¼Œä¹Ÿå¯ä½¿ç”¨å¤§ç´ æ•°ã€‚$g$ ä¸ºæ•´æ•°åˆ°æ•´æ•°çš„æ˜ å°„ï¼Œä»£ç ä¸­ä½¿ç”¨ xor shiftï¼Œä¹Ÿå¯ä»¥é€‰ç”¨å…¶ä»–çš„å‡½æ•°ï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨å¤šé¡¹å¼ã€‚ä¸ºäº†é¢„é˜²å‡ºé¢˜äººå¯¹ç€ xor hash å¡ï¼Œè¿˜å¯ä»¥åœ¨æ˜ å°„å‰åå¼‚æˆ–ä¸€ä¸ªéšæœºå¸¸æ•°ã€‚

è¿™ç§å“ˆå¸Œååˆ†å¥½å†™ï¼Œæ¯”æ¯æ¬¡ä½¿ç”¨`mt19937_64(hs[k])( )`ç”Ÿæˆéšæœºæ•°è¦å¿«ã€‚å¦‚æœéœ€è¦æ¢æ ¹ï¼Œç¬¬äºŒæ¬¡ DP æ—¶åªéœ€æŠŠå­æ ‘å“ˆå¸Œå‡æ‰å³å¯ã€‚

```cpp
//æœ‰æ ¹æ ‘å“ˆå¸Œ https://uoj.ac/problem/763
//ç»™å®šä¸€æ£µä»¥1ä¸ºæ ¹çš„æ ‘ï¼Œä½ éœ€è¦è¾“å‡ºè¿™æ£µæ ‘ä¸­æœ€å¤šèƒ½é€‰å‡ºå¤šå°‘ä¸ªäº’ä¸åŒæ„çš„å­æ ‘ã€‚
#include <iostream>
#include <set>
#include <cstring>
#include <random>
using namespace std;
const int N = 1000006,M = N << 1;
int n;
int h[N],e[M],ne[M],idx;
unsigned long long hs[N];
set<unsigned long long>se;
const unsigned long long mask = mt19937_64(time(0))();

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

unsigned long long shift(unsigned long long x){
	x ^= mask;
	x ^= x << 13;
	x ^= x >> 7;
	x ^= x << 17;
	x ^= mask;
	return x;
}

void dfs(int u,int fa){
	hs[u] = 1;
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		dfs(k,u);
		hs[u] += shift(hs[k]);
	}
	se.insert(hs[u]);
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i < n;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);
	}
	dfs(1,0);
	cout << se.size();
}
```





## ç”Ÿæˆæ ‘

### æœ€å°ç”Ÿæˆæ ‘

æ— å‘è¿é€šå›¾çš„ **æœ€å°ç”Ÿæˆæ ‘**ï¼ˆMinimum Spanning Treeï¼ŒMSTï¼‰ä¸ºè¾¹æƒå’Œæœ€å°çš„ç”Ÿæˆæ ‘ã€‚

ä»å›¾(ä¸€èˆ¬ä¸ºæ— å‘æœ‰ç¯å›¾ )ä¸­ç”Ÿæˆä¸€æ£µæ ‘(n-1æ¡è¾¹)æ—¶ï¼Œè¿™æ£µæ ‘æ¯æ¡è¾¹çš„æƒé‡ç›¸åŠ ä¹‹å’Œæœ€å°ã€‚

åªæœ‰è¿é€šå›¾æ‰æœ‰ç”Ÿæˆæ ‘ï¼Œè€Œå¯¹äºéè¿é€šå›¾ï¼Œåªå­˜åœ¨ç”Ÿæˆæ£®æ—ã€‚

#### Kruskal

> é€‚åˆç¨€ç–å›¾  $O(MlogM)$     **ç»“æ„ä½“**å­˜è¾¹		**å¹¶æŸ¥é›†**å®ç°
>
> å°†è¾¹æƒä»å°åˆ°å¤§æ’åºï¼Œéå†è¾¹ï¼Œè¯ºå½“å‰è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹å±äºä¸åŒçš„æ ‘ï¼Œåˆ™åˆå¹¶è¿™ä¸¤é¢—æ ‘

kurskalé‡æ„æ ‘çš„ä¸€äº›æ€§è´¨

- æ˜¯ä¸€æ£µäºŒå‰æ ‘ã€‚
- å¦‚æœæ˜¯æŒ‰æœ€å°ç”Ÿæˆæ ‘å»ºç«‹çš„è¯æ˜¯ä¸€ä¸ªå¤§æ ¹å †ã€‚
- åŸå›¾ä¸­ä¸¤ä¸ªç‚¹é—´æ‰€æœ‰è·¯å¾„ä¸Šçš„è¾¹æœ€å¤§æƒå€¼çš„æœ€å°å€¼ = æœ€å°ç”Ÿæˆæ ‘ä¸Šä¸¤ç‚¹ç®€å•è·¯å¾„çš„è¾¹æœ€å¤§æƒå€¼ = Kruskal é‡æ„æ ‘ä¸Šä¸¤ç‚¹ LCA çš„ç‚¹æƒã€‚

```cpp
//https://www.acwing.com/problem/content/description/861/
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 100005, M = 2 * N;
int n, m;
int p[N];//ä¿å­˜å¹¶æŸ¥é›†
int res, cnt;
struct Edge {
	int a, b, w;
}edges[M];

bool cmp(Edge E1, Edge E2) {//è‡ªå®šä¹‰sortæ’åºï¼Œä»¥ç»“æ„ä½“wå€¼ä¸ºä¾æ®æ’åº
	return E1.w < E2.w;
}

int find(int x) {//å¹¶æŸ¥é›†
	if (p[x] != x) p[x] = find(p[x]);
	return p[x];
}

void kruskal() {
	for (int i = 0; i < m; i++) {
		int pa = find(edges[i].a), pb = find(edges[i].b);
		if (pa != pb) {//å¦‚æœè¿™ä¸ªè¾¹ä¸ä¹‹å‰é€‰æ‹©çš„æ‰€æœ‰è¾¹ä¸ä¼šæˆç¯ï¼Œå°±é€‰æ‹©è¿™æ¡è¾¹
			p[pa] = pb;//åˆå¹¶
			res += edges[i].w;
			cnt++;
		}
	}
}

int main() {
	cin >> n >> m;
	for (int i = 1; i <= n; i++) { p[i] = i; }//åˆå§‹åŒ–å¹¶æŸ¥é›†

	for (int i = 0; i < m; i++) {
		int a, b, w; cin >> a >> b >> w;
		edges[i] = { a,b,w };
	}
	sort(edges, edges + m,cmp);//å°†æ‰€æœ‰mæ¡è¾¹æŒ‰ç…§æƒå€¼çš„å¤§å°è¿›è¡Œå‡åºæ’åº
	
    kruskal();

	if (cnt < n - 1) puts("impossible");
	else cout << res << endl;
}
```





#### Primæœ´ç´ 

> é€‚åˆç¨ å¯†å›¾     $O(N^2)$

```cpp
//https://www.acwing.com/problem/content/860/
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510, inf = 0x3f3f3f3f;
int n, m;
int dist[N], g[N][N];//distå­˜ç‚¹åˆ°é›†åˆsçš„è·ç¦»
bool vis[N];

int prim(){//1_idx
	std::memset(dist,0x3f,sizeof dist);
	std::memset(vis,0,sizeof vis);
	int ans = 0;
	for(int i = 0;i < n;i++){
		int t = 0;
		for(int j = 1;j <= n;j++){
			if(!vis[j] && (t == 0 || dist[t] > dist[j])) {
				t = j;//å¯»æ‰¾ç¦»é›†åˆsæœ€è¿‘çš„ç‚¹t
			}
		}
		vis[t] = 1;
		if(i && dist[t] == 0x3f3f3f3f) return -1;//åˆ¤æ–­æ˜¯å¦è¿é€š
		if(i) ans += dist[t];//åŠ å…¥ç‚¹t
		for(int j = 1;j <= n;j++){
			dist[j] = std::min(dist[j],g[t][j]);//å†ç”¨ç‚¹tæ›´æ–°å…¶å®ƒç‚¹åˆ°é›†åˆçš„è·ç¦»
		}
	}
	return ans;
}

int main() {
	cin >> n >> m;
	memset(g, 0x3f, sizeof g);
	while (m--){
		int a, b, c; cin >> a >> b >> c;
		g[a][b] = g[b][a] = min(g[a][b], c);//å¤„ç†é‡è¾¹
	}
	int t = prim();
	if (t == -1) puts("impossible");
	else cout << t;
}
```

è¯ºprimè¦è¾“å‡ºå…·ä½“é€‰æ‹©çš„è¾¹ï¼Œå¯ä»¥å¼€ä¸€ä¸ªè¾…åŠ©æ•°ç»„`last[]`ï¼Œæ›´æ–°`dist[]`æ—¶è®°å½•å½“å‰ç‚¹ä»å“ªä¸ªç‚¹è½¬ç§»çš„ï¼Œ`ans+=dist[t]`æ—¶å³é€‰æ‹©äº†è¾¹`(t,last)`ã€‚





**Primå †ä¼˜åŒ–**

æ¯”è¾ƒå¤æ‚ä¸å¸¸ç”¨ï¼Œç›´æ¥ç”¨Kruskalç®—æ³•





#### ~~Boruvka~~

Kruskalå’ŒPrimçš„ç»“åˆï¼Œåœ¨è¾¹å…·æœ‰è¾ƒå¤šç‰¹æ®Šæ€§è´¨çš„é—®é¢˜ä¸­ï¼ŒBoruvkaç®—æ³•å…·æœ‰ä¼˜åŠ¿ã€‚



#### å”¯ä¸€æ€§

è€ƒè™‘æœ€å°ç”Ÿæˆæ ‘çš„å”¯ä¸€æ€§ã€‚å¦‚æœä¸€æ¡è¾¹ **ä¸åœ¨æœ€å°ç”Ÿæˆæ ‘çš„è¾¹é›†ä¸­**ï¼Œå¹¶ä¸”å¯ä»¥æ›¿æ¢ä¸å…¶ **æƒå€¼ç›¸åŒã€å¹¶ä¸”åœ¨æœ€å°ç”Ÿæˆæ ‘è¾¹é›†** çš„å¦ä¸€æ¡è¾¹ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªæœ€å°ç”Ÿæˆæ ‘å°±æ˜¯ä¸å”¯ä¸€çš„ã€‚

å¯¹äº Kruskal ç®—æ³•ï¼Œåªè¦è®¡ç®—ä¸ºå½“å‰æƒå€¼çš„è¾¹å¯ä»¥æ”¾å‡ æ¡ï¼Œå®é™…æ”¾äº†å‡ æ¡ï¼Œå¦‚æœè¿™ä¸¤ä¸ªå€¼ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™å‡ æ¡è¾¹ä¸ä¹‹å‰çš„è¾¹äº§ç”Ÿäº†ä¸€ä¸ªç¯ï¼ˆè¿™ä¸ªç¯ä¸­è‡³å°‘æœ‰ä¸¤æ¡å½“å‰æƒå€¼çš„è¾¹ï¼Œå¦åˆ™æ ¹æ®å¹¶æŸ¥é›†ï¼Œè¿™æ¡è¾¹æ˜¯ä¸èƒ½æ”¾çš„ï¼‰ï¼Œå³æœ€å°ç”Ÿæˆæ ‘ä¸å”¯ä¸€ã€‚

å¯»æ‰¾æƒå€¼ä¸å½“å‰è¾¹ç›¸åŒçš„è¾¹ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•å¤´å°¾æŒ‡é’ˆï¼Œç”¨å•è°ƒé˜Ÿåˆ—å³å¯åœ¨ $O(\alpha(m))$ï¼ˆm ä¸ºè¾¹æ•°ï¼‰çš„æ—¶é—´å¤æ‚åº¦é‡Œä¼˜ç§€è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆåŸºæœ¬ä¸åŸç®—æ³•æ—¶é—´ç›¸åŒï¼‰ã€‚

```cpp
//https://vjudge.net/problem/OpenJ_Bailian-1679#author=GPT_zh
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 105,M = 10004;
int n,m;
int p[N];

struct edge{
	int a,b,w;
	bool operator < (edge &e2){
		return w < e2.w;
	}
}e[M];

int find(int x){
	if(p[x] != x) p[x] = find(p[x]);
	return p[x];
}

void soviet(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++) p[i] = i;
	for(int i = 1;i <= m;i++){
		cin >> e[i].a >> e[i].b >> e[i].w;
	}
	sort(e+1,e+m+1);

	int ans = 0,cnt = 0;
	bool flag = 1;
	int tail = 0,sum1 = 0,sum2 = 0;
	for(int i = 1;i <= m+1;i++){
		if(i > tail){
			if(sum1 != sum2){//å¦‚æœsum1 != sum2 åˆ™æœ€å°ç”Ÿæˆæ ‘ä¸å”¯ä¸€
				flag = 0;
				break;
			}
			sum1 = sum2 = 0;
			for(int j = i;j <= m+1;j++){
				if(j > m || e[j].w != e[i].w){
					tail = j-1;
					break;
				}
				if(find(e[j].a) != find(e[j].b)) sum1++;//sum1è®¡ç®—å½“å‰æƒå€¼çš„è¾¹å¯ä»¥æ”¾å‡ æ¡
			}
		}
		if(i > m) break;
		int pa = find(e[i].a),pb = find(e[i].b);
		if(pa != pb && cnt != n-1){
			sum2++;//sum2è®¡ç®—å½“å‰æƒå€¼çš„è¾¹å®é™…æ”¾äº†å‡ æ¡
			cnt++;
			p[pa] = pb;
			ans += e[i].w;
		}
	}
	if(flag) cout << ans << '\n';
	else cout << "Not Unique!\n";
}

int main(){
	int mt;cin >> mt;
	while(mt--) soviet();
}
```







### æ¬¡å°ç”Ÿæˆæ ‘

**éä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘**

æ±‚è§£æ–¹æ³•

- æ±‚å‡ºæ— å‘å›¾çš„æœ€å°ç”Ÿæˆæ ‘ $T$ï¼Œè®¾å…¶æƒå€¼å’Œä¸º $M$ ã€‚
- éå†æ¯æ¡æœªè¢«é€‰ä¸­çš„è¾¹$e = (u,v,w)$ï¼Œæ‰¾åˆ° $T$ ä¸­ $u$ åˆ° $v$ çš„è·¯å¾„ä¸Šè¾¹æƒæœ€å¤§çš„ä¸€æ¡è¾¹$e' = (s,t,w')$ï¼Œåœ¨ $T$ ä¸­ç”¨ $e$ æ›¿æ¢ $eâ€™$ï¼Œå³å¯å¾—åˆ°ä¸€é¢—ç”Ÿæˆæ ‘ $T'$ï¼Œå…¶æƒå€¼ä¸º $M' = M + w - w'$ ã€‚
- å¯¹æ‰€æœ‰çš„ $M'$ å–æœ€å°å€¼å³ä¸ºç­”æ¡ˆã€‚

å…¶ä¸­æ±‚ $u,v$ è·¯å¾„ä¸Šè¾¹æƒæœ€å¤§çš„å€¼å¯ä»¥åœ¨å€å¢æ±‚ $LCA$ çš„è¿‡ç¨‹ä¸­æ±‚å¾—ã€‚

```cpp
//ACM Contest and Blackout  https://vjudge.net/problem/UVA-10600
//æ¨¡ç‰ˆé¢˜,åˆ†åˆ«è¾“å‡ºæ— å‘å›¾çš„æœ€å°ç”Ÿæˆæ ‘å’Œéä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘çš„æƒå€¼,æœ¬é¢˜ä¿è¯ç­”æ¡ˆå­˜åœ¨
#include <iostream>
#include <cstring>
#include <vector>
#include <algorithm>

const int N = 105,M = N*N;
int n,m;
int fa[N][22],deep[N],mx[N][22];
int h[N],e[M],ne[M],w[M],idx;

void add(int a,int b,int c){
    w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

int p[N];
int find(int x){
    if(p[x] != x) p[x] = find(p[x]);
    return p[x];
}

struct Edge{
    int a,b,c;
    bool operator < (const Edge &e2) const{
        return c < e2.c;
    }
};

void dfs(int u,int father,int weight){//mx[u][i]è¡¨ç¤ºuåˆ°å…¶ç¬¬2^iä¸ªçˆ¶èŠ‚ç‚¹çš„æœ€å¤§æƒå€¼
    deep[u] = deep[father]+1;
    fa[u][0] = father;
    mx[u][0] = weight;

    for(int i = 1;(1 << i) <= deep[u];i++){
        mx[u][i] = std::max(mx[fa[u][i-1]][i-1],mx[u][i-1]);//
        fa[u][i] = fa[fa[u][i-1]][i-1];
    }
    for(int i = h[u];~i;i = ne[i]){
        if(e[i] != father) dfs(e[i],u,w[i]);
    }
}

int lca(int a,int b){//æ±‚a,bè·¯å¾„ä¸Šçš„æœ€å¤§æƒå€¼
    int ans = 0;
    if(deep[a] < deep[b]) std::swap(a,b);
    for(int i = 20;i >= 0;i--){
        if(deep[fa[a][i]] >= deep[b]) {
            ans = std::max(ans,mx[a][i]);
            a = fa[a][i];
        }
    }
    if(a == b) return ans;
    for(int i = 20;i >= 0;i--){
        if(fa[a][i] != fa[b][i]){
            ans = std::max({ans,mx[a][i],mx[b][i]});
            a = fa[a][i];
            b = fa[b][i];
        }
    }
    ans = std::max({ans,mx[a][0],mx[b][0]});
    return ans;
}

void sol(){
    std::memset(h,-1,sizeof h);
    std::memset(fa,0,sizeof fa);//å¤šæµ‹éœ€æ¸…ç©ºfaæ•°ç»„
    idx = 0;
    std::cin >> n >> m;
    for(int i = 1;i <= n;i++) p[i] = i;
    std::vector<Edge>edge;
    for(int i = 1;i <= m;i++){
        int a,b,c; std::cin >> a >> b >> c;
        edge.push_back({a,b,c});
    }
    std::sort(edge.begin(),edge.end());
    
    int ans1 = 0;
    std::vector<Edge>T2;
    for(auto &[a,b,c]:edge){
        int pa = find(a),pb = find(b);
        if(pa == pb) { T2.push_back({a,b,c}); }
        else{
            p[pa] = pb;
            ans1 += c;
            add(a,b,c); add(b,a,c);
        }
    }
    //if(cnt != n-1) {return;}	ä¸å­˜åœ¨æœ€å°ç”Ÿæˆæ ‘
    //if(T2.empty()) {return;}	ä¸å­˜åœ¨æ¬¡å°ç”Ÿæˆæ ‘
    dfs(1,0,0);
    int ans2 = 1e9;
    for(auto &[a,b,c]:T2){//éå†æ‰€æœ‰æœªé€‰æ‹©çš„è¾¹
        int now = ans1 + c - lca(a,b);//æ›¿æ¢æœ€å°ç”Ÿæˆæ ‘ä¸­(a,b)è·¯å¾„ä¸Šæƒå€¼æœ€å¤§çš„ä¸€æ¡è¾¹
        ans2 = std::min(ans2,now);//ç­”æ¡ˆå–æœ€å°
    }
    std::cout << ans1 << ' ' << ans2 << '\n';
}

int main(){
    int mt;std::cin >> mt;
    while(mt--) sol();
}
```







**ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘**

åœ¨ç”¨æœªé€‰æ‹©çš„è¾¹ $e = (u,v,w)$ æ›¿æ¢æœ€å°ç”Ÿæˆæ ‘ $T$ ä¸Šçš„è¾¹æ—¶ï¼Œæ‰¾å‡º $T$ ä¸Š $(u,v)$ è·¯å¾„ä¸­è¾¹æƒä¸¥æ ¼å°äº $w$ çš„æœ€å¤§çš„ä¸€æ¡è¾¹è¿›è¡Œæ›¿æ¢ã€‚

åŒæ—¶ç»´æŠ¤èŠ‚ç‚¹åˆ°ç¥–å…ˆè·¯å¾„ä¸Šçš„æœ€å¤§è¾¹æƒå’Œ**ä¸¥æ ¼æ¬¡å¤§è¾¹æƒ**å³å¯ã€‚

```cpp
//https://www.luogu.com.cn/problem/P4180
//æ¨¡ç‰ˆ,æœ¬é¢˜ä¿è¯ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘å­˜åœ¨
#include <iostream>
#include <cstring>
#include <vector>
#include <algorithm>

const int INF = 0x3f3f3f3f;
const int N = 100005,M = 600005;
int n,m;
int h[N],e[M],ne[M],w[M],idx;
int fa[N][20],deep[N],mx[N][20],mx2[N][20];//mx:æœ€å¤§è¾¹æƒ,mx2:æ¬¡å¤§è¾¹æƒ

struct Edge{
	int a,b,c;
	bool operator < (const Edge &e2)const{
		return c < e2.c;
	}
};

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

int p[N];
int find(int x){
	if(p[x] != x) p[x] = find(p[x]);
	return p[x];
}

void dfs(int u,int father,int weight){
	deep[u] = deep[father] + 1;
	fa[u][0] = father;
	mx[u][0] = weight;
	mx2[u][0] = -INF;//-INFä»£è¡¨ä¸å­˜åœ¨æ¬¡å¤§è¾¹æƒ
	for(int i = 1;(1 << i) <= deep[u];i++){
		mx[u][i] = std::max(mx[fa[u][i-1]][i-1],mx[u][i-1]);
		mx2[u][i] = std::max(mx2[fa[u][i-1]][i-1],mx2[u][i-1]);

		if(mx[u][i-1] > mx[fa[u][i-1]][i-1]) mx2[u][i] = std::max(mx2[u][i],mx[fa[u][i-1]][i-1]);
		else if(mx[u][i-1] < mx[fa[u][i-1]][i-1]) mx2[u][i] = std::max(mx2[u][i],mx[u][i-1]);

		fa[u][i] = fa[fa[u][i-1]][i-1];
	}
	for(int i = h[u];~i;i = ne[i]){
		if(e[i] != father) dfs(e[i],u,w[i]);
	}
}

int lca(int a,int b,int c){
	int ans = -INF;
	if(deep[a] < deep[b]) std::swap(a,b);
	for(int i = 18;i >= 0;i--){
		if(deep[fa[a][i]] >= deep[b]) {
			if(mx[a][i] < c) ans = std::max(ans,mx[a][i]);
			else ans = std::max(ans,mx2[a][i]);
			a = fa[a][i];
		}
	}
	if(a == b) return ans;
	for(int i = 18;i >= 0;i--){
		if(fa[a][i] != fa[b][i]){
			ans = std::max(ans,mx[a][i] < c ? mx[a][i] : mx2[a][i]);
			ans = std::max(ans,mx[b][i] < c ? mx[b][i] : mx2[b][i]);
			a = fa[a][i];
			b = fa[b][i];
		}
	}
	ans = std::max(ans,mx[a][0] < c ? mx[a][0] : mx2[a][0]);
	ans = std::max(ans,mx[b][0] < c ? mx[b][0] : mx2[b][0]);
	return ans;
}

int main(){
	std::memset(h,-1,sizeof h);
	std::cin >> n >> m;
	for(int i = 1;i <= n;i++) p[i] = i;
	std::vector<Edge>edge;
	for(int i = 1;i <= m;i++){
		int a,b,c;std::cin >> a >> b >> c;
		edge.push_back({a,b,c});
	}
	std::sort(edge.begin(),edge.end());

	std::vector<Edge>T2;
	int cnt = 0;
	long long ans1 = 0;
	for(auto &[a,b,c]:edge){
		int pa = find(a),pb = find(b);
		if(pa == pb) {
			T2.push_back({a,b,c});
		}
		else{
			p[pa] = pb;
			ans1 += c;
			cnt++;
			add(a,b,c); add(b,a,c);
		}
	}

//	if(cnt != n-1) {return 0;}	//æ— æœ€å°ç”Ÿæˆæ ‘
//	if(T2.empty()) {return 0;}	//æ— æ¬¡å°ç”Ÿæˆæ ‘

	dfs(1,0,0);
	long long ans2 = 1e18;
	for(auto &[a,b,c]:T2){
		long long w2 = lca(a,b,c);	//æŸ¥æ‰¾ç”Ÿæˆæ ‘ä¸­(a,b)è·¯å¾„ä¸Šè¾¹æƒä¸¥æ ¼å°äºcçš„æœ€å¤§è¾¹æƒ
		if(w2 == -INF) continue;	//ä¸å­˜åœ¨ä¸¥æ ¼æ¬¡å¤§è¾¹

		long long now = ans1 + c - w2;
		ans2 = std::min(ans2,now);
	}
//	if(ans2 == 1e18) {return 0;}	//æ— ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘
	std::cout << ans2;
}
```





### ç”Ÿæˆæ ‘è®¡æ•°



**æ— å‘å›¾çš„ç”Ÿæˆæ ‘è®¡æ•°**

[UVA10766 Organising the Organisation - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/UVA10766)

> ç»™å®šnä¸ªç‚¹ï¼Œä¸¤ä¸¤ä¹‹é—´æœ‰ä¸€æ¡æ— å‘è¾¹ï¼Œç°åœ¨åˆ‡æ–­mæ¡è¾¹ï¼Œæ±‚å‰©ä¸‹çš„å›¾ä¸­æœ‰å¤šå°‘ç§ä¸åŒçš„ç”Ÿæˆæ ‘

**çŸ©é˜µæ ‘å®šç†**ï¼Œæ—¶é—´å¤æ‚åº¦$O(N^3)$

æƒå€¼è®¾ä¸º1æ±‚å¾—çš„æ˜¯ä¸åŒç”Ÿæˆæ ‘çš„ä¸ªæ•°ã€‚æƒå€¼è®¾ä¸ºåŸè¾¹æƒæ±‚å¾—çš„æ˜¯ä¸åŒç”Ÿæˆæ ‘çš„æƒå€¼ä¹‹å’Œã€‚

```cpp
#include <iostream>
#include <vector>

const int N = 55;
int n,m,root;
int g[N][N];

struct Mat{
	std::vector<std::vector<long long>>a;

	Mat(int n){
		a = std::vector<std::vector<long long>>(n+1,std::vector<long long>(n+1));
	}

	void add(int x,int y,int w){//æ— å‘å›¾add(x,y,w),add(y,x,w); åº¦æ•°çŸ©é˜µ-é‚»æ¥çŸ©é˜µ
		if(x == y) return;
		a[y][y] = (a[y][y] + w);
		a[x][y] = (a[x][y] - w);
	}

	long long det(int n){//é«˜æ–¯æ¶ˆå…ƒæ±‚n*nè¡Œåˆ—å¼çš„å€¼(1_idx)
		long long ans = 1;
		for(int i = 2;i <= n;i++){//åˆ é™¤æ ¹èŠ‚ç‚¹1æ‰€åœ¨è¡Œåˆ—,ä¸‹æ ‡ä»2å¼€å§‹å³å¯(æ— å‘å›¾å¯ä»»é€‰æ ¹)
			for(int j = i+1;j <= n;j++){
				while(a[j][i]){
					long long t = a[i][i]/a[j][i];//è²Œä¼¼æ±‚ä¸æ±‚é€†å…ƒéƒ½æ— æ‰€è°“?
					for(int k = i;k <= n;k++) {
						a[i][k] -= a[j][k] * t;
					}
					std::swap(a[i],a[j]);
					ans = -ans;
				}
			}
			if(!a[i][i]) return 0;
			ans *= a[i][i];
		}
		return std::abs(ans);
	}
};

void sol(){
	Mat M(n);
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			g[i][j] = 1;
		}
	}
	for(int i = 1;i <= m;i++){
		int x,y;std::cin >> x >> y;
		g[x][y] = g[y][x] = 0;
	}

	for(int i = 1;i <= n;i++){
		for(int j = i+1;j <= n;j++){
			if(g[i][j]) {
				M.add(i,j,1);
				M.add(j,i,1);
			}
		}
	}
	std::cout << M.det(n) << '\n';
}

int main(){
	while(std::cin >> n >> m >> root) sol();
}
```





**æœ‰å‘å›¾çš„ç”Ÿæˆæ ‘è®¡æ•°**

[P4455 [CQOI2018\] ç¤¾äº¤ç½‘ç»œ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4455)

> ç»™å®šnä¸ªç‚¹mæ¡è¾¹çš„æœ‰å‘å›¾ï¼Œæ±‚ä»¥1ä¸ºæ ¹èŠ‚ç‚¹çš„ç”Ÿæˆæ ‘ä¸ªæ•°ã€‚

å¦‚æœè¦æ˜¯ç»™å®šrootï¼Œä¸ä¸€å®šä¸º1ï¼Œå°†ç¬¬rootè¡Œå’Œç¬¬nè¡Œäº¤æ¢ï¼Œç¬¬rootåˆ—å’Œç¬¬nåˆ—äº¤æ¢ï¼Œç„¶ååˆ é™¤ç¬¬nè¡Œnåˆ—å†è®¡ç®—å³å¯ã€‚

```cpp
#include <iostream>
#include <vector>

const int mod = 1e4+7;

struct Mat{
	std::vector<std::vector<long long>>a;

	Mat(int n){
		a = std::vector<std::vector<long long>>(n+1,std::vector<long long>(n+1));
	}

	void add(int x,int y,int w){//æœ‰å‘å›¾add(x,y,w);
		if(x == y) return;
		a[y][y] = (a[y][y] + w) % mod;
		a[x][y] = (a[x][y] - w) % mod;
	}

	long long det(int n){//é«˜æ–¯æ¶ˆå…ƒæ±‚n*nè¡Œåˆ—å¼çš„å€¼(1_idx)
		long long ans = 1;
		for(int i = 2;i <= n;i++){//ä¸‹æ ‡ä»2å¼€å§‹,ç›¸å½“äºåˆ é™¤æ ¹èŠ‚ç‚¹1æ‰€åœ¨è¡Œåˆ—,
			for(int j = i+1;j <= n;j++){
				while(a[j][i]){
					long long t = a[i][i]/a[j][i];//è²Œä¼¼æ±‚ä¸æ±‚é€†å…ƒéƒ½æ— æ‰€è°“?
					for(int k = i;k <= n;k++) {
						a[i][k] = (a[i][k] - a[j][k] * t % mod + mod) % mod;
					}
					std::swap(a[i],a[j]);
					ans = -ans;
				}
			}
			if(!a[i][i]) return 0;
			ans = (ans * a[i][i] % mod + mod) % mod;
		}
		return std::abs(ans);
	}
};

int main(){
	int n,m; std::cin >> n >> m;
	Mat M(n);
	for(int i = 1;i <= m;i++){
		int a,b;std::cin >> a >> b;
		M.add(b,a,1);//æœ¬é¢˜é¢˜æ„æ˜¯bå‘aè¿è¾¹
	}
	std::cout << M.det(n);
}
```







### æœ€å°æ ‘å½¢å›¾

`æœ‰å‘å›¾`ä¸Šçš„æœ€å°ç”Ÿæˆæ ‘ï¼ˆDirected Minimum Spanning Treeï¼‰ç§°ä¸ºæœ€å°æ ‘å½¢å›¾ã€‚
æ‰€æœ‰ä»å›¾ä¸­ç”Ÿæˆä¸€é¢— `æ ¹èŠ‚ç‚¹èƒ½åˆ°è¾¾å…¶å®ƒèŠ‚ç‚¹`çš„æ ‘ï¼Œè¾¹æƒå’Œæœ€å°çš„ä¸€é¢—æ ‘

å¸¸ç”¨çš„ç®—æ³•æ˜¯**æœ±åˆ˜ç®—æ³•**ï¼ˆä¹Ÿç§° Edmonds ç®—æ³•ï¼‰ï¼Œå¯ä»¥åœ¨ $O(nm)$ æ—¶é—´å†…è§£å†³æœ€å°æ ‘å½¢å›¾é—®é¢˜

<img src="https://cdn.luogu.com.cn/upload/pic/22858.png" alt="img" style="zoom:50%;" /> 

ç®—æ³•æµç¨‹ï¼Œå¯¹äºæ¯ä¸€æ¬¡å¾ªç¯ï¼š

- åˆå§‹åŒ–
- å¯¹äºæ¯ä¸ªç‚¹ï¼Œé€‰æ‹©æŒ‡å‘å®ƒçš„è¾¹æƒæœ€å°çš„ä¸€æ¡è¾¹
- å°†é€‰å‡ºçš„è¾¹ç´¯åŠ åˆ°ç­”æ¡ˆé‡Œï¼Œå¦‚æœå‡ºç°å­¤ç«‹ç‚¹åˆ™æ— è§£
- å¦‚æœæ²¡æœ‰ç¯ï¼Œç®—æ³•å®Œæˆï¼Œé€€å‡ºå¾ªç¯
- æŠŠæ‰€æœ‰ä¸æ˜¯ç¯ä¸Šçš„ç‚¹å…¨éƒ¨è®¾ç½®ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¯(å¤§å°ä¸º1çš„æ–°ç¯)
- è¿›è¡Œç¼©ç¯å¹¶æ›´æ–°å…¶å®ƒç‚¹åˆ°ç¯çš„è·ç¦»
- é‡æ–°è®¾ç½®nå’Œroot

```cpp
//https://www.luogu.com.cn/problem/P4716
//ç»™å®šä¸€ä¸ªnä¸ªç‚¹mæ¡è¾¹æ ¹èŠ‚ç‚¹ä¸ºrootçš„æœ‰å‘å›¾,è¯•æ±‚å‡ºä¸€é¢—ä»¥rootä¸ºæ ¹çš„æœ€å°æ ‘å½¢å›¾
#include <iostream>

const int INF = 0x3f3f3f3f;
const int N = 3003,M = 10004;

int mn[N],fa[N];//æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å°å…¥è¾¹æƒå€¼åŠå…¶çˆ¶èŠ‚ç‚¹
int loop[N];//èŠ‚ç‚¹æ‰€å±çš„ç¯ç¼–å·(0è¡¨ç¤ºä¸åœ¨ç¯ä¸­)
int vis[N];	//ä¸´æ—¶æ ‡è®°æ•°ç»„(ç”¨äºç¯æ£€æµ‹)

struct Edge{
	int a,b,c;
}edge[M];

int zhuliu(int n,int m,int root){
	int ans = 0;
	while(1){
		int tot = 0;//è®°å½•å½“å‰è¿­ä»£æ£€æµ‹åˆ°çš„ç¯çš„æ•°é‡
		for(int i = 1;i <= n;i++){//åˆå§‹åŒ–æ•°ç»„
			mn[i] = INF;
			fa[i] = vis[i] = loop[i] = 0;
		}

		for(int i = 1;i <= m;i++){//è´ªå¿ƒæ‰¾åˆ°æœ€å°å…¥è¾¹å›¾,å¹¶è®°å½•è¯¥å›¾ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„æœ€å°å…¥è¾¹æƒå€¼åŠå…¶çˆ¶èŠ‚ç‚¹
			auto &[a,b,c] = edge[i];
			if(a != b && mn[b] > c){//å¤„ç†è‡ªç¯(ç¼©ç¯åå­˜åœ¨è‡ªç¯)
				mn[b] = c;
				fa[b] = a;
			}
		}
		mn[root] = 0;//æ ¹èŠ‚ç‚¹æ²¡æœ‰å…¥è¾¹,æƒå€¼è®¾ä¸º0

		for(int i = 1;i <= n;i++){
			if(mn[i] == INF) return -1;//è¯ºå­˜åœ¨å­¤ç«‹èŠ‚ç‚¹,æ— è§£
			ans += mn[i];//ç´¯åŠ å½“å‰é€‰æ‹©è¾¹çš„æƒå€¼
		}

		for(int a = 1;a <= n;a++){//ç¯æ£€æµ‹
			int b = a;
            //æ²¿ç€çˆ¶é“¾å›æº¯,ç›´åˆ°é‡åˆ°æ ¹èŠ‚ç‚¹ã€å·²æ ‡è®°èŠ‚ç‚¹æˆ–å·²ç»åœ¨ç¯ä¸Šçš„èŠ‚ç‚¹
			while(b != root && !vis[b] && !loop[b]) {
				vis[b] = a;//æ ‡è®°å½“å‰èŠ‚ç‚¹
				b = fa[b];//å›æº¯çˆ¶èŠ‚ç‚¹
			}
			if(b != root && vis[b] == a){//å‘ç°æ–°ç¯
				loop[b] = ++tot;//è®°å½•ç¯ä¸Šçš„ç‚¹åœ¨å“ªä¸ªç¯ä¸Š
				for(int k = fa[b];k != b;k = fa[k]){
					loop[k] = tot;
				}
			}
		}
		if(!tot) return ans;//å¦‚æœæ²¡æœ‰ç¯,ç®—æ³•å®Œæˆ,è¿”å›ç­”æ¡ˆ
        
		for(int i = 1;i <= n;i++){//å¤„ç†å‰©ä½™èŠ‚ç‚¹,æ‰€æœ‰éç¯ä¸Šçš„ç‹¬ç«‹ç‚¹,æ¯ä¸ªç‚¹è‡ªå·±è§†ä¸ºä¸€ä¸ªç¯
			if(!loop[i]) loop[i] = ++tot;
		}
		for(int i = 1;i <= m;i++){//é‡æ–°è®¾ç½®è¾¹æƒ,ç¼©ç¯
			auto &[a,b,c] = edge[i];
			edge[i] = {loop[a],loop[b],c-mn[b]};//è¾¹æƒå‡å»å·²é€‰æ‹©çš„æœ€å°å…¥è¾¹æƒå€¼
		}
		n = tot;//å®Œæˆç¼©ç¯,é‡æ–°è®¾ç½®nå’Œroot
		root = loop[root];
	}
}

int main(){
	int n,m,root; std::cin >> n >> m >> root;
	for(int i = 1;i <= m;i++){
		std::cin >> edge[i].a >> edge[i].b >> edge[i].c;
	}
	std::cout << zhuliu(n,m,root);
}
```



**ä¸å®šæ ¹çš„æœ€å°æ ‘å½¢å›¾**

[Ice_creamâ€™s world II - HDU 2121 - Virtual Judge (vjudge.net)](https://vjudge.net/problem/HDU-2121)

> è¾“å‡º æœ€å°æ ‘å½¢å›¾æƒå€¼ å’Œ é€‰å®šçš„æ ¹ï¼Œè¯ºæ ¹ä¸å”¯ä¸€ï¼Œè¾“å‡ºç¼–å·æœ€å°çš„ã€‚

æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªè™šæ‹Ÿçš„è¶…çº§æºç‚¹ï¼Œå¹¶å‘å…¶å®ƒæ‰€æœ‰ç‚¹è¿è¾¹ï¼Œè¾¹æƒä¸ºå¤§äºåŸå›¾æ‰€æœ‰è¾¹æƒä¹‹å’Œå’Œä¸€ä¸ªæ•°(å‡è®¾ä¸º`sum`)ï¼Œè¯ºæœ€å`ans - sum >= sum`è¯´æ˜è™šæ‹Ÿæºç‚¹å»ºçš„è¾¹ç”¨äº†è¶…è¿‡ä¸€æ¬¡ï¼Œåˆ™å›¾ä¸è¿é€šæ— è§£ã€‚å¦åˆ™æœ€ç»ˆç­”æ¡ˆå°±æ˜¯`ans-sum`ã€‚

ä¸»è¦åœ¨äºå¦‚ä½•æ‰¾ç¼–å·æœ€å°çš„æ ¹ã€‚å¦‚æœæœ‰å¤šä¸ªæ ¹ï¼Œåˆ™ä»–ä»¬æœ€ç»ˆä¼šæˆä¸€ä¸ªç¯ï¼Œè¿™ä¸ªç¯ç¼©ç‚¹åä¼šä¸è™šæ ¹ç›¸è¿ï¼Œæ‰¾å‡ºèŠ‚ç‚¹ç¼–å·æœ€å°çš„ä¸€ä¸ªæ ¹å³å¯ï¼Œå› ä¸ºæˆ‘ä»¬ä»è™šæ ¹å‘èŠ‚ç‚¹å»ºè¾¹æ—¶æ˜¯ä»`m+1åˆ°m+n`å»ºè¾¹çš„ï¼Œæ‰€ä»¥åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œç¬¬ä¸€æ¬¡è®¿é—®åˆ°è¿å‘è¯¥ç¯çš„è¾¹æ—¶ï¼Œå…¶ç¼–å·(å‡å»m)å³ä¸ºç¼–å·æœ€å°çš„æ ¹ã€‚

```cpp
#include <iostream>

const int INF = 0x3f3f3f3f;
const int N = 2003,M= 20004;
int n,m,root,real_root;
int fa[N],mn[N],vis[N],loop[N];

struct Edge{
	int a,b,c;
}edge[M];

int zhuliu(int n,int m,int root){
	int ans = 0;
	while(1){
		int cnt = 0;
		for(int i = 1;i <= n;i++){
			mn[i] = INF;
			fa[i] = vis[i] = loop[i] = 0;
		}
		for(int i = 1;i <= m;i++){
			auto &[a,b,c] = edge[i];
			if(a != b && mn[b] > c){
				mn[b] = c;
				fa[b] = a;
				if(a == root) real_root = i;//åªéœ€è¦åœ¨è¿™é‡Œæ›´æ–°è¦æ‰¾çš„æ ¹
			}
		}
		mn[root] = 0;
		for(int i = 1;i <= n;i++){
			if(mn[i] == INF) return -1;
			ans += mn[i];
		}
		for(int a = 1;a <= n;a++){
			int b = a;
			while(b != root && !vis[b] && !loop[b]){
				vis[b] = a;
				b = fa[b];
			}
			if(b != root && vis[b] == a){
				loop[b] = ++cnt;
				for(int k = fa[b];k != b;k = fa[k]){
					loop[k] = cnt;
				}
			}
		}
		if(!cnt) return ans;
		for(int i = 1;i <= n;i++){
			if(!loop[i]) loop[i] = ++cnt;
		}
		for(int i = 1;i <= m;i++){
			auto &[a,b,c] = edge[i];
			edge[i] = {loop[a],loop[b],c-mn[b]};
		}
		n = cnt;
		root = loop[root];
	}
}

void sol(){
	int sum = 0;
	for(int i = 1;i <= m;i++){
		int a,b,c;std::cin >> a >> b >> c;
		edge[i] = {++a,++b,c};//æœ¬é¢˜èŠ‚ç‚¹ç¼–å·ä»0_idxå¼€å§‹
		sum += c;
	}
	sum++;
	for(int i = 1;i <= n;i++){
		edge[m+i] = {n+1,i,sum};
	}
	int ans = zhuliu(n+1,n+m,n+1);

	if(ans == -1 || ans - sum >= sum) std::cout << "impossible\n";
	else std::cout << ans-sum << ' ' << real_root - m - 1<< '\n';
}

int main(){
	std::ios::sync_with_stdio(false);std::cin.tie(0);
	while(std::cin >> n >> m) {
		sol();
		std::cout << '\n';
	}
}
```







## äºŒåˆ†å›¾

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240128162924921.png" alt="image-20240128162924921" style="zoom:50%;" /> 

> æ€§è´¨ï¼š
>
> - ä¸å­˜åœ¨è¾¹æ•°ä¸ºå¥‡æ•°çš„ç¯
>
> - å¦‚æœä¸¤ä¸ªé›†åˆä¸­çš„ç‚¹åˆ†åˆ«æŸ“æˆé»‘è‰²å’Œç™½è‰²ï¼Œå¯ä»¥å‘ç°äºŒåˆ†å›¾ä¸­çš„æ¯ä¸€æ¡è¾¹éƒ½ä¸€å®šæ˜¯è¿æ¥ä¸€ä¸ªé»‘è‰²ç‚¹å’Œä¸€ä¸ªç™½è‰²ç‚¹ã€‚



### äºŒåˆ†å›¾åˆ¤å®š

**æŸ“è‰²æ³•åˆ¤äºŒåˆ†å›¾**

åˆ¤æ–­æ˜¯å¦æ˜¯äºŒåˆ†å›¾ï¼ˆä¸å­˜åœ¨å¥‡ç¯ï¼‰

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240729102404459.png" alt="image-20240729102404459" style="zoom:33%;" /> 



```cpp
//äºŒåˆ†å›¾çš„åˆ¤å®š https://www.acwing.com/problem/content/862/
#include <iostream>
#include <queue>
#include <cstring>
using namespace std;
const int N = 200005;
int n,m;
int h[N],e[N],ne[N],idx;
int color[N];//0ä»£è¡¨æœªæŸ“è‰²ï¼Œ1/2è¡¨ç¤ºæŸ“äº†ä¸¤ç§é¢œè‰²

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool uuz(int be){
	color[be] = 1;
	queue<int>q;
	q.push(be);
	while(q.size()){
		int t = q.front();
		q.pop();
		for(int i = h[t];~i;i = ne[i]){
			int k = e[i];
			if(!color[k]){//å¦‚æœå½“å‰ç‚¹kæœªæŸ“è‰²ï¼Œåˆ™æŸ“ä¸ºä¸ç‚¹tç›¸å¯¹çš„é¢œè‰²
				color[k] = 3 - color[t];
				q.push(k);
			}
			if(color[k] == color[t]) return 0;//å¦‚æœå·²ç»æŸ“è‰²,ä¸”ç›¸é‚»èŠ‚ç‚¹tä¸kåŒè‰²,åˆ™ä¸æ˜¯äºŒåˆ†å›¾
		}
	}
	return 1;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);
	}

	for(int i = 1;i <= n;i++){
		if(!color[i]){
			if(uuz(i) == 0) {
				cout << "No";
				return 0;
			}
		}
	}
	cout << "Yes";
}
```





### æœ€å¤§åŒ¹é…

â€œä»»æ„ä¸¤æ¡è¾¹éƒ½æ²¡æœ‰å…¬å…±ç«¯ç‚¹â€çš„è¾¹çš„é›†åˆè¢«ç§°ä¸ºå›¾çš„ä¸€ç»„**åŒ¹é…**ã€‚åœ¨äºŒåˆ†å›¾ä¸­ï¼ŒåŒ…å«è¾¹æ•°æœ€å¤šçš„ä¸€ç»„åŒ¹é…è¢«ç§°ä¸ºäºŒåˆ†å›¾çš„**æœ€å¤§åŒ¹é…**ã€‚

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250422194240838.png" alt="image-20250422194240838" style="zoom: 25%;" /> ä¾‹å¦‚å›¾ä¸­çº¢è¾¹é›†åˆä¸ºä¸€ç§æœ€å¤§åŒ¹é…æ–¹æ¡ˆã€‚

#### åŒˆç‰™åˆ©ç®—æ³•

åˆç§°å¢å¹¿è·¯ç®—æ³•ï¼ŒäºŒåˆ†å›¾çš„ä¸€ç»„åŒ¹é…Sæ˜¯æœ€å¤§åŒ¹é…ï¼Œå½“ä¸”ä»…å½“å›¾ä¸­ä¸å­˜åœ¨Sçš„å¢å¹¿è·¯ã€‚

æ—¶é—´å¤æ‚åº¦ $O(NM)$ï¼Œå®é™…æ•ˆç‡è¾ƒé«˜ã€‚

```cpp
//https://www.acwing.com/problem/content/863/
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510, M = 100005;
int n1, n2, m;
int h[N], e[M], ne[M], idx;
int match[N],res;//match[b] = a; å³ä¸ºa->bçš„åŒ¹é…
bool st[N];

void add(int a, int b) {
	e[idx] = b, ne[idx] = h[a], h[a] = idx++;
}

bool find(int x) {
	for (int i = h[x]; i != -1;i = ne[x]) {
		int y = e[i];
		if (!st[y]) {//å¦‚æœæŸä¸ªç‚¹æ²¡è¢«é¢„å®š
			st[y] = 1;//é¢„å®šè¿™ä¸ªç‚¹
			if (match[y] == 0 || find(match[y])) {
				//å¦‚æœè¿™ä¸ªç‚¹æ²¡æœ‰åŒ¹é…çš„å¯¹è±¡æˆ–å…¶åŒ¹é…çš„å¯¹è±¡èƒ½åŒ¹é…å…¶å®ƒç‚¹
				match[y] = x;//åˆ™yä¸xåŒ¹é…
				return 1;
			}
		}
	}
	return 0;//å¦‚æœå…¨è¢«é¢„å®šäº†ï¼Œåˆ™åŒ¹é…å¤±è´¥
}

int main() {
	cin >> n1 >> n2 >> m;
	memset(h, -1, sizeof h);
	while (m--){
		int a, b; cin >> a >> b;
		add(a, b);//åªè¿ä¸€è¾¹(å·¦åˆ°å³),åªæœ‰ç¡®å®šé›†åˆAåˆ°Båªæœ‰å•å‘å…³ç³»,ä¸¤ä¸ªèŠ‚ç‚¹ç¼–å·æ‰å¯ä»¥ç›¸åŒ,å¦åˆ™åº”è®©båŠ ä¸Šä¸€ä¸ªåç§»
	}

	for (int i = 1; i <= n1;i++) {//n1è½®
		memset(st, 0, sizeof st);
		//å› ä¸ºæ¯æ¬¡æ¨¡æ‹ŸåŒ¹é…çš„é¢„å®šæƒ…å†µéƒ½æ˜¯ä¸ä¸€æ ·çš„æ‰€ä»¥æ¯è½®æ¨¡æ‹Ÿéƒ½è¦åˆå§‹åŒ–
		if (find(i)) res++;
	}
	cout << res;
}
```

ç»“æœ$match[v_i] = u_i$è¡¨ç¤ºé›†åˆvä¸­çš„ç‚¹å’Œé›†åˆuä¸­çš„ç‚¹å®Œæˆé…å¯¹ã€‚



**æ— å‘å›¾çš„æœ€å¤§åŒ¹é…**

åªèƒ½æ±‚æœ€äºŒåˆ†å›¾å¤§åŒ¹é…(å³æ²¡æœ‰å¥‡ç¯),è¯ºä¸ºä¸€èˆ¬å›¾,åˆ™åº”æ¢ç”¨å¸¦èŠ±æ ‘ç®—æ³•

```cpp
//https://vjudge.net/problem/HDU-2444
//æŸ“è‰²ä¸”åªåŒ¹é…å½“å‰é¢œè‰²ä¸º1çš„ç‚¹
//æˆ–è€…æœ€ç»ˆç­”æ¡ˆç›´æ¥é™¤ä»¥2(è²Œä¼¼è¿™ç§å…·ä½“æ–¹æ¡ˆä¸å¥½æ±‚?)
#include <iostream>
#include <vector>
#include <cstring>

const int N = 205,M = N*N;
int n,m;

int h[N],e[M],ne[M],idx;
void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool vis[N];
int match[N],color[N];
bool dfs(int x,int c){
	color[x] = c;
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!color[y]) {
			if(dfs(y,3-c) == 0) return 0;
		}
		else if(color[y] == c) return 0;  
	}
	return 1;
}

bool find(int x){
	if(color[x] != 1) return 0;//åªåŒ¹é…é¢œè‰²ä¸º1çš„ç‚¹
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!vis[y]){
			vis[y] = 1;
			if(!match[y] || find(match[y])){
				match[y] = x;
				return 1;
			}
		}
	}
	return 0;
}

void sol(){
	for(int i = 1;i <= m;i++){
		int a,b;std::cin >> a >> b;
		add(a,b); add(b,a);
	}
	for(int i = 1;i <= n;i++){
		if(!color[i]){
			if(dfs(i,1) == 0) {std::cout << "No\n";return;}//å‰æå¿…é¡»æ˜¯äºŒåˆ†å›¾
		}
	}

	int ans = 0;
	for(int i = 1;i <= n;i++){
		std::memset(vis,0,sizeof vis);
		ans += find(i);
	}
	std::cout << ans << '\n';
}

int main(){
	while(std::cin >> n >> m) {
		idx = 0;
		for(int i = 1;i <= n;i++){
			h[i] = -1;
			color[i] = match[i] = 0;
		}
		sol();
	}
}
```



**å¤šé‡åŒ¹é…**

```cpp
const int N = 303;
int n1,n2,m;
int g[N][N];

std::set<int>se[N];
bool vis[N];
bool find(int x){
    for(int y = 1;y <= n1;y++){
        if(g[x][y] && !vis[y]){
            vis[y] = 1;
            if(se[y].size() < m){//å¦‚æœå½“å‰ç»„å®¹é‡æœ‰å‰©ä½™,åˆ™ç›´æ¥åŠ å…¥
                se[y].insert(x);
                return 1;
            }
            else if(se[y].size() == m){//å¦‚æœå·²ç»æ»¡äº†
                for(auto &x2:se[y]){//å°è¯•ä»å½“å‰ç»„ç§»å‡ºä¸€ä¸ªåˆ°å…¶å®ƒç»„
                    if(find(x2,mid)){
                        se[y].erase(x2);
                        se[y].insert(x);
                        return 1;
                    }
                }
            }
        }
    }
    return 0;
}

bool check(){
    for(int i = 1;i <= n1;i++) se[i].clear();
    for(int i = n1+1;i <= n1+n2;i++){
        std::memset(vis,0,sizeof vis);
        if(find(i) == 0) return 0;
    }
    return 1;
}
```



#### HK ç®—æ³•

Hopcroftâ€“Karpç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(M\sqrt{N})$ï¼Œå®é™…è¡¨ç°è¾ƒå¥½

```cpp
//ã€æ¨¡æ¿ã€‘äºŒåˆ†å›¾æœ€å¤§åŒ¹é… https://www.luogu.com.cn/problem/P3386
#include <iostream>
#include <queue>
#include <cstring>

struct HK{
	int n1,n2,dis;
	std::vector<int>cx,cy,dx,dy,vis;
	std::vector<std::vector<int>>g;
	const int INF = 0x3f3f3f3f;

	HK(int _n1,int _n2){
		n1 = _n1,n2 = _n2;
		g.assign(n1+1,{});
	}

	void add(int a,int b){
		g[a].emplace_back(b);
	}

	bool bfs(){
		std::queue<int>q;
		dx = std::vector<int>(n1+1,-1);
		dy = std::vector<int>(n2+1,-1);

		dis = INF;
		for(int i = 1;i <= n1;i++){
			if(cx[i] == -1){
				q.push(i);
				dx[i] = 0;
			}
		}
		while(q.size()){
			int x = q.front();
			q.pop();
			if(dx[x] > dis) break;
			for(auto &y:g[x]){
				if(dy[y] == -1){
					dy[y] = dx[x] + 1;
					if(cy[y] == -1) dis = dy[y];
					else{
						dx[cy[y]] = dy[y]+1;
						q.push(cy[y]);
					}
				}
			}
		}
		return dis != INF;
	}

	bool dfs(int x){
		for(auto &y:g[x]){
			if(!vis[y] && dy[y] == dx[x] + 1){
				vis[y] = 1;
				if(cy[y] != -1 && dy[y] == dis) continue;
				if(cy[y] == -1 || dfs(cy[y])){
					cy[y] = x;
					cx[x] = y;
					return 1;
				}
			}
		}
		return 0;
	}

	int sol(){
		int ans = 0;
		cx = std::vector<int>(n1+1,-1);
		cy = std::vector<int>(n2+1,-1);
		while(bfs()) {
			vis = std::vector<int>(n2+1,0);
			for(int i = 1;i <= n1;i++){
				if(cx[i] == -1 && dfs(i)) ans++;
			}
		}
		return ans;
	}
};


int main(){
	int n1,n2,m;
	std::cin >> n1 >> n2 >> m;
	HK hk(n1,n2);
	for(int i = 1;i <= m;i++){
		int a,b;std::cin >> a >> b;//n1[] -> n2[]
		hk.add(a,b);
	}
	std::cout << hk.sol() << '\n';
//	for(int i = 1;i <= n1;i++){//å…·ä½“æ–¹æ¡ˆ,cx[]ä¸ºå·¦è¾¹çš„ç‚¹åŒ¹é…åˆ°çš„æ–¹æ¡ˆ,cy[]ä¸ºå³è¾¹çš„ç‚¹åŒ¹é…åˆ°çš„æ–¹æ¡ˆ
//		if(hk.cx[i] != -1) {//-1åˆ™ä¸ºåŒ¹é…å¤±è´¥
//			std::cout << i << ' ' << hk.cx[i] << '\n';
//		}
//	}
}
```



#### è½¬ä¸ºç½‘ç»œæµæ¨¡å‹

è¾¹æƒè®¾ä¸º1ï¼Œæºç‚¹å‘å·¦è¾¹é›†åˆæ‰€æœ‰ç‚¹è¿è¾¹ï¼Œå³è¾¹é›†åˆæ‰€æœ‰ç‚¹å‘æ±‡ç‚¹è¿è¾¹ã€‚æ±‚æœ€å¤§æµå³å¯ã€‚

æ—¶é—´å¤æ‚åº¦ $O(M\sqrt{N})$

```cpp
//åŸºäºDinicå®ç° ã€æ¨¡æ¿ã€‘äºŒåˆ†å›¾æœ€å¤§åŒ¹é… https://www.luogu.com.cn/problem/P3386
#include <iostream>
#include <queue>
#include <cstring>

const int INF = 0x3f3f3f3f;
const int N = 1003,M = 400005;
int h[N],e[M],ne[M],idx,w[M];
int n1,n2,m;
int s,t;
int maxflow;
int d[N],now[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool bfs(){
	memset(d,0,sizeof d);
	std::queue<int>q;
	q.push(s);
	d[s] = 1;
	now[s] = h[s];
	while(q.size()){
		int x = q.front();
		q.pop();
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(!w[i] || d[y]) continue;
			d[y] = d[x]+1;
			now[y] = h[y];
			q.push(y);
			if(y == t) return 1;
		}
	}
	return 0;
}

int dfs(int x,int flow){
	if(x == t) return flow;
	int res = 0;
	for(int i = now[x];~i && flow;i = ne[i]){
		now[x] = i;
		int y = e[i];
		if(!w[i] || d[y] != d[x]+1) continue;
		int k = dfs(y,std::min(flow,w[i]));
		if(!k) d[y] = 0;
		w[i] -= k;
		w[i^1] += k;
		flow -= k;
		res += k;
	}
	return res;
}

int main(){
	std::memset(h,-1,sizeof h);
	std::cin >> n1 >> n2 >> m;
	s = 0,t = n1+n2+1;
	for(int i = 1;i <= m;i++){
		int a,b;std::cin >> a >> b;
		add(a,b+n1,1);
		add(b+n1,a,0);
	}
	for(int i = 1;i <= n1;i++) add(s,i,1),add(i,s,0);
	for(int i = n1+1;i <= n1+n2;i++) add(i,t,1),add(t,i,0);//å¦‚æœBé›†åˆæ¯ä¸ªç‚¹å¯ä»¥å®¹ä¸‹æœ€å¤šmä¸ªAé›†åˆä¸­çš„ç‚¹,åˆ™è¿™é‡Œè¾¹æƒæ”¹ä¸ºmå³å¯

	while(bfs()) maxflow += dfs(s,INF);

	std::cout << maxflow << '\n';
//	for(int i = 1;i < idx;i += 2){//å…·ä½“æ–¹æ¡ˆ,éå†æ‰€æœ‰åè¾¹
//		if(w[i]) {//å¦‚æœåè¾¹è¿˜å‰©æµé‡ä¸”ç«¯ç‚¹ä¸ä¸ºæºç‚¹æˆ–æ±‡ç‚¹
//			if(e[i] == s || e[i^1] == t) continue;
//			std::cout << e[i] << ' ' << e[i^1] - n1 << '\n';
//		}
//	}
}
```





#### å¸¸è§é—®é¢˜æ¨¡å‹

äºŒåˆ†å›¾åŒ¹é…çš„æ¨¡å‹æœ‰ä¸¤ä¸ªè¦ç´ ï¼š

1. èŠ‚ç‚¹èƒ½åˆ†æˆç‹¬ç«‹çš„ä¸¤ä¸ªé›†åˆï¼Œæ¯ä¸ªé›†åˆå†…éƒ¨æœ‰0æ¡è¾¹ã€‚
2. æ¯ä¸ªèŠ‚ç‚¹åªèƒ½ä¸1æ¡åŒ¹é…è¾¹ç›¸è¿ã€‚



[372. æ£‹ç›˜è¦†ç›– - AcWingé¢˜åº“](https://www.acwing.com/problem/content/374/)

ç»™å®šä¸€ä¸ª N è¡Œ Nåˆ—çš„æ£‹ç›˜ï¼Œå·²çŸ¥æŸäº›æ ¼å­ç¦æ­¢æ”¾ç½®ã€‚æ±‚æœ€å¤šèƒ½å¾€æ£‹ç›˜ä¸Šæ”¾å¤šå°‘å—çš„é•¿åº¦ä¸º 2ã€å®½åº¦ä¸º 1 çš„éª¨ç‰Œï¼Œå¹¶ä¸”ä»»æ„ä¸¤å¼ éª¨ç‰Œéƒ½ä¸é‡å ã€‚

å°†éª¨ç‰Œçœ‹ä½œæ— å‘è¾¹ï¼Œåœ¨ç›¸é‚»çš„ä¸¤ä¸ªæ ¼å­è¿è¾¹ã€‚å¦‚æœæŠŠæ£‹ç›˜é»‘ç™½æŸ“è‰²(è¡Œå·åŠ åˆ—å·ä¸ºå¶æ•°æŸ“æˆç™½è‰²ï¼Œå¦åˆ™æŸ“æˆé»‘è‰²)ã€‚é‚£ä¹ˆç›¸é‚»çš„ä¸¤ä¸ªæ ¼å­é¢œè‰²ä¸åŒï¼Œæœ‰è¿è¾¹ã€‚åŒè‰²çš„ä¸¤ä¸ªæ ¼å­ä¸ç›¸é‚»ï¼Œæ²¡æœ‰è¾¹ç›¸è¿ã€‚è¯¥å›¾æ˜¯ä¸€å¼ äºŒåˆ†å›¾ï¼ŒäºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…å³ä¸ºæœ€å¤šèƒ½æ”¾éª¨ç‰Œçš„ä¸ªæ•°ã€‚

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 105;
int n,t;
int a[N][N];
pair<int,int> match[N][N];
bool st[N][N];
int dx[] ={-1,1,0,0},dy[] = {0,0,-1,1};

bool find(pair<int,int>p){
	auto [x,y] = p;
	for(int i = 0;i < 4;i++){
		int nx = x + dx[i],ny = y + dy[i];
		if(nx < 1 || nx > n || ny < 1 || ny > n || a[nx][ny]) continue;
		if(!st[nx][ny]){
			st[nx][ny] = 1;
			if(!match[nx][ny].first || find(match[nx][ny])){
				match[nx][ny] = {x,y};
				return 1;
			}
		}
	}
	return 0;
}

int main(){
	cin >> n >> t;
	while(t--){
		int x,y;cin >> x >> y;
		a[x][y] = 1;
	}
	int ans = 0;
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= n;j++){
			if((i+j)&1 || a[i][j]) continue;
			memset(st,0,sizeof st);
			ans += find({i,j});
		}
	}
	cout << ans;
}
```



[P10937 è»Šçš„æ”¾ç½® - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10937)

ç»™å®šä¸€ä¸ª *N* è¡Œ *M* åˆ—çš„æ£‹ç›˜ï¼Œå·²çŸ¥æŸäº›æ ¼å­ç¦æ­¢æ”¾ç½®ã€‚é—®æ£‹ç›˜ä¸Šæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ªä¸èƒ½äº’ç›¸æ”»å‡»çš„è»Šï¼ˆåŒè¡Œæˆ–åŒåˆ—åªèƒ½æœ‰ä¸€ä¸ªè½¦ï¼‰ã€‚

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 205,M = N*N;
int n,m,t;
int a[N][N];
int h[N],e[M],ne[M],idx;
bool st[N];
int match[N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool find(int x){
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!st[y]){
			st[y] = 1;
			if(!match[y] || find(match[y])){
				match[y] = x;
				return 1;
			}
		}
	}
	return 0;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m >> t;
	while(t--){
		int x,y;cin >> x >> y;
		a[x][y] = 1;
	}

	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			if(a[i][j] == 0) add(i,j);
		}
	}
	int ans = 0;
	for(int i = 1;i <= n;i++){
		memset(st,0,sizeof st);
		ans += find(i);
	}
	cout << ans;
}
```







### æœ€å¤§æƒåŒ¹é…

#### KMç®—æ³•

æ—¶é—´å¤æ‚åº¦$O(N^3)$

```cpp
//ã€æ¨¡æ¿ã€‘äºŒåˆ†å›¾æœ€å¤§æƒå®Œç¾åŒ¹é…  https://www.luogu.com.cn/problem/P6577
//è¯ºè¦æ±‚æœ€å°æƒ,åªéœ€å°†ç»“æ„ä½“ä¾‹çš„INFå’Œ-INF,minå’Œmaxå¯¹æ¢
#include<bits/stdc++.h>
using namespace std;

const long long INF = 1e18;
const int N = 505;
int n1,n2,m;

struct KM {
	int n;
	int pl[N], pr[N], fa[N];
	long long g[N][N], wl[N], wr[N], sl[N];
	bitset<N> vis;
	long long tot;

	void init(int _n) {
		n = _n;
		for (int i = 1; i <= n; i++) {
			fill(g[i] + 1, g[i] + n + 1, -INF);//æœ¬é¢˜å«æœ‰è´Ÿæƒè¾¹,åˆå§‹åŒ–ä¸º-INF,å¦åˆ™åˆå§‹åŒ–ä¸º0
			wl[i] = wr[i] = sl[i] = 0;
			pl[i] = pr[i] = fa[i] = 0;
		}
	}

	void add(int x, int y, long long z) {
		g[x][y] = max(g[x][y],z);
	}

	void get(int x) {
		for (int i = 1; i <= n; i++) {
			sl[i] = INF;
			fa[i] = 0;
		}
		vis.reset();
		pr[0] = x;
		int cr = 0;
		while (pr[cr]) {
			long long mn = INF;
			vis[cr] = 1;
			int cl = pr[cr];
			for (int i = 1; i <= n; i++) {
				if (!vis[i]) {
					const long long t1 = wl[cl] + wr[i] - g[cl][i];
					if (sl[i] > t1) {
						fa[i] = cr;
						sl[i] = t1;
					}
					mn = min(mn, sl[i]);
				}
			}
			for (int i = 0; i <= n; i++) {
				if (vis[i]) {
					wr[i] += mn;
					wl[pr[i]] -= mn;
				} 
				else sl[i] -= mn;
			}
			cr = 0;
			for (int i = 1; i <= n; i++) {
				if (!vis[i] && sl[i] == 0) {
					cr = i;
					break;
				}
			}
		}
		while (cr) {
			pr[cr] = pr[fa[cr]];
			cr = fa[cr];
		}
	}

	void sol() {
		tot = 0;
		for (int i = 1; i <= n; i++) get(i);
		for (int i = 1; i <= n; i++) pl[pr[i]] = i;
		for (int i = 1; i <= n; i++) tot += g[i][pl[i]];
	}
} km;

int main(){
	ios::sync_with_stdio(0); cin.tie(0);
	std::cin >> n1 >> m; n2 = n1;
	km.init(max(n1,n2));
	while(m--){
		int a,b,c; cin >> a >> b >> c;
		km.add(a,b,c);
	}

	km.sol();

	cout << km.tot << '\n';
//	for(int i = 1;i <= n1;i++){
//		if(km.g[i][km.pl[i]] > -INF) {
//			std::cout << i << "->" << km.pl[i] << ' ';
//		}
//	}
}
```

```cpp
//éå®Œç¾åŒ¹é…ä¸‹çš„æœ€å¤§æƒ  https://uoj.ac/problem/80
#include<bits/stdc++.h>
using namespace std;

const long long INF = 1e18;
const int N = 505;
int n1,n2,m;


struct KM {
	int n;
	int pl[N], pr[N], fa[N];
	long long g[N][N], wl[N], wr[N], sl[N];
	bitset<N> vis;
	long long tot;

	void init(int _n) {
		n = _n;
		for (int i = 1; i <= n; i++) {
			fill(g[i] + 1, g[i] + n + 1, 0);//è¾¹æƒåˆå§‹åŒ–ä¸º0,æœ¬é¢˜å‡ä¸ºæ­£æƒè¾¹
			wl[i] = wr[i] = sl[i] = 0;
			pl[i] = pr[i] = fa[i] = 0;
		}
	}

	void add(int x, int y, long long z) {
		g[x][y] = max(g[x][y],z);
	}

	void get(int x) {
		for (int i = 1; i <= n; i++) {
			sl[i] = INF;
			fa[i] = 0;
		}
		vis.reset();
		pr[0] = x;
		int cr = 0;
		while (pr[cr]) {
			long long mn = INF;
			vis[cr] = 1;
			int cl = pr[cr];
			for (int i = 1; i <= n; i++) {
				if (!vis[i]) {
					const long long t1 = wl[cl] + wr[i] - g[cl][i];
					if (sl[i] > t1) {
						fa[i] = cr;
						sl[i] = t1;
					}
					mn = min(mn, sl[i]);
				}
			}
			for (int i = 0; i <= n; i++) {
				if (vis[i]) {
					wr[i] += mn;
					wl[pr[i]] -= mn;
				} 
				else sl[i] -= mn;
			}
			cr = 0;
			for (int i = 1; i <= n; i++) {
				if (!vis[i] && sl[i] == 0) {
					cr = i;
					break;
				}
			}
		}
		while (cr) {
			pr[cr] = pr[fa[cr]];
			cr = fa[cr];
		}
	}

	void sol() {
		tot = 0;
		for (int i = 1; i <= n; i++) get(i);
		for (int i = 1; i <= n; i++) pl[pr[i]] = i;
		for (int i = 1; i <= n; i++) tot += g[i][pl[i]];
	}
} km;

int main(){
	ios::sync_with_stdio(0); cin.tie(0);
	cin >> n1 >> n2 >> m;
	km.init(max(n1,n2));//ç›¸å½“äºåœ¨èŠ‚ç‚¹è¾ƒå°‘çš„é›†åˆæ·»åŠ äº†è™šæ‹Ÿç‚¹
	while(m--){
		int a,b,c; cin >> a >> b >> c;
		km.add(a,b,c);
	}

	km.sol();

//	cout << km.tot << '\n';
//	for(int i = 1;i <= n1;i++){
//		if(km.g[i][km.pl[i]]) {
//			std::cout << i << "->" << km.pl[i] << '\n';
//		}
//	}
}
```



#### è½¬ä¸ºè´¹ç”¨æµæ¨¡å‹

- æ–°å»ºæºç‚¹s1å’Œæ±‡ç‚¹s2ã€‚
- `æºç‚¹`å‘æ¯ä¸ª`å·¦éƒ¨èŠ‚ç‚¹`è¿ä¸€æ¡æµé‡ä¸º1ï¼Œè´¹ç”¨ä¸º0çš„è¾¹ã€‚
- æ¯ä¸ª`å³éƒ¨èŠ‚ç‚¹`å‘`æ±‡ç‚¹`è¿ä¸€æ¡æµé‡ä¸º1ï¼Œè´¹ç”¨ä¸º0çš„è¾¹ã€‚
- å¯¹äºäºŒåˆ†å›¾ä¸­æ¯æ¡å·¦éƒ¨åˆ°å³éƒ¨çš„è¾¹ï¼Œè¿ä¸€æ¡æµé‡ä¸º1ï¼Œè´¹ç”¨ä¸ºè¾¹æƒçš„è¾¹ã€‚
- å¦å¤–å¦‚æœè€ƒè™‘éå®Œç¾åŒ¹é…ï¼Œå¯¹äºæ¯ä¸ª`å·¦éƒ¨èŠ‚ç‚¹`è¿˜éœ€è¦å‘`æ±‡ç‚¹`è¿ä¸€æ¡æµé‡ä¸º1ï¼Œè´¹ç”¨ä¸º0çš„è¾¹ã€‚æœ€å¤§è´¹ç”¨çš„å‰ææ˜¯æœ€å¤§æµã€‚
- æ±‚è¿™ä¸ªç½‘ç»œçš„**æœ€å¤§è´¹ç”¨æœ€å¤§æµ**å³å¯ï¼Œæ­¤æ—¶ç½‘ç»œçš„æœ€å¤§æµé‡ä¸€å®šä¸ºå·¦éƒ¨èŠ‚ç‚¹çš„æ•°é‡ï¼Œè€Œæœ€å¤§æµé‡ä¸‹çš„æœ€å¤§è´¹ç”¨å³å¯¹åº”ä¸€ä¸ªæœ€å¤§æƒåŒ¹é…æ–¹æ¡ˆã€‚

æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œæ¯”KMç®—æ³•æ…¢äº†å¤§æ¦‚ä¸€ä¸ªæ•°é‡çº§ï¼Œå¦‚æœæ•°æ®èŒƒå›´è¾ƒå¤§å»ºè®®æ¢KMç®—æ³•ã€‚

```cpp
//æ¨¡æ¿ äºŒåˆ†å›¾æœ€å¤§æƒå®Œç¾åŒ¹é… https://www.luogu.com.cn/problem/P6577
//åŸºäºDinicå®ç°,å®é™…å¹¶ä¸èƒ½é€šè¿‡æœ¬é¢˜,åªä½œä¸ºå®ç°å‚è€ƒæ¨¡ç‰ˆ,ä¸€èˆ¬åªèƒ½é€šè¿‡èŠ‚ç‚¹æ€»æ•°<=500çš„å›¾
#include <iostream>
#include <queue>
#include <cstring>

const long long INF = 1e18;
const int N = 1005,M = 1000006;//Nå¼€n1+n2+5,Må¼€n1*n2*3
int n1,n2,m;

int h[N],e[M],ne[M],idx;
long long c[M],w[M];
void add(int a,int b,int x,int y){
	c[idx] = y,w[idx] = x,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

int s1,s2;
long long maxflow,maxcost;
long long dist[N];
int now[N];
bool vis[N];
bool spfa(){
	std::memset(vis,0,sizeof vis);
	for(int i = 0;i <= n1+n2+1;i++) dist[i] = -INF;
	std::queue<int>q;
	q.push(s1);
	dist[s1] = 0;
	now[s1] = h[s1];
	while(q.size()){
		int x = q.front();
		q.pop();
		vis[x] = 0;
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(w[i] && dist[y] < dist[x] + c[i]) {
				dist[y] = dist[x] + c[i];
				now[y] = h[y];
				if(!vis[y]) {
					vis[y] = 1;
					q.push(y);
				}
			}
		}
	}
	return dist[s2] > -INF;
}

long long dinic(int x,long long flow){
	if(x == s2) return flow;
	long long res = 0;
	vis[x] = 1;
	for(int i = now[x];~i && flow;i = ne[i]){
		int y = e[i];
		now[x] = i;
		if(w[i] && dist[y] == dist[x] + c[i] && !vis[y]){
			long long k = dinic(y,std::min(flow,w[i]));
			if(!k) dist[y] = 0;
			w[i] -= k;
			w[i^1] += k;
			res += k;
			flow -= k;
			maxcost += k * c[i];
		}
	}
	vis[x] = 0;
	return res;
}

int main(){
	std::ios::sync_with_stdio(false);std::cin.tie(0);
	std::memset(h,-1,sizeof h);
	std::cin >> n1 >> m; n2 = n1;
	s1 = 0,s2 = n1+n2+1;
	for(int i = 1;i <= m;i++){
		int x,y,z;std::cin >> x >> y >> z;
		add(x,y+n1,1,z); add(y+n1,x,0,-z);
	}

	for(int i = 1;i <= n1;i++){
		add(s1,i,1,0); add(i,s1,0,0);
//		add(i,s2,1,0); add(i,s2,0,0); //åŠ ä¸Šå³ä¸ºéå®Œç¾åŒ¹é…ä¸‹çš„æœ€å¤§æƒ
	}

	for(int i = 1;i <= n2;i++){
		add(i+n1,s2,1,0); add(s2,i+n1,0,0);
	}

	while(spfa()) maxflow += dinic(s1,INF);

	std::cout << maxcost << '\n';

//	for(int i = 1;i < idx;i += 2){
//		if(w[i]){
//			if(e[i] == s1 || e[i^1] == s2) continue;
//			std::cout << e[i] << "->" << e[i^1] - n1 << '\n';
//		}
//	}
}
```













### æœ€å°ç‚¹è¦†ç›–

æ±‚å‡ºä¸€ä¸ªæœ€å°çš„ç‚¹é›†Sï¼Œä½¿å¾—ä»»æ„ä¸€æ¡è¾¹éƒ½è‡³å°‘æœ‰ä¸€ä¸ªç«¯ç‚¹å±äºS

**KÃ¶nigå®šç†**ï¼šæœ€å°ç‚¹è¦†ç›–=æœ€å¤§åŒ¹é…

äºŒåˆ†å›¾æœ€å°è¦†ç›–çš„æ¨¡å‹ç‰¹ç‚¹æ˜¯ï¼šæ¯æ¡è¾¹æœ‰2ä¸ªç«¯ç‚¹ï¼ŒäºŒè€…è‡³å°‘é€‰æ‹©ä¸€ä¸ªã€‚



[P6062 [USACO05JAN\] Muddy Fields G - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P6062)

> ç»™å®šä¸€ä¸ªN*Mçš„ç½‘æ ¼ï¼Œå…¶ä¸­ä¸€äº›åœ°é¢æ—¶æ³¥æ³çš„ï¼Œä½ éœ€è¦ç”¨ä¸€äº›å®½åº¦ä¸º1ï¼Œé•¿åº¦ä»»æ„çš„æœ¨æ¿å°†æ‰€æœ‰æ³¥åœ°ç›–ä½ï¼ŒåŒæ—¶ä¸èƒ½ç›–ä½å¹²å‡€çš„åœ°é¢ï¼Œæœ¨æ¿å¯ä»¥é‡å ã€‚N,M <= 50ã€‚

æ¯å—æ³¥åœ°è¦ä¹ˆè¢«ç¬¬iè¡Œçš„ä¸€ä¸ªæ¨ªç€çš„æœ¨æ¿ç›–ä½ï¼Œè¦ä¹ˆè¢«ç¬¬jåˆ—çš„ä¸€ä¸ªç«–ç€çš„æœ¨æ¿ç›–ä½ï¼ŒäºŒè€…è‡³å°‘é€‰æ‹©ä¸€ä¸ªï¼Œæ»¡è¶³äºŒåˆ†å›¾æœ€å°è¦†ç›–ç‰¹ç‚¹ã€‚æŠŠè¡Œæœ¨æ¿ä½œä¸ºå·¦è¾¹ï¼Œåˆ—æœ¨æ¿ä½œä¸ºå³è¾¹ï¼Œå¯¹äºæ¯å—æ³¥åœ°ï¼Œåœ¨å®ƒæ‰€å±çš„è¡Œæœ¨æ¿ä¸åˆ—æœ¨æ¿ä¹‹é—´è¿è¾¹ï¼Œæ±‚å‡ºäºŒåˆ†å›¾çš„æœ€å°è¦†ç›–ï¼Œå³ä¸ºæœ€å°‘å¾—æœ¨æ¿è¦†ç›–æ‰€æœ‰æ³¥åœ°çš„ç­”æ¡ˆã€‚

```cpp
#include <iostream>
#include <vector>
#include <cstring>
using namespace std;
const int N = 55;
int n,m;
string s[N];
int r[N][N],c[N][N],cnt;
bool st[N*N];
int match[N*N];
vector<int>e[N*N];

void add(int a,int b){
	e[a].emplace_back(b);
}

bool find(int x){
	for(int y:e[x]){
		if(!st[y]){
			st[y] = 1;
			if(!match[y] || find(match[y])){
				match[y] = x;
				return 1;
			}
		}
	}
	return 0;
}

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> s[i];s[i] = ' ' + s[i];
	}
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			if(!r[i][j] && s[i][j] == '*'){
				if(r[i][j-1]) r[i][j] = r[i][j-1];
				else r[i][j] = ++cnt;
			}
		}
	}
	int cnt1 = cnt;
	for(int j = 1;j <= m;j++){
		for(int i = 1;i <= n;i++){
			if(!c[i][j] && s[i][j] == '*'){
				if(c[i-1][j]) c[i][j] = c[i-1][j];
				else c[i][j] = ++cnt;
				add(r[i][j],c[i][j]);
			}
		}
	}
	int ans = 0;
	for(int i = 1;i <= cnt1;i++){
		memset(st,0,sizeof st);
		ans += find(i);
	}
	cout << ans;
}
```





### æœ€å¤§ç‹¬ç«‹é›†

é€‰æœ€å¤šçš„ç‚¹ï¼Œæ»¡è¶³ä¸¤ä¸¤ä¹‹é—´æ²¡æœ‰è¾¹ç›¸è¿ã€‚

**å®šç†**ï¼šè®¾Gæ˜¯æœ‰Nä¸ªç‚¹çš„äºŒåˆ†å›¾ï¼Œåˆ™Gçš„æœ€å¤§ç‹¬ç«‹é›†ç­‰äº**é¡¶ç‚¹æ•°N-æœ€å¤§åŒ¹é…æ•°**

æ±‚è§£ä¸€ä¸ªå›¾ä¸­çš„æœ€å¤§ç‹¬ç«‹é›†ç­‰ä»·äºæ±‚è§£å…¶åå›¾çš„`æœ€å¤§å›¢`(å³ä¸¤ä¸¤ä¹‹é—´éƒ½æœ‰è¿è¾¹)ã€‚



[P10939 éª‘å£«æ”¾ç½® - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10939)

> ç»™ç‚¹N*Mçš„æ£‹ç›˜ï¼Œå…¶ä¸­æœ‰ä¸€äº›æ ¼å­ç¦æ­¢æ”¾æ——å­ï¼Œé—®æ£‹ç›˜ä¸Šæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ªäº’ä¸æ”»å‡»çš„éª‘å£«(ä¸è±¡æ£‹çš„é©¬ç±»ä¼¼ï¼Œæ”»å‡»â€˜æ—¥â€™å­—)ã€‚N,M <= 100ã€‚

å°†æ£‹ç›˜é»‘ç™½æŸ“è‰²åï¼Œå¯ä»¥å‘ç°ï¼Œä¸€åŒ¹é©¬å¯ä»¥è·³åˆ°çš„æ ¼å­çš„é¢œè‰²ä¸€å®šä¸å½“å‰æ‰€åœ¨æ ¼å­é¢œè‰²ç›¸åã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªä½ç½®ä¸èƒ½è·³åˆ°çš„ä½ç½®è¿è¾¹ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªäºŒåˆ†å›¾ï¼ˆæ‰€æœ‰ç™½è‰²æ ¼å­æ˜¯ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰é»‘è‰²æ ¼å­æ˜¯ä¸€éƒ¨åˆ†ï¼‰ã€‚å¦‚æœæƒ³è®©æ‰€æœ‰çš„é©¬éƒ½ä¸èƒ½äº’ç›¸åƒï¼Œé‚£ä¹ˆè¿™ä¸ªäºŒåˆ†å›¾é‡Œä¸€æ¡è¾¹çš„ä¸¤ä¸ªç‚¹æœ€å¤šåªèƒ½é€‰ä¸€ä¸ªç‚¹æ”¾é©¬ï¼Œæ‰€ä»¥è¿™é¢˜å°±æ˜¯è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªäºŒåˆ†å›¾é‡Œç›¸é‚»çš„ä¸¤ä¸ªç‚¹åªèƒ½é€‰ä¸€ä¸ªï¼Œé—®æœ€å¤šèƒ½é€‰å¤šå°‘ä¸ªç‚¹ã€‚

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250423003607638.png" alt="image-20250423003607638" style="zoom:50%;" /> 

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 105;
int n,m,t;
int g[N][N];
pair<int,int> match[N][N];
bool st[N][N];
int dx[] = {-2,-1,1,2,2,1,-1,-2},dy[] = {1,2,2,1,-1,-2,-2,-1};

bool find(pair<int,int>p){
	auto &[x,y] = p;
	for(int i = 0;i < 8;i++){
		int nx = x + dx[i],ny = y + dy[i];
		if(nx < 1 || nx > n || ny < 1 || ny > m || g[nx][ny]) continue;
		if(!st[nx][ny]){
			st[nx][ny] = 1;
			if(!match[nx][ny].first || find(match[nx][ny])){
				match[nx][ny] = {x,y};
				return 1;
			}
		}
	}
	return 0;
}

int main(){
	cin >> n >> m >> t;
	for(int i = 1;i <= t;i++){
		int x,y;cin >> x >> y;
		g[x][y] = 1;
	}

	int ans = 0;
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			if(g[i][j] || (i+j)%2) continue;
			memset(st,0,sizeof st);
			ans += find({i,j});
		}
	}
	cout << n*m-t - ans;
}
```





### æœ€å°è·¯å¾„è¦†ç›–

åœ¨ä¸€ä¸ªæœ‰æ— ç¯å‘å›¾ä¸­ï¼Œæ‰¾å‡ºæœ€å°‘å¾—è·¯å¾„ï¼Œä½¿å¾—è¿™äº›è·¯å¾„ç»è¿‡äº†æ‰€æœ‰ç‚¹ã€‚ç‰¹åˆ«çš„ï¼Œæ¯ä¸ªç‚¹è‡ªå·±ä¹Ÿå¯ä»¥ç§°ä¸ºæ˜¯è·¯å¾„è¦†ç›–ï¼Œåªä¸è¿‡è·¯å¾„çš„é•¿åº¦æ˜¯0ã€‚



**æœ€å°ä¸ç›¸äº¤è·¯å¾„è¦†ç›–**

> æ¯ä¸€æ¡è·¯å¾„ç»è¿‡çš„é¡¶ç‚¹å„ä¸ç›¸åŒã€‚
>
> åŸå›¾Gä¸­æ¯ä¸ªç‚¹å¦‚æœ`a`èƒ½ç›´æ¥åˆ°è¾¾`b`ï¼Œå°±åŠ è¾¹`a->b`è¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªGçš„æ‹†ç‚¹äºŒåˆ†å›¾G2ã€‚
>
> **å®šç†**ï¼šDAGå›¾Gçš„æœ€å°ä¸ç›¸äº¤è·¯å¾„è¦†ç›–åŒ…å«çš„è·¯å¾„æ¡æ•° = n - æ‹†ç‚¹äºŒåˆ†å›¾G2çš„æœ€å¤§åŒ¹é…æ•°

ä¸€å¼€å§‹æ¯ä¸ªç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„ä¸ºä¸€æ¡è·¯å¾„ï¼Œæ€»å…±æœ‰næ¡ä¸ç›¸äº¤è·¯å¾„ã€‚æˆ‘ä»¬æ¯æ¬¡åœ¨äºŒåˆ†å›¾é‡Œæ‰¾ä¸€æ¡åŒ¹é…è¾¹å°±ç›¸å½“äºæŠŠä¸¤æ¡è·¯å¾„åˆæˆäº†ä¸€æ¡è·¯å¾„ï¼Œä¹Ÿå°±ç›¸å½“äºè·¯å¾„æ•°å‡å°‘äº†1ã€‚æ‰€ä»¥æ‰¾åˆ°äº†å‡ æ¡åŒ¹é…è¾¹ï¼Œè·¯å¾„æ•°å°±å‡å°‘äº†å¤šå°‘ã€‚æ‰€ä»¥æœ€å°è·¯å¾„è¦†ç›–=åŸå›¾çš„ç»“ç‚¹æ•°-æ–°å›¾çš„æœ€å¤§åŒ¹é…æ•°

```cpp
//è¡—é“æ¸…ç†  https://www.luogu.com.cn/problem/UVA1184
#include <iostream>
#include <cstring>
#include <vector>
using namespace std;
const int N = 205;
int n,m;
vector<int>e[N];
int match[N];
bool st[N];

bool find(int x){
	for(int y:e[x]){
		if(!st[y]){
			st[y] = 1;
			if(!match[y] || find(match[y])){
				match[y] = x;
				return 1;
			}
		}
	}
	return 0;
}

void sol(){
	memset(match,0,sizeof match);
	cin >> n >> m;
	for(int i = 1;i <= n;i++) e[i].clear();
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		e[a].emplace_back(b);
	}
	int ans = 0;
	for(int i = 1;i <= n;i++){
		memset(st,0,sizeof st);
		ans += find(i);
	}
	cout << n - ans << '\n';
}

int main(){
	int T;cin >> T;
	while(T--) sol();
}
```



**æœ€å°å¯ç›¸äº¤è·¯å¾„è¦†ç›–**

> æ¯ä¸€æ¡è·¯å¾„ç»è¿‡çš„é¡¶ç‚¹å¯ä»¥ç›¸åŒã€‚
>
> **æ€è·¯**ï¼šå…ˆç”¨floydæ±‚å‡ºåŸå›¾çš„ä¼ é€’é—­åŒ…ï¼Œå³å¦‚æœ`a`èƒ½ç›´æ¥/é—´æ¥åˆ°è¾¾`b`ï¼Œé‚£ä¹ˆå°±åŠ è¾¹`a->b`ã€‚å¾—åˆ°æœ‰å‘æ— ç¯å›¾G2ï¼Œå†åœ¨G2ä¸Šæ±‚æœ€å°ä¸ç›¸äº¤è·¯å¾„è¦†ç›–å³å¯ã€‚

```cpp
//å®è—æ¢ç´¢ https://vjudge.net/problem/OpenJ_Bailian-2594
#include <iostream>
#include <cstring>

const int N = 505;
int n,m;
int g[N][N];

void floyd(){
	for(int k = 1;k <= n;k++){
		for(int i = 1;i <= n;i++){
			for(int j = 1;j <= n;j++){
				g[i][j] |= g[i][k]&g[k][j];
			}
		}
	}
}

bool vis[N];
int match[N];
bool find(int x){
	for(int y = 1;y <= n;y++){
		if(g[x][y] && !vis[y]){
			vis[y] = 1;
			if(!match[y] || find(match[y])) {
				match[y] = x;
				return 1;
			}
		}
	}
	return 0;
}

void sol(){
	std::memset(g,0,sizeof g);
	for(int i = 1;i <= m;i++){
		int a,b;std::cin >> a >> b;
		g[a][b] = 1;
	}
    
	floyd();
    
	int ans = 0;
	std::memset(match,0,sizeof match);
	for(int i = 1;i <= n;i++){
		std::memset(vis,0,sizeof vis);
		ans += find(i);
	}
	std::cout << n - ans << '\n';
}

int main(){
	while(std::cin >> n >> m,n || m) sol();
}
```



### ä¸€èˆ¬å›¾æœ€å¤§åŒ¹é…

ä¸€èˆ¬å›¾åŒ¹é…å’ŒäºŒåˆ†å›¾åŒ¹é…ä¸åŒçš„æ˜¯ï¼Œå›¾å¯èƒ½å­˜åœ¨å¥‡ç¯ã€‚ä¸€èˆ¬å›¾çš„æœ€å¤§åŒ¹é…å¯ä»¥ç”¨**å¸¦èŠ±æ ‘ç®—æ³•**ï¼ˆblossom alogrithmï¼‰è§£å†³ã€‚

æ—¶é—´å¤æ‚åº¦åœ¨$O(NM) åˆ° O(N^3)$å·¦å³

```cpp
//ã€æ¨¡æ¿ã€‘ä¸€èˆ¬å›¾æœ€å¤§åŒ¹é… https://www.luogu.com.cn/problem/P6113
//æ¨¡ç‰ˆæ¥è‡ªsse
#include <bits/stdc++.h>
using namespace std;

namespace blossom_tree {
    const int N = 1003;
    vector<int> e[N];
    int lk[N],rt[N],f[N],dfn[N],typ[N],q[N];
    int id,h,t,n;
    int lca(int u,int v) {
        ++id;
        while(1) {
            if(u){
                if (dfn[u]==id) return u;
                dfn[u]=id;u=rt[f[lk[u]]];
            }
            swap(u,v);
        }
    }
    void blm(int u,int v,int a) {
        while (rt[u]!=a) {
            f[u]=v;
            v=lk[u];
            if (typ[v]==1) typ[q[++t]=v]=0;
            rt[u]=rt[v]=a;
            u=f[v];
        }
    }
    void aug(int u) {
        while (u) {
            int v=lk[f[u]];
            lk[lk[u]=f[u]]=u;
            u=v;
        }
    }
    void bfs(int root) {
        memset(typ+1,-1,n*sizeof typ[0]);
        iota(rt+1,rt+n+1,1);
        typ[q[h=t=1]=root]=0;
        while (h<=t) {
            int u=q[h++];
            for (int v:e[u]) {
                if (typ[v]==-1) {
                    typ[v]=1;f[v]=u;
                    if (!lk[v]) return aug(v);
                    typ[q[++t]=lk[v]]=0;
                } else if (!typ[v]&&rt[u]!=rt[v]) {
                    int a=lca(rt[u],rt[v]);
                    blm(v,u,a);blm(u,v,a);
                }
            } 
        }
    }
    int max_general_match(int N,vector<pair<int,int>> edges){
        n=N;id=0;
        memset(f+1,0,n*sizeof f[0]);
        memset(dfn+1,0,n*sizeof dfn[0]);
        memset(lk+1,0,n*sizeof lk[0]);
        for (int i=1;i<=n;i++) e[i].clear();
        mt19937_64 rnd(114514);
		shuffle(edges.begin(),edges.end(),rnd);
        for (auto [u,v]:edges) {
            e[u].push_back(v),e[v].push_back(u);
            if (!(lk[u]||lk[v])) lk[u]=v,lk[v]=u;
        }
        int res = 0;
        for (int i=1;i<=n;i++) if (!lk[i]) bfs(i);
        for (int i=1;i<=n;i++) res += !!lk[i];
        return res/2;
    }
}
using blossom_tree::max_general_match,blossom_tree::lk;

int main(){
	int n,m; std::cin >> n >> m;
	std::vector<std::pair<int,int>>e;
	while(m--){
		int a,b;std::cin >> a >> b;
		e.push_back({a,b});
	}

	std::cout << max_general_match(n,e) << '\n';//N:1_idx;  edges:0_idx

	std::vector<int>ans(n+1);
	for(int i = 1;i <= n;i++){//if(lk[i]) i <-> lk[i]
		ans[i] = lk[i];
	}

	for(int i = 1;i <= n;i++){
		std::cout << ans[i] << ' ';//if(ans[i] == 0) not_match
	}
}
```



### ä¸€èˆ¬å›¾æœ€å¤§æƒåŒ¹é…

æ—¶é—´å¤æ‚åº¦$O(N^3)$

```cpp
//https://www.luogu.com.cn/problem/P6699
#include <bits/stdc++.h>
using namespace std;

namespace Graph {
    const int N = 403 * 2; //ä¸¤å€ç‚¹æ•°
    typedef int T; //æƒå€¼å¤§å°
    const T inf = numeric_limits<int>::max() >> 1;
    struct Q { int u, v; T w; } e[N][N];
    T lab[N];
    int n, m = 0, id, h, t, lk[N], sl[N], st[N], f[N], b[N][N], s[N], ed[N], q[N];
    vector<int> p[N];
#define dvd(x) (lab[x.u] + lab[x.v] - e[x.u][x.v].w * 2)
#define FOR(i, b) for (int i = 1; i <= (int)(b); i++)
#define ALL(x) (x).begin(), (x).end()
#define ms(x, i) memset(x + 1, i, m * sizeof x[0])
    void upd(int u, int v) {
        if (!sl[v] || dvd(e[u][v]) < dvd(e[sl[v]][v])) {
            sl[v] = u;
        }
    }
    void ss(int v) {
        sl[v] = 0;
        FOR(u, n) {
            if (e[u][v].w > 0 && st[u] != v && !s[st[u]]) {
                upd(u, v);
            }
        }
    }
    void ins(int u) {
        if (u <= n) { q[++t] = u; }
        else {
            for (int v : p[u]) ins(v);
        }
    }
    void mdf(int u, int w) {
        st[u] = w;
        if (u > n) {
            for (int v : p[u]) mdf(v, w);
        }
    }
    int gr(int u, int v) {
        v = find(ALL(p[u]), v) - p[u].begin();
        if (v & 1) {
            reverse(1 + ALL(p[u]));
            return (int)p[u].size() - v;
        }
        return v;
    }
    void stm(int u, int v) {
        lk[u] = e[u][v].v;
        if (u <= n) return;
        Q w = e[u][v];
        int x = b[u][w.u], y = gr(u, x);
        for (int i = 0; i < y; i++) {
            stm(p[u][i], p[u][i ^ 1]);
        }
        stm(x, v);
        rotate(p[u].begin(), y + ALL(p[u]));
    }
    void aug(int u, int v) {
        int w = st[lk[u]];
        stm(u, v);
        if (!w) return;
        stm(w, st[f[w]]), aug(st[f[w]], w);
    }
    int lca(int u, int v) {
        for (++id; u | v; swap(u, v)) {
            if (!u) continue;
            if (ed[u] == id) return u;
            ed[u] = id;
            if (u = st[lk[u]]) u = st[f[u]];
        }
        return 0;
    }
    void add(int u, int a, int v) {
        int x = n + 1, i, j;
        while (x <= m && st[x]) ++x;
        if (x > m) ++m;
        lab[x] = s[x] = st[x] = 0;
        lk[x] = lk[a];
        p[x].clear();
        p[x].push_back(a);
        for (i = u; i != a; i = st[f[j]]) {
            p[x].push_back(i);
            p[x].push_back(j = st[lk[i]]);
            ins(j);
        }
        reverse(1 + ALL(p[x]));
        for (i = v; i != a; i = st[f[j]]) {
            p[x].push_back(i);
            p[x].push_back(j = st[lk[i]]);
            ins(j);
        }
        mdf(x, x);
        FOR(i, m) {
            e[x][i].w = e[i][x].w = 0;
        }
        memset(b[x] + 1, 0, n * sizeof b[0][0]);
        for (int u : p[x]) {
            FOR(v, m) {
                if (!e[x][v].w || dvd(e[u][v]) < dvd(e[x][v])) {
                    e[x][v] = e[u][v], e[v][x] = e[v][u];
                }
            }
            FOR(v, n) {
                if (b[u][v]) { b[x][v] = u; }
            }
        }
        ss(x);
    }
    void ex(int u) {
        for (int x : p[u]) mdf(x, x);
        int a = b[u][e[u][f[u]].u], r = gr(u, a);
        for (int i = 0; i < r; i += 2) {
            int x = p[u][i], y = p[u][i + 1];
            f[x] = e[y][x].u;
            s[x] = 1;
            s[y] = sl[x] = 0;
            ss(y), ins(y);
        }
        s[a] = 1, f[a] = f[u];
        for (int i = r + 1; i < p[u].size(); i++) {
            s[p[u][i]] = -1;
            ss(p[u][i]);
        }
        st[u] = 0;
    }
    bool on(const Q &e) {
        int u = st[e.u], v = st[e.v];
        if (s[v] == -1) {
            f[v] = e.u, s[v] = 1;
            int a = st[lk[v]];
            sl[v] = sl[a] = s[a] = 0;
            ins(a);
        } else if (!s[v]) {
            int a = lca(u, v);
            if (!a) {
                return aug(u, v), aug(v, u), 1;
            } else {
                add(u, a, v);
            }
        }
        return 0;
    }
    bool bfs() {
        ms(s, -1), ms(sl, 0);
        h = 1, t = 0;
        FOR(i, m) {
            if (st[i] == i && !lk[i]) {
                f[i] = s[i] = 0;
                ins(i);
            }
        }
        if (h > t) return 0;
        while (1) {
            while (h <= t) {
                int u = q[h++];
                if (s[st[u]] == 1) continue;
                FOR(v, n) {
                    if (e[u][v].w > 0 && st[u] != st[v]) {
                        if (dvd(e[u][v])) upd(u, st[v]);
                        else if (on(e[u][v])) return 1;
                    }
                }
            }
            T x = inf;
            for (int i = n + 1; i <= m; i++) {
                if (st[i] == i && s[i] == 1) {
                    x = min(x, lab[i] >> 1);
                }
            }
            FOR(i, m) {
                if (st[i] == i && sl[i] && s[i] != 1) {
                    x = min(x, dvd(e[sl[i]][i]) >> s[i] + 1);
                }
            }
            FOR(i, n) {
                if (~s[st[i]]) {
                    if ((lab[i] += (s[st[i]] * 2 - 1) * x) <= 0) return 0;
                }
            }
            for (int i = n + 1; i <= m; i++) {
                if (st[i] == i && ~s[st[i]]) {
                    lab[i] += (2 - s[st[i]] * 4) * x;
                }
            }
            h = 1, t = 0;
            FOR(i, m) {
                if (st[i] == i && sl[i] && st[sl[i]] != i && !dvd(e[sl[i]][i]) && on(e[sl[i]][i])) {
                    return 1;
                }
            }
            for (int i = n + 1; i <= m; i++) {
                if (st[i] == i && s[i] == 1 && !lab[i]) ex(i);
            }
        }
        return 0;
    }
    template<typename TT> long long work(int N, const vector<tuple<int, int, TT>> &edges) {
        ms(ed, 0), ms(lk, 0);
        n = m = N; id = 0;
        iota(st + 1, st + n + 1, 1);
        T wm = 0; long long r = 0;
        FOR(i, n) FOR(j, n) {
            e[i][j] = {i, j, 0};
        }
        for (auto [u, v, w] : edges) {
            wm = max(wm, e[v][u].w = e[u][v].w = max(e[u][v].w, (T)w));
        }
        FOR(i, n) { p[i].clear(); }
        FOR(i, n) FOR(j, n) {
            b[i][j] = i * (i == j);
        }
        fill_n(lab + 1, n, wm);
        while (bfs()) {};
        FOR(i, n) if (lk[i]) {
            r += e[i][lk[i]].w;
        }
        return r / 2;
    }
    auto match() {
        vector<array<int, 2>> ans;
        FOR(i, n) if (lk[i]) {
            ans.push_back({i, lk[i]});
        }
        return ans;
    }
} // namespace Graph
using Graph::work, Graph::match;

void soviet(){
	int n,m; std::cin >> n >> m;
	std::vector<std::tuple<int,int,long long>>edges(m);
	for(auto &[a,b,c]:edges){
		std::cin >> a >> b >> c;
	}
	std::cout << work(n,edges) << '\n';//n:1_idx;  edges:0_idx

	std::vector<int>ans(n+1);
	auto v = match();

	for(auto [x,y]:v){// x <-> y
		ans[x] = y;
	}
	for(int i = 1;i <= n;i++){
		std::cout << ans[i] << ' ';//if(ans[i] = 0) not_match
	}
}

int main() {
	int M_T = 1;std::ios::sync_with_stdio(false),std::cin.tie(0);
//	std::cin >> M_T;
	while(M_T--){ soviet(); }
	return 0;
}
```





## åŸºç¯æ ‘

nä¸ªç‚¹næ¡è¾¹ç»„æˆçš„æ— å‘è¿é€šå›¾ã€‚è‹¥ä¸ä¿è¯è¿é€šï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å†…/å¤–å‘æ ‘/æ£®æ—ã€‚

**æ‰¾ç¯**

å¯ä»¥ä»¥æ‹“æ‰‘æ’åºæˆ–è€…dfså®ç°ï¼š [P8655 å‘ç°ç¯ - æ´›è°·](https://www.luogu.com.cn/problem/P8655)

**åŸºç¯æ ‘çš„ç›´å¾„**

ç›´å¾„æœ‰ä¸¤ç§æƒ…å†µï¼ŒäºŒè€…å–æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆï¼š

1. ç›´å¾„å¤„äºä»¥ç¯ä¸ŠæŸä¸€ç‚¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œä¸”ä¸ç»è¿‡ç¯è¾¹çš„å­æ ‘ä¸­ã€‚å¯¹æ¯ä¸€é¢—å­æ ‘è¿›è¡Œæ ‘å½¢DPæ±‚ç›´å¾„ï¼Œå–æœ€å¤§å€¼ã€‚
2. ç»è¿‡ç¯è¾¹ï¼Œé“¾æ¥ä¸¤ä¸ªæ ¹èŠ‚ç‚¹x,yçš„å­æ ‘ã€‚ans = max{d1[x]+d1[y]+dis(x,y)}ã€‚d1[i]è¡¨å¼ä»¥iä¸ºæ ¹èŠ‚ç‚¹å‘ä¸‹èƒ½è¾¾åˆ°çš„æœ€å¤§è·ç¦»ï¼Œdis(i,j)è¡¨ç¤ºç¯ä¸Šä¸¤ç‚¹ä¹‹é—´çš„æœ€è¿œè·ç¦»ï¼Œæ–­é“¾æˆç¯ï¼Œå¤åˆ¶æ‹¼æ¥ï¼Œå†ç”¨å‰ç¼€å’Œ+å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å³å¯O(N)æ±‚å¾—ç­”æ¡ˆã€‚



**ä¸€èˆ¬å¤„ç†æ–¹æ³•**

1. æ‰¾åˆ°å”¯ä¸€çš„ç¯ï¼›
2. å¯¹ç¯ä¹‹å¤–çš„éƒ¨åˆ†æŒ‰ç…§è‹¥å¹²æ£µæ ‘å¤„ç†ï¼›
3. è€ƒè™‘ä¸ç¯ä¸€èµ·è®¡ç®—ã€‚





## è´Ÿç¯

### SPFAåˆ¤è´Ÿç¯

å¦‚æœæŸç‚¹çš„æœ€çŸ­è·¯æ‰€åŒ…å«çš„è¾¹æ•°å¤§äºç­‰äºnï¼Œåˆ™è¯´æ˜å­˜åœ¨è´Ÿç¯

```cpp
//https://www.acwing.com/activity/content/problem/content/921/
//åˆ¤æ–­æœ‰å‘å›¾ä¸­æ˜¯å¦å­˜åœ¨è´Ÿç¯
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 100005;
int n, m;
queue<int>q;
int h[N], e[N], ne[N], idx, w[N];
int dist[N], cnt[N];//distè®°å½•1~kæœ€çŸ­è·ç¦»ï¼Œcntè®°å½•1~kè¾¹çš„æ•°é‡
bool st[N];

void add(int a, int b, int c) {
	w[idx] = c, e[idx] = b, ne[idx] = h[a], h[a] = idx++;
}

int SPFA() {
	//åˆ¤è´Ÿç¯ä¸éœ€è¦åˆå§‹åŒ–dist,å¦‚æœå­˜åœ¨è´Ÿç¯,é‚£ä¹ˆdistä¸ç®¡åˆå§‹åŒ–ä¸ºå¤šå°‘,éƒ½ä¼šè¢«æ›´æ–°
    //å°†æ‰€æœ‰ç‚¹è¿›å…¥é˜Ÿåˆ—ã€‚å¦‚æœåªåŠ æºç‚¹å¯èƒ½åˆ°ä¸äº†æœ‰è´Ÿç¯çš„ç‚¹,åªèƒ½è¯´æ˜ä»æºç‚¹å‡ºå‘ä¸èƒ½æŠµè¾¾è´Ÿç¯,è€Œä¸èƒ½è¯´æ˜å›¾ä¸Šä¸å­˜åœ¨è´Ÿç¯ã€‚
	for (int i = 1; i <= n;i++) { 
		st[i] = 1;
		q.push(i);
	}

	while (q.size()){
		int t = q.front();
		q.pop();
		st[t] = 0;
		for (int i = h[t]; i != -1;i = ne[i]) {
			int k = e[i];
			if (dist[k] > dist[t] + w[i]) {
				dist[k] = dist[t] + w[i];
				cnt[k] = cnt[t] + 1;//æ›´æ–°
				if (cnt[k] >= n) return 1;//å¦‚æœåˆ°kç»è¿‡çš„è¾¹çš„æ•°é‡>=æ€»ç‚¹æ•°è¯´æ˜å­˜åœ¨è´Ÿç¯
				if (!st[k]) {
					q.push(k);
					st[k] = 1;
				}
			}
		}
	}
	return 0;
}

int main() {
	memset(h, -1, sizeof h);
	cin >> n >> m;
	while (m--){
		int a, b, c; cin >> a >> b >> c;
		add(a, b, c);
	}
	if(SPFA()) puts("Yes");
	else puts("No");
}
```





### bellman-fordåˆ¤è´Ÿç¯

bellman-fordåˆ¤è´Ÿç¯ï¼Œæ®bellman-fordçš„æ€§è´¨æœ€åå¾—å‡ºçš„æ˜¯é€šè¿‡ä¸è¶…è¿‡n-1æ¡è¾¹çš„ä»èµ·ç‚¹åˆ°å…¶ä»–ç‚¹çš„æœ€çŸ­è·ç¦»

ä½†æ˜¯å¦‚æœåœ¨n-1æ¬¡å¾ªç¯ä¹‹åä»ç„¶å­˜åœ¨è¾¹å¯ä»¥è¢«æ¾å¼›ï¼Œé‚£ä¹ˆå°±å­˜åœ¨è´Ÿç¯ï¼ˆå› ä¸ºå¦‚æœæ²¡æœ‰è´Ÿç¯n-1æ¬¡å°±å·²ç»ç¡®å®šäº†æœ€çŸ­è·ç¦»ï¼Œå…·ä½“å¯å‚è€ƒbellman-fordè¯æ˜ï¼Œå·²ç»æ˜¯æœ€çŸ­è·ç¦»äº†è¿˜èƒ½è¢«æ¾å¼›ï¼Œå¿…ç„¶æ˜¯å­˜åœ¨è´Ÿç¯ï¼‰

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 2003,M = 10004;
int n,m;
int dist[N];

struct Edge{
	int a,b,c;
}e[M];

bool bellman(){
    memset(dist,0x3f,sizeof dist);          
    dist[1] = 0;

	for(int i = 1;i <= n-1;i++){
		for(int j = 1;j <= m;j++){
			auto &[a,b,c] = e[j];
			dist[b] = min(dist[b],dist[a] + c);
		}
	}
	for(int i = 0;i <= m;i++){//å¦‚æœåœ¨n-1æ¬¡å¾ªç¯ä¹‹åä»ç„¶å­˜åœ¨è¾¹å¯ä»¥è¢«æ¾å¼›ï¼Œé‚£ä¹ˆå°±å­˜åœ¨è´Ÿç¯
		auto &[a,b,c] = e[i];
		if(dist[b] > dist[a] + c) return 1;
	}
    return 0;
}
int main(){
    cin >> n >> m;
	for(int i = 1;i <= m;i++){
		cin >> e[i].a >> e[i].b >> e[i].c;
	}
    if(bellman()) cout << "Yes";
    else cout << "No";
}
```





## å·®åˆ†çº¦æŸ

æ±‚è§£å·®åˆ†çº¦æŸç³»ç»Ÿï¼Œæœ‰ $m$ æ¡çº¦æŸæ¡ä»¶ï¼Œæ¯æ¡éƒ½ä¸ºå½¢å¦‚ $x_a-x_b\geq c_k$ï¼Œ$x_a-x_b\leq c_k$ æˆ– $x_a=x_b$ çš„å½¢å¼ï¼Œåˆ¤æ–­è¯¥å·®åˆ†çº¦æŸç³»ç»Ÿæœ‰æ²¡æœ‰è§£ã€‚

|        é¢˜æ„        |                    è½¬åŒ–                     |             è¿è¾¹              |
| :----------------: | :-----------------------------------------: | :---------------------------: |
| $x_a - x_b \geq c$ |             $x_b - x_a \leq -c$             |       `add(a, b, -c);`        |
| $x_a - x_b \leq c$ |             $x_a - x_b \leq c$              |        `add(b, a, c);`        |
|    $x_a = x_b$     | $x_a - x_b \leq 0, \space x_b - x_a \leq 0$ | `add(b, a, 0), add(a, b, 0);` |

åˆ¤æ–­è´Ÿç¯ï¼Œå¦‚æœå­˜åœ¨è´Ÿç¯ï¼Œåˆ™æ— è§£ã€‚

å»ºç«‹ä¸€ä¸ª**è™šæ‹Ÿçš„æºç‚¹**0ï¼Œè®¾ $dist[0]=0$ å¹¶å‘æ¯ä¸€ä¸ªç‚¹è¿ä¸€æ¡æƒé‡ä¸º $0$ è¾¹ï¼Œè·‘å•æºæœ€çŸ­è·¯ï¼Œè‹¥å›¾ä¸­å­˜åœ¨è´Ÿç¯ï¼Œåˆ™ç»™å®šçš„å·®åˆ†çº¦æŸç³»ç»Ÿæ— è§£ï¼Œå¦åˆ™ï¼Œ$x_i=dist[i]$ ä¸ºè¯¥å·®åˆ†çº¦æŸç³»ç»Ÿçš„ä¸€ç»„è§£ã€‚
æ³¨æ„åˆ°ï¼Œå¦‚æœ $\{x_1,x_2,\dots,x_n\}$ æ˜¯è¯¥å·®åˆ†çº¦æŸç³»ç»Ÿçš„ä¸€ç»„è§£ï¼Œé‚£ä¹ˆå¯¹äºä»»æ„çš„å¸¸æ•° $d$ï¼Œ$\{x_1+d,x_2+d,\dots,x_n+d\}$ æ˜¾ç„¶ä¹Ÿæ˜¯è¯¥å·®åˆ†çº¦æŸç³»ç»Ÿçš„ä¸€ç»„è§£ï¼Œå› ä¸ºè¿™æ ·åšå·®å $d$ åˆšå¥½è¢«æ¶ˆæ‰ã€‚

ä¸€èˆ¬ä½¿ç”¨ SPFA åˆ¤æ–­å›¾ä¸­æ˜¯å¦å­˜åœ¨è´Ÿç¯ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦ä¸º $O(nm)$ã€‚

```cpp
//å° K çš„å†œåœº https://www.luogu.com.cn/problem/P1993
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 20004;
int n,m;
int h[N],e[N],ne[N],w[N],idx;
int dist[N],cnt[N];
bool st[N];

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool spfa(){
	std::memset(dist,0x3f,sizeof dist);
	queue<int>q;
	dist[0] = 0;
	q.push(0);
	while(q.size()){
		int t = q.front();
		q.pop();
		st[t] = 0;
		for(int i = h[t];~i;i = ne[i]){
			int k = e[i];
			if(dist[k] > dist[t] + w[i]){
				dist[k] = dist[t] + w[i];
				cnt[k] = cnt[t] + 1;
				if(cnt[k] >= n+1) return 1;//(åŠ å…¥æºç‚¹0åæœ‰n+1ä¸ªç‚¹)
				if(!st[k]){
					q.push(k);
					st[k] = 1;
				}
			}
		}
	}
	return 0;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int op,a,b,c;cin >> op;
		if(op == 1){
			cin >> a >> b >> c;
			add(a,b,-c);
		}
		else if(op == 2){
			cin >> a >> b >> c;
			add(b,a,c);
		}
		else{
			cin >> a >> b;
			add(a,b,0);add(b,a,0);
		}
	}
	for(int i = 1;i <= n;i++) add(0,i,0);//å»ºç«‹è¶…çº§æºç‚¹0,è·‘å•æºspfa
	//ä¹Ÿå¯ä»¥ä¸å»ºæºç‚¹,ç›´æ¥å°†æ‰€æœ‰ç»“ç‚¹å…¥é˜Ÿè·‘å…¨æºspfa

	if(spfa()) cout << "No";//è¯ºå­˜åœ¨è´Ÿç¯,åˆ™æ— è§£
	else cout << "Yes";//å¦åˆ™dist[]ä¸ºä¸€ç»„è§£
}
```





## è¿é€šæ€§ç›¸å…³



### å‰²ç‚¹å’Œå‰²è¾¹

dfn[x]ä¸ºæ¯ä¸ªç‚¹dfsç¬¬ä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´æˆ³

low[x]ä¸ºä»¥ä¸‹èŠ‚ç‚¹çš„æ—¶é—´æˆ³çš„æœ€å°å€¼
1.xçš„å­æ ‘ä¸­çš„èŠ‚ç‚¹
2.é€šè¿‡ä¸€æ¡ä¸åœ¨æœç´¢æ ‘ä¸Šçš„è¾¹ï¼Œèƒ½å¤Ÿåˆ°è¾¾xçš„å­æ ‘çš„èŠ‚ç‚¹

ä»æ ¹å¼€å§‹çš„ä¸€æ¡è·¯å¾„ä¸Šçš„ dfn ä¸¥æ ¼é€’å¢ï¼Œlow éä¸¥æ ¼é€’å¢

```cpp
//Tarjan
void Tarjan(int u) {
  low[u] = dfn[u] = ++dn;                 // low åˆå§‹åŒ–ä¸ºå½“å‰èŠ‚ç‚¹ dfn
  for (int v : G[u]) {                    // éå† u çš„ç›¸é‚»èŠ‚ç‚¹
    if (!dfn[v]) {                        // å¦‚æœæœªè®¿é—®è¿‡
      Tarjan(v);                          // é€’å½’
      low[u] = std::min(low[u], low[v]);  // æœªè®¿é—®çš„å’Œ low å– min
    } else
      low[u] = std::min(low[u], dfn[v]);  // å·²è®¿é—®çš„å’Œ dfn å– min
  }
}
```



**å‰²ç‚¹**

å¯¹äºä¸€ä¸ªæ— å‘å›¾ï¼Œå¦‚æœæŠŠä¸€ä¸ªç‚¹åˆ é™¤åè¿™ä¸ªå›¾çš„æå¤§è¿é€šåˆ†é‡æ•°å¢åŠ äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å°±æ˜¯è¿™ä¸ªå›¾çš„å‰²ç‚¹ï¼ˆåˆç§°å‰²é¡¶ï¼‰ã€‚

è¯ºxä¸æ˜¯æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹root(dfsçš„èµ·ç‚¹)ï¼Œåˆ™xæ˜¯å‰²ç‚¹å½“ä¸”ä»…å½“æœç´¢æ ‘ä¸Šå­˜åœ¨ä¸€ä¸ªxçš„å­èŠ‚ç‚¹æ»¡è¶³`dfn[x] <= low[y]`
è¯ºxæ˜¯æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œåˆ™xæ˜¯å‰²ç‚¹å½“ä¸”ä»…å½“æœç´¢æ ‘ä¸Šå­˜åœ¨è‡³å°‘ä¸¤ä¸ªå­èŠ‚ç‚¹`y1,y2`æ»¡è¶³ä¸Šå¼

```cpp
//P3388 ã€æ¨¡æ¿ã€‘å‰²ç‚¹ï¼ˆå‰²é¡¶ï¼‰ https://www.luogu.com.cn/problem/P3388
#include <iostream>
#include <cstring>
using namespace std;
const int N = 200005;
int n,m;
int h[N],e[N],ne[N],idx;
int dfn[N],low[N],cut[N],dn,root;

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void tarjan(int x){
	dfn[x] = low[x] = ++dn;
	int son = 0;
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!dfn[y]){
			tarjan(y);
			son++;
			low[x] = min(low[x],low[y]);
			if(x != root && dfn[x] <= low[y]) cut[x] = 1;
		}
		else low[x] = min(low[x],dfn[y]);
	}
	if(x == root && son >= 2) cut[x] = 1;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);
	}
	int cnt = 0;
	for(int i = 1;i <= n;i++){
		if(!dfn[i]) root = i,tarjan(i);
		if(cut[i]) cnt++;
	}
	cout << cnt << endl;
	for(int i = 1;i <= n;i++){
		if(cut[i]) cout << i << ' ';
	}
}
```





**å‰²è¾¹**

å¯¹äºä¸€ä¸ªæ— å‘å›¾ï¼Œå¦‚æœåˆ æ‰ä¸€æ¡è¾¹åå›¾ä¸­çš„è¿é€šåˆ†é‡æ•°å¢åŠ äº†ï¼Œåˆ™ç§°è¿™æ¡è¾¹ä¸ºæ¡¥æˆ–è€…å‰²è¾¹ã€‚

æ— å‘è¾¹(x,y)æ˜¯å‰²è¾¹ï¼Œå½“ä¸”ä»…å½“æœç´¢æ ‘ä¸Šå­˜åœ¨xçš„ä¸€ä¸ªå­èŠ‚ç‚¹yæ»¡è¶³`dfn[x] < low[y]`

```cpp
//https://www.luogu.com.cn/problem/U63110
//å¯å¤„ç†é‡è¾¹
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100005;
int n,m;
int h[N],e[N],ne[N],idx;
int dfn[N],low[N],cut[N],dn;

void add(int a,int b){//(0 1),(2 3),(4 5)...(x y)  xå’Œx^1ä¸ºä¸¤æ¡æ–¹å‘ç›¸åçš„è¾¹
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void tarjan(int x,int edge){
	dfn[x] = low[x] = ++dn;
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!dfn[y]){
			tarjan(y,i);
			low[x] = min(low[x],low[y]);
			if(dfn[x] < low[y]){
				cut[i] = cut[i^1] = 1;
			}
		}
		else if(i != (edge^1)) low[x] = min(low[x],dfn[y]);
	}
}

void sol(){
	memset(h,-1,sizeof h);
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);//æ­£åè¾¹ä¸€å®šè¦åŒæ—¶æ·»åŠ 
	}
	for(int i = 1;i <= n;i++){
		if(!dfn[i]) tarjan(i,0);
	}
	int cnt = 0;
	for(int i = 0;i < idx;i+=2){
		if(cut[i]) cnt++;//e[i]åˆ°e[i^1]ä¸ºä¸€æ¡å‰²è¾¹
	}
	cout << cnt << '\n';
}

int main(){
	while(cin >> n >> m,n && m){

		for(int i = 1;i <= n;i++) dfn[i] = low[i] = 0;
		for(int i = 0;i < idx;i++) cut[i] = 0;//æ³¨æ„cutæ¸…ç©ºèŒƒå›´
		idx = dn = 0;
		sol();
	}
}
```





### åŒè¿é€šåˆ†é‡



åœ¨ä¸€å¼ è¿é€šçš„æ— å‘å›¾ä¸­ï¼Œå¯¹äºä¸¤ä¸ªç‚¹ $u$ å’Œ $v$ï¼Œå¦‚æœæ— è®ºåˆ å»å“ªæ¡è¾¹ï¼ˆåªèƒ½åˆ å»ä¸€æ¡ï¼‰éƒ½ä¸èƒ½ä½¿å®ƒä»¬ä¸è¿é€šï¼Œæˆ‘ä»¬å°±è¯´ $u$ å’Œ $v$  **è¾¹åŒè¿é€š**ã€‚

åœ¨ä¸€å¼ è¿é€šçš„æ— å‘å›¾ä¸­ï¼Œå¯¹äºä¸¤ä¸ªç‚¹ $u$ å’Œ $v$ï¼Œå¦‚æœæ— è®ºåˆ å»å“ªä¸ªç‚¹ï¼ˆåªèƒ½åˆ å»ä¸€ä¸ªï¼Œä¸”ä¸èƒ½åˆ  $u$ æˆ– $v$ è‡ªå·±ï¼‰éƒ½ä¸èƒ½ä½¿å®ƒä»¬ä¸è¿é€šï¼Œæˆ‘ä»¬å°±è¯´ $u$ å’Œ $v$  **ç‚¹åŒè¿é€š**ã€‚

è¾¹åŒè¿é€šå…·æœ‰ä¼ é€’æ€§ï¼Œå³ï¼Œè‹¥ $x,y$ è¾¹åŒè¿é€šï¼Œ$y,z$ è¾¹åŒè¿é€šï¼Œåˆ™ $x,z$ è¾¹åŒè¿é€šã€‚

ç‚¹åŒè¿é€š**ä¸**å…·æœ‰ä¼ é€’æ€§ï¼Œåä¾‹å¦‚ä¸‹å›¾ï¼Œ$A,B$ ç‚¹åŒè¿é€šï¼Œ$B,C$ ç‚¹åŒè¿é€šï¼Œè€Œ $A,C$ **ä¸**ç‚¹åŒè¿é€šã€‚

<img src="https://oi-wiki.org/graph/images/bcc-0.svg" alt="bcc-counterexample.png" style="zoom:50%;" /> 

å¯¹äºä¸€ä¸ªæ— å‘å›¾ä¸­çš„ **æå¤§** è¾¹åŒè¿é€šçš„å­å›¾ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå­å›¾ä¸ºä¸€ä¸ª **è¾¹åŒè¿é€šåˆ†é‡**ã€‚

å¯¹äºä¸€ä¸ªæ— å‘å›¾ä¸­çš„ **æå¤§** ç‚¹åŒè¿é€šçš„å­å›¾ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå­å›¾ä¸ºä¸€ä¸ª **ç‚¹åŒè¿é€šåˆ†é‡**ã€‚





#### è¾¹åŒè¿é€šåˆ†é‡

ä¸å­˜åœ¨å‰²è¾¹ã€‚

e-DCCçš„æ±‚æ³•æ¯”è¾ƒç®€å•ï¼Œå…ˆæ±‚å‡º**æ— å‘å›¾**ä¸­çš„æ‰€æœ‰å‰²è¾¹ï¼ŒæŠŠå‰²è¾¹åˆ é™¤åï¼Œå‰©ä¸‹çš„å›¾ä¼šåˆ†æˆè‹¥å¹²ä¸ªè¿é€šå—ï¼Œæ¯ä¸€ä¸ªè¿é€šå—å°±æ˜¯ä¸€ä¸ªâ€œè¾¹åŒè¿é€šåˆ†é‡â€ã€‚

```cpp
//https://www.luogu.com.cn/problem/P8436
#include <iostream>
#include <cstring>
#include <vector>
using namespace std;
const int N = 500005,M = 4000006;
int n,m;
int h[N],e[M],ne[M],idx;
int dfn[N],low[N],dn;
bool cut[M];
int cnt;
bool st[N];
vector<int>v[N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void tarjan(int x,int edge){
	dfn[x] = low[x] = ++dn;
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!dfn[y]){
			tarjan(y,i);
			low[x] = min(low[x],low[y]);
			if(dfn[x] < low[y]){
				cut[i] = cut[i^1] = 1;
			}
		}
		else if(i != (edge^1)) low[x] = min(low[x],dfn[y]);
	}
}

void dfs(int u){
	st[u] = 1;
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(st[k] || cut[i]) continue;
		dfs(k);
		v[cnt].emplace_back(k);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;scanf("%d %d",&a,&b);
		add(a,b);add(b,a);
	}

	for(int i = 1;i <= n;i++){
		if(!dfn[i]) tarjan(i,0);
	}

	for(int i = 1;i <= n;i++){
		if(!st[i]) {
			cnt++;
			v[cnt] = {i};
			dfs(i);
		}
	}
	cout << cnt << endl;
	for(int i = 1;i <= cnt;i++){
		printf("%d ",v[i].size());
		for(auto x:v[i]){
			printf("%d ",x);
		}
		printf("\n");
	}
}
```





#### ç‚¹åŒè¿é€šåˆ†é‡

ä¸å­˜åœ¨å‰²ç‚¹

ä¸€å¼ **æ— å‘å›¾**æ˜¯ç‚¹åŒè¿é€šå›¾ï¼Œå½“ä¸”ä»…å½“æ»¡è¶³ä¸‹åˆ—**ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€**ï¼š

1. å›¾çš„é¡¶ç‚¹æ•°ä¸è¶…è¿‡ 2ã€‚
2. å›¾ä¸­ä»»æ„ä¸¤ç‚¹éƒ½åŒæ—¶åŒ…å«åœ¨**è‡³å°‘ä¸€ä¸ª**ç®€å•ç¯ä¸­ã€‚å…¶ä¸­â€œç®€å•ç¯â€æŒ‡çš„æ˜¯ä¸è‡ªäº¤çš„ç¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸ç”»å‡ºçš„ç¯ã€‚

```cpp
//ã€æ¨¡æ¿ã€‘ç‚¹åŒè¿é€šåˆ†é‡ https://www.luogu.com.cn/problem/P8435
#include <iostream>
#include <cstring>
#include <vector>
#include <stack>
using namespace std;
const int N = 500005,M = 4000006;
int n,m;
int h[N],e[M],ne[M],idx;
int dfn[N],low[N],dn,root;
bool cut[N];
stack<int>sk;
vector<int>v[N];
int cnt;

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a]= idx++;
}

void tarjan(int x){
	dfn[x] = low[x] = ++dn;
	sk.emplace(x);
	if(x == root && h[x] == -1) {//å¤„ç†å­¤ç«‹ç‚¹
		v[++cnt].emplace_back(x);
		return;
	}
	int son = 0;
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!dfn[y]){
			tarjan(y);
			son++;
			low[x] = min(low[x],low[y]);
			if(dfn[x] <= low[y]){
				if(x != root || son >= 2) cut[x] = 1;
				v[++cnt].emplace_back(x);
				v[cnt].emplace_back(y);
				while(sk.top() != y){
					v[cnt].emplace_back(sk.top());
					sk.pop();
				}
				sk.pop();
			}
		}
		else low[x] = min(low[x],dfn[y]);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;scanf("%d %d",&a,&b);
		if(a == b) continue;
		add(a,b);add(b,a);
	}

	for(int i = 1;i <= n;i++){
		if(!dfn[i]) root = i,tarjan(i);
	}
	cout << cnt << endl;
	for(int i = 1;i <= cnt;i++){
		printf("%d ",v[i].size());
		for(auto x:v[i]){
			printf("%d ",x);
		}
		printf("\n");
	}
}
```





### å¼ºè¿é€šåˆ†é‡

[æœ‰å‘å›¾å¼ºè¿é€šåˆ†é‡çš„Tarjanç®—æ³• (byvoid.com)](https://byvoid.com/zhs/blog/scc-tarjan/)

ç»™ç‚¹ä¸€å¼ æœ‰å‘å›¾ï¼Œè¯ºå¯¹äºå›¾ä¸­**ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ç›¸äº’å¯è¾¾**ï¼Œåˆ™ç§°è¯¥æœ‰å‘å›¾æ˜¯â€œå¼ºè¿é€šå›¾â€
æœ‰å‘å›¾çš„æå¤§å¼ºè¿é€šå­å›¾è¢«ç§°ä¸ºâ€œå¼ºè¿é€šåˆ†é‡â€ï¼Œç®€è®°ä¸ºSCCã€‚

ä¸€ä¸ªç¯ä¸€å®šæ˜¯å¼ºè¿é€šå›¾ã€‚Tarjanç®—æ³•åŸºæœ¬æ€è·¯å°±æ˜¯å¯¹äºæ¯ä¸ªç‚¹ï¼Œå°½å¯èƒ½æ‰¾åˆ°ä¸å®ƒä¸€èµ·èƒ½æ„æˆç¯çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚æ¯ä¸ªå¼ºè¿é€šåˆ†é‡ä¸ºæœç´¢æ ‘ä¸­çš„ä¸€æ£µå­æ ‘ã€‚æœç´¢æ—¶ï¼ŒæŠŠå½“å‰æœç´¢æ ‘ä¸­æœªå¤„ç†çš„èŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªæ ˆï¼Œå›æº¯æ—¶å¯ä»¥åˆ¤æ–­æ ˆé¡¶åˆ°æ ˆä¸­çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºä¸€ä¸ªå¼ºè¿é€šåˆ†é‡



```cpp
//B3609 [å›¾è®ºä¸ä»£æ•°ç»“æ„ 701] å¼ºè¿é€šåˆ†é‡ https://www.luogu.com.cn/problem/B3609
#include <iostream>
#include <algorithm>
#include <cstring>
#include <stack>
#include <vector>
using namespace std;
const int N = 10004,M = 200005;
int n,m;

int h[N],e[M],ne[M],idx;
void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

vector<int>v[N];//ç¬¬iä¸ªå¼ºè¿é€šåˆ†é‡åŒ…å«çš„èŠ‚ç‚¹
int dfn[N],low[N],dn;
int id[N],idn;//èŠ‚ç‚¹iæ‰€åœ¨å¼ºè¿é€šåˆ†é‡scc
stack<int>sk;
void tarjan(int x){
	dfn[x] = low[x] = ++dn;
	sk.push(x);
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!dfn[y]){//å¦‚æœyæœªè¢«æœç´¢è¿‡,é€’å½’æœç´¢y
			tarjan(y);
			low[x] = min(low[x],low[y]);
		}
		else if(!id[y]){//å¦‚æœyè¢«æœç´¢è¿‡,ä¸”ä¸å±äºä»»ä½•ä¸€ä¸ªå¼ºè¿é€šåˆ†é‡(åˆ™yåœ¨æ ˆä¸­),ç”¨dfn[y]æ›´æ–°low[x]
			low[x] = min(low[x],dfn[y]);
		}
	}
	if(dfn[x] == low[x]){
		id[x] = ++idn;
		v[idn].emplace_back(x);
		while(sk.top() != x){
			id[sk.top()] = idn;
			v[idn].emplace_back(sk.top());
			sk.pop();
		}
		sk.pop();
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		add(a,b);
	}

	for(int i = 1;i <= n;i++){
		if(!dfn[i]) tarjan(i);
	}
    
	for(int i = 1;i <= idn;i++) sort(v[i].begin(),v[i].end());
	cout << idn << '\n';
    vector<int>st(n+1);
	for(int i = 1;i <= n;i++){
		if(st[i]) continue;
		for(auto x:v[id[i]]){
			cout << x << ' ';
			st[x] = 1;
		}
		cout << '\n';
	}
}
```



å¸¸åº”ç”¨ç¼©ç‚¹æ¶ˆé™¤ç¯çš„å½±å“ï¼Œè½¬åŒ–ä¸ºDAGå›¾è§£å†³

åœ¨ç¼©ç‚¹åçš„DAGä¸­ï¼Œå¼ºè¿é€šåˆ†é‡çš„æ ‡å·é¡ºåºæ˜¯å…¶æ‹“æ‰‘åºçš„é€†åºï¼Œå‡ºåº¦ä¸º0çš„ç‚¹æ ‡å·æ ‡å·è¶Šå°ï¼Œå³åå›¾çš„æ‹“æ‰‘åºã€‚





## 2-SAT

æœ‰Nä¸ªå˜é‡ï¼Œæ¯ä¸ªå˜é‡åªæœ‰ä¸¤ç§å¯èƒ½å¾—å–å€¼ã€‚å†ç»™ç‚¹Mä¸ªæ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶éƒ½æ˜¯å¯¹ä¸¤ä¸ªå˜é‡çš„å–å€¼é™åˆ¶ã€‚æ±‚æ˜¯å¦å­˜åœ¨å¯¹Nä¸ªå˜é‡çš„åˆæ³•èµ‹å€¼ï¼Œä½¿å¾—Mä¸ªæ¡ä»¶å‡å¾—åˆ°æ»¡è¶³ã€‚

è®¾ä¸€ä¸ªå˜é‡$A_i$çš„ä¸¤ç§å–å€¼åˆ†åˆ«æ˜¯$A_{i,0}$å’Œ$A_{i,1}$ ã€‚æ¯ä¸ªæ¡ä»¶å¯ä»¥è½¬åŒ–ä¸ºç»Ÿä¸€çš„å½¢å¼ï¼š
â€œè¯º$A_i$çš„èµ‹å€¼ä¸º$A_{i,p}$ï¼Œåˆ™$A_j$çš„èµ‹å€¼å¿…é¡»ä¸º$A_{j,q}$â€ï¼Œå…¶ä¸­$p,q\in\{0,1\}$ã€‚



2-SATé—®é¢˜çš„åˆ¤æ–­æ–¹æ³•å¦‚ä¸‹ï¼ˆæ—¶é—´å¤æ‚åº¦O(N+M)ï¼‰ï¼š

1. å»ºç«‹2Nä¸ªèŠ‚ç‚¹çš„æœ‰å‘å›¾ï¼Œæ¯ä¸ªå˜é‡$A_i$å¯¹åº”ä¸¤ä¸ªèŠ‚ç‚¹`i`å’Œ`i+n`ã€‚

2. è€ƒè™‘æ¯ä¸ªæ¡ä»¶ï¼Œå½¢å¦‚â€œè¯º$A_i$çš„èµ‹å€¼ä¸º$A_{i,p}$ï¼Œåˆ™$A_j$çš„èµ‹å€¼å¿…é¡»ä¸º$A_{j,q}$â€ï¼Œ$p,q\in\{0,1\}$ï¼Œä»`i+p*n`åˆ°`j+q*n`è¿ä¸€æ¡æœ‰å‘è¾¹ã€‚
   æ³¨æ„ä¸Šè¿°æ¡ä»¶è•´å«ç€å®ƒçš„é€†å¦å‘½é¢˜â€œè¯º$A_j$çš„èµ‹å€¼ä¸º$A_{j,1-q}$ï¼Œåˆ™$A_i$çš„èµ‹å€¼å¿…é¡»ä¸º$A_{i,1-p}$â€ã€‚å¦‚æœåœ¨ç»™ç‚¹çš„Mä¸ªé™åˆ¶æ¡ä»¶ä¸­ï¼ŒåŸå‘½é¢˜å’Œé€†å¦å‘½é¢˜ä¸ä¸€å®šæˆå¯¹å‡ºç°ï¼Œåº”è¯¥ä»`j+(1-q)*n`åˆ°`i+(1-p)*n`ä¹Ÿè¿ä¸€æ¡æœ‰å‘è¾¹ã€‚
3. ç”¨**Tarjan**ç®—æ³•æ±‚å‡ºæœ‰å‘å›¾ä¸­æ‰€æœ‰çš„å¼ºè¿é€šåˆ†é‡ã€‚
4. è¯ºå­˜åœ¨$i\in [1,n]$æ»¡è¶³`i`å’Œ`i+n`å±äºåŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ï¼Œåˆ™å‡ºç°äº†çŸ›ç›¾ï¼šè¯ºå˜é‡$A_i$èµ‹å€¼ä¸º$A_{i,p}$ï¼Œåˆ™å˜é‡$A_i$å¿…é¡»èµ‹å€¼ä¸º$A_{i,1-p}$ï¼Œè¯´æ˜é—®é¢˜æ— è§£ã€‚
5. è¯ºé—®é¢˜è¿˜è¦æ±‚å…·ä½“è§£ï¼ŒTarjanååŒä¸€å…ƒç´ æ‹†ç‚¹å¼ºè¿é€šåˆ†é‡ç¼–å·å°çš„ç‚¹å³ä¸ºåˆæ³•ç‚¹ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ æ‹†æˆçš„ä¸¤ä¸ªç‚¹ä¹‹é—´æ²¡æœ‰ä»»ä½•è·¯å¾„ç›¸è¿ï¼Œå³ä½¿æ˜¯æœ‰å‘è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸¤ç‚¹éƒ½å¯ä»¥æˆä¸ºåˆæ³•ç‚¹ï¼Œè¿™ä¸¤ç‚¹çš„åˆ†é‡ç¼–å·ä¸åŒï¼Œé€‰å°çš„å³å¯



[P4782 ã€æ¨¡æ¿ã€‘2-SAT - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P4782)

Nä¸ªå˜é‡ï¼ŒMä¸ªæ¡ä»¶ï¼š$ã€Œx_i ä¸º a æˆ– x_j ä¸º bã€(a,bâˆˆ{0,1})$
æ¡ä»¶å¯è½¬åŒ–ä¸º $è¯ºx_iä¸º1-aåˆ™x_jå¿…ä¸ºb$ ï¼Œ $è¯ºx_jä¸º1-båˆ™x_iå¿…ä¸ºa$ã€‚ä»¥æ­¤å»ºè¾¹

```cpp
#include <iostream>
#include <cstring>
#include <stack>
using namespace std;
const int N = 2000006;
int n,m;
int h[N],e[N],ne[N],idx;
int dfn[N],low[N],dn;
int id[N],idn;
stack<int>sk;

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void tarjan(int x){
	dfn[x] = low[x] = ++dn;
	sk.push(x);
	for(int i = h[x];~i;i = ne[i]){
		int y = e[i];
		if(!dfn[y]) {
			tarjan(y);
			low[x] = min(low[x],low[y]);
		}
		else if(!id[y]) low[x] = min(low[x],dfn[y]);
	}
	if(low[x] == dfn[x]){
		++idn;
		id[x] = idn;
		while(sk.top() != x){
			id[sk.top()] = idn;
			sk.pop();
		}
		sk.pop();
	}
}

int main(){
	memset(h,-1,sizeof h);
	scanf("%d %d",&n,&m);
	while(m--){
		int a,x,b,y;scanf("%d %d %d %d",&a,&x,&b,&y);
		if(x == 0 && y == 0){
			add(a+n,b);
			add(b+n,a);
		}
		if(x == 0 && y == 1){
			add(a+n,b+n);
			add(b,a);
		}
		if(x == 1 && y == 0){
			add(a,b);
			add(b+n,a+n);
		}
		if(x == 1 && y == 1){
			add(a,b+n);
			add(b,a+n);
		}
	}
	for(int i = 1;i <= n << 1;i++){//2nå±‚å¾ªç¯
		if(!dfn[i]) tarjan(i);
	}

	for(int i = 1;i <= n;i++){
		if(id[i] == id[i+n]) {//å±äºåŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡,æ— è§£
			cout << "IMPOSSIBLE";
			return 0;
		}
	}
	cout << "POSSIBLE\n";
	for(int i = 1;i <= n;i++){//è¿™é‡Œa[i]ä¸º0,a[i+n]ä¸º1,é€‰æ‰€åœ¨å¼ºè¿é€šåˆ†é‡å°çš„ä¸ºåˆæ³•è§£
		cout << (id[i] > id[i+n]) << ' ';
	}
}
```

[P10969 Katu Puzzle - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10969)





## ç½‘ç»œæµ

[ç½‘ç»œæµä¸çº¿æ€§è§„åˆ’24é¢˜ (luogu.com.cn)](https://www.luogu.com.cn/problem/list?tag=332)

ä¸€ä¸ªç½‘ç»œ`G=(V,E)`ï¼Œæ˜¯ä¸€å¼ æœ‰å‘å›¾ï¼Œå›¾ä¸­æ¯æ¡è¾¹ $(x,y)\in E$ éƒ½æœ‰ä¸€ä¸ªç»™å®šçš„æƒå€¼`c(x,y)` ï¼Œç§°ä¸ºè¾¹çš„**å®¹é‡**ï¼Œç‰¹åˆ«çš„è¯º$(x,y)\notin E$ï¼Œåˆ™`c(x,y) = 0` ã€‚å›¾ä¸­è¿˜æœ‰ä¸¤ä¸ªæŒ‡å®šçš„ç‰¹æ®ŠèŠ‚ç‚¹ **æºç‚¹S** å’Œ **æ±‡ç‚¹T**   (S != T)ã€‚

è®¾`f(x,y)` æ˜¯å®šä¹‰åœ¨èŠ‚ç‚¹äºŒå…ƒç»„$(x\in V,y \in V)$ä¸‰çš„å®æ•°å‡½æ•°ï¼Œä¸”æ»¡è¶³ï¼š

1. å®¹é‡é™åˆ¶ï¼š`f(x,y) <= c(x,y)` 
2. æ–œå¯¹ç§°ï¼š`f(x,y) = -f(y,x)`  
3. æµé‡å®ˆæ’ï¼šc  

`f()`ç§°ä¸ºç½‘ç»œçš„æµé‡å‡½æ•°ï¼Œå¯¹äº$(x,y)\in E$ï¼Œ`f(x,y)`ç§°ä¸ºè¾¹çš„**æµé‡**ï¼Œ`c(x,y) - f(x,y)`ç§°ä¸ºè¾¹çš„å‰©ä½™å®¹é‡

$\sum_{(S,v)\in E} f(S,v)$ï¼Œä¸ºæ•´ä¸ªç½‘ç»œçš„æµé‡(å…¶ä¸­Sè¡¨ç¤ºæºç‚¹)



### æœ€å¤§æµ

å¯¹äºä¸€ä¸ªç»™å®šçš„ç½‘ç»œï¼Œåˆæ³•æµå‡½æ•°`f()`æœ‰å¾ˆå¤šã€‚å…¶ä¸­ä½¿å¾—æ•´ä¸ªç½‘ç»œçš„æµé‡æœ€å¤§çš„æµå‡½æ•°è¢«ç§°ä¸ºç½‘ç»œçš„**æœ€å¤§æµ**ã€‚

å»ºè¾¹æ—¶åè¾¹å®¹é‡å…¨ä¸º0



#### Edmondsd-Karp

æ—¶é—´å¤æ‚åº¦$O(NM^2)$ï¼Œå®é™…æ•ˆç‡è¾ƒé«˜ï¼Œä¸€èˆ¬èƒ½å¤„ç†10^3 ~ 10^4 è§„æ¨¡çš„ç½‘ç»œ

æ¯æ¬¡bfséå†æ•´ä¸ª[æ®‹é‡ç½‘ç»œ](ç½‘ç»œä¸­æ‰€æœ‰èŠ‚ç‚¹ä»¥åŠå‰©ä½™å®¹é‡å¤§äº0çš„è¾¹æ„æˆçš„å­å›¾)ï¼Œæ‰¾å‡ºä»»æ„ä¸€æ¡å¢å¹¿è·¯ï¼ŒåŒæ—¶è®¡ç®—è·¯å¾„ä¸Šå„è¾¹å‰©ä½™æµé‡çš„æœ€å°å€¼minfï¼Œæ˜¾ç„¶å¯ä»¥è®©ä¸€è‚¡æµæ²¿ç€å¢å¹¿è·¯ä»Sæµå‘Tï¼Œç½‘ç»œçš„æµé‡å°±å¯ä»¥å¢åŠ minfã€‚ç›´åˆ°ç½‘ç»œä¸Šä¸å­˜åœ¨å¢å¹¿è·¯ä¸ºæ­¢ã€‚



```cpp
//æ¨¡ç‰ˆ https://www.luogu.com.cn/problem/P3376
#include <iostream>
#include <queue>
#include <cstring>
using namespace std;
const int N = 205,M = 10004;
const int INF = 0x3f3f3f3f;
int n,m,s,t;
long long maxflow;
int h[N],e[M],ne[M],idx;
long long w[M];//å®¹é‡
long long rest[N];//è®°å½•å„è¾¹å‰©ä½™å®¹é‡çš„æœ€å°å€¼
int pre[M];//è®°å½•ç‚¹xæ˜¯ä»å“ªæ¡è¾¹è¿‡æ¥çš„
bool vis[N];

void add(int x,int y,int z){
	w[idx] = z,e[idx] = y,ne[idx] = h[x],h[x] = idx++;
}

bool bfs(){
	memset(vis,0,sizeof vis);
	queue<int>q;
	q.push(s);
	vis[s] = 1;
	rest[s] = INF;
	while(q.size()){
		int x = q.front();
		q.pop();
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(vis[y] || w[i] == 0) continue;
			rest[y] = min(rest[x],w[i]);
			pre[y] = i;
			q.push(y);
			vis[y] = 1;
			if(y == t) return 1;
		}
	}
	return 0;
}

int update(){//å°†æµè¿‡çš„è·¯å¾„å®¹é‡å‡å°‘minf,åè¾¹å¢åŠ minf
	int x = t;
	while(x != s){
		int i = pre[x];
		w[i] -= rest[t];
		w[i^1] += rest[t];
		x = e[i^1];
	}
	return rest[t];//ç½‘ç»œçš„æµé‡å¯ä»¥å¢åŠ æœ€å°å€¼minf
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m >> s >> t;
	for(int i = 1;i <= m;i++){
		int x,y,z;cin >> x >> y >> z;
			add(x,y,z);add(y,x,0);
	}
	while(bfs()) maxflow += update();
	cout << maxflow;
}
```



#### Dinic

æ—¶é—´å¤æ‚åº¦$O(N^2M)$ï¼Œå®é™…æ•ˆç‡è¾ƒé«˜ï¼Œèƒ½å¤„ç† 10^4~10^5 è§„æ¨¡çš„ç½‘ç»œã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨æ±‚è§£[äºŒåˆ†å›¾æœ€å¤§åŒ¹é…](https://www.luogu.com.cn/record/220061271)æ—¶é—´å¤æ‚åº¦ä¸º$O(M \sqrt{N})$ï¼Œè¾¹æƒè®¾ä¸º1ï¼Œæºç‚¹å‘Aé›†åˆè¿è¾¹ï¼ŒBé›†åˆå‘æ±‡ç‚¹è¿è¾¹ã€‚

EKç®—æ³•æ¯æ¬¡åªæ‰¾å‡ºä¸€æ¡å¢å¹¿è·¯ï¼Œè€ŒDinicå¯ä»¥ä¸€æ¬¡æ‰¾å‡ºå¤šæ¡ã€‚

1. åœ¨[æ®‹é‡ç½‘ç»œ]ä¸Šbfsæ±‚å‡ºèŠ‚ç‚¹çš„å±‚æ¬¡ï¼Œæ„é€ [åˆ†å±‚å›¾]ã€‚
2. åœ¨åˆ†å±‚å›¾ä¸Šdfså¯»æ‰¾å¢å¹¿è·¯ï¼Œå›æº¯æ—¶æ›´æ–°è¾¹æƒã€‚



```cpp
#include <iostream>
#include <queue>
#include <cstring>
using namespace std;
const int INF = 0x3f3f3f3f;
const int N = 205,M = 10004;
int n,m,s,t;
long long maxflow;
int h[N],e[M],ne[M],w[M],idx;
int d[N];
int now[N];//å½“å‰å¼§ä¼˜åŒ–

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool bfs(){//åœ¨æ®‹é‡ç½‘ç»œä¸Šæ„é€ åˆ†å±‚å›¾
	memset(d,0,sizeof d);
	queue<int>q;
	q.push(s);
	d[s] = 1;
	now[s] = h[s];
	while(q.size()){
		int x = q.front();
		q.pop();
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(!w[i] || d[y]) continue;
			d[y] = d[x] + 1;
			now[y] = h[y];
			q.push(y);
			if(y == t) return 1;
		}
	}
	return 0;
}

int dfs(int x,int flow){//flowè¡¨ç¤ºç»è¿‡è¯¥ç‚¹çš„å‰©ä½™æµé‡
	if(x == t) return flow;
	int res = 0;//resè¡¨ç¤ºç»è¿‡è¯¥ç‚¹çš„æ‰€æœ‰æµé‡å’Œ
	for(int i = now[x];~i && flow;i = ne[i]){//åªæœ‰å½“å‰è¿˜æœ‰æµæ—¶æ‰ç»§ç»­æœç´¢
		now[x] = i;//å½“å‰å¼§ä¼˜åŒ–
		int y = e[i];
		if(!w[i] || d[y] != d[x] + 1) continue;
		int k = dfs(y,min(flow,w[i]));
		if(k == 0) d[y] = 0;//å‰ªæ,å»æ‰å¢å¹¿å®Œæ¯•çš„ç‚¹
		w[i] -= k;
		w[i^1] += k;
		res += k;
		flow -= k;
	}
	return res;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m >> s >> t;
	for(int i = 1;i <= m;i++){
		int a,b,c;cin >> a >> b >> c;
		add(a,b,c);add(b,a,0);
	}
	while(bfs()) maxflow += dfs(s,INF);
	cout << maxflow;
}
```





### æœ€å°å‰²

è¯ºåˆ é™¤ä¸€ä¸ªè¾¹é›†$E\prime \in E$åï¼ŒSä¸Tå°†ä¸å†è¿é€šï¼Œ åˆ™$E\prime$ä¸ºè¯¥ç½‘ç»œçš„ä¸€ä¸ªå‰²ã€‚å®¹é‡ä¹‹å’Œæœ€å°çš„å‰²ç§°ä¸ºç½‘ç»œçš„**æœ€å°å‰²**ã€‚

**æœ€å¤§æµæœ€å°å‰²å®šç†**ï¼šä»»ä½•ä¸€ä¸ªç½‘ç»œçš„æœ€å¤§æµé‡ç­‰äºæœ€å°å‰²ä¸­è¾¹çš„å®¹é‡ä¹‹å’Œï¼Œå³â€œæœ€å¤§æµ=æœ€å°å‰²â€





**æ±‚å…·ä½“æ–¹æ¡ˆ**

åœ¨æ±‚å®Œæœ€å¤§æµåï¼Œä»æºç‚¹Så‡ºå‘ï¼ŒBFSéå†æ®‹é‡ç½‘ç»œä¸­è¿˜èƒ½åˆ°è¾¾çš„ç‚¹ï¼Œè¿™äº›ç‚¹å±äºSé›†åˆï¼Œå‰©ä¸‹æ— æ³•åˆ°è¾¾çš„ç‚¹å±äºTé›†åˆã€‚æ‰€æœ‰è¿æ¥Så’ŒTçš„è¾¹å³ä¸ºå±äºæœ€å°å‰²çš„è¾¹ã€‚

```cpp
bool st[N] = {};//st[x]=1åˆ™å±äºSï¼Œå¦åˆ™å±äºT
void uuz(){
	queue<int>q;
	q.push(s);
	st[s] = 1;
	while(q.size()){
		int x = q.front();
		q.pop();
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(!st[y] && w[i]){
				q.push(y);
				st[y] = 1;
			}
		}
	}
	for(int i = 0;i < idx;i += 2){
		int x = e[i^1],y = e[i];
		if(st[x] && !st[y]){//æ­¤æ—¶w[i] == 0
			cout << x << ' ' << y << endl;//è¾¹(x,y)å±äºæœ€å°å‰²
		}
	}
}
```



**æ±‚å‰²è¾¹æ•°é‡**

å¦‚æœè¦åœ¨æœ€å°å‰²çš„å‰æä¸‹æœ€å°åŒ–ä¸ªè¾¹æ•°é‡ï¼Œé‚£ä¹ˆå…ˆæ±‚å‡ºæœ€å°å‰²ï¼Œç„¶åæŠŠæ²¡æœ‰æ»¡æµçš„è¾¹å®¹é‡æ”¹ä¸ºINFï¼Œæ»¡æµçš„è¾¹å®¹é‡æ”¹ä¸º1ï¼Œå†è·‘ä¸€è¾¹æœ€å°å‰²å°±å¯ä»¥æ±‚å‡ºæœ€å°å‰²è¾¹æ•°é‡ï¼›
å¦‚æœæ²¡æœ‰æœ€å°å‰²çš„å‰æï¼Œç›´æ¥æŠŠæ‰€æœ‰è¾¹çš„å®¹é‡è®¾ä¸º1ï¼Œæ±‚ä¸€éæœ€å°å‰²å³å¯ã€‚





**å¸¸è§é—®é¢˜æ¨¡å‹**

æœ‰nä¸ªç‰©å“å’Œä¸¤ä¸ªé›†åˆA,Bï¼Œæ¯ä¸ªç‰©å“å¿…é¡»ä¸”åªèƒ½æ”¾å…¥ä¸€ä¸ªé›†åˆé‡Œï¼Œå¦‚æœä¸€ä¸ªç‰©å“æ²¡æœ‰æ”¾å…¥Aé›†åˆä¼šèŠ±è´¹$a_i$ï¼Œå¦‚æœæ²¡æœ‰æ”¾å…¥Bé›†åˆä¼šèŠ±è´¹$b_i$ï¼Œè¿˜æœ‰è¯ºå¹²ä¸ªæ¡ä»¶å¦‚$(u_i,v_i,w_i)$è¡¨ç¤ºå¦‚æœ$u_i$å’Œ$v_i$ä¸åœ¨åŒä¸€ä¸ªé›†åˆé‡Œä¼šèŠ±è´¹$w_i$ï¼Œæ±‚æœ€å°ä»£ä»·ã€‚

è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„äºŒè€…é€‰ä¸€çš„æœ€å°å‰²é¢˜ç›®ã€‚æˆ‘ä»¬è®¾ç«‹ä¸€ä¸ªè¶…çº§æºç‚¹så’Œè¶…çº§æ±‡ç‚¹tï¼Œå¯¹æ¯ä¸ªç‚¹`i`è¿è¾¹`add(s,i,a[i])`å’Œ`add(i,t,b[i])`ï¼Œåè¾¹å®¹é‡å‡ä¸º0ã€‚å¯¹æ¯ä¸ªé™åˆ¶æ¡ä»¶è¿åŒå‘è¾¹`add(u,v,w),add(v,u,w)`ã€‚
æ³¨æ„åˆ°ï¼Œä½†æºç‚¹å’Œæ±‡ç‚¹ä¸ç›¸è¿æ—¶ï¼Œä»£è¡¨è¿™äº›ç‚¹éƒ½é€‰æ‹©äº†ä¸€ä¸ªå…¶ä¸­é›†åˆï¼Œæœ€å°å‰²å°±æ˜¯æœ€å°èŠ±è´¹ã€‚å¦‚æœè¦æ±‚æœ€å¤§èŠ±è´¹ï¼Œå°†æ‰€æœ‰èŠ±è´¹å‡å»æœ€å°å‰²å³å¯ã€‚

[ä¾‹é¢˜ï¼šP1361 å°Mçš„ä½œç‰© - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P1361)







#### æœ€å¤§æƒé—­åˆå›¾

ç»™å®šä¸€å¼ æœ‰å‘å›¾ï¼Œæ¯ä¸ªç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼a[i]ï¼ˆå¯èƒ½ <= 0ï¼‰,ä½ éœ€è¦é€‰æ‹©æƒå€¼å’Œæœ€å¤§çš„ä¸€ç»„ç‚¹é›†ï¼Œæ»¡è¶³ï¼šæ¯ä¸ªç‚¹çš„åç»§èŠ‚ç‚¹éƒ½å¿…é¡»åŒ…å«åœ¨ç‚¹é›†ä¸­ã€‚

**ç»“è®º**ï¼šå»ºç«‹è¶…çº§æºç‚¹så’Œè¶…çº§æ±‡ç‚¹tï¼Œè¯ºèŠ‚ç‚¹uæƒå€¼ä¸ºæ­£ï¼Œåˆ™è¿è¾¹(s,u,a[i])ï¼›è¯ºèŠ‚ç‚¹uæƒå€¼ä¸ºè´Ÿï¼Œåˆ™è¿è¾¹(u,t,-a[i])ï¼›æƒå€¼ä¸º0ä¸ç”¨è¿ï¼ŒåŸå›¾ä¸Šæ‰€æœ‰è¾¹æƒæ”¹ä¸º$\infin$ã€‚æ‰€æœ‰åè¾¹è¾¹æƒå…¨ä¸º0ï¼Œè·‘æœ€å¤§æµï¼Œç­”æ¡ˆå³ä¸º**æ‰€æœ‰æ­£æƒç‚¹ä¹‹å’Œå‡å»æœ€å°å‰²**ã€‚



[ä¾‹é¢˜ï¼šGet More Moneyï¼ˆâ˜…7ï¼‰ - AtCoder typical90_an - Virtual Judge (vjudge.net)](https://vjudge.net/problem/AtCoder-typical90_an#author=GPT_zh)

ä¹Ÿå¯ç”¨äºå¤„ç†ä¸è¿é€šçš„æœ‰å‘æ£®æ—

```cpp
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int INF = 0x3f3f3f3f;
const int N = 105,M = N*N;
int n,m;
int h[N],e[M],ne[M],idx,w[M];
int a[N];

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	s = 0,t = n+1;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		a[i] -= m;
		if(a[i] > 0){
			ans += a[i];
			add(s,i,a[i]);
			add(i,s,0);
		}
		if(a[i] < 0){
			add(i,t,-a[i]);
			add(t,i,0);
		}
	}

	for(int i = 1;i <= n;i++){
		int k;cin >> k;
		while(k--){
			int j;cin >> j;
			add(j,i,INF);
			add(i,j,0);
		}
	}
	while(bfs()) maxflow += dfs(s,INF);//Dinicæœ€å¤§æµæ¿å­çœç•¥
	cout << ans - maxflow;
}
```



### è´¹ç”¨æµ

ç»™å®šä¸€ä¸ªç½‘ç»œ$G=(V,E)$ï¼Œæ¯æ¡è¾¹é™¤äº†æœ‰å®¹é‡é™åˆ¶`c(x,y)`å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå•ä½æµé‡çš„è´¹ç”¨`w(x,y)`ï¼Œå½“`(x,y)`çš„æµé‡ä¸º`f(x,y)`æ—¶ï¼Œéœ€è¦èŠ±è´¹`f(x,y) * w(x,y)`çš„è´¹ç”¨ã€‚`w`ä¹Ÿæ»¡è¶³æ–œå¯¹ç§°æ€§è´¨ï¼Œå³`w(x,y) = -w(y,x)`ã€‚

ä½¿è¯¥ç½‘ç»œä¸­èŠ±è´¹æœ€å°çš„æœ€å¤§æµç§°ä¸º**æœ€å°è´¹ç”¨æœ€å¤§æµ**ã€‚æ³¨æ„ï¼šè´¹ç”¨æµçš„å‰ææ˜¯æœ€å¤§æµã€‚



**SSPç®—æ³•ï¼ˆSuccessive Shortest Pathï¼‰**ï¼šæ¯æ¬¡å¯»æ‰¾å•ä½è´¹ç”¨æœ€å°çš„å¢å¹¿è·¯è¿›è¡Œå¢å¹¿ï¼Œç›´åˆ°å›¾ä¸Šä¸å­˜åœ¨å¢å¹¿è·¯ä¸ºæ­¢ã€‚æ—¶é—´å¤æ‚åº¦æœ€åä¸º$O(nmf)$ï¼Œå…¶ä¸­`f`è¡¨ç¤ºç½‘ç»œçš„æœ€å¤§æµã€‚å®ç°æ—¶ï¼Œåªéœ€å°† EK ç®—æ³•æˆ– Dinic ç®—æ³•ä¸­æ‰¾å¢å¹¿è·¯çš„è¿‡ç¨‹ï¼Œæ›¿æ¢ä¸ºç”¨æœ€çŸ­è·¯ç®—æ³•å¯»æ‰¾å•ä½è´¹ç”¨æœ€å°çš„å¢å¹¿è·¯å³å¯ã€‚éœ€è¦ä¿è¯ç½‘ç»œæ²¡æœ‰è´Ÿç¯ã€‚



[P3381 ã€æ¨¡æ¿ã€‘æœ€å°è´¹ç”¨æœ€å¤§æµ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P3381)

```cpp
//åŸºäºEKç®—æ³•å®ç°
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int INF = 0x3f3f3f3f;
const int N = 5003,M = 100005;
int n,m,s,t;
int maxflow,mincost;
int h[N],e[M],ne[M],w[M],c[M],idx;//wä¸ºå®¹é‡,cä¸ºè´¹ç”¨
bool vis[N];
int pre[M];
int rest[N];
int dist[N];

void add(int u,int v,int x,int y){
	c[idx] = y,w[idx] = x,e[idx] = v,ne[idx] = h[u],h[u] = idx++;
}

bool spfa(){
	memset(vis,0,sizeof vis);
	memset(dist,0x3f,sizeof dist);
	queue<int>q;
	q.push(s);
	vis[s] = 1;
	rest[s] = INF;
	dist[s] = 0;
	while(q.size()){
		int x = q.front();
		q.pop();
		vis[x] = 0;
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(w[i] && dist[y] > dist[x] + c[i]){
				dist[y] = dist[x] + c[i];
				rest[y] = min(rest[x],w[i]);
				pre[y] = i;
				if(!vis[y]){
					q.push(y);
					vis[y] = 1;
				}
			}
		}
	}
	return dist[t] < INF;
}

void update(){
	int x = t;
	while(x != s){
		int i = pre[x];
		w[i] -= rest[t];
		w[i^1] += rest[t];
		x = e[i^1];
	}
	mincost += rest[t] * dist[t];
	maxflow += rest[t];
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m >> s >> t;
	for(int i = 1;i <= m;i++){
		int u,v,x,y;cin >> u >> v >> x >> y;
		add(u,v,x,y);add(v,u,0,-y);//è´¹ç”¨å–å
	}
	while(spfa()) update();
	cout << maxflow << ' ' << mincost;
}
```

```cpp
//åŸºäºDinicç®—æ³•å®ç°
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int INF = 0x3f3f3f3f;
const int N = 5003,M = 100005;
int n,m,s,t;
int maxflow,mincost;
int h[N],e[M],ne[M],w[M],c[M],idx;
int now[N],dist[N];
bool vis[N];

void add(int a,int b,int x,int y){//w[] = xä¸ºå®¹é‡,c[] = yä¸ºè´¹ç”¨
	c[idx] = y,w[idx] = x,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

bool spfa(){
	memset(vis,0,sizeof vis);
	memset(dist,0x3f,sizeof dist);
	queue<int>q;
	q.push(s);
	now[s] = h[s];
	dist[s] = 0;
	while(q.size()){
		int x = q.front();
		q.pop();
		vis[x] = 0;
		for(int i = h[x];~i;i = ne[i]){
			int y = e[i];
			if(w[i] && dist[y] > dist[x] + c[i]){
				dist[y] = dist[x] + c[i];
				now[y] = h[y];
				if(!vis[y]){
					q.push(y);
					vis[y] = 1;
				}
			}
		}
	}
	return dist[t] < INF;
}

int dfs(int x,int flow){
	if(x == t) return flow;
	vis[x] = 1;//
	int res = 0;
	for(int i = now[x];~i && flow;i = ne[i]){
		now[x] = i;
		int y = e[i];
		if(w[i] && dist[y] == dist[x] + c[i] && !vis[y]){
			int k = dfs(y,min(w[i],flow));
			if(!k) dist[y] = 0;
			w[i] -= k;
			w[i^1] += k;
			res += k;
			flow -= k;
			mincost += k*c[i];//æœ€å°è´¹ç”¨ += å½“å‰æµé‡*å½“å‰è´¹ç”¨
		}
	}
	vis[x] = 0;
	return res;
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m >> s >> t;
	for(int i = 1;i <= m;i++){
		int a,b,x,y;cin >> a >> b >> x >> y;
		add(a,b,x,y);add(b,a,0,-y);//è´¹ç”¨å–å
	}
	while(spfa()) maxflow += dfs(s,INF);
	cout << maxflow << ' ' << mincost;
}
```







## æ¬§æ‹‰å›¾

**æ¬§æ‹‰è·¯**ï¼šç»™å®šä¸€å¼ æ— å‘å›¾ï¼Œè¯ºå­˜åœ¨ä¸€æ¡ä»èŠ‚ç‚¹Såˆ°èŠ‚ç‚¹Tçš„è·¯å¾„ï¼Œæ°å¥½ä¸é‡ä¸æ¼åœ°ç»è¿‡æ¯æ¡è¾¹ä¸€æ¬¡ï¼Œåˆ™ç§°è¯¥è·¯å¾„ä¸ºSåˆ°Tçš„æ¬§æ‹‰è·¯

**æ¬§æ‹‰å›è·¯**ï¼šç‰¹åˆ«åœ°ï¼Œè¯ºå­˜åœ¨ä¸€æ¡ä»èŠ‚ç‚¹Så‡ºå‘ï¼Œæ°å¥½ä¸é‡ä¸æ¼åœ°ç»è¿‡æ¯ä¸€æ¡è¾¹ä¸€æ¬¡(å¯ä»¥é‡å¤ç»è¿‡å›¾ä¸­çš„èŠ‚ç‚¹)ï¼Œæœ€ç»ˆå›åˆ°èµ·ç‚¹Sï¼Œåˆ™ç§°è¯¥è·¯å¾„ä¸ºæ¬§æ‹‰å›è·¯ã€‚<u>å­˜åœ¨æ¬§æ‹‰å›è·¯çš„å›¾è¢«ç§°ä¸ºæ¬§æ‹‰å›¾ã€‚</u>

**æ¬§æ‹‰è·¯çš„å­˜åœ¨æ€§åˆ¤æ–­**ï¼šä¸€å¼ æ— å‘å›¾ä¸­å­˜åœ¨æ¬§æ‹‰è·¯ï¼Œå½“ä¸”ä»…å½“æ— å‘å›¾è¿é€šï¼Œä¸”èµ·ç‚¹å’Œç»ˆç‚¹çš„åº¦æ•°ä¸ºå¥‡æ•°ï¼Œå…¶å®ƒèŠ‚ç‚¹çš„åº¦æ•°ä¸ºå¶æ•°ã€‚

**ä½¿ç”¨DFSå¯»æ‰¾æ¬§æ‹‰è·¯çš„åŸºæœ¬æ€æƒ³å¦‚ä¸‹ï¼š**

DFSå¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ— è¾¹å¯èµ°çš„èŠ‚ç‚¹ï¼Œåˆ™è¿™ä¸ªèŠ‚ç‚¹å¿…å®šä¸ºç»ˆç‚¹ã€‚

æ¥ä¸‹æ¥ç”±äºDFSçš„é€’å½’å›æº¯ï¼Œä¼šé€€å›ç»ˆç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»§ç»­å¾€ä¸‹æœç´¢ï¼Œç›´åˆ°å¯»æ‰¾åˆ°ç¬¬äºŒä¸ªæ— è¾¹å¯èµ°çš„èŠ‚ç‚¹ï¼Œåˆ™è¿™ä¸ªèŠ‚ç‚¹å¿…å®šä¸ºæ¬§æ‹‰è·¯ä¸­ç»ˆç‚¹å‰æœ€åè®¿é—®çš„èŠ‚ç‚¹ã€‚

äºæ˜¯å½“é€šè¿‡DFSéå†å®Œæ•´å¼ å›¾åï¼Œå°±å¯ä»¥å€’åºå‚¨å­˜ä¸‹æ•´ä¸ªæ¬§æ‹‰è·¯ã€‚è¯¥ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸ºO(NM)ï¼Œå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¼šè¢«éå†å¤šæ¬¡ï¼Œä¸”é€’å½’å±‚æ•°ä¸ºO(M)çº§åˆ«ï¼Œå®¹æ˜“æ ˆæº¢å‡ºã€‚å¯ä»¥ä½¿ç”¨æ ˆæ¨¡æ‹Ÿé€’å½’ï¼Œä¸”æ¯æ¬¡è®¿é—®ä¸€æ¡è¾¹ååˆ é™¤è¯¥è¾¹(ä¿®æ”¹è¡¨å¤´ï¼Œä»¤å…¶æŒ‡å‘ä¸‹ä¸€æ¡è¾¹)

```cpp
//è¯ºæ¬§æ‹‰å›è·¯å­˜åœ¨ï¼Œåˆ™å¯ç”¨dfså’Œæ ˆæ±‚å‡ºæ¬§æ‹‰å›è·¯çš„ä¸€ç§å…·ä½“æ–¹æ¡ˆ
#include <iostream>
#include <cstring>
#include <stack>
#include <vector>
using namespace std;
const int N = 10004,M = 100005;
int n,m;
int h[N],e[M],ne[M],idx;
bool vis[M];
stack<int>sk;
vector<int>ans;

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void euler(){//æ ˆæ¨¡æ‹Ÿé€’å½’
	sk.emplace(1);
	while(sk.size()){
		int u = sk.top();
		int i = h[u];
		while(~i && vis[i]) i = ne[i];//æ‰¾åˆ°ä¸€æ¡å°šæœªè®¿é—®çš„è¾¹
		if(~i){//æ²¿ç€è¿™æ¡è¾¹æ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹ï¼Œæ ‡è®°è¯¥è¾¹ï¼Œå¹¶æ›´æ–°è¡¨å¤´ï¼Œé¿å…é‡å¤æ£€æŸ¥å·²å¤„ç†è¾¹
			sk.emplace(e[i]);
			vis[i] = vis[i^1] = 1;//è¯ºå°†è¯¥è¡Œæ³¨é‡Šæ‰,åˆ™ä¸ºæ¯æ¡è¾¹æ­£åæ°å¥½å„èµ°ä¸€æ¬¡çš„ç­”æ¡ˆ[Luogu_P6066]
			h[u] = ne[i];
		}
		else{//uç›¸è¿çš„æ‰€æœ‰è¾¹å‡å·²è®¿é—®ï¼Œæ¨¡æ‹Ÿå›æº¯è¿‡ç¨‹ï¼Œè®°å½•ç­”æ¡ˆ
			sk.pop();
			ans.emplace_back(u);
		}
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= m;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);
	}

	euler();//è¿™é‡Œå‡è®¾1ä¸ºèµ·ç‚¹

	for(int i = ans.size()-1;i >= 0;i--){
		cout << ans[i] << '\n';
	}
}
```





------

# åŠ¨æ€è§„åˆ’

[ã€Œç¬”è®°ã€DPä»å…¥åœŸåˆ°å…¥é—¨ - Luckyblock - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/luckyblock/p/13121167.html#æ¢æ ¹-dp)

[ã€é¢˜å•ã€‘åŠ¨æ€è§„åˆ’ï¼ˆå…¥é—¨/èƒŒåŒ…/çŠ¶æ€æœº/åˆ’åˆ†/åŒºé—´/çŠ¶å‹/æ•°ä½/æ ‘å½¢/æ•°æ®ç»“æ„ä¼˜åŒ–ï¼‰ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/circle/discuss/tXLS3i/)



1. æ„é€ é—®é¢˜
2. æ‹†è§£å­é—®é¢˜
3. æ±‚è§£æœ€ç®€å•å­é—®é¢˜
4. é€šè¿‡å­é—®é¢˜æ¨å½“å‰é—®é¢˜ï¼Œæ„å»ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹
5. åˆ¤æ–­å¤æ‚åº¦



```cpp
memset()åˆå§‹åŒ–
dp[0][0][...] = è¾¹ç•Œå€¼
for(çŠ¶æ€1 ï¼šæ‰€æœ‰çŠ¶æ€1çš„å€¼){
    for(çŠ¶æ€2 ï¼šæ‰€æœ‰çŠ¶æ€2çš„å€¼){
        for(...){
          //çŠ¶æ€è½¬ç§»æ–¹ç¨‹
          dp[çŠ¶æ€1][çŠ¶æ€2][...] = æ±‚max/min/sum...
        }
    }
}
```



## èƒŒåŒ…é—®é¢˜

### 01èƒŒåŒ…

> æ¯ä¸ªç‰©å“æœ€å¤šåªèƒ½ç”¨ä¸€æ¬¡
>

```cpp
//ä¸€ç»´ä¼˜åŒ–
//dp[j] = max(dp[k], dp[k - v[i]] + w[i]);
//1. dp[i] ä»…ç”¨åˆ°äº†dp[i-1]å±‚, 
//2. kä¸k-v[i] å‡å°äºk
//3.è‹¥ç”¨åˆ°ä¸Šä¸€å±‚çš„çŠ¶æ€æ—¶,ä»å¤§åˆ°å°æšä¸¾, åä¹‹ä»å°åˆ°å¤§å“¦
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 1003;
int n, m;
int v[N], w[N];
int dp[N];//dp[i]è¡¨ç¤ºèƒŒåŒ…å®¹é‡ä¸è¶…è¿‡iä¸‹çš„æœ€å¤§ä»·å€¼

int main() {
	cin >> n >> m;
	for (int i = 0; i < n;i++) {
		cin >> v[i] >> w[i];
	}
	for (int i = 0; i < n;i++) {//æšä¸¾æ‰€æœ‰ç‰©å“
		for (int k = m; k >= v[i];k--) {//kä»m~v[i]èƒ½æšä¸¾æ‰€æœ‰ä½“ç§¯
			dp[k] = max(dp[k], dp[k - v[i]] + w[i]);
		}
	}
	cout << dp[m];
	return 0;
}
```



```cpp
//äºŒç»´æœªä¼˜åŒ–ç‰ˆ
int dp[N][N];//dp[i][j]è¡¨ç¤ºå‰iä¸ªç‰©å“,æ€»ä½“ç§¯ä¸è¶…è¿‡jçš„æœ€å¤§ä»·å€¼

for(int i = 1;i <= n;i++){
    for(int j = 1;j <= m;j++){
        if(j-v[i] >= 0) dp[i][j] = max(dp[i-1][j],dp[i-1][j-v[i]]+w[i]);
        else dp[i][j] = dp[i-1][j];
    }
}
```







### å®Œå…¨èƒŒåŒ…

> æ¯ä¸ªç‰©å“å¯ä»¥ä½¿ç”¨æ— æ•°æ¬¡
>

```cpp
//https://www.acwing.com/problem/content/3/
//æœªä¼˜åŒ–ç‰ˆ  æ—¶é—´å¤æ‚åº¦è¾ƒé«˜    æœ€å¤§ä¸ºO(nmk)
//f[i][j] = max(f[i][j], f[i - 1][j - k * v[i]] + k * w[i]);
```

```cpp
//äºŒç»´ä¼˜åŒ–  (i:1~n)  (j:0~m)
if (j >= v[i]) f[i][j] = max(f[i - 1][j], f[i][j - v[i]] + w[i]);
else f[i][j] = f[i - 1][j];
```

```cpp
//ä¸€ç»´ä¼˜åŒ–  O(NM)
#include <iostream>
using namespace std;
const int N = 1003;
int n,m;
int w[N],v[N],dp[N];

int main(){
    cin >> n >> m;
    for(int i = 1;i <= n;i++){
        cin >> v[i] >> w[i];
    }
    for(int i = 1;i <= n;i++){
        for(int k = v[i];k <= m;k++){//ä¸€ç»´å®Œå…¨èƒŒåŒ…è¿™é‡Œkä»å°åˆ°å¤§æšä¸¾
            dp[k] = max(dp[k],dp[k-v[i]]+w[i]);
        }
    }
    cout << dp[m] << endl;
    return 0;
}
```



### å¤šé‡èƒŒåŒ…

> æ¯ä¸ªç‰©å“ä½¿ç”¨æœ‰é™æ¬¡
>

```cpp
//https://www.acwing.com/problem/content/4/
//äºŒç»´æœªä¼˜åŒ–  O(nms)
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 103;
int n, m;
int v[N], w[N], s[N];
int f[N][N];

int main() {
	cin >> n >> m;
	for (int i = 1; i <= n;i++) {
		cin >> v[i] >> w[i] >> s[i];
	}
	for (int i = 1; i <= n;i++) {
		for (int j = 0; j <= m;j++) {//j:0~m
			for (int k = 0; k <= s[i] && k * v[i] <= j;k++) {//k*v[i] <= j
				f[i][j] = max(f[i][j], f[i - 1][j - k * v[i]] + k * w[i]);//
			}
		}
	}
	cout << f[n][m];
	return 0;
}
```

```cpp
//https://www.acwing.com/problem/content/5/
//äºŒè¿›åˆ¶ä¼˜åŒ–   O(nmlogs)    å†ç”¨01èƒŒåŒ…é—®é¢˜æ±‚è§£
//ä»»æ„ä¸€ä¸ªæ­£æ•´æ•°séƒ½å¯æ‹†æˆ1+2+4+8+16+... = s
#include <iostream>
using namespace std;
const int N = 200005;
int n,m;
int v[N],w[N],dp[N],idx;

int main(){
    cin >> n >> m;
    for(int i = 1;i <= n;i++){
        int a,b,s;cin >> a >> b >> s;
        int k = 1;
        while(k <= s){
            idx++;//ç¬¬cntä¸ªç‰©å“ä½“ç§¯ä¸ºa*sï¼Œä»·å€¼ä¸ºb*s
            v[idx] = a*k;
            w[idx] = b*k;
            s-=k;
            k*=2;
        }
        if(s > 0){//è¡¥ä¸Šå‰©ä¸‹çš„sä¸ªç‰©å“
            idx++;
            v[idx] = a*s;
            w[idx] = b*s;
        }
    }
    for(int i = 1;i <= idx;i++){//å†ç”¨01èƒŒåŒ…å¤„ç†è¯¥idxä¸ªç‰©å“
        for(int k = m;k >= v[i];k--){
            dp[k] = max(dp[k],dp[k-v[i]]+w[i]);
        }
    }
    cout << dp[m];
}

//////////////////////////////////////////////////////
//ç®€å†™ï¼Œä¼˜åŒ–ç©ºé—´
#include <iostream>
using namespace std;
const int N = 2003;
int dp[N];

int main(){
	int n,m;cin >> n >> m;
	for(int i = 1;i <= n;i++){
		int v,w,s;cin >> v >> w >> s;
		for(int k = 1;k <= s;k <<= 1){
			s -= k;
			for(int j = m;j >= k*v;j--){
				dp[j] = max(dp[j],dp[j-k*v]+k*w);
			}
		}
		if(s){
			for(int j = m;j >= s*v;j--){
				dp[j] = max(dp[j],dp[j-s*v]+s*w);
			}
		}
	}
	cout << dp[m];
}
```



```cpp
//å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–  O(nm)
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1003,M = 20004;
int n,m;
int v[N],w[N],s[N];
int dp[M],g[M];//å¯¹äºç¬¬iå±‚åªç”¨åˆ°ç¬¬i-1å±‚,å¯ç”¨æ‹·è´/æ»šåŠ¨æ•°ç»„ä¼˜åŒ–
int q[M],hh,tt = -1;//å•è°ƒé˜Ÿåˆ—æ»‘åŠ¨çª—å£

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> v[i] >> w[i] >> s[i];
	}
	for(int i = 1;i <= n;i++){
		memcpy(g,dp,sizeof g);//g[]ä½œä¸ºdp[]çš„i-1å±‚
		int k = (s[i]+1)*v[i];//(s[i]+1)*v[i]ä¸ºçª—å£æœ€å¤§é•¿åº¦ï¼Œè¯ºè¶…å‡ºåˆ™çª—å£å³ç§»
		for(int r = 0;r < v[i];r++){//rä¸ºm%v[i]çš„åç§»é‡
			hh = 0,tt = -1;//L(hh),R(tt)
			for(int j = r;j <= m;j += v[i]){
				if(hh <= tt && j-k >= q[hh]) hh++;
				while(hh <= tt && g[q[tt]]+(j-q[tt])/v[i]*w[i] <= g[j]) tt--;
				//æŠŠä»¥é˜Ÿå°¾q[tt]ä¸ºå€¼æ—¶<=g[j]çš„æ•°éƒ½å¼¹å‡ºï¼Œä¿æŒé˜Ÿåˆ—å•è°ƒé€’å‡
				q[++tt] = j; //é˜Ÿé¦–q[hh]ä¸ºæ»‘åŠ¨çª—å£æœ€å¤§å€¼
				dp[j] = g[q[hh]] + (j-q[hh])/v[i]*w[i];
                //dp[i][j] = dp[i-1][mx] + (j-mx)/v[i]*w[i];
			}
		}
	}
	cout << dp[m];
}
```





### åˆ†ç»„èƒŒåŒ…

> æ¯ç»„æœ‰è‹¥å¹²ä¸ªç‰©å“ï¼ŒåŒä¸€ç»„å†…çš„ç‰©å“æœ€å¤šåªèƒ½é€‰ä¸€ä¸ªã€‚

```cpp
//https://www.acwing.com/problem/content/description/9/
#include <iostream>
using namespace std;
const int N = 105;
int n, m;
int dp[N];//åªä»å‰iç»„ç‰©å“ä¸­é€‰ï¼Œå½“å‰ä½“ç§¯å°äºç­‰äºjçš„æœ€å¤§å€¼
int v[N][N], w[N][N], s[N];
int main() {
	cin >> n >> m;
	for (int i = 1; i <= n; i++) {
		cin >> s[i];//æ¯ç»„s[i]ä¸ªç‰©å“
		for (int j = 1; j <= s[i]; j++) {
			cin >> v[i][j] >> w[i][j];
		}
	}

	for (int i = 1; i <= n; i++) {//æšä¸¾æ‰€æœ‰èƒŒåŒ…
		for (int k = m; k >= 0; k--) {//ä»m~0æšä¸¾æ‰€æœ‰ä½“ç§¯
			for (int j = 0; j <= s[i]; j++) {//æšä¸¾æ‰€æœ‰é€‰æ‹©
				if (k >= v[i][j]) {
					dp[k] = max(dp[k]/*ä¸é€‰*/, dp[k - v[i][j]] + w[i][j]/*é€‰*/);
				}
			}
		}
	}
	cout << dp[m];
}
```



### äºŒç»´è´¹ç”¨èƒŒåŒ…

```cpp
//äºŒç»´è´¹ç”¨01èƒŒåŒ… https://www.acwing.com/problem/content/8/
//å®¹é‡ä¸è¶…è¿‡Vï¼Œé‡é‡ä¸è¶…è¿‡M
#include <iostream>
using namespace std;
const int MX = 1003;
int N,V,M;
int v[MX],m[MX],w[MX];
int dp[105][105];

int main(){
	cin >> N >> V >> M;
	for(int i = 1;i <= N;i++){
		cin >> v[i] >> m[i] >> w[i];
	}
	for(int i = 1;i <= N;i++){
		for(int j = V;j >= v[i];j--){
			for(int k = M;k >= m[i];k--){
				dp[j][k] = max(dp[j][k],dp[j-v[i]][k-m[i]] + w[i]);
			}
		}
	}
	cout << dp[V][M];
}
```

```cpp
//æ½œæ°´å‘˜ http://ybt.ssoier.cn:8088/problem_show.php?pid=1271
//01èƒŒåŒ…,æ±‚æ»¡è¶³æ°§æ°”>=A,æ°®æ°”>=Bçš„åŒæ—¶,æœ€å°é‡é‡å’Œ
#include <iostream>
#include <cstring>
using namespace std;
int A,B,n;
int dp[25][80];

int main(){
	memset(dp,0x3f,sizeof dp);
	dp[0][0] = 0;
	cin >> A >> B >> n;
	for(int i = 1;i <= n;i++){
		int a,b,w;cin >> a >> b >> w;
		for(int j = A;j >= 0;j--){
			for(int k = B;k >= 0;k--){
				dp[j][k] = min(dp[j][k],dp[max(j-a,0)][max(k-b,0)]+w);
			}
		}
	}
	cout << dp[A][B];
}
//ç©ºé—´æœªä¼˜åŒ–ç‰ˆ dp[i][j][k] = min(dp[i-1][j][k],dp[i-1][max(j-a,0)][max(k-b,0)]+w);
```





### æ±‚å…·ä½“æ–¹æ¡ˆ

æ±‚å…·ä½“æ–¹æ¡ˆï¼Œç©ºé—´ä¸€èˆ¬ä¸èƒ½ä¼˜åŒ–æˆäºŒç»´

```cpp
//01èƒŒåŒ…  https://www.acwing.com/problem/content/12/
#include <iostream>
using namespace std;
const int N = 1003;
int n,m;
int v[N],w[N];
int dp[N][N];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> v[i] >> w[i];
	}

	for(int i = n;i >= 1;i--){
		for(int j = 0;j <= m;j++){
			dp[i][j] = dp[i+1][j];
			if(j >= v[i]) dp[i][j] = max(dp[i+1][j],dp[i+1][j-v[i]]+w[i]);
		}
	}
	//dp[1][m]ä¸ºç»ˆç‚¹çŠ¶æ€
	for(int i = 1,j = m;i <= n;i++){
		if(j >= v[i] && dp[i][j] == dp[i+1][j-v[i]]+w[i]){
			cout << i << ' ';//å­—å…¸åºæœ€å°çš„æ–¹æ¡ˆ,ä»å‰å¾€åæ¨
			j -= v[i];
		}
	}
}
```



```cpp
//åˆ†ç»„èƒŒåŒ… æœºå™¨åˆ†é…:https://www.acwing.com/problem/content/1015/
#include <iostream>
using namespace std;
const int N = 20;
int n,m;
int w[N][N];
int dp[N][N];
int ans[N];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			cin >> w[i][j];
		}
	}

	for(int i = 1;i <= n;i++){
		for(int k = 0;k <= m;k++){
			for(int j = 0;j <= m;j++){
				if(k >= j){
					dp[i][k] = max(dp[i][k],dp[i-1][k-j]+w[i][j]);
				}
			}
		}
	}
    
	cout << dp[n][m] << '\n';
	for(int i = n,k = m;i >= 1;i--){
		for(int j = 1;j <= m;j++){
			if(k >= j && dp[i][k] == dp[i-1][k-j]+w[i][j]){
				k -= j;
				ans[i] = j;
				break;
			}
		}
	}
	for(int i = 1;i <= n;i++){//ç¬¬iç»„é‡Œé€‰ç¬¬ans[i]ä¸ªç‰©å“(å¯èƒ½ä¸º0)
		cout << i << ' ' << ans[i] << '\n';
	}
}
```





### æ±‚æ–¹æ¡ˆæ•°



```cpp
//01èƒŒåŒ…æ±‚æœ€ä¼˜é€‰çš„æ–¹æ¡ˆæ•°  https://www.acwing.com/problem/content/11/
//ä½¿æ€»ä»·å€¼æœ€å¤§çš„æœ€ä¼˜æ–¹æ¡ˆæ•°  O(nm)
#include <iostream>
using namespace std;
const int N = 1003,mod = 1e9+7;
int n,m;
int v[N],w[N];
int dp[N],f[N];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> v[i] >> w[i];
	}

	for(int i = 0;i <= m;i++) {//ä»€ä¹ˆéƒ½ä¸é€‰ä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆ
		f[i] = 1;
	}

	for(int i = 1;i <= n;i++){
		for(int j = m;j >= v[i];j--){
			if(dp[j] < dp[j-v[i]]+w[i]){
				dp[j] = dp[j-v[i]]+w[i];
				f[j] = f[j-v[i]];
			}
			else if(dp[j] == dp[j-v[i]]+w[i]){
				f[j] = (f[j]+f[j-v[i]])%mod;
			}
		}
	}
	cout << f[m];
}
```

```cpp
//01èƒŒåŒ…æ±‚ä»·å€¼æ°å¥½ä¸ºmçš„æ–¹æ¡ˆæ•°  https://www.acwing.com/problem/content/description/280/
//O(nm)
#include <iostream>
using namespace std;
const int N = 105,M = 10004;
int n,m;
int a[N];
int dp[M];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}

	dp[0] = 1;
	for(int i = 1;i <= n;i++){
		for(int j = m;j >= a[i];j--){
			dp[j] += dp[j-a[i]];
		}
	}
	cout << dp[m];
}
```





```cpp
//å®Œå…¨èƒŒåŒ…æ±‚æœ€ä¼˜é€‰çš„æ–¹æ¡ˆæ•°(å¾…éªŒè¯)  O(nm)
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1003,mod = 1e9+7;
int n,m;
int v[N],w[N];
int dp[N],f[N];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> v[i] >> w[i];
	}

	for(int i = 0;i <= m;i++){
        f[i] = 1;
    }
	for(int i = 1;i <= n;i++){
		for(int j = v[i];j <= m;j++){
			if(dp[j] < dp[j-v[i]]+w[i]){
				dp[j] = dp[j-v[i]]+w[i];
				f[j] = f[j-v[i]];
			}
			else if(dp[j] == dp[j-v[i]]+w[i]){
				f[j] = (f[j]+f[j-v[i]])%mod;
			}
		}
	}
	cout << f[m];
}
```

```cpp
//å®Œå…¨èƒŒåŒ…æ±‚ä»·å€¼æ°å¥½ä¸ºmçš„æ–¹æ¡ˆæ•°  https://www.acwing.com/problem/content/1023/
// ç»™ä½ ä¸€ä¸ªnç§é¢å€¼çš„è´§å¸ç³»ç»Ÿï¼Œæ±‚ç»„æˆé¢å€¼ä¸ºmçš„è´§å¸æœ‰å¤šå°‘ç§æ–¹æ¡ˆã€‚ O(nm)
#include <iostream>
using namespace std;
const int N = 20,M = 3003;
int n,m;
int a[N];
long long dp[M];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}
	dp[0] = 1;
	for(int i = 1;i <= n;i++){
		for(int j = a[i];j <= m;j++){
			dp[j] += dp[j-a[i]];
		}
	}
	cout << dp[m];
}
```



### æœ‰ä¾èµ–çš„èƒŒåŒ…é—®é¢˜

> æœ‰ N ä¸ªç‰©å“å’Œä¸€ä¸ªå®¹é‡æ˜¯ V çš„èƒŒåŒ…ã€‚ç‰©å“ä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»ï¼Œä¸”ä¾èµ–å…³ç³»ç»„æˆä¸€æ£µæ ‘çš„å½¢çŠ¶ã€‚å¦‚æœé€‰æ‹©ä¸€ä¸ªç‰©å“ï¼Œåˆ™å¿…é¡»é€‰æ‹©å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚
>

```cpp
//æ ‘ä¸Šåˆ†ç»„èƒŒåŒ…   dpä¸ç±»ä¼¼äºæ´›è°·P2014é€‰è¯¾
#include <iostream>
#include <cstring>
using namespace std;
const int N = 105;
int n,m;
int v[N],w[N],p[N];
int h[N],e[N],ne[N],idx;
int dp[N][N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u){
	for(int i = h[u];~i;i = ne[i]){//ç‰©å“ç»„
		dfs(e[i]);
		for(int j = m;j >= 0;j--){//ä½“ç§¯
			for(int k = 0;k <= j-v[u];k++){//å†³ç­–
				dp[u][j] = max(dp[u][j],dp[u][j-k]+dp[e[i]][k]);
			}
		}
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	int root;
	for(int i = 1;i <= n;i++){
		cin >> v[i] >> w[i] >> p[i];
		for(int j = v[i];j <= m;j++) dp[i][j] = w[i];//åˆå§‹çŠ¶æ€
		if(p[i] == -1) root = i;
		else add(p[i],i);
	}
	dfs(root);
	cout << dp[root][m];
}
```







## çº¿æ€§DP



### æ•°å­—ä¸‰è§’å½¢



```cpp
//https://www.acwing.com/problem/content/900/
#include <iostream>
using namespace std;
const int INF = 0x3f3f3f3f;
const int N = 505;
int arr[N][N],dp[N][N];
int n;

int main() {
	cin >> n;
	for (int i = 1; i <= n;i++) {
		for (int j = 1; j <= i;j++) {
			cin >> arr[i][j];
		}
	}

	for (int i = 0; i <= n;i++) {//åˆå§‹åŒ–å¤šä¸€å±‚
		for (int j = 0; j <= i + 1;j++) {
			dp[i][j] = -INF;
		}
	}
	dp[1][1] = arr[1][1];

	for (int i = 2; i <= n;i++) {
		for (int j = 1; j <= i;j++) {		
			dp[i][j] = arr[i][j] + max(dp[i-1][j-1], dp[i-1][j]);
		}
	}
    
	int ans = -INF;
	for (int i = 1; i <= n;i++) {//å¯»æ‰¾æœ€åä¸€å±‚çš„æœ€å¤§å€¼
		ans = max(ans, dp[n][i]);
	}
	cout << ans;
}
```



```cpp
//æ–¹æ ¼å–æ•°ï¼šhttps://www.luogu.com.cn/problem/P1004
//å·¦ä¸Šåˆ°å³ä¸‹èµ°ä¸¤æ¬¡
#include <iostream>
using namespace std;
const int N = 12;
int n;
int arr[N][N];
int dp[N+N][N][N];//dp[k][i1][i2]:k = i1+j1 = i2+j2
//ä»(1,1)èµ°åˆ°(i1,j2)å’Œ(i2,j2)èƒ½å¾—åˆ°çš„æœ€å¤§æ•°

int main(){
	cin >> n;
	int a,b,c;
	while(cin >> a >> b >> c,a&&b&&c){
		arr[a][b] = c;
	}

	for(int k = 2;k <= n+n;k++){
		for(int i1 = 1;i1 <= n;i1++){
			for(int i2 = 1;i2 <= n;i2++){
				int j1 = k-i1,j2 = k-i2;
				if(j1 >= 1 && j1 <= n && j2 >= 1 && j2 <= n){
					int t = arr[i1][j1];
					if(i1 != i2) t += arr[i2][j2];//i1 != i2 è¯´æ˜å½“å‰ä¸åœ¨åŒä¸€ä¸ªæ ¼å­
					int &x = dp[k][i1][i2];
                    //æ‰€æœ‰ä»ä¸Šä¸ªçŠ¶æ€è½¬ç§»è¿‡æ¥çš„æœ€å¤§å€¼
					x = max(x,dp[k-1][i1-1][i2-1]+t);
					x = max(x,dp[k-1][i1-1][i2] + t);
					x = max(x,dp[k-1][i1][i2-1] + t);
					x = max(x,dp[k-1][i1][i2] + t);
				}
			}
		}
	}
	cout << dp[n+n][n][n];
}
```



### æœ€é•¿ä¸Šå‡å­åºåˆ—

**LIS**  Longest Increasing Subsequenceï¼Œæœ€é•¿é€’å¢å­åºåˆ—

```cpp
//https://www.luogu.com.cn/problem/B3637
//O(n^2)  -- DP
#include <iostream>
using namespace std;
const int N = 5005;
int n,ans;
int arr[N],dp[N];//dp[i]ä¸ºä»¥ç¬¬iä¸ªç‚¹çš„a[i]ç»“å°¾çš„æœ€å¤§çš„ä¸Šå‡åºåˆ—

int main() {
	cin >> n;
	for (int i = 1; i <= n;i++) {
		cin >> arr[i];
	}

	for (int i = 1; i <= n; i++) {
		dp[i] = 1;//åˆå§‹åŒ–dp[i] = 1;
		for (int j = 1; j < i;j++) {
			if (arr[i] > arr[j]) {
				dp[i] = max(dp[i], dp[j] + 1);
				//å‰ä¸€ä¸ªå°äºè‡ªå·±çš„æ•°ç»“å°¾çš„æœ€å¤§ä¸Šå‡å­åºåˆ—åŠ ä¸Šè‡ªå·±ï¼Œå³+1
			}			
		}
		ans = max(ans, dp[i]);
	}
	cout << ans;
}
```



```cpp
//https://www.acwing.com/problem/content/898/
//O(nlogn)  -- æ¨¡æ‹Ÿæ ˆ + äºŒåˆ†
//è¯ºæ±‚æœ€é•¿å•è°ƒéé€’å‡å­åºåˆ—  lbæ”¹ä¸ºub,>æ”¹>=å³å¯ï¼šhttps://ac.nowcoder.com/acm/contest/83252/D
#include <iostream>
#include <vector>
using namespace std;

const int N = 100005;
int n,arr[N];
vector<int>v;//æ¨¡æ‹Ÿå †æ ˆ

int main() {
	cin >> n;
	for (int i = 1; i <= n;i++) {
		cin >> arr[i];
	}	

	for (int i = 1; i <= n;i++) {
		if (v.empty()||arr[i] > v.back()) { //å¦‚æœarr[i]å¤§äºæ ˆé¡¶å…ƒç´ ,å°†è¯¥å…ƒç´ å…¥æ ˆ
			v.push_back(arr[i]); 
		}
		else {//å¦åˆ™æ›¿æ¢æ‰ç¬¬æ ˆä¸­ä¸€ä¸ªå¤§äºæˆ–è€…ç­‰äºarr[i]çš„é‚£ä¸ªæ•°
			*lower_bound(begin(v), end(v), arr[i]) = arr[i];           
		}
	}
	cout << v.size();
}
```

  



### æœ€é•¿å…¬å…±å­åºåˆ—

 **LCS**  Longest Common Subsequenceï¼Œæœ€é•¿å…¬å…±å­åºåˆ—

```cpp
//https://www.acwing.com/problem/content/899/
//O(nm)
#include <iostream>
using namespace std;
const int N = 1005;
int n, m, dp[N][N];//dp[i][j]è¡¨ç¤ºaçš„å‰iä¸ªå­—æ¯å’Œbçš„å‰jä¸ªå­—æ¯æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦
string a, b;
int main() {
	cin >> n >> m >> a >> b;
	a = ' ' + a, b = ' ' + b;
	for (int i = 1; i <= n;i++) {
		for (int j = 1; j <= m;j++) {
			if(a[i] == b[j]){//æƒ…å†µä¸€ï¼ša[i]åœ¨b[j]åœ¨(dp[i][j])
                dp[i][j] = max(dp[i][j],dp[i-1][j-1]+1);
            }
         	else {//æƒ…å†µäºŒï¼ša[i]åœ¨b[j]ä¸åœ¨(dp[i][j-1])ã€æƒ…å†µä¸‰ï¼ša[i]ä¸åœ¨b[j]åœ¨(d[i-1][j])
                //(æƒ…å†µå››ï¼ša[i]ä¸åœ¨b[j]ä¸åœ¨(dp[i-1][j-1]),å·²ç»åŒ…å«åœ¨æƒ…å†µäºŒã€ä¸‰ä¸­
                dp[i][j] = max(dp[i-1][j],dp[i][j-1]);
            }
		}
	}
	cout << dp[n][m];
    /*	å…·ä½“åºåˆ—æ–¹æ¡ˆ
    string s;
	for(int i = n,j = m;i >= 1 && j >= 1;){
		if(dp[i][j] == dp[i-1][j-1]+1){
			s += s1[i];
			i--;j--;
		}
		else if(dp[i][j] == dp[i-1][j]) i--;
		else if(dp[i][j] == dp[i][j-1]) j--;
	}
	for(int i = s.size()-1;i >= 0;i--){
		cout << s[i];
	}*/
}
```



**æœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—LCIS**

```cpp
//https://www.acwing.com/problem/content/274/
#include <iostream>
using namespace std;
const int N = 3003;
int n;
int a[N],b[N];
int dp[N][N];//a[]ä¸­å‰iä¸ªæ•°å­—,b[]ä¸­å‰jä¸ªæ•°å­—,..ä¸”å½“å‰ä»¥b[j]ç»“å°¾çš„å­åºåˆ—çš„æœ€é•¿æ–¹æ¡ˆ

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++) cin >> a[i];
	for(int i = 1;i <= n;i++) cin >> b[i];

	for(int i = 1;i <= n;i++){
		int nmax = 1;
		for(int j = 1;j <= n;j++){
			dp[i][j] = dp[i-1][j];
			if(b[j] == a[i]) dp[i][j] = max(dp[i][j],nmax);
			if(b[j] < a[i]) nmax = max(nmax,dp[i-1][j] + 1);
		}
	}
    
	int ans = 0;
	for(int i = 0;i <= n;i++){ans = max(ans,dp[n][i]);}
	cout << ans;
	return 0;
}
```





### ç¼–è¾‘è·ç¦»

å°†å­—ç¬¦ä¸²aé€šè¿‡ä»¥ä¸‹æ“ä½œå˜ä¸ºå­—ç¬¦ä¸²bçš„æœ€å°æ“ä½œæ¬¡æ•°

1. åˆ é™¤ä¸€ä¸ªå­—ç¬¦
2. æ’å…¥ä¸€ä¸ªå­—ç¬¦
3. ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦

> ```cpp
> if (a[i] == b[j]) dp[i][j] = dp[i-1][j-1];   //æ— éœ€ä¿®æ”¹
> else{
>     dp[i][j] = min({dp[i-1][j-1]+1,dp[i-1][j]+1,dp[i][j-1]+1});
>     /*min{
>     	a[1~i-1] = b[1~j-1],ä¿®æ”¹a[i]ä¸ºb[j]
>     	a[1~i-1] = b[1~j],åˆ é™¤a[i]
>     	a[1~i] = b[1~j-1],å¢åŠ b[j]
>     }*/
> }
> ```

```cpp
//https://www.luogu.com.cn/problem/P2758
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 2003;
int n,m;
string a,b;
int dp[N][N];//dp[i][j]ä¸ºå°†a[1~i]å˜ä¸ºb[1~j]çš„æœ€å°æ“ä½œæ¬¡æ•°

int main(){
	cin >> a >> b;n = a.size();m = b.size();
	a = ' ' + a,b = ' ' + b;

	for(int i = 1;i <= n;i++) dp[i][0] = i;//åˆå§‹åŒ–
	for(int j = 1;j <= m;j++) dp[0][j] = j;

	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= m;j++){
			if(a[i] == b[j]){
				dp[i][j] = dp[i-1][j-1];
			}
			else{
				dp[i][j] = min({dp[i-1][j-1]+1,dp[i-1][j]+1,dp[i][j-1]+1});
			}
		}
	}
	cout << dp[n][m];
}
```





##  åŒºé—´DP

**å®šä¹‰**

åŒºé—´ç±»åŠ¨æ€è§„åˆ’æ˜¯çº¿æ€§åŠ¨æ€è§„åˆ’çš„æ‰©å±•ï¼Œå®ƒåœ¨åˆ†é˜¶æ®µåœ°åˆ’åˆ†é—®é¢˜æ—¶ï¼Œä¸é˜¶æ®µä¸­å…ƒç´ å‡ºç°çš„é¡ºåºå’Œç”±å‰ä¸€é˜¶æ®µçš„å“ªäº›å…ƒç´ åˆå¹¶è€Œæ¥æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚

ä»¤çŠ¶æ€ $f(i,j)$ è¡¨ç¤ºå°†ä¸‹æ ‡ä½ç½® $i$ åˆ° $j$ çš„æ‰€æœ‰å…ƒç´ åˆå¹¶èƒ½è·å¾—çš„ä»·å€¼çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆ $f(i,j)=\max\{f(i,k)+f(k+1,j)+cost\}$ï¼Œ$cost$ ä¸ºå°†è¿™ä¸¤ç»„å…ƒç´ åˆå¹¶èµ·æ¥çš„ä»·å€¼ã€‚

**æ€§è´¨**

åŒºé—´ DP æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

åˆå¹¶ï¼šå³å°†ä¸¤ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†è¿›è¡Œæ•´åˆï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åè¿‡æ¥ï¼›

ç‰¹å¾ï¼šèƒ½å°†é—®é¢˜åˆ†è§£ä¸ºèƒ½ä¸¤ä¸¤åˆå¹¶çš„å½¢å¼ï¼›

æ±‚è§£ï¼šå¯¹æ•´ä¸ªé—®é¢˜è®¾æœ€ä¼˜å€¼ï¼Œæšä¸¾åˆå¹¶ç‚¹ï¼Œå°†é—®é¢˜åˆ†è§£ä¸ºå·¦å³ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæœ€ååˆå¹¶ä¸¤ä¸ªéƒ¨åˆ†çš„æœ€ä¼˜å€¼å¾—åˆ°åŸé—®é¢˜çš„æœ€ä¼˜å€¼ã€‚



### ä¸€ç»´

**çŸ³å­åˆå¹¶**

> nä¸ªæ•°a[1]~a[n]æ’æˆä¸€æ’ï¼Œè¿›è¡Œn-1æ¬¡åˆå¹¶æ“ä½œï¼Œæ¯æ¬¡æ“ä½œå°†ç›¸é‚»çš„ä¸¤å †åˆå¹¶æˆä¸€å †ï¼Œå¹¶è·å¾—æ–°çš„ä¸€å †ä¸­çš„çŸ³å­æ•°é‡çš„å’Œçš„å¾—åˆ†ã€‚ä½ éœ€è¦æœ€å°åŒ–ä½ çš„å¾—åˆ†ã€‚
>
> è¯ºè¦æ±‚ç¯å½¢çš„ï¼Œåªéœ€å°†ä¸¤ä¸ªa[ ]æ¥åœ¨ä¸€èµ·ã€‚æšä¸¾æ‰€æœ‰é•¿åº¦ä¸ºnçš„åŒºé—´å–æœ€å€¼

```cpp
//https://www.luogu.com.cn/problem/P1775
//O(n^3)
#include <iostream>
#include <cstring>
using namespace std;
const int N = 305;
int n;
int s[N];//a[]çš„å‰ç¼€å’Œ
int dp[N][N];//dp[i][j]è¡¨ç¤ºå°†iåˆ°jè¿™ä¸€æ®µçŸ³å­åˆå¹¶æˆä¸€å †çš„æ–¹æ¡ˆçš„é›†åˆï¼Œå±æ€§Min

int main() {
	cin >> n;
	for (int i = 1; i <= n;i++) {
        cin >> s[i];
        s[i] += s[i-1];
	}
    
    memset(dp,0x3f,sizeof dp);
	for(int i = 1;i <= n;i++) dp[i][i] = 0;
    
	for (int len = 2; len <= n;len++) {//æšä¸¾åŒºé—´é•¿åº¦ï¼Œå¯ä»¥è·³è¿‡1ï¼Œä»2å¼€å§‹
		for (int l = 1; l + len - 1 <= n;l++) {//æšä¸¾åŒºé—´å·¦å³ç«¯ç‚¹
			int r = l + len - 1;
			for (int k = l; k < r;k++) {// æšä¸¾åˆ†å‰²ç‚¹ï¼Œæ„é€ çŠ¶æ€è½¬ç§»æ–¹ç¨‹
				dp[l][r] = min(dp[l][r], dp[l][k]+dp[k+1][r] + s[r]-s[l-1]);
			}
		}
	}
	cout << dp[1][n];
}
///////////////////////////////////////////////////
//è®°å¿†åŒ–æœç´¢å†™æ³•
int sol(int l,int r){
	if(l >= r) return 0; 
	if(dp[l][r] != -1) return dp[l][r];
	dp[l][r] = 0x3f3f3f3f;
	for(int k = l;k <= r-1;k++){
		dp[l][r] = min(dp[l][r],sol(l,k)+sol(k+1,r) + s[r]-s[l-1]);
	}
	return dp[l][r];
}

memset(dp,-1,sizeof dp);
cout << sol(1,n);
```



> å½“nå¾ˆå¤§æ—¶ï¼Œç”¨Garsiaâ€“Wachs ç®—æ³•æ±‚è§£
>
> æ¯æ¬¡æ‰¾åˆ°ç¬¬ä¸€ä¸ªa[i-1] < a[i+1]çš„ä½ç½®ï¼ŒæŠŠa[i-1]å’Œa[i]åˆå¹¶ä¸ºnowï¼Œå†å°†nowæ’å…¥åˆ°ä»iå¼€å§‹å·¦è¾¹ç¬¬ä¸€ä¸ªa[k] > nowçš„a[k]åé¢

```cpp
//https://www.luogu.com.cn/problem/P5569
//éœ€è¦å¼€å¯O2ä¼˜åŒ–ï¼Œæˆ–ä½¿ç”¨å¹³è¡¡æ ‘ç­‰æ•°æ®ç»“æ„
#include<bits/stdc++.h>
using namespace std;
const int N= 40004;
const long long INF = 1e18;
long long ans;

int main(){
	int n;cin >> n;
	vector<long long>v(n+2);
	for(int i = 1;i <= n;i++){ cin >> v[i]; }
	v[0] = v[n+1] = INF;//åœ¨ä¸¤ç«¯è®¾ç½®å“¨å…µ
	n++;

	while(n-- && n >= 2){
		int i,k;
		for(i = 1;i <= n;i++){
			if(v[i-1] < v[i+1]) break;
		}
		int now = v[i-1]+v[i];
		ans += now;
		for(k = i-1;k >= 0;k--){
			if(v[k] > now) break;
		}

		v.erase(v.begin()+i-1);
		v.erase(v.begin()+i-1);
		v.insert(v.begin()+k+1,now);
	}
	cout << ans;
}
```



### äºŒç»´

**æ£‹ç›˜åˆ†å‰²**

> å°†ä¸€ä¸ª $8\times 8$ çš„æ£‹ç›˜è¿›è¡Œå¦‚ä¸‹åˆ†å‰²ï¼šå°†åŸæ£‹ç›˜å‰²ä¸‹ä¸€å—çŸ©å½¢æ£‹ç›˜å¹¶ä½¿å‰©ä¸‹éƒ¨åˆ†ä¹Ÿæ˜¯çŸ©å½¢ï¼Œå†å°†å‰©ä¸‹çš„ä¸¤éƒ¨åˆ†ä¸­çš„ä»»æ„ä¸€å—ç»§ç»­å¦‚æ­¤åˆ†å‰²ï¼Œè¿™æ ·å‰²äº† $(n-1)$ æ¬¡åï¼Œè¿åŒæœ€åå‰©ä¸‹çš„çŸ©å½¢æ£‹ç›˜å…±æœ‰ $n$ å—çŸ©å½¢æ£‹ç›˜ã€‚ï¼ˆæ¯æ¬¡åˆ‡å‰²éƒ½åªèƒ½æ²¿ç€æ£‹ç›˜æ ¼å­çš„è¾¹è¿›è¡Œï¼‰ã€‚åŸæ£‹ç›˜ä¸Šæ¯ä¸€æ ¼æœ‰ä¸€ä¸ªåˆ†å€¼ï¼Œä¸€å—çŸ©å½¢æ£‹ç›˜çš„æ€»åˆ†ä¸ºå…¶æ‰€å«å„æ ¼åˆ†å€¼ä¹‹å’Œã€‚ç°åœ¨éœ€è¦æŠŠæ£‹ç›˜æŒ‰ä¸Šè¿°è§„åˆ™åˆ†å‰²æˆ $n$ å—çŸ©å½¢æ£‹ç›˜ï¼Œå¹¶ä½¿å„çŸ©å½¢æ£‹ç›˜æ€»åˆ†çš„å¹³æ–¹å’Œæœ€å°ï¼Œç»™å®šnæ±‚æœ€å°å€¼æ—¶å¤šå°‘ï¼Ÿ
>

<img src="https://cdn.luogu.com.cn/upload/image_hosting/rxnb404s.png" style="zoom: 33%;" /> 

```cpp
#include <iostream>
#include <cmath>
#include <cstring>
using namespace std;
const long long INF = 1e18;
const int N = 20,M = 10;
int n,m = 8;
long long a[M][M],s[M][M];
long long dp[M][M][M][M][N];
//dp[x1][y1][x2][y2][k]è¡¨ç¤ºè¯¥çŸ©é˜µä¸”åˆ‡å‰²äº†kæ¬¡çš„æœ€å°å¹³æ–¹å’Œ

long long get(int x1,int y1,int x2,int y2){
	long long sum = s[x2][y2] - s[x2][y1-1] - s[x1-1][y2] + s[x1-1][y1-1];
	return sum*sum;
}

long long dfs(int x1,int y1,int x2,int y2,int k){//è®°å¿†åŒ–æœç´¢dp
	long long &now = dp[x1][y1][x2][y2][k];
	if(now >= 0) return now;//å¦‚æœè¯¥åŒºé—´å·²ç»æ±‚è¿‡ï¼Œç›´æ¥è¿”å›
	if(k == 1) return now = get(x1,y1,x2,y2);//k=1ä¸åˆ†å‰²ï¼Œç›´æ¥è¿”å›è¯¥åŒºé—´å’Œ
	now = INF;
	for(int i = x1;i < x2;i++){//æšä¸¾æ¨ªç€åˆ†å‰²
		now = min(now,dfs(x1,y1,i,y2,k-1)+get(i+1,y1,x2,y2));//é€‰ä¸ŠåŠæ®µ
		now = min(now,dfs(i+1,y1,x2,y2,k-1)+get(x1,y1,i,y2));//é€‰ä¸‹åŠæ®µ
	}
	for(int i = y1;i < y2;i++){//æšä¸¾ç«–ç€åˆ†å‰²
		now = min(now,dfs(x1,y1,x2,i,k-1)+get(x1,i+1,x2,y2));//é€‰å·¦åŠæ®µ
		now = min(now,dfs(x1,i+1,x2,y2,k-1)+get(x1,y1,x2,i));//é€‰å³åŠæ®µ
	}
	return now;
}

int main(){
	cin >> n;
	for(int i = 1;i <= m;i++){
		for(int j = 1;j <= m;j++){
			cin >> a[i][j];
			s[i][j] += s[i-1][j] + s[i][j-1] - s[i-1][j-1] + a[i][j];
		}
	}
	memset(dp,-0x3f,sizeof dp);
	cout << dfs(1,1,8,8,n);
}
```









## è®¡æ•°DP

æ•´æ•°åˆ’åˆ†

> ä¸€ä¸ªæ­£æ•´æ•° n å¯ä»¥è¡¨ç¤ºæˆè‹¥å¹²ä¸ªæ­£æ•´æ•°ä¹‹å’Œï¼Œå½¢å¦‚ï¼šn=n1+n2+â€¦+nkï¼Œå…¶ä¸­ n1â‰¥n2â‰¥â€¦â‰¥nk,kâ‰¥1ã€‚ç°åœ¨ç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼ˆ1<=n<=1000ï¼‰ï¼Œè¯·ä½ æ±‚å‡º nå…±æœ‰å¤šå°‘ç§ä¸åŒçš„åˆ’åˆ†æ–¹æ³•ã€‚

å®Œå…¨èƒŒåŒ…è§£æ³•ï¼šæŠŠ1,2,3, â€¦ nåˆ†åˆ«çœ‹åšnä¸ªç‰©ä½“çš„ä½“ç§¯ï¼Œè¿™nä¸ªç‰©ä½“å‡æ— ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼Œé—®æ°å¥½èƒ½è£…æ»¡æ€»ä½“ç§¯ä¸ºnçš„èƒŒåŒ…çš„æ€»æ–¹æ¡ˆæ•°

```cpp
//https://www.acwing.com/problem/content/902/
//O(N^2)
#include <iostream>
using namespace std;
const int N = 1005, mod = 1e9 + 7;
int n, dp[N];

int main() {
	cin >> n;

	dp[0] = 1;//å®¹é‡ä¸º0æ—¶ï¼Œå‰iä¸ªç‰©å“å…¨ä¸é€‰ä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆ

	for (int i = 1; i <= n;i++) {
		for (int j = i; j <= n;j++) {
			dp[j] = (dp[j] + dp[j - i]) % mod;
		}
	}
	cout << dp[n];
}
```



å¦ä¸€ç§è§£æ³•ï¼šdp[i] [j]è¡¨ç¤ºä¸ºæ€»å’Œä¸ºiï¼Œæ€»ä¸ªæ•°ä¸ºjçš„æ–¹æ¡ˆæ•°

```cpp
#include <iostream>
using namespace std;
const int N = 1005, mod = 1e9 + 7;
int n,ans, dp[N][N];

int main() {
	cin >> n;
	
	dp[0][0] = 1;

	for (int i = 1; i <= n;i++) {
		for (int j = 1; j <= i;j++) {
			dp[i][j] = (dp[i - 1][j - 1] + dp[i - j][j]) % mod;
		}
	}
    
	for (int i = 1; i <= n;i++) {
		ans = (ans + dp[n][i]) % mod;
	}
    
	cout << ans;
}
```



https://codeforces.com/contest/560/problem/E

ç»™å®šä¸€ä¸ªH*Wçš„æ£‹ç›˜ï¼Œå…¶ä¸­æœ‰nä¸ªé»‘æ ¼å­ä¸èƒ½èµ°ï¼Œæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–å³èµ°ï¼Œé—®ä»å·¦ä¸Šèµ°åˆ°å³ä¸‹è§’å…±æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿ
æ’åºåï¼Œä»¤dp[i]è¡¨ç¤ºä»å·¦ä¸Šèµ°åˆ°æ’åºåçš„ç¬¬iä¸ªæ ¼å­ä¸”ä¸ç»è¿‡å…¶ä»–é»‘æ ¼å­çš„èµ°æ³•ï¼Œåˆ™æœ‰ï¼š
$$
dp[i] = C_{x_i+y_i-2}^{x_i-1}-\sum_{j=0}^{i-1}{dp[j]*C_{x_i+y_i-x_j-y_j}^{x_i-x_j}}ï¼Œå…¶ä¸­x_i>=x_jä¸”y_i>=y_j
$$

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 200005;
int h,w,n;
const int mod = 1e9+7;
long long dp[N];

struct node{
	int x,y;
	bool operator < (const auto&e2){
		if(x != e2.x) return x < e2.x;
		return y < e2.y;
	}
}a[N];

long long qmi(long long a,long long b,long long p){
	long long ans = 1;
	while(b){
		if(b&1) ans = ans*a%mod;
		b >>= 1;
		a = a*a%mod;
	}
	return ans%mod;
}

long long fact[N],infact[N];
void init(){
	fact[0] = infact[0] = 1;
	for(int i = 1;i < N;i++){
		fact[i] = i*fact[i-1]%mod;
	}
	infact[N-1] = qmi(fact[N-1],mod-2,mod);
	for(int i = N-2;i >= 1;i--){
		infact[i] = infact[i+1]*(i+1)%mod;
	}
}

long long C(int a,int b){
	return fact[a]*infact[b]%mod*infact[a-b]%mod;
}

int main(){
	init();
	cin >> h >> w >> n;
	for(int i = 1;i <= n;i++){ cin >> a[i].x >> a[i].y; }
	sort(a+1,a+n+1);
	a[n+1] = {h,w};
	for(int i = 1;i <= n+1;i++){
		auto [x,y] = a[i];
		dp[i] = C(x+y-2,x-1);
		for(int j = 1;j < i;j++){
			if(x < a[j].x || y < a[j].y) continue;
			dp[i] -= dp[j]*C(x+y - a[j].x-a[j].y,x-a[j].x)%mod;
		}
		dp[i] = (dp[i]%mod+mod)%mod;
	}
	cout << dp[n+1];
}
```





## æ•°ä½DP

[æ•°ä½ DP - OI Wiki (oi-wiki.org)](https://oi-wiki.org/dp/number/)

æ±‚åŒºé—´[l,r]ä¸­ç­”æ¡ˆçš„ä¸ªæ•°ï¼Œå¯ä»¥è½¬åŒ–ä¸ºæ±‚ F(r) - F(l-1)ï¼Œå…¶ä¸­F(x)ä¸ºåŒºé—´[1,x]ä¸­ç­”æ¡ˆçš„ä¸ªæ•°





[P2602 [ZJOI2010\] æ•°å­—è®¡æ•° - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P2602)

> é¢˜ç›®å¤§æ„ï¼šç»™å®šä¸¤ä¸ªæ­£æ•´æ•°a,b,æ±‚åœ¨[a,b]ä¸­çš„æ‰€æœ‰æ•´æ•°ä¸­ï¼Œæ¯ä¸ªæ•°ç (digit)å„å‡ºç°äº†å¤šå°‘æ¬¡ã€‚

```cpp
#include <iostream>
#include <cstring>

const int N = 13;
int nums[N],len;
long long dp[N][N];//dp[pos][sum]è¡¨ç¤ºposä½ç½®,å½“å‰å·²ç»ç»Ÿè®¡äº†sumä¸ªç›®æ ‡æ•°å­—çš„æ–¹æ¡ˆæ•°

long long dfs(int pos,bool lim,bool zero,int dig,int sum){
	if(!pos) return sum;
	if(!lim && !zero && ~dp[pos][sum]) return dp[pos][sum];
	int up = lim ? nums[pos] : 9;
	long long ans = 0;
	for(int i = 0;i <= up;i++){
		bool count = (!(zero&(!i)) && (i == dig));//å½“å‰i==digä¸”ä¸å­˜åœ¨å‰å¯¼0
		ans += dfs(pos-1,lim&(i==up),zero&(!i),dig,sum+count);
	}
	return (lim || zero) ? ans : dp[pos][sum] = ans;
}

long long f(long long x,int dig){
	len = 0;
	while(x) nums[++len] = x % 10, x /= 10;
	return dfs(len,1,1,dig,0);
}

int main(){
	long long l,r; std::cin >> l >> r;
	for(int i = 0;i <= 9;i++){
		std::memset(dp,-1,sizeof dp);
		std::cout << f(r,i) - f(l-1,i) << ' ';
	}
}
```



```cpp
//åº¦çš„æ•°é‡  https://ac.nowcoder.com/acm/contest/973/A
//æ±‚ç»™å®šåŒºé—´[X,Y]ä¸­æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„æ•´æ•°ä¸ªæ•°ï¼šè¿™ä¸ªæ•°æ°å¥½ç­‰äºKä¸ªäº’ä¸ç›¸ç­‰çš„Bçš„æ•´æ•°æ¬¡å¹‚ä¹‹å’Œã€‚
#include <iostream>
#include <vector>
using namespace std;
const int N = 35;
int k,b;
int c[N][N];

void init(){
	for(int i = 0;i < N;i++){
		for(int j = 0;j <= i;j++){
			if(!j) c[i][j] = 1;
			else c[i][j] = c[i-1][j] + c[i-1][j-1];
		}
	}
}

int f(int n){
	if(n == 0) return 0;
	vector<int>v;
	while(n) v.emplace_back(n%b),n/=b;//å°†nè½¬åŒ–ä¸ºbè¿›åˆ¶æ•°
	for(int i = v.size()-1;i >= 0;i--){
		cout << v[i];
	}
	cout << endl;

	int ans = 0;
	int last = 0;//è®°å½•å‰é¢å·²ç»å ç”¨å¤šå°‘ä½
	for(int i = v.size()-1;i >= 0;i--){
		int x = v[i];
		if(x > 0){
			if(i >= k-last) ans += c[i][k-last];//å½“å‰ä½(i)å¡«0,åˆ™å‰©ä¸‹ä½(0~i-1)å¯ä»¥ä»»æ„å¡«,å…±æœ‰C(i,k-last)ç§å¡«æ³•
			if(x >= 2){//å½“å‰ä½(i)å¡«1,åˆ™å‰©ä¸‹ä½(0~i-1)å¯ä»¥ä»»æ„å¡«,å…±æœ‰C(i,k-last-1)ç§å¡«æ³•,ç›´æ¥break
				if(i >= k-last-1 && k-last-1 >= 0) ans += c[i][k-last-1];
				break;
			}
			else {//å¦‚æœx==1,åˆ™å½“å‰ä½åªèƒ½å¡«1,å·²ç”¨ä½æ•°last++,é˜²æ­¢åŠ ä¸Šåé¢å¡«çš„æ•°ä¼šè¶…è¿‡n,ç»§ç»­å¤„ç†ä¸‹ä¸€ä½
				last++;
				if(last > k) break;
			}
		}
		if(i == 0 && last == k) ans++;//ç‰¹æ®Šå¤„ç†æœ€åä¸€ä½å³åˆ†æ”¯
	}
	return ans;
}

int main(){
	init();
	int l,r;cin >> l >> r >> k >> b;
	cout << f(r) - f(l-1);
}
```

```cpp
//éä¸‹é™æ•°  https://ac.nowcoder.com/acm/problem/50517
//æ±‚ç»™å®šåŒºé—´å†…æœ‰å¤šå°‘ä¸ªéä¸‹é™æ•°
#include <iostream>
#include <vector>
using namespace std;
const int N = 15;
int dp[N][N];//dp[i][j]è¡¨ç¤ºå…±æœ‰iä½,ä¸”æœ€é«˜ä½æ•°å­—æ˜¯jçš„æ‰€æœ‰éä¸‹é™æ•°çš„ä¸ªæ•°

void init(){
	for(int i = 1;i <= 9;i++){ dp[1][i] = 1; }
	for(int i = 2;i < N;i++){
		for(int j = 0;j <= 9;j++){
			for(int k = j;k <= 9;k++){
				dp[i][j] += dp[i-1][k];
			}
		}
	}
}

int f(int n){
	if(n == 0) return 1;
	vector<int>v;
	while(n) v.emplace_back(n%10),n/=10;

	int ans = 0;
	int last = 0;//ä¿å­˜å‰é¢ä½çš„æœ€å¤§å€¼
	for(int i = v.size()-1;i >= 0;i--){
		int x = v[i];
		for(int j = last;j < x;j++){//å·¦è¾¹åˆ†æ”¯,å› ä¸ºè¦ä¿æŒä¸é™åº,æ‰€ä»¥j>=last
			ans += dp[i+1][j];
		}
		if(x < last) break;//å¦‚æœä¸Šä¸€ä½æœ€å¤§å€¼å¤§äºxçš„è¯,ä¸æ„æˆé™åº,æ‰€ä»¥å³è¾¹åˆ†æ”¯ç»“æŸ
		else last = x;
		if(i == 0) ans++;//å…¨éƒ¨æšä¸¾å®Œäº†,è¯´æ˜næœ¬èº«æ„æˆä¸€ä¸ªæ–¹æ¡ˆ
	}
	return ans;
}

int main(){
	init();
	int l,r;
	while(cin >> l >> r){
		cout << f(r) - f(l-1) << '\n';
	}
}
```





### è®°å¿†åŒ–æœç´¢

å»ºè®®æ•°ä½DPä½¿ç”¨è®°å¿†åŒ–æœç´¢åšï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ¯”é€’æ¨ç®€å•ä¸€ç‚¹ã€‚

```cpp
//å¸¸è§„å†™æ³•
//zeroæ ¹æ®å‰å¯¼é›¶æ˜¯å¦ä¼šå½±å“ç­”æ¡ˆæ·»åŠ 
//stateå¯èƒ½éœ€è¦è®¾è®¡å¤šä¸ª
ll dfs(int pos,bool lim,bool zero ,int state){
    if(!pos) return check(state);
    if(!lim && !zero && ~dp[pos][state]) return dp[pos][state];
    int up = lim ? nums[pos] : 9;
    ll ans = 0;
    for(int i = 0;i <= up;i++){
        ans += dfs(pos-1,lim&(i==up),zero&(!i),update(state));
    }
    return (lim || zero) ? ans : dp[pos][state] = ans;
}

ll f(ll x){
    len = 0;
    while(x) nums[++len] = x % 10, x /= 10;
    return dfs(len,1,1,0);
}
```



[XHXJ's LIS - HDU 4352 - Virtual Judge (vjudge.net)](https://vjudge.net/problem/HDU-4352)

> Tç»„è¯¢é—®ï¼Œæ¯æ¬¡æ±‚åŒºé—´[Lï¼ŒR]å†…æœ‰å¤šå°‘æ•´æ•°çš„æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦ä¸ºKï¼Ÿ

è€ƒè™‘åˆ°æœ€é•¿ä¸Šå‡å­åºåˆ—å€¼åŸŸä¸ºä¸ä¼šè¶…è¿‡9ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªäºŒè¿›åˆ¶çŠ¶æ€å‹ç¼©è¡¨ç¤ºå½“å‰LISçš„çŠ¶æ€ã€‚å‰å¯¼0ä¸èƒ½ç®—å…¥LISï¼Œæ‰€ä»¥å‚æ•°è¦ä¼ å…¥å‰å¯¼0çŠ¶æ€ã€‚å¤šå¼€ä¸€ç»´Kå¯ä»¥èŠ‚çœåˆå§‹åŒ–DPæ•°ç»„çš„æ—¶é—´

```cpp
#include <iostream>
#include <cstring>

const int N = 22;
int k;
long long dp[N][1 << 10][10];//dp[pos][state][k]è¡¨ç¤ºç¬¬posä½,LISçŠ¶æ€å‹ç¼©ä¸ºstate,LISä¸ºkçš„æ–¹æ¡ˆæ•°
int nums[N],len;

int update(int state,int x,int zero){
	if(zero && (!x)) return state;//å‰å¯¼é›¶ä¸è®¡å…¥åºåˆ—
	for(int i = x;i <= 9;i++){//ç”¨xæ›¿æ¢stateä¸­ç¬¬ä¸€ä¸ª>=xçš„æ•°
		if(state >> i & 1) {
			return state & (~(1 << i)) | (1 << x);
		}
	}
	return state | 1 << x;
}

long long dfs(int pos,int state,int lim,int zero){//limåˆ¤æ–­å½“å‰ä½æ˜¯å¦æœ‰é™åˆ¶,zeroåˆ¤æ–­æ˜¯å¦æœ‰å‰å¯¼0
	if(!pos) return __builtin_popcount(state) == k;//é€’å½’ç»ˆç‚¹,åˆ¤æ–­LISé•¿åº¦
	if(~dp[pos][state][k] && !lim) return dp[pos][state][k];//è®°å¿†åŒ–ç»“æœ(æ— é™åˆ¶æ—¶å¤ç”¨)
	int up = lim ? nums[pos] : 9;//å½“å‰ä½ä¸Šé™,æ— é™åˆ¶åˆ™å¯ä»»æ„å¡«
	long long ans = 0;
	for(int i = 0;i <= up;i++){
		ans += dfs(pos-1,update(state,i,zero),lim && (i == up),zero && (!i));
	}
	return lim ? ans : dp[pos][state][k] = ans;//æ— é™åˆ¶æ—¶ç»“æœè®°å¿†åŒ–
}

long long f(long long x){
	len = 0;
	while(x) nums[++len] = x % 10, x /= 10;
	return dfs(len,0,1,1);
}

void sol(){
	long long l,r; std::cin >> l >> r >> k;
	std::cout << f(r) - f(l-1) << '\n';
}

int main(){
	std::memset(dp,-1,sizeof dp);
	int t; std::cin >> t;
	for(int i = 1;i <= t;i++){
		printf("Case #%d: ",i);
		sol();
	}
}
```



### è¯•å¡«æ³•

[P10958 å¯ç¤ºå½• - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10958)

> åªè¦æŸæ•°å­—çš„åè¿›åˆ¶è¡¨ç¤ºä¸­æœ‰ä¸‰ä¸ªè¿ç»­çš„ 6ï¼Œå³è®¤ä¸ºè¿™æ˜¯ä¸ªé­”é¬¼çš„æ•°ï¼Œæ¯”å¦‚ 666,1666,6663,16666,6660666 ç­‰ç­‰ã€‚
>
> ç»™å®šnï¼Œæ±‚ç¬¬nä¸ªé­”é¬¼æ•°æ˜¯å¤šå°‘ã€‚

å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨äºŒåˆ†+è®°å¿†åŒ–æœç´¢ï¼š[è®°å½•è¯¦æƒ…  (luogu.com.cn)](https://www.luogu.com.cn/record/228849502)

```cpp
#include <iostream>
using namespace std;
const int N = 12;
int n;
int dp[N][3],g[N];//dp[i][j]è¡¨ç¤ºå…±æœ‰iä½,ä¸”æœ‰è¿ç»­j(0~2)ä¸ª6ï¼Œg[i]è¡¨ç¤ºiä½å…±æœ‰å¤šå°‘ä¸ªé­”é¬¼æ•°

void init(){
	dp[0][0] = 1;
	dp[0][1] = dp[0][2] = 0;
	for(int i = 1; i < N;i++){
		dp[i][0] = 9*(dp[i-1][0]+dp[i-1][1]+dp[i-1][2]);
		dp[i][1] = dp[i-1][0];
		dp[i][2] = dp[i-1][1];
		g[i] = 10*g[i-1] + dp[i-1][2];
	}
}

void sol(){
	cin >> n;
	int m = 3;
	while(g[m] < n) m++;//ç¡®å®šä½æ•°,ç¬¬nä¸ªé­”é¬¼æ•°æœ‰mä½
	for(int i = m,k = 0;i >= 1;i--){
		for(int j = 0;j <= 9;j++){//å½“å‰ç¬¬iä½è¯ºå¡«j
			long long cnt = g[i-1];//åé¢i-1ä½è¿˜æœ‰cntç§å¡«æ³•èƒ½è®©æ•´ä¸ªæ•°æ˜¯é­”é¬¼æ•°
			if(j == 6 || k == 3){
				//å½“å‰ä½iå¼€å§‹,å·¦è¾¹å·²ç»æœ‰äº†è¿ç»­k+(j==6)ä¸ª6ï¼Œè¿˜å·®3-(k+(j==6))ä¸ª6
				for(int l = max(3-k-(j==6),0);l <= 2;l++){
					cnt += dp[i-1][l];
				}
			}
			if(cnt >= n){
				cout << j;
				if(k < 3){
					if(j == 6) k++;
					else k = 0;
				}
				break;
			}
			else n -= cnt;
		}
	}
	cout << '\n';
}

int main(){
	init();
	int t;cin >> t;
	while(t--) sol();
}
```



## çŠ¶å‹DP

[çŠ¶å‹ DP - OI Wiki (oi-wiki.org)](https://oi-wiki.org/dp/state/)

**é•¿æ–¹å½¢æ‘†æ”¾**

æ±‚æŠŠ NÃ—Mçš„æ£‹ç›˜åˆ†å‰²æˆè‹¥å¹²ä¸ª 1Ã—2 çš„é•¿æ–¹å½¢ï¼Œæœ‰å¤šå°‘ç§æ–¹æ¡ˆã€‚ 

<img src="https://cdn.acwing.com/media/article/image/2019/01/26/19_4dd1644c20-2411_1.jpg" alt="2411_1.jpg" style="zoom: 67%;" /> 

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20240521160644123.png" alt="image-20240521160644123" style="zoom: 33%;" /> 

ç”¨äºŒè¿›åˆ¶jè¡¨ç¤ºç¬¬iåˆ—çŠ¶æ€ï¼Œå¦‚ç¬¬1åˆ—çŠ¶æ€ä¸º10010ï¼Œç¬¬2åˆ—çŠ¶æ€ä¸º01001ï¼Œst[1|2] = 11011

```cpp
//https://www.acwing.com/problem/content/description/293/
#include <iostream>
#include <cstring>
#include <vector>
using namespace std;
const int N = 12, M = 1 << N;//M = 2^N
int n, m;
bool st[M];
long long dp[N][M];//ç¬¬ä¸€ç»´è¡¨ç¤ºåˆ—ï¼Œ ç¬¬äºŒç»´è¡¨ç¤ºæ‰€æœ‰å¯èƒ½çš„çŠ¶æ€(1è¡¨ç¤ºå½“å‰ä½ç½®æ”¾äº†æ¨ªç€çš„é•¿æ–¹å½¢çš„å·¦åŠè¾¹)
vector<int>v[M];//äºŒç»´æ•°ç»„è®°å½•åˆæ³•çš„çŠ¶æ€

int main() {
	while (cin >> n >> m, n && m) {//nè¡Œï¼Œmåˆ—
		//é¢„å¤„ç†1ï¼šç­›æ‰è¿ç»­å¥‡æ•°ä¸ª0çš„çŠ¶æ€(ä¸èƒ½ç«–ç€æ”¾æ»¡é•¿æ–¹å½¢)
		for (int j = 0; j < (1 << n); j++) {//j < 2^n
			st[j] = 1;
			int cnt = 0;//cntè®°å½•è¿ç»­0çš„ä¸ªæ•°
			for (int k = 0; k < n; k++) {
				if ((j >> k) & 1) {//å¦‚æœå½“å‰ä½ä¸º1ï¼Œä¸”å‰æœ‰è¿ç»­å¥‡æ•°ä¸ª0åˆ™çŠ¶æ€ä¸åˆæ³•
					if (cnt & 1)st[j] = 0;
					cnt = 0;
				}
				else cnt++;
			}
			if (cnt & 1)st[j] = 0;//åˆ¤æ–­æœ€åä¸€èŠ‚è¿ç»­0ä¸ªæ•°
		}

		//é¢„å¤„ç†2ï¼šçœ‹ç¬¬iåˆ—èƒ½ä½¿ç”¨é‚£äº›çŠ¶æ€è€Œä¸ä¼šå’Œç¬¬i-1åˆ—å†²çª
		for (int j = 0; j < (1 << n); j++) {//æšä¸¾ç¬¬iåˆ—çš„æ‰€æœ‰çŠ¶æ€j
			v[j].clear();//åˆå§‹åŒ–æ¸…ç©ºä¸Šæ¬¡æ“ä½œé—ç•™çš„çŠ¶æ€ï¼Œé˜²æ­¢å½±å“æœ¬æ¬¡çŠ¶æ€ã€‚
			for (int k = 0; k < (1 << n); k++) {//æšä¸¾ç¬¬i-1åˆ—çš„æ‰€æœ‰çŠ¶æ€k
				if ((j & k) == 0 && st[j | k]) {
					//j&kæŒ‰ä½ä¸åˆ¤æ–­i-1åˆ—ä¼¸åˆ°iåˆ—å’Œç¬¬iåˆ—çŠ¶æ€æ˜¯å¦é‡åˆå†²çª
					//j|kæŒ‰ä½æˆ–åˆ¤æ–­i-1åˆ—ä¼¸å‡ºå»çš„æ–¹å—æ˜¯å¦ä¼šå¯¼è‡´iåˆ—æœ‰è¿ç»­å¥‡æ•°ä¸ª0
					v[j].emplace_back(k);
					//jè¡¨ç¤ºç¬¬iåˆ—çš„å¯è¡ŒçŠ¶æ€ï¼Œkè¡¨ç¤ºç¬¬iåˆ—çŠ¶æ€ä¸ºjçš„æƒ…å†µä¸‹ç¬¬i-1åˆ—æ‰€æœ‰å¯è¡ŒçŠ¶æ€
				}
			}
		}

		memset(dp, 0, sizeof dp);
		dp[0][0] = 1;
        //ç¬¬1åˆ—ç”±è™šæ„çš„ç¬¬0åˆ—æ¨å¯¼ï¼Œç¬¬0åˆ—ä¸å¯èƒ½æ”¾æ¨ªæ¡ï¼Œåªèƒ½å…¨æ‘†è–¯æ¡ï¼Œæ•…æ‘†æ³•åªæœ‰ä¸€ç§ï¼Œæ— éœ€è€ƒè™‘å¥‡å¶æ€§
		for (int i = 1; i <= m; i++) {
			for (int j = 0; j < (1 << n); j++) {
				for (auto& k : v[j]) {
					dp[i][j] += dp[i - 1][k];
				}
			}
		}
		cout << dp[m][0] << endl;
		//dp[m][0]è¡¨ç¤º å‰m-1åˆ—éƒ½å¤„ç†å®Œï¼Œå¹¶ä¸”ç¬¬m-1åˆ—æ²¡æœ‰ä¼¸å‡ºæ¥çš„æ‰€æœ‰æ–¹æ¡ˆæ•°
		//æ—¢æ•´ä¸ªæ£‹ç›˜å¤„ç†å®Œçš„æ–¹æ¡ˆæ•°
	}
}
```





**æœ€çŸ­Hamiltonè·¯å¾„**

> ç»™å®šä¸€å¼  n(nâ‰¤20) ä¸ªç‚¹çš„å¸¦æƒæ— å‘å›¾ï¼Œç‚¹ä»0âˆ¼nâˆ’1æ ‡å·ï¼Œæ±‚èµ·ç‚¹ 0 åˆ°ç»ˆç‚¹ n-1 çš„æœ€çŸ­Hamiltonè·¯å¾„ã€‚ Hamiltonè·¯å¾„çš„å®šä¹‰æ˜¯ä» 0 åˆ° n-1 ä¸é‡ä¸æ¼åœ°ç»è¿‡æ¯ä¸ªç‚¹æ°å¥½ä¸€æ¬¡ã€‚

```cpp
//https://ac.nowcoder.com/acm/problem/50909
#include <iostream>
#include <algorithm>
#include <cstring>
using namespace std;
const int N = 21, M = 1 << N;
int n;
int a[N][N];//å¸¦æƒæ— å‘å›¾
int dp[M][N];//dp[i][j],iè¡¨ç¤ºå½“å‰èµ°è¿‡çš„ç‚¹çš„é›†åˆ,jè¡¨ç¤ºå½“å‰åœåœ¨äº†å“ªä¸ªç‚¹
//iä¸ºäºŒè¿›åˆ¶è¡¨ç¤ºè·¯å¾„ï¼Œå¦‚èµ°0,1,2,4ç‚¹åˆ™iä¸º(10111)=23

int main() {
	cin >> n;
	for (int i = 0; i < n;i++) {
		for (int j = 0; j < n;j++) {
			cin >> a[i][j];
		}
	}
	memset(dp, 0x3f, sizeof dp);//å› ä¸ºè¦æ±‚æœ€å°å€¼ï¼Œæ‰€ä»¥åˆå§‹åŒ–ä¸ºæ— ç©·å¤§
	dp[1][0] = 0;//0ä¸ºèµ·ç‚¹ï¼Œæ‰€ä»¥dp[1][0] = 0;

	for (int i = 1; i < 1 << n;i++) {//æšä¸¾æ‰€æœ‰è·¯å¾„
		for (int j = 0; j < n;j++) {//æšä¸¾æ‰€æœ‰ç»ˆç‚¹
			if (i >> j & 1) {//åˆæ³•ç»ˆç‚¹j
				for (int k = 0; k < n;k++) {//æšä¸¾æ‰€æœ‰ç»ˆç‚¹
					if (i >> k & 1) {//åˆæ³•ç»ˆç‚¹k
						dp[i][j] = min(dp[i][j], dp[i - (1 << j)][k] + a[k][j]);
						//dp[i][j] å¯¹ (dp[iä¸­ä¸åŒ…å«ç‚¹jçš„æ‰€æœ‰å­è·¯å¾„][ç»ˆç‚¹ä¸ºk] + a[k][j]) å–æœ€å°å€¼
					}
				}
			}
		}
	}
	cout << dp[(1 << n) - 1][n - 1];//[1111111...][n-1]è¡¨ç¤ºæ‰€æœ‰ç‚¹éƒ½èµ°è¿‡ï¼Œç»ˆç‚¹ä¸ºn-1
}
```



### bitsetä¼˜åŒ–

[Many Graph Queriesï¼ˆâ˜…7ï¼‰ - AtCoder typical90_bg - Virtual Judge (vjudge.net)](https://vjudge.net/problem/AtCoder-typical90_bg#author=GPT_zh)

> ç»™å®šNä¸ªç‚¹ï¼ŒMæ¡è¾¹çš„æœ‰å‘å›¾ã€‚å›ç­”Qä¸ªè¯¢é—®ï¼šä»ç‚¹aèƒ½å¦åˆ°è¾¾ç‚¹bï¼Ÿ$N,M,Q\le 10^5$

å°†è¯¢é—®åˆ†æˆ$\sqrt Q$ç»„ï¼Œä¾æ¬¡å¤„ç†æ¯ç»„è¯¢é—®ã€‚

```cpp
#include <iostream>
#include <bitset>
#include <vector>
using namespace std;

int main(){
	int n,m,q;cin >> n >> m >> q;
	vector<vector<int>>e(n);
	for(int i = 0;i < m;i++){
		int a,b;cin >> a >> b;
		a--;b--;
		e[a].emplace_back(b);
	}

	vector<int>a(q),b(q);
	for(int i = 0;i < q;i++){
		cin >> a[i] >> b[i];
		a[i]--;b[i]--;
	}

	for(int i = 0;i < q;i += 316){
		vector<bitset<316>>dp(n+1);
		for(int j = 0;j < 316 && i+j < q;j++){
			dp[a[i+j]][j] = 1;
		}
		for(int x = 0;x < n;x++){
			for(auto& y:e[x]){
				dp[y] |= dp[x];
			}
		}
		for(int j = 0;j < 316 && i+j < q;j++){
			if(dp[b[i+j]][j]) cout << "Yes\n";
			else cout << "No\n";
		}
	}
}
```



### é‡å¤è¦†ç›–é—®é¢˜

> ç»™å®šnä¸ªé›†åˆï¼Œå’Œä¸€ä¸ªç›®æ ‡é›†åˆï¼Œé€‰æ‹©æœ€å°‘çš„é›†åˆï¼Œä½¿å¾—æ‰€é€‰é›†åˆçš„å¹¶é›†=ç›®æ ‡é›†åˆ
>
> æ—¶é—´å¤æ‚åº¦$O(N*2^M)$ï¼Œè¯ºå¤æ‚åº¦è¿‡é«˜ï¼Œå¯ä»¥è€ƒè™‘Dancing Linksè§£å†³

```cpp
//ç³–æœ https://www.luogu.com.cn/problem/P8687
//dp[i]è¡¨ç¤ºä»çŠ¶æ€0000èµ°åˆ°çŠ¶æ€içš„æœ€å°‘æ­¥æ•°
#include <iostream>
#include <cstring>
using namespace std;
const int N = 105,M = 1 << 21;
int a[N];
int dp[M];

int main(){
	int n,m,k;cin >> n >> m >> k;
	for(int i = 1;i <= n;i++){
		for(int j = 1;j <= k;j++){
			int x;cin >> x;
			a[i] |= 1 << (x-1);
		}
	}
	memset(dp,0x3f,sizeof dp);
	dp[0] = 0;
	for(int i = 1;i <= n;i++){
		for(int j = 0;j < 1 << m;j++){
			dp[a[i]|j] = min(dp[a[i]|j],dp[j]+1);//æ ¸å¿ƒä»£ç 
		}
	}
	int ans = dp[(1<<m)-1];
	if(ans == 0x3f3f3f3f) cout << -1;
	else cout << ans;
}
```

```cpp
//dfs+è®°å¿†åŒ–å†™æ³•  dp[i]è¡¨ç¤ºä»çŠ¶æ€ièµ°åˆ°ç›®æ ‡çŠ¶æ€1111çš„æœ€å°‘æ­¥æ•°,å¦‚æœdp[i]=0(ä¸”i!=n)åˆ™æ²¡æœ‰è®¿é—®è¿‡è¯¥çŠ¶æ€
//memset(dp,0,sizeof dp);
//int ans = dfs(0);
int dfs(int u){
	if(u == (1 << m)-1) return 0;//ç›®æ ‡çŠ¶æ€
	if(dp[u]) return dp[u];//è¯ºçŠ¶æ€uåˆ°ä¹‹å‰è¾¾è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›
	int ans = 0x3f3f3f3f;//å¯ä»¥ç”¨dp[u] = 0x3f3f3f3fæ›¿æ¢;
	for(int i = 1;i <= n;i++){
		if((u|a[i]) == u) continue;//åªæœ‰çŠ¶æ€å‘ç”Ÿæ”¹å˜æ‰è½¬ç§»ï¼Œé˜²æ­¢æ­»å¾ªç¯
		ans = min(ans,dfs(u|a[i])+1);
	}
	return dp[u] = ans;
}
```





## æ ‘å½¢DP



 [æ´›è°· P1352 æ²¡æœ‰ä¸Šå¸çš„èˆä¼š](https://www.luogu.com.cn/problem/P1352)

â€‹    æ±‚è§£ä¸€é¢—æœ‰å‘æ ‘çš„[æœ€å¤§æƒç‹¬ç«‹é›†](æ‰€é€‰çš„é¡¶ç‚¹ä¹‹é—´æ²¡æœ‰ä¸¤è¾¹ï¼Œä¸”ç‚¹æƒå’Œæœ€å¤§)ï¼Œæ¯æ¡è¾¹æœ€å¤šé€‰ä¸€ä¸ªç‚¹

> æˆ‘ä»¬è®¾ $f(i,0/1)$ ä»£è¡¨ä»¥ $i$ ä¸ºæ ¹çš„å­æ ‘çš„æœ€ä¼˜è§£ï¼ˆç¬¬äºŒç»´çš„å€¼ä¸º 0 ä»£è¡¨ $i$ ä¸å‚åŠ èˆä¼šçš„æƒ…å†µï¼Œ1 ä»£è¡¨ $i$ å‚åŠ èˆä¼šçš„æƒ…å†µï¼‰ã€‚
>
> å¯¹äºæ¯ä¸ªçŠ¶æ€ï¼Œéƒ½å­˜åœ¨ä¸¤ç§å†³ç­–ï¼ˆå…¶ä¸­ä¸‹é¢çš„ $x$ éƒ½æ˜¯ $i$ çš„å„¿å­ï¼‰ï¼š
>
> -   ä¸Šå¸ä¸å‚åŠ èˆä¼šæ—¶ï¼Œä¸‹å±å¯ä»¥å‚åŠ ï¼Œä¹Ÿå¯ä»¥ä¸å‚åŠ ï¼Œæ­¤æ—¶æœ‰ $f(i,0) = \sum\max \{f(x,1),f(x,0)\}$ï¼›
> -   ä¸Šå¸å‚åŠ èˆä¼šæ—¶ï¼Œä¸‹å±éƒ½ä¸ä¼šå‚åŠ ï¼Œæ­¤æ—¶æœ‰ $f(i,1) = \sum{f(x,0)} + a_i$ã€‚
>
> æˆ‘ä»¬å¯ä»¥é€šè¿‡ DFSï¼Œåœ¨è¿”å›ä¸Šä¸€å±‚æ—¶æ›´æ–°å½“å‰ç»“ç‚¹çš„æœ€ä¼˜è§£ã€‚ 

```cpp
//https://www.luogu.com.cn/problem/P1352
#include <iostream>
#include <cstring>
using namespace std;
const int N = 6006;
int n,w[N];
int h[N], e[N], ne[N], idx;
int dp[N][2];//dp[i][0]è¡¨ç¤ºièŠ‚ç‚¹ä¸å‚åŠ ï¼Œdp[i][1]è¡¨ç¤ºièŠ‚ç‚¹å‚åŠ 
bool st[N];//æ ‡è®°èŠ‚ç‚¹æ˜¯å¦æœ‰çˆ¶èŠ‚ç‚¹

void add(int a, int b) {
	e[idx] = b, ne[idx] = h[a], h[a] = idx++;
}

void dfs(int u) {
	dp[u][1] = w[u];
	for (int i = h[u]; i != -1;i = ne[i]) {
		int k = e[i];
		dfs(k);
		dp[u][0] += max(dp[k][0], dp[k][1]);//çˆ¶èŠ‚ç‚¹å‚åŠ æ—¶å­èŠ‚ç‚¹å¯å‚åŠ å¯ä¸å‚åŠ 
		dp[u][1] += dp[k][0];//çˆ¶èŠ‚ç‚¹å‚åŠ æ—¶å­èŠ‚ç‚¹éƒ½ä¸èƒ½å‚åŠ 
	}
}

int main() {
	memset(h, -1, sizeof h);
	cin >> n;
	for (int i = 1; i <= n;i++) {
		cin >> w[i];
	}
	for (int i = 1; i < n;i++) {
		int a, b; cin >> a >> b;
		add(b, a);
		st[a] = 1;//æ ‡è®°aæœ‰çˆ¶èŠ‚ç‚¹
	}

	int root = 1;
	while (st[root]) root++;
	dfs(root);//ä»æ ¹èŠ‚ç‚¹æœç´¢

	cout << max(dp[root][0], dp[root][1]);
}
```



[çš‡å®«çœ‹å®ˆ](https://ac.nowcoder.com/acm/contest/972/E)

æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘è¦è¿æ¥ä¸€ä¸ªè¢«é€‰æ‹©çš„ç‚¹ï¼Œå¹¶ä½¿æ‰€æœ‰é€‰æ‹©çš„ç‚¹æ€»èŠ±è´¹æœ€å°

dp[iï¼Œ0]  è¡¨ç¤ºæœªé€‰æ‹©å½“å‰ç‚¹ï¼Œä¸”é€‰æ‹©äº†å…¶çˆ¶èŠ‚ç‚¹ã€‚
dp[iï¼Œ1]  è¡¨ç¤ºæœªé€‰æ‹©å½“å‰ç‚¹ï¼Œä¸”é€‰æ‹©äº†è‡³å°‘ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚
dp[iï¼Œ2]  è¡¨ç¤ºé€‰æ‹©äº†å½“å‰ç‚¹ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 1505;
int n;
int h[N],e[N],ne[N],w[N],idx;
int dp[N][N];
bool st[N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u){
	dp[u][2] = w[u];
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		dfs(k);
		dp[u][0] += min(dp[k][1],dp[k][2]);
		dp[u][2] += min({dp[k][0],dp[k][1],dp[k][2]});
	}
	dp[u][1] = 0x3f3f3f3f;
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		dp[u][1] = min(dp[u][1],dp[u][0]+dp[k][2]-min(dp[k][1],dp[k][2]));
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i <= n;i++){
		int a,k;cin >> a >> w[a] >> k;
		while(k--){
			int b;cin >> b;
			add(a,b);
			st[b] = 1;
		}
	}
	int root = 1;
	while(st[root]) root++;
	dfs(root);
	cout << min(dp[root][1],dp[root][2]);
}
```







### æ ‘ä¸ŠèƒŒåŒ…



```cpp
//é€‰è¯¾ https://www.luogu.com.cn/problem/P2014
//O(N*M^2)   æœ‰ä¾èµ–å…³ç³»çš„èƒŒåŒ…é—®é¢˜
//å¯¹äºæ£®æ—ï¼Œå¯ä»¥å°†æ¯ä¸€æ£µæ ‘çš„æ ¹èŠ‚ç‚¹éƒ½æ¥åˆ°ä¸€ä¸ª"è™šæ‹Ÿæ ¹èŠ‚ç‚¹0"ä¸Šï¼Œä»¥0ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œdp[0][m+1]å³ä¸ºç­”æ¡ˆ
#include <iostream>
#include <cstring>
using namespace std;
const int N = 305;
int n,m;
int s[N],k[N];
int h[N],e[N],ne[N],idx;
int dp[N][N];//é€‰åˆ°èŠ‚ç‚¹i,ä»·å€¼ä¸è¶…è¿‡jçš„æœ€å¤§ä»·å€¼

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs(int u){//åˆ†ç»„èƒŒåŒ…å¤„ç†
	for(int i = h[u];~i;i = ne[i]){//æšä¸¾ç‰©å“ç»„
		dfs(e[i]);
		for(int j = m+1;j >= 0;j--){//æšä¸¾ä½“ç§¯  j(m+1~0)
			for(int k = 0;k <= j-1;k++){//æšä¸¾å†³ç­– k(0~j-v[u])
				dp[u][j] = max(dp[u][j],dp[u][j-k]+dp[e[i]][k]);
			}
		}
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> k[i] >> s[i];
		for(int j = 1;j <= m;j++) dp[i][j] = s[i]; //åˆå§‹çŠ¶æ€
		add(k[i],i);
	}
	dfs(0);
	cout << dp[0][m+1];
}
```







### æ¢æ ¹DP

æ ‘å½¢ DP ä¸­çš„æ¢æ ¹ DP é—®é¢˜åˆè¢«ç§°ä¸ºäºŒæ¬¡æ‰«æï¼Œé€šå¸¸ä¸ä¼šæŒ‡å®šæ ¹ç»“ç‚¹ï¼Œå¹¶ä¸”æ ¹ç»“ç‚¹çš„å˜åŒ–ä¼šå¯¹ä¸€äº›å€¼ï¼Œä¾‹å¦‚å­ç»“ç‚¹æ·±åº¦å’Œã€ç‚¹æƒå’Œç­‰äº§ç”Ÿå½±å“ã€‚

é€šå¸¸éœ€è¦ä¸¤æ¬¡ DFSï¼Œç¬¬ä¸€æ¬¡ DFS è‡ªåº•å‘ä¸Šé¢„å¤„ç†è¯¸å¦‚æ·±åº¦ï¼Œå­æ ‘å¤§å°ï¼Œç‚¹æƒå’Œä¹‹ç±»çš„ä¿¡æ¯ï¼Œåœ¨ç¬¬äºŒæ¬¡ DFS è‡ªé¡¶å‘ä¸‹å¼€å§‹è¿è¡Œæ¢æ ¹åŠ¨æ€è§„åˆ’ã€‚

```cpp
//https://www.luogu.com.cn/problem/P3478
//ç»™å®šä¸€ä¸ªnä¸ªç‚¹çš„æ ‘ï¼Œè¯·æ±‚å‡ºä¸€ä¸ªç»“ç‚¹ï¼Œä½¿å¾—ä»¥è¿™ä¸ªç»“ç‚¹ä¸ºæ ¹æ—¶ï¼Œæ‰€æœ‰ç»“ç‚¹çš„æ·±åº¦ä¹‹å’Œæœ€å¤§ã€‚
#include <iostream>
#include <cstring>
using namespace std;
const int N = 2000006;
int n;
int h[N],e[N],ne[N],idx;
long long f[N],siz[N],deep[N];

void add(int a,int b){
	e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs_d(int u,int fa){
	siz[u] = 1;
	deep[u] = deep[fa]+1;
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		dfs_d(k,u);
		siz[u] += siz[k];
	}
}

void dfs_u(int u,int fa){
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		f[k] = f[u]-siz[k]+n-siz[k];
		dfs_u(k,u);
	}
}

int main(){
	memset(h,-1,sizeof h);
	cin >> n;
	for(int i = 1;i < n;i++){
		int a,b;cin >> a >> b;
		add(a,b);add(b,a);
	}

	dfs_d(1,0);//ä¸€èˆ¬ç¬¬ä¸€édfsç”±åº•å›æº¯åˆ°æ ¹ç»Ÿè®¡ä¿¡æ¯
	for(int i = 1;i <= n;i++) f[1] += deep[i];//ä»»é€‰ä¸€ä¸ªç‚¹(ä¸€èˆ¬ä¸º1)ä½œä¸ºæ ¹
	dfs_u(1,0);//å†dfsç”±æ ¹åˆ°åº•è€ƒè™‘å°†æ ¹ä¸æ–­è½¬ç§»åˆ°å­èŠ‚ç‚¹ï¼Œæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹æ—¶çš„ç­”æ¡ˆ

	long long ans = 0,p = 0;
	for(int i = 1;i <= n;i++){
		if(ans < f[i]){ ans = f[i]; p = i; }
	}
	cout << p;
}
```



```cpp
//hdu2196 computer  https://acm.hdu.edu.cn/showproblem.php?pid=2196
//æ±‚æ¯ä¸ªèŠ‚ç‚¹è·ç¦»å…¶å®ƒèŠ‚ç‚¹çš„æœ€è¿œè·ç¦»
#include <iostream>
#include <cstring>
using namespace std;
const int N = 20004;
int n;
int h[N],e[N],ne[N],idx,w[N];
int d1[N],d2[N],p1[N],p2[N],up[N];//d1å’Œd2ä¸ºèŠ‚ç‚¹uå‘ä¸‹çš„æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼,upä¸ºå‘ä¸Šçš„æœ€å¤§å€¼

void add(int a,int b,int c){
	w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;
}

void dfs_d(int u,int fa){
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		dfs_d(k,u);
		int t = d1[k] + w[i];
		if(t > d1[u]){
			d2[u] = d1[u];d1[u] = t;
			p2[u] = p1[u];p1[u] = k;
		}
		else if(t > d2[u]){
			d2[u] = t;
			p2[u] = k;
		}
	}
}

void dfs_u(int u,int fa){
	for(int i = h[u];~i;i = ne[i]){
		int k = e[i];
		if(k == fa) continue;
		if(p1[u] == k){ up[k] = max(up[u],d2[u]) + w[i]; }
		else { up[k] = max(up[u],d1[u]) + w[i];}
		dfs_u(k,u);
	}
}

int main(){
	while(cin >> n){
		for(int i = 1;i <= n;i++){
			h[i] = -1; d1[i] = d2[i] = up[i] = 0;
		}
		idx = 0;

		for(int i = 2;i <= n;i++){
			int b,c;cin >> b >> c;
			add(i,b,c);add(b,i,c);
		}
		dfs_d(1,0);
		dfs_u(1,0);

		for(int i = 1;i <= n;i++){
			int now = max(d1[i],up[i]);
			cout << now << '\n';
		}
	}
}
```









## è®°å¿†åŒ–æœç´¢

è®°å¿†åŒ–æœç´¢æ˜¯ä¸€ç§é€šè¿‡è®°å½•å·²ç»éå†è¿‡çš„çŠ¶æ€çš„ä¿¡æ¯ï¼Œä»è€Œé¿å…å¯¹åŒä¸€çŠ¶æ€é‡å¤éå†çš„æœç´¢å®ç°æ–¹å¼ã€‚

å› ä¸ºè®°å¿†åŒ–æœç´¢ç¡®ä¿äº†æ¯ä¸ªçŠ¶æ€åªè®¿é—®ä¸€æ¬¡ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„åŠ¨æ€è§„åˆ’å®ç°æ–¹å¼ã€‚



**æ»‘é›ª**

```cpp
//https://ac.nowcoder.com/acm/problem/235954
#include <iostream>
#include <cstring>
using namespace std;
const int N = 305;
int n, m;
int a[N][N];
int dp[N][N];//dp[i][j]è¡¨ç¤ºä»i,jå¼€å§‹æ»‘çš„æœ€é•¿è·¯å¾„
int px[] = { 0,0,-1,1 }, py[] = { 1,-1,0,0 };

int dfs(int x, int y) {
	if (dp[x][y]) return dp[x][y];//å¦‚æœå·²ç»è®¡ç®—è¿‡äº†ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç­”æ¡ˆï¼Œé¿å…é‡å¤è®¡ç®—
	dp[x][y] = 1;//æ³¨æ„dp[x][y]è‡³å°‘ä¸º1(å››ä¸ªæ–¹å‘éƒ½ä¸èƒ½æ»‘)
	for (int i = 0; i < 4;i++) {//æšä¸¾ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘
		int dx = x + px[i], dy = y + py[i];
		if (dx >= 1 && dx <= n && dy >= 1 && dy <= m && a[x][y]>a[dx][dy]) {//åˆ¤æ–­èƒ½å¦ä»x,yæ»‘å‘æ»‘dx,dy
			dp[x][y] = max(dp[x][y], dfs(dx, dy) + 1);//æ›´æ–°dp[x][y]
		}
	}
	return dp[x][y];
}

int main() {
	cin >> n >> m;
	for (int i = 1; i <= n;i++) {
		for (int j = 1; j <= m;j++) {
			cin >> a[i][j];
		}
	}

	int ans = 0;//å› ä¸ºå¯ä»¥åœ¨ä»»æ„ä¸€ç‚¹å¼€å§‹æ»‘ï¼Œæ‰€ä»¥è¦éå†ä¸€éæ»‘é›ªåœºï¼Œå–æœ€å¤§å€¼
	for (int i = 1; i <= n;i++) {
		for (int j = 1; j <= m;j++) {
			ans = max(ans, dfs(i, j));
		}
	}
	cout << ans;
}
```





## DPä¼˜åŒ–

### å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–

- åŠ å…¥æ‰€éœ€å…ƒç´ ï¼šå‘å•è°ƒé˜Ÿåˆ—é‡å¤åŠ å…¥å…ƒç´ ç›´åˆ°å½“å‰å…ƒç´ è¾¾åˆ°æ‰€æ±‚åŒºé—´çš„å³è¾¹ç•Œï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ‰€éœ€å…ƒç´ éƒ½åœ¨å•è°ƒé˜Ÿåˆ—ä¸­ã€‚
- å¼¹å‡ºè¶Šç•Œé˜Ÿé¦–ï¼šå•è°ƒé˜Ÿåˆ—æœ¬è´¨ä¸Šæ˜¯ç»´æŠ¤çš„æ˜¯æ‰€æœ‰å·²æ’å…¥å…ƒç´ çš„æœ€å€¼ï¼Œä½†æˆ‘ä»¬æƒ³è¦çš„å¾€å¾€æ˜¯ä¸€ä¸ªåŒºé—´æœ€å€¼ã€‚äºæ˜¯æˆ‘ä»¬å¼¹å‡ºåœ¨å·¦è¾¹ç•Œå¤–çš„å…ƒç´ ï¼Œä»¥ä¿è¯å•è°ƒé˜Ÿåˆ—ä¸­çš„å…ƒç´ éƒ½åœ¨æ‰€æ±‚åŒºé—´ä¸­ã€‚
- è·å–æœ€å€¼ï¼šç›´æ¥å–é˜Ÿé¦–ä½œä¸ºç­”æ¡ˆå³å¯ã€‚

```cpp
//çƒ½ç«ä¼ é€’ https://loj.ac/p/10180
//ç»™å®šæ•°ç»„a[N],æ¯è¿ç»­mä¸ªå…ƒç´ è‡³å°‘æœ‰ä¸€ä¸ªè¢«é€‰ä¸­,æœ€å°é€‰ä¸­ä»£ä»·
#include <iostream>
using namespace std;
const int N = 200005;
int n,m,a[N];
int dp[N];//dp[i]è¡¨ç¤ºé€‰æ‹©ç¬¬iä¸ªæ—¶çš„æœ€å°ä»£ä»·
int q[N],hh,tt;

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++) cin >> a[i];

	for(int i = 1;i <= n;i++){
		dp[i] = dp[q[hh]] + a[i];//é˜Ÿé¦–å³ä¸ºæœ€å€¼ dp[i] = min(dp[i-m]~dp[i-1]) + a[i]
		if(hh <= tt && i - q[hh] >= m) hh++;//å¼¹å‡ºè¶Šç•Œé˜Ÿé¦–
		while(hh <= tt && dp[i] <= dp[q[tt]]) tt--;//åŠ å…¥æ‰€éœ€å…ƒç´ ,å¹¶ä¿æŒé˜Ÿåˆ—å•è°ƒé€’å¢
		q[++tt] = i;
	}

	int ans = 0x3f3f3f3f;
	for(int i = n-m+1;i <= n;i++) ans = min(ans,dp[i]);
	cout << ans;
}
```



```cpp
//ä¿®å‰ªè‰åª https://loj.ac/p/10177
//ç»™å®ša[N],ä¸èƒ½é€‰æ‹©è¿ç»­mä¸ªå…ƒç´ ,æ±‚æœ€å¤§ä»£ä»·
//dp[i] = max(dp[i-1],max(dp[j-1]+sum(j+1,i)))  //é€‰/ä¸é€‰ç¬¬iä¸ª
//å…¶ä¸­dp[j-1]+sum(j+1,i) = dp[j-1] + s[i] - s[j]  åªéœ€è¦å•è°ƒé˜Ÿåˆ—æ±‚å‡ºæœ€å¤§çš„dp[j-1]-s[j]
#include <iostream>
using namespace std;
const int N = 100005;
int n,m;
long long a[N],dp[N];
int q[N],hh,tt;

long long g(int i){
	return dp[i-1] - a[i];
}

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> a[i]; a[i] += a[i-1];
	}

	for(int i = 1;i <= n;i++){
		dp[i] = max(dp[i-1],g(q[hh]) + a[i]);
        //åŒºé—´[i-m,i-1],çª—å£å¤§å°ä¸ºm (ä¸åŒ…æ‹¬i)
		if(hh <= tt && i - q[hh] >= m) hh++;
        //åŒºé—´[i-m+1,i-1],çª—å£å¤§å°ä¸ºm-1 (ä¸åŒ…æ‹¬i)
		while(hh <= tt && g(i) >= g(q[tt])) tt--;
		q[++tt] = i;
        //åŒºé—´[i-m+1,i],çª—å£å¤§å°ä¸ºm (åŒ…æ‹¬i)
	}
	cout << dp[n];
}
```



### æ•°æ®ç»“æ„ä¼˜åŒ–



[çº¿æ®µæ ‘ä¼˜åŒ–  P4644 (luogu.com.cn)](https://www.luogu.com.cn/problem/P4644)

ç»™å®šnä¸ªåŒºé—´ä»¥åŠå…¶èŠ±è´¹{ [ l , r ] , c }ï¼Œé€‰æ‹©åˆç†çš„åŒºé—´ä½¿å…¶èƒ½å¤Ÿå®Œå…¨è¦†ç›–åŒºé—´[st,ed]ï¼Œå¹¶ä½¿å¾—æ€»èŠ±è´¹æœ€å°

> å°†æ‰€æœ‰åŒºé—´æŒ‰å³ç«¯ç‚¹æ’åºåï¼Œéå†nä¸ªåŒºé—´ï¼Œå¯¹äºå½“å‰åŒºé—´l,r,c
>
> dp[r] = min(dp[r] , dp[l-1~r-1] + c)
>
> è€ƒè™‘çº¿æ®µæ ‘ä¼˜åŒ–ï¼Œå•ç‚¹ä¿®æ”¹ï¼Œæ±‚åŒºé—´æœ€å°å€¼

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100005;
const long long INF = 0x3f3f3f3f3f3f3f3f;
int n,st,ed;
long long dp[N];

struct node{
	int l,r;
	long long c;
	bool operator < (const auto &e2){
		return r < e2.r;
	}
}a[N];

struct ST{
	int l,r;
	long long dat;
}t[N<<2];

void pushup(ST &p,ST &pl,ST &pr){
	p.dat = min(pl.dat,pr.dat);
}

void pushup(int p){
	pushup(t[p],t[p<<1],t[p<<1|1]);
}

void build(int p,int l,int r){
	t[p] = {l,r};
	if(l == r){
		t[p].dat = INF;
		return;
	}
	int mid = l + r >> 1;
	build(p<<1,l,mid);build(p<<1|1,mid+1,r);
	pushup(p);
}

void modify(int p,int l,int r,long long x){
	if(l <= t[p].l && r >= t[p].r){
		t[p].dat = x;
		return;
	}
	int mid = t[p].l + t[p].r >> 1;
	if(l <= mid) modify(p<<1,l,r,x);
	if(r > mid) modify(p<<1|1,l,r,x);
	pushup(p);
}

ST query(int p,int l,int r){
	if(l <= t[p].l && r >= t[p].r){
		return t[p];
	}
	int mid = t[p].l + t[p].r >> 1;
	if(r <= mid) return query(p<<1,l,r);
	if(l > mid) return query(p<<1|1,l,r);
	ST pl = query(p<<1,l,r),pr = query(p<<1|1,l,r),ans;
	pushup(ans,pl,pr);
	return ans;
}

int main(){
	cin >> n >> st >> ed;
	build(1,0,ed);
	for(int i = 1;i <= n;i++){
		cin >> a[i].l >> a[i].r >> a[i].c;
	}
	sort(a+1,a+n+1);
	memset(dp,0x3f,sizeof dp);

	for(int i = 1;i <= n;i++){
		auto [l,r,c] = a[i];
		if(l - 1 <= st - 1) dp[r] = min(dp[r],c);
		else dp[r] = min(dp[r],query(1,l-1,r-1).dat + c);
		modify(1,r,r,dp[r]);
	}

	if(dp[ed] == INF) cout << -1;
	else cout << dp[ed];
}
```





[æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–   UVA12983  (luogu.com.cn)](https://www.luogu.com.cn/problem/UVA12983)

åœ¨é•¿åº¦ä¸ºnçš„æ•°åˆ—a[ ]ä¸­ï¼Œæ±‚é•¿åº¦ä¸ºmçš„ä¸¥æ ¼ä¸Šå‡å­åºåˆ—çš„ä¸ªæ•°

> dp[i,j]è¡¨ç¤ºä»¥a[i]ç»“å°¾ï¼Œä¸”é•¿åº¦ä¸ºjçš„ä¸Šå‡å­åºåˆ—ä¸ªæ•°
>
> dp[i,j] = $\sum dp[k,j-1]$  å…¶ä¸­1 <= k < i && a[k] < a[i]
>
> è€ƒè™‘å°†a[ ]ç¦»æ•£åŒ–åå»ºç«‹æ ‘çŠ¶æ•°ç»„ï¼Œquery(id(a[i])-1) ä¸º1~id(a[i])ä¸­çš„$\sum dp[k,j-1]$ï¼Œæ’å…¥çš„å…ˆåé¡ºåºä¿è¯äº†ä¸ä¼šé‡å¤è®¡ç®—åˆ°åé¢çš„å€¼

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 1005,mod = 1e9+7;
int n,m;
int a[N],hs[N];
long long t[N],dp[N][N];

void add(int p,long long x){
	while(p <= n){
		t[p] = (t[p] + x)%mod;
		p += p&-p;
	}
}

long long query(int p){
	long long ans = 0;
	while(p > 0){
		ans = (ans + t[p]) % mod;
		p -= p&-p;
	}
	return ans;
}

void sol(){
	memset(dp,0,sizeof dp);
	cin >> n >> m;

	for(int i = 1;i <= n;i++){
		scanf("%d",&a[i]);hs[i] = a[i];
	}
	sort(hs+1,hs+n+1);
	for(int i = 1;i <= n;i++){ a[i] = lower_bound(hs+1,hs+n+1,a[i])-hs; }

	for(int i = 1;i <= n;i++){ dp[i][1] = 1;}

	for(int j = 2;j <= m;j++){
		memset(t,0,sizeof t);
		for(int i = 1;i <= n;i++){
			dp[i][j] = query(a[i]-1);
			add(a[i],dp[i][j-1]);
		}
	}
	long long ans = 0;
	for(int i = 1;i <= n;i++){
		ans = (ans + dp[i][m]) % mod;
	}
	cout << ans << '\n';
}

int main(){
	int T;cin >> T;
	for(int o = 1;o <= T;o++){
		cout << "Case #" << o << ": ";sol();
	}
}
```





### æ–œç‡ä¼˜åŒ–

[ã€å­¦ä¹ ç¬”è®°ã€‘åŠ¨æ€è§„åˆ’â€”æ–œç‡ä¼˜åŒ–DPï¼ˆè¶…è¯¦ç»†ï¼‰â€”â€”è¾°æ˜Ÿå‡Œçš„åšå®¢QAQ](https://www.cnblogs.com/Xing-Ling/p/11210179.html)

å…ˆå†™å‡ºDPæ–¹ç¨‹ï¼Œä¾‹å¦‚:$dp[i] = min\{dp[j] + (s[i]-s[j])^2 + m\}$
å»æ‰$min$ï¼Œå¯¹é½è¿›è¡Œç§»é¡¹å˜æ¢ä¸º$y = kx+b$çš„ç‚¹æ–œå¼ã€‚
æŠŠå«æœ‰$function(i)*funciton(j)$çš„è¡¨è¾¾å¼çœ‹åšæ–œç‡$k$ä¹˜ä»¥æœªçŸ¥æ•°$x$ï¼Œå«æœ‰$dp[i]$æˆ–å¸¸æ•°é¡¹åœ¨$b$çš„è¡¨è¾¾å¼ä¸­ï¼Œå«æœ‰$function(j)$çš„é¡¹åœ¨$y$çš„è¡¨è¾¾å¼ä¸­ã€‚
$dp[j] + s[j]^2 = 2*s[i]*s[j] + dp[i]-s[i]^2-m$ã€‚
æ­¤å¤„ $y = dp[j] +s[j]^2$ï¼Œ$k = 2*s[i]$ï¼Œ$x = s[j]$ï¼Œ$b = dp[i]-s[i]^2 - m$ã€‚
å³æ‰¾å‡ºä¸€ä¸ªç‚¹$(s[j],dp[j]+s[j]^2)$ï¼Œä½¿å¾—$b$ä¹Ÿå³$dp[i]$æœ€å¤§

å†™å‡ºDPæ–¹ç¨‹åï¼Œåˆ¤æ–­èƒ½å¦ä½¿ç”¨æ–œç‡ä¼˜åŒ–ï¼Œå³æ˜¯å¦å­˜åœ¨ $function(i) * function(j)$ çš„é¡¹ï¼Œæˆ–è€… $\frac{Y(j)-Y(j')}{X(j) - X(j')}$

é€šè¿‡å¤§å°äºç¬¦å·æˆ–è€…æ¢$b$ä¸­$dp[i]$çš„ç¬¦å·ç»“åˆé¢˜ç›®è¦æ±‚$(min/max)$åˆ¤æ–­æ˜¯ä¸Šå‡¸åŒ…è¿˜æ˜¯ä¸‹å‡¸åŒ…ã€‚



[P10979 ä»»åŠ¡å®‰æ’ 2 - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10979)
$$
dp[i] = min_{0\le j<i}\{dp[j]-(s+st[i])*sc[j]\} + st[i]*sc[i]+s*sc[n]
$$
æŠŠ$min$å‡½æ•°å»æ‰ï¼ŒæŠŠå…³äº$j$çš„å€¼$dp[j]$å’Œ$sc[j]$çœ‹ä½œå˜é‡ï¼Œå…¶ä½™éƒ¨åˆ†çœ‹ä½œå¸¸æ•°å¾—åˆ°ï¼š
$$
dp[j] = (s+st[i])*sc[j]+dp[i]-st[i]*sc[i]-s*sc[n]
$$
ä»¥$sc[j]$ä¸ºæ¨ªåæ ‡ï¼Œ$dp[j]$ä¸ºçºµåæ ‡å»ºç«‹å¹³é¢ç›´è§’åæ ‡ç³»ï¼Œå½“å‰ç‚¹$i$æ–œç‡$k$ä¸ºå›ºå®šå€¼$s+st[i]$ï¼Œå†³ç­–å€™é€‰é›†åˆæ˜¯åæ ‡ç³»ä¸­çš„ä¸€ä¸ªç‚¹é›†ï¼Œæ¯ä¸ªå†³ç­–jéƒ½å¯¹åº”ç€åæ ‡ç³»ä¸­çš„ä¸€ä¸ªç‚¹$(sc[j],dp[j])$ï¼Œè¦ä½¿$dp[i]$æœ€å°ï¼Œä¹Ÿå°±æ˜¯åœ¨å‰$i-1$ä¸ªç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªç‚¹ï¼Œä½¿å¾—åœ¨$k$ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œæˆªè·æœ€å°ï¼Œä¸éš¾å‘ç°ï¼Œç­”æ¡ˆå¿…ç„¶åœ¨åŸç‚¹é›†çš„ä¸€ä¸ªå³ä¸‹å‡¸åŒ…ä¸Šï¼š

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250321162203462.png" alt="image-20250321162203462" style="zoom:33%;" />  

ç”±äºæœ¬é¢˜ä¸­$t$ä¸ºæ­£æ•´æ•°ï¼Œ$st$é€’å¢ä¹Ÿå³æ–œç‡$k$é€’å¢ï¼Œæ¯æ¬¡å†³ç­–æ—¶å°†é˜Ÿé¦–æ–œç‡å°äº$k$çš„å¼¹å‡ºï¼Œé˜Ÿå¤´å³ä¸ºç›®æ ‡ $j$ã€‚
å°†ç‚¹$i$æ’å…¥å‰ï¼Œè¯ºé˜Ÿå°¾ä¸¤ç‚¹å’Œç‚¹$i$å½¢æˆå‡¹åŒ…ï¼Œåˆ™ä¸æ–­å°†é˜Ÿå°¾å¼¹å‡ºï¼Œç›´åˆ°æ»¡è¶³å‡¸åŒ…ã€‚

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 300005;
long long n,s;
long long dp[N];
long long c[N],t[N],sc[N],st[N];
int q[N],hh,tt;

long long X(int i){return sc[i];}
long long Y(int i){return dp[i];}
long long up(int a,int b) {return Y(a) - Y(b);}//åˆ†å­
long long down(int a,int b) {return X(a) - X(b);}//åˆ†æ¯


int main(){
	cin >> n >> s;
	for(int i = 1;i <= n;i++){
		cin >> t[i] >> c[i];
		st[i] = st[i-1] + t[i];
		sc[i] = sc[i-1] + c[i];
	}

	for(int i = 1;i <= n;i++){
		int k = st[i] + s;
		while(hh <= tt-1 && up(q[hh+1],q[hh]) <= k * down(q[hh+1],q[hh])) hh++;
		int j = q[hh];
		dp[i] = dp[j] - (s+st[i])*sc[j] + st[i]*sc[i] + s*sc[n];
		while(hh <= tt-1 && up(i,q[tt])*down(q[tt],q[tt-1]) <= up(q[tt],q[tt-1])*down(i,q[tt]))tt--;
		q[++tt] = i;
	}
	cout << dp[n];
}
```



[P5785 [SDOI2012\] ä»»åŠ¡å®‰æ’ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P5785)

æœ¬é¢˜ï¼Œè¯ºkä¸æ»¡è¶³å•è°ƒæ€§ï¼Œåˆ™éœ€è¦ç»´æŠ¤æ•´ä¸ªå‡¸åŒ…ï¼Œæ¯æ¬¡å†³ç­–æ—¶åªéœ€è¦åœ¨é˜Ÿåˆ—ä¸­ç”¨`äºŒåˆ†/CDQ/å¹³è¡¡æ ‘`æ‰¾åˆ°ç‚¹ j æ»¡è¶³ï¼šç‚¹jå·¦è¾¹çš„æ–œç‡éƒ½å°äºkï¼Œå³è¾¹çš„æ–œç‡éƒ½å¤§äºkã€‚

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 300005;
long long n,s;
long long dp[N];
long long c[N],t[N],sc[N],st[N];
int q[N],hh,tt;

struct node{
	long long x,y;
};

int lb(long long k,int bl,int br){
	auto check = [&](int x)->bool{
		node p1 = {sc[q[x]],dp[q[x]]},p2 = {sc[q[x+1]],dp[q[x+1]]};
		return (p2.y - p1.y) >= k*(p2.x - p1.x);
	};
	int l = bl,r = br;
	while(l < r){
		int mid = l + r >> 1;
		if(check(mid)) r = mid;
		else l = mid + 1;
	}
	return q[r];
}

int main(){
	cin >> n >> s;
	for(int i = 1;i <= n;i++){
		cin >> t[i] >> c[i];
		st[i] = st[i-1] + t[i];
		sc[i] = sc[i-1] + c[i];
	}
    
	for(int i = 1;i <= n;i++){
		int j = lb(st[i]+s,hh,tt);
		dp[i] = dp[j] - (s+st[i])*sc[j] + st[i]*sc[i] + s*sc[n];
		while(hh <= tt - 1){
			node p1 = {sc[q[tt-1]],dp[q[tt-1]]},p2 = {sc[q[tt]],dp[q[tt]]},p3 = {sc[i],dp[i]};
			if(__int128(p3.y-p2.y)*(p2.x-p1.x) <= __int128(p2.y-p1.y)*(p3.x-p2.x)) tt--;
			else break;
		}
		q[++tt] = i;
	}
	cout << dp[n];
}
```





[303. è¿è¾“å°çŒ« - AcWingé¢˜åº“](https://www.acwing.com/problem/content/305/)

å¯¹äºæ¯åªå°çŒ«æ‰€éœ€è¦çš„æ—©å‡ºå‘æ—¶é—´ä¸º$a[i] = t[i]-\sum{d[i]}$ï¼Œæ’åºåå¯¹a[ ]å»ºç«‹å‰ç¼€å’Œæ•°ç»„s[ ]

ä»¤`dp[i][j]`è¡¨ç¤ºå‰`i`ä¸ªäººè¿è¾“å‰`j`åªå°çŒ«æ‰€éœ€è¦çš„æœ€å°ç­‰å¾…æ¬¡æ•°ã€‚ç¬¬`i`ä¸ªäººè¿è¾“ç¬¬`k+1~j`åªçŒ«ã€‚åˆ™æœ‰ï¼š
$$
dp[i][j] = min\{dp[i-1][k]+a[j]*(j-k)-(s[j]-s[k])\}
$$
å»æ‰minï¼Œç§»é¡¹å¾—ï¼š
$$
dp[i-1][k]+s[k] = a[j]*k + dp[i][j]-a[j]*j+s[j]
$$
æ–œç‡ä¼˜åŒ–O(1)æ±‚å‡ºkï¼Œä»¥`k`ä¸ºæ¨ªè½´ï¼Œ`dp[i-1][k]+s[k]`ä¸ºçºµè½´å»ºç«‹åæ ‡ç³»ï¼Œå½“å‰æ–œç‡ä¸º`a[j]`ï¼Œåæ ‡è½´ä¸Šæ¯ä¸ªç‚¹ä¸º`(k,dp[i-1][k]+s[k])` 

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100005;
int n,m,p;
long long d[N];
long long h[N],t[N],a[N],s[N];
long long dp[105][N];
int q[N],hh,tt;

struct node{
	long long x,y;
};

int main(){
	cin >> n >> m >> p;
	for(int i = 2;i <= n;i++){
		cin >> d[i];
		d[i] += d[i-1];
	}
	for(int i = 1;i <= m;i++){
		cin >> h[i] >> t[i];
		a[i] = t[i] - d[h[i]];
	}
	sort(a+1,a+m+1);

	for(int i = 1;i <= m;i++){
		s[i] = s[i-1] + a[i];
	}

	memset(dp,0x3f,sizeof dp);
	dp[0][0] = 0;
	for(int i = 1;i <= p;i++){
		hh = 0,tt = 0;
		for(int j = 1;j <= m;j++){
			while(hh <= tt - 1){//ç”±äºæ–œç‡a[j]é€’å¢,æ¯æ¬¡ç»´æŠ¤é˜Ÿé¦–å³å¯
				node p1 = {q[hh],dp[i-1][q[hh]]+s[q[hh]]},p2 = {q[hh+1],dp[i-1][q[hh+1]]+s[q[hh+1]]};
				if((p2.y-p1.y) <= a[j]*(p2.x-p1.x)) hh++;
				else break;
			}
			dp[i][j] = dp[i-1][q[hh]] + a[j]*(j-q[hh])-s[j]+s[q[hh]];
			while(hh <= tt-1){
				node p1 = {q[tt-1],dp[i-1][q[tt-1]]+s[q[tt-1]]},p2 = {q[tt],dp[i-1][q[tt]]+s[q[tt]]};
				node p3 = {j,dp[i-1][j]+s[j]};//æ’å…¥çš„ç‚¹p3,å–å€¼åº”ä¸ºdp[i-1]
				if((p3.y-p2.y)*(p2.x-p1.x) <= (p2.y-p1.y)*(p3.x-p2.x)) tt--;
				else break;
			}
			q[++tt] = j;
		}
	}
	cout << dp[p][m];
}
```



## å…¶ä»–

### ç¯å½¢å¤„ç†

**æ–­ç¯æˆé“¾ï¼Œå¤åˆ¶æ‹¼æ¥**

[P10957 ç¯è·¯è¿è¾“ - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P10957)

```cpp
#include <iostream>
using namespace std;
const int N = 2000006;
int n;
long long a[N];
int q[N],hh,tt;

long long g(int i){
	return a[i] - i;
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		a[i+n] = a[i];
	}

	long long ans = 0;
	for(int i = 1;i <= n << 1;i++){//å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–
		ans = max(ans,a[i] + i + g(q[hh]));
		if(hh <= tt && i - q[hh] >= n/2) hh++;
		while(hh <= tt && g(i) >= g(q[tt])) tt--;
		q[++tt] = i;
	}
	cout << ans;
}
```



**äºŒæ¬¡DP**

ä¸€æ¬¡é€‰æ‹©Nå’Œ1æ–­å¼€ï¼Œå¦ä¸€æ¬¡é€‰æ‹©Nå’Œ1è¿æ¥ã€‚ç­”æ¡ˆå–ä¸¤æ¬¡DPçš„æœ€å€¼

[P6064 [USACO05JAN\] Naptime G - æ´›è°· (luogu.com.cn)](https://www.luogu.com.cn/problem/P6064)

```cpp
#include <iostream>
#include <algorithm>
#include <cstring>
using namespace std;
const int N = 3900;
int n,a[N],m;
int dp[2][N][2];

int main(){
	cin >> n >> m;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}

	memset(dp,-0x3f,sizeof dp);
	for(int i = 1;i <= n;i++) dp[i&1][0][0] = 0;
	dp[1&1][1][1] = 0;
	for(int i = 2;i <= n;i++){
		dp[i&1][0][0] = dp[(i-1)&1][0][0];
		for(int j = 1;j <= m;j++){
			dp[i&1][j][0] = max(dp[(i-1)&1][j][0],dp[(i-1)&1][j][1]);
			dp[i&1][j][1] = max(dp[(i-1)&1][j-1][0],dp[(i-1)&1][j-1][1]+a[i]);
		}
	}
	int ans = max(dp[n&1][m][0],dp[n&1][m][1]);

	memset(dp,-0x3f,sizeof dp);
	for(int i = 1;i <= n;i++) dp[i&1][0][0] = 0;
	dp[1][1][1] = a[1];
	for(int i = 2;i <= n;i++){
		for(int j = 1;j <= m;j++){
			dp[i&1][j][0] = max(dp[(i-1)&1][j][0],dp[(i-1)&1][j][1]);
			dp[i&1][j][1] = max(dp[(i-1)&1][j-1][0],dp[(i-1)&1][j-1][1]+a[i]);
		}
	}
	ans = max(ans,dp[n&1][m][1]);
	cout << ans;
}
```



### æ»šåŠ¨æ•°ç»„

ç®€è¦æ¥è¯´å°±æ˜¯é€šè¿‡è§‚å¯Ÿdpæ–¹ç¨‹æ¥åˆ¤æ–­éœ€è¦ä½¿ç”¨å“ªäº›æ•°æ®ï¼Œå¯ä»¥æŠ›å¼ƒå“ªäº›æ•°æ®ï¼Œä¸€æ—¦æ‰¾åˆ°å…³ç³»ï¼Œå°±å¯ä»¥ç”¨æ–°çš„æ•°æ®ä¸æ–­è¦†ç›–æ—§çš„æ²¡ç”¨çš„æ•°æ®æ¥å‡å°‘ç©ºé—´çš„ä½¿ç”¨ã€‚è¿˜è¦æ³¨æ„**æ ¹æ®æ•°æ®æ˜¯å¦å¯ä»¥ç›´æ¥ç»§æ‰¿è€ƒè™‘æ˜¯å¦éœ€è¦æƒ…å†µæ•°ç»„**



åˆ©ç”¨**å¯¹è‡ªç„¶æ•°å–æ¨¡çš„å‘¨æœŸæ€§**

```cpp
//ä¾‹ï¼šé€’æ¨æ±‚æ–æ³¢é‚£å¥‘æ•°åˆ—
for (int i=3;i<=n;i++) f[i%3]=f[(i-1)%3]+f[(i-2)%3];
cout << f[n%3];
```



```cpp
dp[i][s1][s2] = max(dp[i][s1][s2],dp[i-1&1][s2][s3]+1);
//åªç”¨åˆ°äº†i-1é¡¹ï¼Œå¯ä»¥ä¼˜åŒ–ä¸º
dp[i&1][s1][s2] = max(dp[i&1][s1][s2],dp[i-1&1][s2][s3]+1);
```



```cpp
for(int i = 1;i <= n+1;i++){//dp[N][M]
    for(auto s1:st[i-1]){
        for(auto s2:st[i]){
            if(s1&s2) continue;
            dp[i][s2] = (dp[i][s2]+dp[i-1][s1])%mod;
        }
    }
}
//å¯ä»¥ä¼˜åŒ–ä¸º
for(int i = 1;i <= n+1;i++){//dp[2][M]
    for(auto s1:st[i-1]){
        for(auto s2:st[i]){
			if(s1&s2) continue;
             dp[i&1][s2] = 0;
        }
    }
    for(auto s1:st[i-1]){
        for(auto s2:st[i]){
            if(s1&s2) continue;
            dp[i&1][s2] = (dp[i&1][s2]+dp[i-1&1][s1])%mod;
        }
    }
}
```





### çŠ¶æ€æœºDP

[4747. DNAåºåˆ— - AcWingé¢˜åº“](https://www.acwing.com/problem/content/4750/)

> ç»™å®šmä¸ªDNAåºåˆ—ç‰‡æ®µï¼Œè®¡ç®—æœ‰å¤šå°‘é•¿åº¦ä¸ºnçš„DNAåºåˆ—ä¸åŒ…å«ä¸Šè¿°mä¸ªç‰‡æ®µ $0\le m \le 10,1\le n \le 2*10^9$

```cpp
#include <iostream>
#include <queue>
#include <cstring>
#include <vector>

namespace ACAM{
    const int N = 105,M = 4;
    int son[N][M],cnt[N],fail[N],idx;

    struct Trie{

        Trie(){idx = 0;init(idx);};

        void init(int p){
            fail[p] = cnt[p] = 0;
            std::memset(son[p],0,sizeof son[p]);
        }

        int get(char x){
            if(x == 'A') return 0;
            if(x == 'C') return 1;
            if(x == 'T') return 2;
            if(x == 'G') return 3;
            return 0;
        }

        void insert(const std::string &s){
            int p = 0;
            for(int i = 0;i < s.size();i++){
                int u = get(s[i]);
                if(!son[p][u]){
                    son[p][u] = ++idx;
                    init(idx);
                }
                p = son[p][u];
            }
            cnt[p]++;
        }

        void get_fail(){
            std::queue<int>q;
            for(int u = 0;u < M;u++){
                if(son[0][u]) {
                    fail[son[0][u]] = 0;
                    q.push(son[0][u]);
                }
            }
            while(q.size()){
                int p = q.front();
                q.pop();
                cnt[p] |= cnt[fail[p]];//å°†å½“å‰èŠ‚ç‚¹çš„ç¦æ­¢çŠ¶æ€ä¸failæŒ‡é’ˆçš„ç¦æ­¢çŠ¶æ€åˆå¹¶
                for(int u = 0;u < M;u++){
                    if(son[p][u]) {
                        fail[son[p][u]] = son[fail[p]][u];
                        q.push(son[p][u]);
                    }
                    else{
                        son[p][u] = son[fail[p]][u];
                    }
                }
            }
        }
    };
}
using ACAM::Trie;
using ACAM::fail,ACAM::son,ACAM::cnt,ACAM::idx;

const int mod = 100000;
template<typename T>
struct Mat{
    int n;
    std::vector<std::vector<T>>a;

    Mat(int _n,T val){
        n = _n;
        a = std::vector<std::vector<T>>(n,std::vector<T>(n,val));
    }

    Mat<T> operator * (const Mat<T> &m2){
        Mat<T> ans(n,0);
        for(int i = 0;i < n;i++){
            for(int j = 0;j < n;j++){
                for(int k = 0;k < n;k++){
                    ans.a[i][j] = (ans.a[i][j] + a[i][k] * m2.a[k][j]) % mod;
                }
            }
        }
        return ans;
    }

    void norm(){
        for(int i = 0;i < n;i++) a[i][i] = 1;
    }

    Mat<T> qmi(long long b){
        auto base = *this;
        Mat<T> ans(n,0);
        ans.norm();
        while(b){
            if(b&1) ans = ans * base;
            b >>= 1;
            base = base * base;
        }
        return ans;
    }
};

const int N = 12;
std::string s[N];

int main(){
    int m,n; std::cin >> m >> n;
    Trie t;
    for(int i = 1;i <= m;i++){
        std::cin >> s[i];
        t.insert(s[i]);
    }
    t.get_fail();

    Mat<long long> base(idx+1,0);

    for(int i = 0;i <= idx;i++){
        for(int u = 0;u < 4;u++){
            int p = son[i][u];
            if(cnt[p]) continue;
            base.a[p][i]++;//çŠ¶æ€ié€šè¿‡å­—ç¬¦cè½¬ç§»è‡³çŠ¶æ€p //dp[k][p] += dp[k-1][i]
        }
    }

    base = base.qmi(n);//çŸ©é˜µå¿«é€Ÿå¹‚åŠ é€Ÿé€’æ¨

    long long res = 0;
    for(int i = 0;i <= idx;i++){
        res = (res + base.a[i][0]) % mod;
    }

    std::cout << res;
}
```



------

# è´ªå¿ƒ

[è´ªå¿ƒ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/basic/greedy/)

## åŒºé—´é—®é¢˜

### åŒºé—´é€‰ç‚¹

>ç»™å®š N ä¸ªé—­åŒºé—´ [ai,bi] ï¼Œè¯·ä½ åœ¨æ•°è½´ä¸Šé€‰æ‹©å°½é‡å°‘çš„ç‚¹ï¼Œä½¿å¾—æ¯ä¸ªåŒºé—´å†…è‡³å°‘åŒ…å«ä¸€ä¸ªé€‰å‡ºçš„ç‚¹ã€‚
> è¾“å‡ºé€‰æ‹©çš„ç‚¹çš„æœ€å°æ•°é‡ã€‚ï¼ˆä½äºåŒºé—´ç«¯ç‚¹ä¸Šçš„ç‚¹ä¹Ÿç®—ä½œåŒºé—´å†…ï¼‰

```cpp
//https://www.acwing.com/problem/content/907/
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 100005;
int n;

struct Edge{
	int l,r;
}e[N];

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){ cin >> e[i].l >> e[i].r; }
    
	sort(e+1,e+n+1,[](auto&e1,auto&e2){return e1.l < e2.l;});//æŒ‰å·¦ç«¯ç‚¹ä»å°åˆ°å¤§æ’åº

	int ans = 1;
	int ed = e[1].r;

	for(int i = 2;i <= n;i++){
		if(e[i].l > ed){
			ans++;
			ed = e[i].r;
		}
		else{
			ed = min(ed,e[i].r);
		}
	}
	cout << ans;
}
```

```cpp
//ç•œæ é¢„å®š https://www.acwing.com/problem/content/113/
//ç»™å®šNæ®µåŒºé—´[l,r],å½“ä¸¤ä¸ªåŒºé—´ç›¸äº¤æ—¶(åŒ…æ‹¬ç«¯ç‚¹),è¿™ä¸¤å¤´ç‰›ä¸èƒ½å®‰æ’åœ¨åŒä¸€ä¸ªç•œæ åƒè‰
//æ±‚éœ€è¦çš„æœ€å°ç•œæ æ•°ç›®å’Œæ¯å¤´ç‰›å¯¹åº”çš„ç•œæ æ–¹æ¡ˆ
#include <iostream>
#include <algorithm>
#include <queue>
using namespace std;
const int N = 100005;
using pii = pair<int,int>;
int n;
int id[N];

struct Edge{
	int l,r,rk;
}e[N];

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> e[i].l >> e[i].r;
		e[i].rk = i;
	}

	sort(e+1,e+n+1,[](auto &e1,auto &e2){return e1.l < e2.l;});
    //æŒ‰å·¦ç«¯ç‚¹å°†åŒºé—´æ’åº

	priority_queue<pii,vector<pii>,greater<pii>>pq;
	//å †ä¸­å­˜æ”¾çš„å…ƒç´ ä¸º<å½“å‰åˆ†ç»„å†…åŒºé—´å³ç«¯ç‚¹çš„æœ€å°å€¼ï¼Œç•œæ ç¼–å·>

	for(int i = 1;i <= n;i++){
		if(pq.empty() || pq.top().first >= e[i].l){//æ–°å»ºå †
			//å½“å‰å †ä¸ºç©º æˆ– å †é¡¶æœ€å°å€¼å³ç«¯ç‚¹rä¸å½“å‰ç‰›å·¦ç«¯ç‚¹lé‡åˆ
			pii t = {e[i].r,pq.size()};
			id[e[i].rk] = t.second;
			pq.push(t);
		}
		else{//ä½¿ç”¨åŸæ¥çš„å †
			auto t = pq.top();
			pq.pop();//å¼¹å‡ºå †é¡¶
			t.first = e[i].r;//è®©å½“å‰ç‰›ä½¿ç”¨è¯¥ç•œæ 
			id[e[i].rk] = t.second;//è®°å½•ç­”æ¡ˆ
			pq.push(t);
		}
	}
	cout << pq.size() << endl;
	for(int i = 1;i <= n;i++){
		cout << id[i]+1 << endl;
	}
}
```



### åŒºé—´åˆå¹¶

> ç°ç»™å®š ğ‘›ä¸ªé—­åŒºé—´ ğ‘ğ‘–,ğ‘ğ‘–ï¼ˆ1â‰¤ğ‘–â‰¤ğ‘›ï¼‰ã€‚è¿™äº›åŒºé—´çš„å¹¶å¯ä»¥è¡¨ç¤ºä¸ºä¸€äº›ä¸ç›¸äº¤çš„é—­åŒºé—´çš„å¹¶ã€‚åœ¨è¿™äº›è¡¨ç¤ºæ–¹å¼ä¸­æ‰¾å‡ºåŒ…å«æœ€å°‘åŒºé—´çš„æ–¹æ¡ˆã€‚

```CPP
//https://www.luogu.com.cn/problem/P2434
#include <bits/stdc++.h>
using PII = std::pair<int, int>;
using namespace std;

struct P {
	int l,r;
}p[50005];

queue<PII>q;

bool cmp(P p1, P p2) {
	return p1.l < p2.l;
}

int main() {
	int n; cin >> n;
	for (int i = 0; i < n; i++) {
		cin >> p[i].l >> p[i].r;
	}
    
	sort(p, p + n, cmp);
    
	int op = p[0].l, ed = p[0].r;
	for (int i = 0; i < n; i++) {
		if (ed >= p[i].l) {
			ed = max(ed, p[i].r);
		}
		else {
			q.push({ op,ed });
			op = p[i].l;
			ed = p[i].r;
		}
	}
	q.push({ op,ed });

	while (q.size()) {
		cout << q.front().first << ' ' << q.front().second << endl;
		q.pop();
	}
}
```





### ä¸ç›¸äº¤åŒºé—´

> ç»™å®š ğ‘ ä¸ªé—­åŒºé—´ [ğ‘ğ‘–,ğ‘ğ‘–]ï¼Œè¯·ä½ åœ¨æ•°è½´ä¸Šé€‰æ‹©è‹¥å¹²åŒºé—´ï¼Œä½¿å¾—é€‰ä¸­çš„åŒºé—´ä¹‹é—´äº’ä¸ç›¸äº¤ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰ã€‚
> è¾“å‡ºå¯é€‰å–åŒºé—´çš„æœ€å¤§æ•°é‡ã€‚

```cpp
//https://www.acwing.com/problem/content/910/
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 100005;
int n;
struct Point {
	int x, y;
}p[N];

bool cmp(Point p1, Point p2) {
	return p1.x < p2.x;
}

int main() {
	cin >> n;
	for (int i = 1; i <= n;i++) {
		cin >> p[i].x >> p[i].y;
	}

	sort(p + 1, p + n + 1,cmp);

	int ans = 1;
	int r = p[1].y;
	for (int i = 2; i <= n; i++) {
		if (p[i].y < r) {
			r = p[i].y;
		}
		if (p[i].x > r) {
			ans++;
			r = p[i].y;
		}
	}
	cout << ans;
}
```





### åŒºé—´è¦†ç›–

> ç»™å®š N ä¸ªé—­åŒºé—´ [ğ‘ğ‘–,ğ‘ğ‘–] ä»¥åŠä¸€ä¸ªçº¿æ®µåŒºé—´ [ğ‘ ,ğ‘¡]ï¼Œè¯·ä½ é€‰æ‹©å°½é‡å°‘çš„åŒºé—´ï¼Œå°†æŒ‡å®šçº¿æ®µåŒºé—´å®Œå…¨è¦†ç›–ã€‚
> è¾“å‡ºæœ€å°‘åŒºé—´æ•°ï¼Œå¦‚æœæ— æ³•å®Œå…¨è¦†ç›–åˆ™è¾“å‡º âˆ’1ã€‚
>
> æ ¸å¿ƒæ€æƒ³ï¼šåœ¨å·¦ç«¯ç‚¹léƒ½å°äºaçš„æƒ…å†µä¸‹ï¼Œå–å³ç«¯ç‚¹æœ€å¤§çš„å°åŒºé—´

```cpp
//https://www.acwing.com/problem/content/description/909/
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 100005,INF = 0x3f3f3f3f;

struct P {
	int x, y;
}p[N];

bool cmp(P p1, P p2) {
	return p1.x < p2.x;
}

int main() {
	int a, b; cin >> a >> b;
	int n; cin >> n;
	for (int i = 1; i <= n;i++) {
		cin >> p[i].x >> p[i].y;
	}

	sort(p + 1, p + n + 1, cmp);
	int ans = 0;
	bool flag = 0;
	for (int i = 1; i <= n;i++) {
		int j = i, r = -INF;
		while (j <= n && p[j].x <= a){
			r = max(r, p[j].y);
			j++;
		}

		if (r < a) {
			ans = -1;
			break;
		}
		ans++;
		if (r >= b) {
			flag = 1;
			break;
		}
		a = r;
		i = j - 1;
	}
	if (!flag) ans = -1;
	cout << ans;
	return 0;
}
```





### åŒºé—´åˆ†ç»„

ï¼ˆæŸä¸ªç‚¹ï¼‰æœ€å¤šåŒæ—¶é‡å åŒºé—´ä¸ªæ•°

> ç»™å®š ğ‘ ä¸ªé—­åŒºé—´ [ğ‘ğ‘–,ğ‘ğ‘–]ï¼Œè¯·ä½ å°†è¿™äº›åŒºé—´åˆ†æˆè‹¥å¹²ç»„ï¼Œä½¿å¾—æ¯ç»„å†…éƒ¨çš„åŒºé—´ä¸¤ä¸¤ä¹‹é—´ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰æ²¡æœ‰äº¤é›†ï¼Œå¹¶ä½¿å¾—ç»„æ•°å°½å¯èƒ½å°ã€‚è¾“å‡ºæœ€å°ç»„æ•°ã€‚
>
> æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´æ’åºï¼Œé‡åˆ°å¼€å§‹æ—¶é—´å°±æŠŠéœ€è¦çš„æ•™å®¤æ•°cntåŠ 1ï¼Œé‡åˆ°ç»“æŸæ—¶é—´å°±æŠŠéœ€è¦çš„æ•™å®¤æ•°cntå‡1,åœ¨ä¸€ç³»åˆ—éœ€è¦çš„æ•™å®¤ä¸ªæ•°cntå˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œcntçš„å³°å€¼å°±æ˜¯å¤šåŒæ—¶è¿›è¡Œçš„æ´»åŠ¨æ•°ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è‡³å°‘éœ€è¦çš„æ•™å®¤æ•°ã€‚
>
> å¦‚æœå€¼åŸŸè¾ƒå°ï¼Œå¯ä»¥å†™å·®åˆ†

```cpp
//https://www.acwing.com/problem/content/908/
#include <iostream>
#include <algorithm>
#include <vector>
#define fastio ios::sync_with_stdio(0),cin.tie(0)
using namespace std;
const int N = 100005;
vector<pair<int,int>>v;

struct Edge{
	int l,r;
}e[N];

int main(){
	fastio;
	int n;cin >> n;
	for(int i = 1;i <= n;i++){
		auto&[l,r] = e[i];
		cin >> l >> r;
		v.emplace_back(l,0);//0ä»£è¡¨å¼€å§‹
		v.emplace_back(r,1);//1ä»£è¡¨ç»“æŸ
	}
	sort(v.begin(),v.end());
	int ans = 0;
	int cnt = 0;
	for(int i = 0;i < v.size();i++){
		if(v[i].second == 0) cnt++;
		else cnt--;
		ans = max(ans,cnt);
	}
	cout << ans;
}
```



ï¼ˆä»»æ„é•¿åº¦ä¸ºdçš„åŒºé—´ï¼‰æœ€å¤š/æœ€å°‘åŒ…å«ä¸åŒåŒºé—´ä¸ªæ•°ï¼ˆé‡å åŒºé—´çš„é•¿çŸ­å¹¶ä¸é‡è¦ï¼‰

```cpp
//https://codeforces.com/contest/2014/problem/D
#include <bits/stdc++.h>
#define INF 0x3f3f3f3f
using ll = long long;
using namespace std;

void sol(){
	ll n,d,k;cin >> n >> d >> k;
	vector<ll>a(n+5);
	for(int i = 1;i <= k;i++){//å·®åˆ†ï¼Œè®©åŒºé—´[l-d+1,r]åŠ 1
		int l,r;cin >> l >> r;
		a[max(l-d+1,(ll)0)]++;
		a[r+1]--;
	}
	for(int i = 1;i <= n;i++){ a[i] += a[i-1];}//a[i]è¡¨ç¤ºä»ç‚¹iå¼€å§‹,é•¿ä¸ºdçš„ä¸€æ®µåŒºé—´,åŒ…å«ä¸åŒåŒºé—´çš„ä¸ªæ•°
	ll kb = 0,pb = 0,km = INF,pm = 0;
	for(int i = 1;i <= n-d+1;i++){
		if(a[i] > kb){ kb = a[i];pb = i;}
		if(a[i] < km){ km = a[i];pm = i;}
	}
	cout << pb << ' ' << pm << endl;
}

int main() {
	int T = 1;cin >> T;
	while(T--){ sol(); }
}
```



### åŒºé—´åŒ…å«

```cpp
//https://acm.hdu.edu.cn/showproblem.php?pid=7497
#include <bits/stdc++.h>
#define fastio ios::sync_with_stdio(false),cin.tie(0),cout.tie(0)
#define endl  '\n'
#define ll long long
#define PII std::pair<int, int>
#define INF 0x3f3f3f3f
using namespace std;
int n,m;

struct Edge{
	ll l,r;
	ll len;
};

bool cmp(ll x,ll y){
	return x < y;
}

bool cmp1(pair<ll,ll>x,pair<ll,ll>y){
	if(x.first != y.first) return x.first < y.first;
	else{ return x.second < y.second; }
}

void sol(){
	cin >> n >> m;
	vector<Edge>a(n),b(m);
	vector<ll>all;
	for(int i = 0;i < n;i++){
		cin >> a[i].l >> a[i].r;
		all.emplace_back(a[i].l*2+1);
		all.emplace_back(a[i].r*2);
	}
	for(int i = 0;i < m;i++){
		cin >> b[i].l >> b[i].r; 
		b[i].len = 2*(b[i].r-b[i].l);
		all.emplace_back(b[i].l*2+1);
		all.emplace_back(b[i].r*2);
	}
	sort(all.begin(),all.end(),cmp);
	int cnt = 0;
	for(int i = 0;i < all.size();i++){//åˆ¤æ–­Aç»„åŒºé—´ä¸Bç»„åŒºé—´ä¸­æ˜¯å¦å­˜åœ¨åŒºé—´é¦™è•‰(åŒºé—´åˆ†ç»„)
		if(all[i]&1){ cnt++; }
		else { cnt--; }
		if(cnt > 1){ cout << "No" << endl; return; }
	}
    
	vector<pair<ll,ll>>al;
	for(int i = 0;i < n;i++){
		al.emplace_back(a[i].l,2);
		al.emplace_back(a[i].r,3);
	}
	for(int i = 0;i < m;i++){
		al.emplace_back(b[i].r,0);
		al.emplace_back(b[i].r+b[i].len,4);
	}
	sort(al.begin(),al.end(),cmp1);

	int ok = 0,cla = 0;//åˆ¤æ–­Aç»„åŒºé—´æ˜¯å¦å®Œå…¨åŒ…å«äºCç»„åŒºé—´(åŒºé—´åˆ†ç»„åŠ å¼ºç‰ˆ)
	for(int i = 0;i < al.size();i++){
		if(al[i].second == 0) ok++;//0ä»£è¡¨æ¸…é†’çŠ¶æ€å¼€å§‹
		if(al[i].second == 4) ok--;//4ä»£è¡¨æ¸…é†’çŠ¶æ€ç»“æŸ
		if(al[i].second == 2) cla++;//2ä»£è¡¨ä¸Šè¯¾å¼€å§‹
		if(al[i].second == 3) cla--;//3ä»£è¡¨ä¸Šè¯¾ç»“æŸ
		if(cla >= 1 && ok <= 0){//å¦‚æœå‡ºç°å½“å‰æ­£åœ¨ä¸Šè¯¾ï¼Œå¹¶ä¸”çŠ¶æ€ä¸æ¸…é†’ï¼Œè¿”å›No
			cout << "No" << endl; return;
		}
	}
	cout << "Yes" << endl;
}

int main() {
	fastio; int T = 1;
	cin >> T;
	while(T--){sol();}
}
```







## ç»å¯¹å€¼ä¸ç­‰å¼

**è´§ä»“é€‰å€**

> åœ¨ä¸€æ¡æ•°è½´ä¸Šæœ‰ ğ‘ å®¶å•†åº—ï¼Œå®ƒä»¬çš„åæ ‡åˆ†åˆ«ä¸º ğ´1âˆ¼ğ´ğ‘ã€‚
> ç°åœ¨éœ€è¦åœ¨æ•°è½´ä¸Š(ä»»æ„ä¸€ç‚¹)å»ºç«‹ä¸€å®¶è´§ä»“ï¼Œæ¯å¤©æ¸…æ™¨ï¼Œä»è´§ä»“åˆ°æ¯å®¶å•†åº—éƒ½è¦è¿é€ä¸€è½¦å•†å“ã€‚
> ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ±‚æŠŠè´§ä»“å»ºåœ¨ä½•å¤„ï¼Œå¯ä»¥ä½¿å¾—è´§ä»“åˆ°æ¯å®¶å•†åº—çš„è·ç¦»ä¹‹å’Œæœ€å°ã€‚
>
> åœ¨ä¸­ä½æ•°å¤„å»ºç‚¹å¯ä»¥ä½¿å¾—ç­”æ¡ˆæœ€å°

```cpp
//https://www.acwing.com/problem/content/106/
#include <iostream>
#include <cmath>
#include <algorithm>
using namespace std;
const int N = 100005;
int n,a[N];

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
	}
	sort(a+1,a+n+1);
	long long ans = 0;
	for(int i = 1;i <= n;i++){
		ans+=abs(a[i]-a[n+1 >> 1]);
	}
	cout << ans;
}
```



**å‡åˆ†çº¸ç‰Œ**

> nä¸ªäººååœ¨ä¸€æ’,æ¯äººæœ‰a[i]å¼ çº¸ç‰Œ,æ¯æ¬¡å¯å°†ä»»æ„æ•°é‡çº¸ç‰Œç»™ç›¸é‚»çš„ä¸€ä¸ªäºº,æ±‚ä½¿æ‰€æœ‰äººçº¸ç‰Œæ•°ç›¸ç­‰çš„æœ€å°æ“ä½œæ¬¡æ•°

```cpp
//https://www.acwing.com/problem/content/1538/
#include <iostream>
using namespace std;
const int N = 10004;
int a[N];
int ans,sum;

int main(){
	int n;cin >>n;
	for(int i = 1;i <= n;i++){
		cin >> a[i];
		sum += a[i];
	}
	int avg = sum/n;

	for(int i = 1;i < n;i++) {
		a[i] -= avg;//æœ€ç»ˆæ‰€æœ‰äººçš„çº¸ç‰Œä¸€å®šå˜ä¸ºå¹³å‡æ•°
		if(a[i]){//ä¸å¤Ÿçš„ä»i+1å–ï¼Œå¤šçš„ç»™i+1
			a[i+1] += a[i];
			ans++;
		}
	}	
	cout << ans;//æ¯æ¬¡å¯ç§»åŠ¨ä»»æ„å¼ ï¼Œæœ€å°æ¬¡æ•°
}
```



**ç¯å½¢å‡åˆ†çº¸ç‰Œ**

nä¸ªäººå›´åœ¨ä¸€åœˆ,æ¯äººæœ‰a[i]å¼ çº¸ç‰Œ,æ¯æ¬¡å¯å°†1å¼ çº¸ç‰Œç»™ç›¸é‚»çš„ä¸€ä¸ªäºº,æ±‚ä½¿æ‰€æœ‰äººçº¸ç‰Œæ•°ç›¸ç­‰çš„æœ€å°æ“ä½œæ¬¡æ•°

```cpp
//https://www.luogu.com.cn/problem/P2512
#include <iostream>
#include <algorithm>
using namespace std;
using ll = long long;
const int N = 1000006;
ll a[N],s[N];
int n;
ll sum,ans;

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++) cin >> a[i],sum+=a[i];

	ll avg = sum/n;

	for(int i = 1;i <= n;i++){
		s[i] = s[i-1] + a[i] - avg;
	}
    //sä¸ºaçš„æ‰€å·®çš„å‰ç¼€å’Œæ•°ç»„
    //é€‰å–sçš„ä¸­ä½æ•°æœ€ä¼˜ï¼Œé—®é¢˜å˜ä¸ºå¯¹sæ•°ç»„çš„è´§ä»“é€‰å€é—®é¢˜

	sort(s+1,s+n+1);

	ll mid = s[(n+1)/2];

	for(int i = 1;i <= n;i++){
		ans += abs(s[i] - mid);
	}   
	cout << ans;//æ¯æ¬¡ç§»åŠ¨ä¸€å¼ ï¼Œæœ€å°æ¬¡æ•°
}
```







## æ’åºä¸ç­‰å¼

**é‚»é¡¹äº¤æ¢æ³•** è¯æ˜åœ¨ä»»æ„å±€é¢ä¸‹ï¼Œä»»ä½•å¯¹å±€éƒ¨æœ€ä¼˜ç­–ç•¥çš„å¾®å°æ”¹å˜éƒ½ä¼šé€ æˆæ•´ä½“ç»“æœå˜å·®ã€‚ç»å¸¸ç”¨äºä»¥â€œæ’åºâ€ä¸ºè´ªå¿ƒç­–ç•¥çš„è¯æ˜ã€‚

è¯ºäº¤æ¢ç›¸é‚»ä¸¤é¡¹ä¸ä¼šå½±å“å…¶ä»–é¡¹çš„å€¼ï¼Œå•ç‹¬åˆ†æè¿™ä¸¤é¡¹ï¼Œæ‰¾å‡ºæ’åºç­–ç•¥cmp



**è€æ‚æŠ€çš„ç‰›**

> å¥¶ç‰›ä»¬ç«™åœ¨å½¼æ­¤çš„èº«ä¸Šï¼Œå½¢æˆä¸€ä¸ªé«˜é«˜çš„å‚ç›´å †å ã€‚
> è¿™ ğ‘ å¤´å¥¶ç‰›ä¸­çš„æ¯ä¸€å¤´éƒ½æœ‰ç€è‡ªå·±çš„é‡é‡ ğ‘Šğ‘– ä»¥åŠè‡ªå·±çš„å¼ºå£®ç¨‹åº¦ ğ‘†ğ‘–ã€‚
> ä¸€å¤´ç‰›æ”¯æ’‘ä¸ä½çš„å¯èƒ½æ€§å–å†³äºå®ƒå¤´ä¸Šæ‰€æœ‰ç‰›çš„æ€»é‡é‡ï¼ˆä¸åŒ…æ‹¬å®ƒè‡ªå·±ï¼‰å‡å»å®ƒçš„èº«ä½“å¼ºå£®ç¨‹åº¦çš„å€¼ï¼Œç°åœ¨ç§°è¯¥æ•°å€¼ä¸ºé£é™©å€¼ï¼Œé£é™©å€¼è¶Šå¤§ï¼Œè¿™åªç‰›æ’‘ä¸ä½çš„å¯èƒ½æ€§è¶Šé«˜ã€‚
> ç¡®å®šå¥¶ç‰›çš„æ’åºï¼Œä½¿å¾—æ‰€æœ‰å¥¶ç‰›çš„é£é™©å€¼ä¸­çš„æœ€å¤§å€¼å°½å¯èƒ½çš„å°ï¼Œæ±‚å‡ºè¯¥å€¼ã€‚

> å°†æ‰€æœ‰ç‰›æŒ‰w+så€¼ä»å°åˆ°å¤§æ’åºæ—¶ï¼Œæœ€å¤§çš„é£é™©å€¼ä¸€å®šæœ€å°
>
> ç›¸é‚»ä¸¤ç‰›äº¤æ¢ä¸ä¼šå½±å“å…¶å®ƒç‰›çš„é£é™©å€¼ï¼Œæ‰€ä»¥åªéœ€è¦åˆ†æè¿™ä¸¤å¤´ç‰›å³å¯
>
> | é£é™©å€¼         | iç‰›                    | i+1ç‰›                       |
> | -------------- | ---------------------- | --------------------------- |
> | äº¤æ¢å‰ï¼š       | w[1]+....w[i-1]-s[i]   | w[1]+...+w[i-1]+w[i]-s[i+1] |
> | äº¤æ¢åï¼š       | w[1]+...+w[i-1]-s[i+1] | w[1]+...+w[i-1]+w[i+1]-s[i] |
> | äº¤æ¢å‰(åŒ–ç®€)ï¼š | s[i+1]                 | w[i]+s[i]                   |
> | äº¤æ¢å(åŒ–ç®€)ï¼š | s[i]                   | w[i+1]+s[i+1]               |
>
> iç‰›é£é™©å€¼ -= sï¼Œ i+1ç‰›é£é™©å€¼ += s+w

```cpp
//https://www.acwing.com/problem/content/127/
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 50004;
int n;
struct S{
	int sum,w,s;
}s[N];
long long suf[N];

bool cmp(S x,S y){
	return x.sum < y.sum;
}

int main(){
	cin >> n;
	for(int i = 1;i <= n;i++){
		int a,b;cin >> a >> b;
		s[i] = {a+b,a,b};
	}
	sort(s+1,s+n+1,cmp);
	long long ans = -0x3f3f3f3f;
	for(int i = 1;i <= n;i++){
		suf[i] = suf[i-1]+s[i].w;
		ans = max(ans,suf[i-1]-s[i].s);
	}
	cout << ans;
}
```



```cpp
//æ ˆå‹ç¼©ï¼šhttps://qoj.ac/problem/9379
//å›½ç‹æ¸¸æˆï¼šhttps://www.acwing.com/problem/content/description/116/
```







## åæ‚”è§£æ³•

> æ— è®ºå½“å‰çš„é€‰é¡¹æ˜¯å¦æœ€ä¼˜éƒ½æ¥å—ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœé€‰æ‹©ä¹‹åä¸æ˜¯æœ€ä¼˜äº†ï¼Œåˆ™åæ‚”ï¼Œèˆå¼ƒæ‰è¿™ä¸ªé€‰é¡¹ï¼›å¦åˆ™ï¼Œæ­£å¼æ¥å—ã€‚å¦‚æ­¤å¾€å¤ã€‚



[Luogu P2949 å·¥ä½œè°ƒåº¦](https://www.luogu.com.cn/problem/P2949)

> ç»™å®šNä¸ªå·¥ä½œï¼Œæ¯ä¸ªå·¥ä½œæˆªæ­¢æ—¥æœŸä¸º$D_i$ï¼Œå¦‚æœèƒ½åœ¨æˆªæ­¢æ—¥æœŸå‰å®Œæˆåˆ™ä¼šè·å¾—$P_i$çš„æŠ¥é…¬ï¼Œæ¯å¤©åªèƒ½å®Œæˆä¸€é¡¹å·¥ä½œã€‚$1\le N \le 10^5ï¼Œ1\le D_i,P_i \le 10^9$

```cpp
//https://www.luogu.com.cn/problem/P2949
#include <iostream>
#include <queue>
#include <algorithm>
using namespace std;
using ll = long long;
using pii = pair<ll,ll>;
const int N = 100005;
ll ans;

struct Edge{
	ll d,p;
}e[N];


int main(){
	int n;cin >> n;
	for(int i = 1; i <= n;i++){ cin >> e[i].d >> e[i].p; }

	sort(e+1,e+n+1,[](auto &e1,auto &e2){return e1.d < e2.d;});
    //å°†æ¯ä¸€é¡¹å·¥ä½œæŒ‰æˆªæ­¢æ—¶é—´ä»å°åˆ°å¤§æ’åº
    
	priority_queue<ll,vector<ll>,greater<ll>>pq;//å°æ ¹å †å­˜å†³å®šåšçš„å·¥ä½œçš„æŠ¥é…¬p
    										//pq.size()å³ä¸ºåšè¿™äº›å·¥ä½œçš„æœ€å°‘å®‰æ’æ—¶é—´
	for(int i = 1;i <= n;i++){
		if(e[i].d <= pq.size()){//å¦‚æœå½“å‰å·¥ä½œæˆªæ­¢æ—¶é—´ä¸å·²ç»å®‰æ’çš„æ—¶é—´å†²çª
			if(e[i].p > pq.top()){//ä¸”é€‰æ‹©å½“å‰å·¥ä½œæ¯”ä¹‹å‰å†³å®šçš„å·¥ä½œæŠ¥é…¬æ›´é«˜,åˆ™åæ‚”ä¹‹å‰æŠ¥é…¬æœ€ä½çš„å†³å®š
				//ans += e[i].p - pq.top();
				pq.pop();
				pq.push(e[i].p);
			}
		}
		else{//å¦åˆ™å®‰æ’å½“å‰å†³å®š
			//ans += e[i].p;
			pq.push(e[i].p);
		}
	}
	while(pq.size()){
		ans += pq.top();
		pq.pop();
	}
	cout << ans;
}
```





```cpp
//https://codeforces.com/problemset/problem/1526/C2
//ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸ºnçš„åºåˆ—A[]ï¼Œè¦æ±‚ä½ æ‰¾å‡ºæœ€é•¿çš„ä¸€ä¸ªå­åºåˆ—ä½¿å¾—è¿™ä¸ªå­åºåˆ—ä»»æ„å‰ç¼€å’Œéƒ½éè´Ÿã€‚
#include <bits/stdc++.h>
int T = 1;
using ll = long long;
using namespace std;

void sol(){
	int n;cin >>n;
	unsigned ans = 0;
	ll sum = 0;
	priority_queue<ll,vector<ll>,greater<ll>>pq;
	while(n--){
		int x;cin >> x;
		pq.push(x);//æ— è®ºå½“å‰é€‰æ‹©æ˜¯å¦æœ€ä¼˜ï¼Œå…ˆæ¥å—
		sum += x;
		while(sum < 0){//è¯ºæ¥å—åä¸æ˜¯æœ€ä¼˜ï¼Œåˆ™åæ‚”ä¹‹å‰æœ€å·®çš„å†³å®š
			sum -= pq.top();
			pq.pop();
		}
		ans = max(ans,pq.size());
	}
	cout << ans << endl;
}

int main() {
	while(T--){ sol(); }
}
```





------

# å…¶å®ƒ

## å­—ç¬¦ä¸æ•°å­—è½¬æ¢

> ASCIIç èŒƒå›´ä¸º0~127ï¼Œæ³¨æ„ä¸è¦è¶Šç•Œï¼Œå¦åˆ™ä¼šä¹±ç  

**å­—ç¬¦ä¸² <=> æ•°å­—**

```cpp
//å­—ç¬¦ä¸²->æ•°å­—
//atoiæ•´å‹   atolé•¿æ•´å‹	atollé•¿é•¿æ•´å‹	atofæµ®ç‚¹å‹        é»˜è®¤å‚æ•°ä¸ºconst char*ç±»å‹
//stoiç±»ä¼¼,é»˜è®¤å‚æ•°ä¸ºconst string*ç±»å‹,ä¸”è¶…å‡ºintèŒƒå›´ä¼šæŠ¥é”™

string s1 = "123456";
int n = stoi(s1);			//stringç±»å‹å­—ç¬¦ä¸²
int n1 = atoi(s1.c_str());	//c_str() å‡½æ•°å¯ä»¥å°† const string* ç±»å‹ è½¬åŒ–ä¸º cons char* ç±»å‹

char s2[] = "123456";
int n2 = atoi(s2);			//char[]ç±»å‹å­—ç¬¦ä¸²
```

```cpp
//æ•°å­—->å­—ç¬¦ä¸²
int n = 541;
string a = to_string(n);//#include<string>
```

```cpp
//æ•°å­—<=>å­—ç¬¦ä¸²
//ä½¿ç”¨sstream è¾“å…¥æµ
stringstream ss;
int n = 123456;
string str;
ss << n;
ss >> str;
```





**å­—ç¬¦c <=> æ•°å­—n**

```cpp
//å­—ç¬¦c è½¬ æ•°å­—n
n = c - '0' ï¼›  //æˆ–è€… -48
```

```cpp
//æ•°å­—n è½¬ å­—ç¬¦c
c = n + '0';
```



**å¤§å°å†™è½¬æ¢**

```cpp
s[i] ^= ' ';//å¤§å°å†™äº’è½¬    ç©ºæ ¼' 'ä¸ºchar(32)
```

```cpp
s[i] = tolower(s[i]);//è½¬å°å†™	s[i] |= ' '
s[i] = toupper(s[i]);//è½¬å¤§å†™	s[i] &= ~' '
```





## è¿›åˆ¶è½¬æ¢

**stoi**  kè¿›åˆ¶è½¬åè¿›åˆ¶

- `stoi(å­—ç¬¦ä¸², 0, kè¿›åˆ¶)` ï¼šå°†ä¸€ä¸²kè¿›åˆ¶çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º int å‹æ•°å­—ã€‚
- stollï¼Œstoullï¼Œstodï¼Œstold åŒç†ã€‚

```cpp
//sä¸º0~9 + 'a'~'z'
#include <iostream>
using namespace std;
int main(){
	string s = "100";
    int n = stoi(s,0,16);//å°†16è¿›åˆ¶çš„sè½¬ä¸ºåè¿›åˆ¶
	cout << n << endl;
}
```

```cpp
//sä¸ºæ•°å­—
ll calc(vector<int> s,int k){
	ll ans = 0;
	ll base = 1;
	for(int i = s.size()-1;i >= 0;i--){
		ans += s[i]*base;
		base *= k;
	}
	return ans;
}
```



**åè¿›åˆ¶è½¬kè¿›åˆ¶**

> å»ºè®®ç›´æ¥æ‰‹å†™è¿›åˆ¶è½¬æ¢å‡½æ•°

```cpp
//næ˜¯å¾…è½¬æ¢çš„åè¿›åˆ¶æ•°ï¼Œmæ˜¯å¾…è½¬æ¢æˆçš„è¿›åˆ¶æ•°
//ä»¥æ•°å­—+å­—æ¯è¡¨ç¤º
string intToA(int n,int k){
    string ans="";
    do{		 //ä½¿ç”¨doå¾ªç¯é˜²æ­¢nä¸º0çš„æƒ…å†µ
        int t =n %k;
        if(t>=0&&t<=9) ans+=(t+'0');
        else ans+=(t-10+'a');
        n/=k;
    }while(n);
    reverse(ans.begin(),ans.end());
    return ans;   
}

//ä»¥æ•°å­—è¡¨ç¤º
vector<int> calc(int n , int m){
	vector<int>ans;
	do{
		ans.push_back(n%m);
		n /= m;
	}while(n);
	reverse(ans.begin(),ans.end());
	return ans;
}
```



```cpp
//sprintfåè¿›åˆ¶è½¬8/16è¿›åˆ¶
#include <iostream>
using namespace std;

int main() {
	int n; cin >> n;
	char s[100];
	
    //x/X  	-16è¿›åˆ¶(å¤§å°å†™)
    //o		-8è¿›åˆ¶
    //d 	-10è¿›åˆ¶   
    sprintf(s, "%x", n);
	cout << s << endl;

	return 0;
}
```



~~**itoa**~~

ã€æ³¨æ„ã€‘  **ä¸å»ºè®®ä½¿ç”¨**
itoaå¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Cå‡½æ•°ï¼Œå®ƒæ˜¯Windowsç‰¹æœ‰çš„ï¼Œå¦‚æœè¦å†™è·¨å¹³å°çš„ç¨‹åºï¼Œéœ€è¦ç”¨spraintã€‚

ã€å‡½æ•°åŸå‹ã€‘`char *itoa(int value, char *string, int radix);`

ã€å‚æ•°è¯´æ˜ã€‘
      valueï¼šè¦è½¬æ¢çš„æ•°æ®ã€‚
      stringï¼šç›®æ ‡å­—ç¬¦ä¸²çš„åœ°å€ã€‚
      radixï¼šè½¬æ¢åçš„è¿›åˆ¶æ•°ï¼Œå¯ä»¥æ˜¯10è¿›åˆ¶ã€16è¿›åˆ¶ç­‰ï¼ŒèŒƒå›´å¿…é¡»åœ¨ 2-36ã€‚

```cpp
#include <iostream>
using namespace std;
int main() {
	int n;cin >> n;	
	char str[100];
	_itoa(n, str,36 );//ä¾‹ï¼š10è¿›åˆ¶è½¬36è¿›åˆ¶å­˜äºå­—ç¬¦ä¸²strä¸­
	cout << str;
	return 0;
}
```









## ç²¾åº¦/æº¢å‡ºé—®é¢˜

> [doubleç­‰æµ®ç‚¹æ•°æ¯”è¾ƒé—®é¢˜ï¼Œeps_double eps å€¼-CSDNåšå®¢](https://blog.csdn.net/major_zhang/article/details/65449685)

```cpp
double n = 3.8;
double ans = n - int(n);
ans*=10;
int ans1 =int(ans);
cout << ans1 << endl;//é¢„æœŸä¸º8ï¼Œè¾“å‡ºç»“æœå´æ˜¯7
```

```cpp
#define eps = 1e-8
double n = 3.8;
double ans = n - int(n);
ans*=10;
int ans1 =int(ans + eps);//å¯¹äºè´Ÿæ•°çš„æƒ…å†µï¼Œåªéœ€è¦æŠŠans + epsæ”¹ä¸ºans - epså³å¯
cout << ans1 << endl;//æ­£ç¡®è¾“å‡º8
```

ç°åœ¨è€ƒè™‘ä¸€ç§æƒ…å†µ,é¢˜ç›®è¦æ±‚è¾“å‡ºä¿ç•™ä¸¤ä½å°æ•°ã€‚æœ‰ä¸ªcaseçš„æ­£ç¡®ç­”æ¡ˆçš„ç²¾ç¡®å€¼æ˜¯0.005,æŒ‰ç†åº”è¯¥è¾“å‡º0.01,ä½†ä½ çš„ç»“æœå¯èƒ½æ˜¯0.005000000001(æ­å–œ)ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯0.004999999999(æ‚²å‰§),å¦‚æœæŒ‰ç…§printf(â€œ%.2lfâ€, a)è¾“å‡ºï¼Œé‚£ä½ çš„é­é‡å°†å’Œæ‹¬å·é‡Œçš„å­—ç›¸åŒã€‚

è§£å†³åŠæ³•æ˜¯ï¼Œå¦‚æœaä¸ºæ­£ï¼Œåˆ™è¾“å‡ºa+eps, å¦åˆ™è¾“å‡ºa-eps



ä¸¤ä¸ªæµ®ç‚¹æ•°ä¹‹é—´çš„æ¯”è¾ƒï¼Œepsç¼©å†™è‡ªepsilonï¼Œè¡¨ç¤ºä¸€ä¸ªå°é‡ï¼Œä½†è¿™ä¸ªå°é‡åˆè¦ç¡®ä¿è¿œå¤§äºæµ®ç‚¹è¿ç®—ç»“æœçš„ä¸ç¡®å®šé‡ã€‚epsæœ€å¸¸è§çš„å–å€¼æ˜¯1e-8å·¦å³ã€‚å¼•å…¥epsåï¼Œæˆ‘ä»¬åˆ¤æ–­ä¸¤æµ®ç‚¹æ•°aã€bç›¸ç­‰çš„æ–¹å¼å¦‚ä¸‹:

å®šä¹‰ä¸‰å‡ºå£å‡½æ•°å¦‚ä¸‹: int sgn(double a){return a < -eps ? -1 : a < eps ? 0 : 1;}

åˆ™å„ç§åˆ¤æ–­å¤§å°çš„è¿ç®—éƒ½åº”åšå¦‚ä¸‹ä¿®æ­£:

| ä¼ ç»Ÿæ„ä¹‰ | ä¿®æ­£å†™æ³•1       | ä¿®æ­£å†™æ³•2         |
| -------- | --------------- | ----------------- |
| a == b   | sgn(a - b) == 0 | fabs(a â€“ b) < eps |
| a != b   | sgn(a - b) != 0 | fabs(a â€“ b) > eps |
| a < b    | sgn(a - b) < 0  | a â€“ b < -eps      |
| a <= b   | sgn(a - b) <= 0 | a â€“ b < eps       |
| a > b    | sgn(a - b) > 0  | a â€“ b > eps       |
| a >= b   | sgn(a - b) >= 0 | a â€“ b > -eps      |





> é™¤æ³•ä¹‹é—´æ¯”è¾ƒå°½é‡è½¬æ¢ä¸ºä¹˜æ³•ä¹‹é—´æ¯”è¾ƒï¼Œå¦‚$\frac{a}{b} < \frac{c}{d}$åˆ¤æ–­æ”¹ä¸º$a*d < b*c$
>
> æˆ–è€…åˆ©ç”¨ä¹˜æ³•é€†å…ƒåˆ¤æ–­

```cpp
//https://ac.nowcoder.com/acm/contest/93218/D
//æ±‚å¹³é¢ä¸Šæœ‰å¤šå°‘ä¸ªä¸åŒçš„ç›´çº¿
#include <bits/stdc++.h>
int T = 1; using ll = long long;
const int mod = 1e9+7;
using namespace std;
const int N = 1003;
int n;
ll x[N],y[N];

ll qmi(ll a,ll b,ll p){
	ll ans = 1;
	while(b){
		if(b&1) ans = ans*a%p;
		b>>=1;
		a = a*a%p;
	}
	return ans%p;
}

pair<ll,ll> uuz(ll x1,ll y1,ll x2,ll y2){
	ll k;
	if(y1 == y2) k = 1e18;//ç‰¹åˆ¤æ–œç‡ä¸å­˜åœ¨çš„æƒ…å†µ
	else if(x1 == x2) k = 0;
	else k = (x1-x2)*qmi(y2-y1,mod-2,mod)%mod;//é™¤æ³•è½¬ä¹˜æ³•é€†å…ƒ
	ll b = (y2*y2-y1*y1+x2*x2-x1*x1)*qmi(2*(y2-y1),mod-2,mod)%mod;
	return {k,b};
}

void sol(){
	cin >> n;
	for(int i = 1;i <= n;i++){cin >> x[i];}
	for(int i = 1;i <= n;i++){cin >> y[i];}

	map<pair<ll,ll>,int>mp;

	for(int i = 1;i <= n;i++){
		for(int j = i+1;j <= n;j++){
			auto [k,b] = uuz(x[i],y[i],x[j],y[j]);
			if(k == 1e18) mp[{k,x[i]+x[j]}]++;
			else mp[{k,b}]++;
		}
	}
	cout << mp.size() << '\n';
}

int main() {
	cin >> T;
	while(T--){ sol(); }
}
```



> sqrt

```cpp
int ans1 = 0,ans2 = 0,ans3 = 0;
for(int i = 1;i <= 100;i++){
    if(i == sqrt(i)*sqrt(i)) ans1++;//53
    if(i - sqrt(i)*sqrt(i) < 1e-9) ans2++;//100
    if(i == (int)sqrt(i)*sqrt(i)) ans3++;//10
}
```

sqrtlè¿”å›å€¼ä¸ºlong doubleç±»å‹ï¼Œç²¾åº¦æ›´é«˜ã€‚[Yet Another Simple Math Problem - Problem - QOJ.ac](https://qoj.ac/contest/1499/problem/8167)





> pow/ceil/floor/roundå‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹å‡ä¸ºæµ®ç‚¹å‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¾“å‡ºä¸é¢„æœŸä¸ç¬¦è€Œwrong answer

```cpp
int a = 1234;
cout << a*a << endl;//1522756
cout << pow(a, 2) << endl;//1.52276e+06        å¯ä»¥ç”¨int n = pow(a,2)ç±»å‹è½¬æ¢å†è¾“å‡ºn
```



> æœ‰ç¬¦å·æ•´å‹ - æ— ç¬¦å·æ•´å‹

```cpp
vector<int>v(3);
int n = 2;
while(n - v.size() > 0){
    //é¢„æœŸ2-3 = -1
    //å®é™…å´æ˜¯4294967295å¯¼è‡´æ­»å¾ªç¯
    //åº”æ”¹å†™ä¸ºwhile(n > s.size()) æˆ– while(n > (int)v.size())
}
```



## è¾“å…¥è¾“å‡ºä¼˜åŒ–

ä½¿ç”¨cin/coutä¼šæ¯”scanf/printfæ…¢

```cpp
//å…³é—­cstdioå’Œiostreamçš„åŒæ­¥å,cin/coutä¸è¦ä¸printf/scanf/putsæ··ç”¨,ä¹Ÿä¸è¦å†ä½¿ç”¨endl,å¦åˆ™ä¼šé€ æˆè¾“å…¥è¾“å‡ºæ··ä¹±
ios::sync_with_stdio(false);
cin.tie(0);
cout.tie(0);
```



```cpp
//endlæ¯æ¬¡ä¼šæ¸…ç©ºç¼“å†²åŒºï¼Œæ•ˆç‡æ¯”'\n'æ…¢å¾ˆå¤š
#define endl '\n'
```



```cpp
//å¿«è¯»å¿«å†™   ä¸è¦ä¸ios::sync_with_stdio(false)åŒæ—¶ä½¿ç”¨
inline int read(){
    int x = 0,f = 1;
    char ch = getchar();//linuxå¯ä»¥ç”¨æ›´å¿«çš„getchar_unlocked()
    while(ch < '0' || ch > '9'){//è·³è¿‡ç©ºæ ¼å›è½¦ç­‰å…¶ä»–å­—ç¬¦+åˆ¤æ–­æ­£è´Ÿ
        if(ch == '-') f = -1;
        ch = getchar();
    }
    while(ch >= '0' && ch <= '9'){//è¯»å–æ•°å­—
         x = x * 10 + ch - '0';
		ch = getchar();
    } 
    return x * f;
}

void write(int x) {
	if (x < 0) putchar('-'), x = ~x + 1;
	if (x > 9) write(x / 10);
	putchar(x % 10 + '0');
}
```





```cpp
//O2ä¼˜åŒ–ï¼Œç¨‹åºå¼€å¤´åŠ å…¥
#pragma GCC optimize(2)
```



```cpp
//ç«è½¦å¤´?
#pragma GCC optimize(3)
#pragma GCC target("avx")
#pragma GCC optimize("Ofast")
#pragma GCC optimize("inline")
#pragma GCC optimize("-fgcse")
#pragma GCC optimize("-fgcse-lm")
#pragma GCC optimize("-fipa-sra")
#pragma GCC optimize("-ftree-pre")
#pragma GCC optimize("-ftree-vrp")
#pragma GCC optimize("-fpeephole2")
#pragma GCC optimize("-ffast-math")
#pragma GCC optimize("-fsched-spec")
#pragma GCC optimize("unroll-loops")
#pragma GCC optimize("-falign-jumps")
#pragma GCC optimize("-falign-loops")
#pragma GCC optimize("-falign-labels")
#pragma GCC optimize("-fdevirtualize")
#pragma GCC optimize("-fcaller-saves")
#pragma GCC optimize("-fcrossjumping")
#pragma GCC optimize("-fthread-jumps")
#pragma GCC optimize("-funroll-loops")
#pragma GCC optimize("-fwhole-program")
#pragma GCC optimize("-freorder-blocks")
#pragma GCC optimize("-fschedule-insns")
#pragma GCC optimize("inline-functions")
#pragma GCC optimize("-ftree-tail-merge")
#pragma GCC optimize("-fschedule-insns2")
#pragma GCC optimize("-fstrict-aliasing")
#pragma GCC optimize("-fstrict-overflow")
#pragma GCC optimize("-falign-functions")
#pragma GCC optimize("-fcse-skip-blocks")
#pragma GCC optimize("-fcse-follow-jumps")
#pragma GCC optimize("-fsched-interblock")
#pragma GCC optimize("-fpartial-inlining")
#pragma GCC optimize("no-stack-protector")
#pragma GCC optimize("-freorder-functions")
#pragma GCC optimize("-findirect-inlining")
#pragma GCC optimize("-fhoist-adjacent-loads")
#pragma GCC optimize("-frerun-cse-after-loop")
#pragma GCC optimize("inline-small-functions")
#pragma GCC optimize("-finline-small-functions")
#pragma GCC optimize("-ftree-switch-conversion")
#pragma GCC optimize("-foptimize-sibling-calls")
#pragma GCC optimize("-fexpensive-optimizations")
#pragma GCC optimize("-funsafe-loop-optimizations")
#pragma GCC optimize("inline-functions-called-once")
#pragma GCC optimize("-fdelete-null-pointer-checks")
```







## äº¤äº’é¢˜

è¾“å…¥ç”±è¯„æµ‹æœºè¾“å…¥ï¼Œæ ¹æ®è¾“å…¥çš„å†…å®¹è¾“å‡ºè¯¢é—®ï¼Œç›´åˆ°ç¡®å®šæ­£ç¡®ç­”æ¡ˆï¼Œè¿™ä¸€ç±»é¢˜ç›®ï¼Œå¾€å¾€é™åˆ¶ä½ äº¤æµ(æˆ–è¯¢é—®)çš„æ¬¡æ•°ï¼Œè®©ä½ çŒœå‡ºä¸€ä¸ªä¸œè¥¿æ¥ï¼Œæ­¤ç±»é—®é¢˜æ¯”è¾ƒç»å…¸çš„æŠ€å·§æœ‰äºŒåˆ†ç­”æ¡ˆã€éšæœºåŒ–

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¾“å‡ºäº†ä¸€äº›æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯èƒ½è¢«æ”¾ç½®äºå†…éƒ¨ç¼“å­˜åŒºé‡Œï¼Œè€Œä¸”æˆ–è®¸æ²¡æœ‰è¢«ç›´æ¥ä¼ è¾“ç»™interactorï¼Œå‡ºç°Idleness limit exceededã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œéœ€è¦æ¯æ¬¡è¾“å‡ºæ—¶ç”¨ä¸€ç§ç‰¹æ®Šçš„æ¸…é™¤ç¼“å­˜æ“ä½œã€‚
> ```cpp
> fflush(stdout);//æ–¹å¼ä¸€
> cout << flush; //æ–¹å¼äºŒ
> //endlæ¢è¡Œæ—¶ä¹Ÿä¼šæ¸…é™¤ç¼“å­˜ï¼Œä½†'\n'ä¸ä¼š
> //æœ€å¥½ä¸è¦ä½¿ç”¨å¿«è¯»ã€å…³åŒæ­¥æµç­‰
> ```

```cpp
//https://codeforces.com/contest/1999/problem/G1
#include <bits/stdc++.h>
using namespace std;

void sol() {
	int l = 2, r = 1000;
	while (l < r) {
		int mid = l + r >> 1;
		cout << "? 1 " << mid <<endl;
		int res; cin >> res;
		if (mid != res) r = mid;
		else l = mid + 1;
	}
	cout << "! " << l << endl;
}

int main() {
	int T = 1;
	cin >> T;
	while (T--) {
		sol();
	}
}
```



## ä¸€äº›è¯­æ³•/æ ‡å‡†



### é‡è½½è¿ç®—ç¬¦



**ä¸€äº›å¯é‡è½½è¿ç®—ç¬¦çš„åˆ—ä¸¾**

- ä¸€å…ƒè¿ç®—ï¼š`+`ï¼ˆæ­£å·ï¼‰ï¼›`-`ï¼ˆè´Ÿå·ï¼‰ï¼›`~`ï¼ˆæŒ‰ä½å–åï¼‰ï¼›`++`ï¼›`--`ï¼›`!`ï¼ˆé€»è¾‘éï¼‰ï¼›`*`ï¼ˆå–æŒ‡é’ˆå¯¹åº”å€¼ï¼‰ï¼›`&`ï¼ˆå–åœ°å€ï¼‰ï¼›`->`ï¼ˆç±»æˆå‘˜è®¿é—®è¿ç®—ç¬¦ï¼‰ç­‰ã€‚
- äºŒå…ƒè¿ç®—ï¼š`+`ï¼›`-`ï¼›`&`ï¼ˆæŒ‰ä½ä¸ï¼‰ï¼›`[]`ï¼ˆå–ä¸‹æ ‡ï¼‰ï¼›`=`ï¼ˆèµ‹å€¼ï¼‰ï¼›`>` `<` `>=` `<=` `==` `+=` `&=`ç­‰ã€‚
- å…¶å®ƒï¼š`()`ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰ï¼›`""`ï¼ˆåç¼€æ ‡è¯†ç¬¦ï¼ŒC++11 èµ·ï¼‰ï¼›`new`ï¼ˆå†…å­˜åˆ†é…ï¼‰ï¼›`,`ï¼ˆé€—å·è¿ç®—ç¬¦ï¼‰ï¼›`<=>`ï¼ˆä¸‰è·¯æ¯”è¾ƒ(C++20 èµ·ï¼‰ç­‰ã€‚

**å®ç°**

é‡è½½è¿ç®—ç¬¦åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œé‡è½½ä¸ºæˆå‘˜å‡½æ•°æˆ–éæˆå‘˜å‡½æ•°ã€‚

å½“é‡è½½ä¸ºæˆå‘˜å‡½æ•°æ—¶ï¼Œå› ä¸ºéšå«ä¸€ä¸ªæŒ‡å‘å½“å‰æˆå‘˜çš„ `this` æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œæ­¤æ—¶å‡½æ•°çš„å‚æ•°ä¸ªæ•°ä¸è¿ç®—æ“ä½œæ•°ç›¸æ¯”å°‘ä¸€ä¸ªã€‚

è€Œå½“é‡è½½ä¸ºéæˆå‘˜å‡½æ•°æ—¶ï¼Œå‡½æ•°çš„å‚æ•°ä¸ªæ•°ä¸è¿ç®—æ“ä½œæ•°ç›¸åŒã€‚

å…¶åŸºæœ¬æ ¼å¼ä¸ºï¼ˆå‡è®¾éœ€è¦è¢«é‡è½½çš„è¿ç®—ç¬¦ä¸º `@`ï¼‰ï¼š

```cpp
class Example {
  // æˆå‘˜å‡½æ•°çš„ä¾‹å­
  è¿”å›ç±»å‹ operator @ (é™¤æœ¬èº«å¤–çš„å‚æ•°) { /* ... */ }
};

// éæˆå‘˜å‡½æ•°çš„ä¾‹å­
è¿”å›ç±»å‹ operator @ (æ‰€æœ‰å‚ä¸è¿ç®—çš„å‚æ•°) { /* ... */ }
```



```cpp
#include <iostream>
#include <queue>
#include <set>
using namespace std;
const int P = 1e9 + 7;

struct Test {
	int k;
};

struct Edge {
	int a, b, w;
	bool operator < (const Edge& e2) const {//setå†…å®¹æ— æ³•ä¿®æ”¹éœ€è¦åŠ const
		if (a != e2.a) return a < e2.a;
		if (b != e2.b) return b < e2.b;
		return w < e2.w;
	}
	bool operator > (Edge& e2) {
		if (a != e2.a) return a > e2.a;
		if (b != e2.b) return b > e2.b;
		return w > e2.w;
	}
	long long operator * (Edge& e2) {
		return a * e2.a + b * e2.b + w * e2.w;
	}
	Edge operator += (Edge& e2){
		a += e2.a; b += e2.b; w += e2.w;
		return *this;//éšå«äº†ä¸€ä¸ªæŒ‡å‘å½“å‰æˆå‘˜çš„thisæŒ‡é’ˆ
	}
	long long operator * (Test& t) { //å‚æ•°å¯ä»¥ä¸ºå…¶å®ƒç±»
		return a * t.k + b * t.k + w * t.k;
	}
};

Edge operator += (Edge& e, Test& t) {//éæˆå‘˜å‡½æ•°é‡è½½
	return /*Edge*/{e.a - t.k, e.b - t.k, e.w - t.k};
}

struct cmp{
    bool operator () (auto &e1,auto &e2)const{//cmpå‡½æ•°è°ƒç”¨é‡è½½
		return e1.a > e2.b;//pqå°æ ¹å †ï¼Œå †é¡¶ä¸ºæœ€å°å€¼
		return e1.a < e2.b;//pqå¤§æ ¹å †ï¼Œå †é¡¶ä¸ºæœ€å¤§å€¼
	}
};

int main() {
	int n = 10; //cin >> n;
	multiset<Edge>se;
	priority_queue<Edge>pq;//ä¼˜å…ˆé˜Ÿåˆ—é»˜è®¤é‡è½½<
    //priority_queue<Edge,vector<Edge>,cmp>pq;  //cmpå‡½æ•°è°ƒç”¨é‡è½½
	for (int i = 1; i <= n; i++) {
		int x = abs((P * i * i) % 11) + 1;
		Edge a = { x,x * i % 10,x * i * i % 10 };
		se.insert(a);
		pq.push(a);
	}

	se.insert({ 9,4,4 });
	se.erase({ 9,4,4 });
	cout << "multiset:" << endl;
	for (const Edge& x : se) { cout << x.a << ' ' << x.b << ' ' << x.w << endl; }
	cout << "\npq:" << endl;
	while (pq.size()) {
		Edge x = pq.top();
		cout << x.a << ' ' << x.b << ' ' << x.w << endl;
		pq.pop();
	}
	cout << "\ne1 = {1,2,3},e2 = {4,5,6}\n";
	cout << "e1 * e2 = ";
	Edge e1 = { 1,2,3 }, e2 = { 4,5,6 };
	cout << e1 * e2 << endl;
	
	cout << "e1 += e2 => ";
	e1 += e2;
	cout << e1.a << ' ' << e1.b << ' ' << e1.w << endl;
	Test t = { 10 };
	cout << "e1 * t = ";
	cout << e1 * t << endl;
	cout << "e1 = e1-t => ";
	e1 = e1 += t;
	cout << e1.a << ' ' << e1.b << ' ' << e1.w << endl;
	return 0;
}
```





### Lambdaè¡¨è¾¾å¼

> ```cpp
>[capture list] (parameter list) -> return type { function body }
> ```
> 
> - `capture list` æ˜¯æ•è·åˆ—è¡¨ï¼Œç”¨äºæŒ‡å®š Lambdaè¡¨è¾¾å¼å¯ä»¥è®¿é—®çš„å¤–éƒ¨å˜é‡ï¼Œä»¥åŠæ˜¯æŒ‰å€¼è¿˜æ˜¯æŒ‰å¼•ç”¨çš„æ–¹å¼è®¿é—®ã€‚æ•è·åˆ—è¡¨å¯ä»¥ä¸ºç©ºï¼Œè¡¨ç¤ºä¸è®¿é—®ä»»ä½•å¤–éƒ¨å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤æ•è·æ¨¡å¼ `&` æˆ– `=` æ¥è¡¨ç¤ºæŒ‰å¼•ç”¨æˆ–æŒ‰å€¼æ•è·æ‰€æœ‰å¤–éƒ¨å˜é‡ï¼Œè¿˜å¯ä»¥æ··åˆä½¿ç”¨å…·ä½“çš„å˜é‡åå’Œé»˜è®¤æ•è·æ¨¡å¼æ¥æŒ‡å®šä¸åŒçš„æ•è·æ–¹å¼ã€‚
>- `parameter list` æ˜¯å‚æ•°åˆ—è¡¨ï¼Œç”¨äºè¡¨ç¤º Lambdaè¡¨è¾¾å¼çš„å‚æ•°ï¼Œ**å¯ä»¥ä¸ºç©º**ï¼Œè¡¨ç¤ºæ²¡æœ‰å‚æ•°ï¼Œä¹Ÿå¯ä»¥å’Œæ™®é€šå‡½æ•°ä¸€æ ·æŒ‡å®šå‚æ•°çš„ç±»å‹å’Œåç§°ï¼Œè¿˜å¯ä»¥åœ¨ c++14 ä¸­ä½¿ç”¨ `auto` å…³é”®å­—æ¥å®ç°æ³›å‹å‚æ•°ã€‚
> - `return type` æ˜¯è¿”å›å€¼ç±»å‹ï¼Œç”¨äºæŒ‡å®š Lambdaè¡¨è¾¾å¼çš„è¿”å›å€¼ç±»å‹ï¼Œ**å¯ä»¥çœç•¥**ï¼Œè¡¨ç¤ºç”±ç¼–è¯‘å™¨æ ¹æ®å‡½æ•°ä½“æ¨å¯¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `->` ç¬¦å·æ˜¾å¼æŒ‡å®šï¼Œè¿˜å¯ä»¥åœ¨ c++14 ä¸­ä½¿ç”¨ `auto` å…³é”®å­—æ¥å®ç°æ³›å‹è¿”å›å€¼ã€‚
> - `function body` æ˜¯å‡½æ•°ä½“ï¼Œç”¨äºè¡¨ç¤º Lambdaè¡¨è¾¾å¼çš„å…·ä½“é€»è¾‘ï¼Œå¯ä»¥æ˜¯ä¸€æ¡è¯­å¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šæ¡è¯­å¥ï¼Œè¿˜å¯ä»¥åœ¨ c++14 ä¸­ä½¿ç”¨ `constexpr` æ¥å®ç°ç¼–è¯‘æœŸè®¡ç®—ã€‚



```cpp
int n,x;cin >> n >> x;
for(int i = 1;i <= n;i++){
    cin >> a[i];
}

auto check = [&](int mid){//ä½¿ç”¨ä¾‹å­
    return a[mid] >= x;
};

int l = 1,r = n;
while(l < r){
    int mid = l + r >> 1;
    if(check(mid)) r = mid;
    else l = mid + 1;
}
cout << l << endl;
```



**é€’å½’å†™æ³•**

```cpp
//å‚æ•°è°ƒç”¨è‡ªå·±
auto fib = [&](auto &fib,int x){//é€’å½’æ±‚æ–æ³¢é‚£å¥‘
    if(x == 1 || x == 2) return 1;
    return fib(fib,x-1) + fib(fib,x-2);
};
cout << fib(fib,n) << endl;

auto dfs = [&](auto &dfs,int u,int fa)->void{//éœ€è¦å£°æ˜è¿”å›å€¼ç±»å‹
    for(auto x:e[u]){
        if(x == fa) continue;
        dfs(dfs,x,u);
    }
};
```



**å€¼æ•è·**

> å€¼æ•è·çš„å˜é‡åœ¨ Lambda è¡¨è¾¾å¼å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šï¼Œä¸ä¼šéšç€å¤–éƒ¨å˜é‡çš„å˜åŒ–è€Œå˜åŒ–ã€‚å€¼æ•è·çš„å˜é‡é»˜è®¤ä¸èƒ½åœ¨ Lambda è¡¨è¾¾å¼ä¸­ä¿®æ”¹

```cpp
int x = 10;
auto f = [x](auto a) -> int{ return a*x; };
x = 1;
cout << f(3) << endl;//ç»“æœä¸º30ï¼Œä¸éšxå€¼çš„å˜åŒ–è€Œæ”¹å˜
```



**å¼•ç”¨æ•è·**

> åœ¨æ•è·åˆ—è¡¨ä¸­ä½¿ç”¨ `&` åŠ å˜é‡åï¼Œè¡¨ç¤ºå°†è¯¥å˜é‡çš„å¼•ç”¨ä¼ é€’åˆ° Lambda è¡¨è¾¾å¼ä¸­ï¼Œä½œä¸ºä¸€ä¸ªæ•°æ®æˆå‘˜ã€‚å¼•ç”¨æ•è·çš„å˜é‡åœ¨ Lambda è¡¨è¾¾å¼è°ƒç”¨æ—¶æ‰ç¡®å®šï¼Œä¼šéšç€å¤–éƒ¨å˜é‡çš„å˜åŒ–è€Œå˜åŒ–ã€‚å¼•ç”¨æ•è·çš„å˜é‡å¯ä»¥åœ¨ Lambda è¡¨è¾¾å¼ä¸­è¢«ä¿®æ”¹

```cpp
int x = 10;
auto f = [&x](auto a) ->  int{ x = 100;return a*x; };
cout << f(3) << endl;//ç»“æœä¸º300ï¼Œéšxå€¼çš„å˜åŒ–è€Œæ”¹å˜
cout << x << endl;//x=100
```



**éšå¼æ•è·**

> åœ¨æ•è·åˆ—è¡¨ä¸­ä½¿ç”¨ `=` æˆ– `&`ï¼Œè¡¨ç¤ºæŒ‰å€¼æˆ–æŒ‰å¼•ç”¨æ•è· Lambda è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„æ‰€æœ‰å¤–éƒ¨å˜é‡ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç®€åŒ–æ•è·åˆ—è¡¨çš„ä¹¦å†™ï¼Œé¿å…è¿‡é•¿æˆ–é—æ¼ã€‚éšå¼æ•è·å¯ä»¥å’Œæ˜¾å¼æ•è·æ··åˆä½¿ç”¨ï¼Œä½†ä¸èƒ½å’ŒåŒç±»å‹çš„æ˜¾å¼æ•è·ä¸€èµ·ä½¿ç”¨

```cpp
int x = 10;
int y = 20;
auto f = [=, &y] (int z) -> int { return x + y + z; }; // éšå¼æŒ‰å€¼æ•è· xï¼Œæ˜¾å¼æŒ‰å¼•ç”¨æ•è· y
x = 30;
y = 40;
cout << f(5) << endl; //è¾“å‡º55ï¼Œä¸å—å¤–éƒ¨ x çš„å½±å“ï¼Œå—å¤–éƒ¨ y çš„å½±å“
```



**åˆå§‹åŒ–æ•è·**ï¼ˆinit captureï¼‰ï¼šC++14 å¼•å…¥çš„ä¸€ç§æ–°çš„æ•è·æ–¹å¼ï¼Œå®ƒå…è®¸åœ¨æ•è·åˆ—è¡¨ä¸­ä½¿ç”¨åˆå§‹åŒ–è¡¨è¾¾å¼ï¼Œä»è€Œåœ¨æ•è·åˆ—è¡¨ä¸­åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œè€Œä¸æ˜¯æ•è·ä¸€ä¸ªå·²å­˜åœ¨çš„å˜é‡ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä½¿ç”¨ `auto` å…³é”®å­—æ¥æ¨å¯¼ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼æŒ‡å®šç±»å‹ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç”¨æ¥æ•è·åªç§»åŠ¨çš„å˜é‡ï¼Œæˆ–è€…æ•è· `this` æŒ‡é’ˆçš„å€¼ã€‚

```cpp
int x = 10;
auto f = [z = x + 5] (int y) -> int { return z + y; }; // åˆå§‹åŒ–æ•è· zï¼Œç›¸å½“äºå€¼æ•è· x + 5
x = 20; // ä¿®æ”¹å¤–éƒ¨çš„ x
cout << f(5) << endl; // è¾“å‡º 20ï¼Œä¸å—å¤–éƒ¨ x çš„å½±å“
```



**ä½¿ç”¨ä¾‹å­**

ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œè‡ªå®šä¹‰æ’åºå‡†åˆ™

```cpp
#include <iostream>
#include <algorithm>
using namespace std;

struct Edge{
	int a,b;
}e[100005];

int main(){
	int n;cin >> n;
	for_each(e+1,e+n+1,[](auto &x){cin >> x.a >> x.b;});//Edgeå¯æ¢ç”¨auto
	sort(e+1,e+n+1,[](auto &x,auto &y){if(x.a != y.a) return x.a > y.a;else return x.b > y.b;});
	for_each(e+1,e+n+1,[](auto &x){cout << x.a << ' ' << x.b << endl;});
    
    return 0;
}
```

```cpp
int a,b,c; cin >> a >> b >> c;
auto add = [&](){w[idx] = c,e[idx] = b,ne[idx] = h[a],h[a] = idx++;};
add();
```





### é¢„ç¼–è¯‘å¤´æ–‡ä»¶

é€šè¿‡é¢„ç¼–è¯‘å¤´æ–‡ä»¶<bits/stdc++.h>ï¼ŒåŠ å¿«ç¼–è¯‘ä¸‡èƒ½å¤´çš„æ—¶é—´ï¼Œä»¥windowsä¸‹çš„gcc14.2.0ç¼–è¯‘å™¨ä¸ºä¾‹

```bash
#è¿›å…¥å¤´æ–‡ä»¶æ‰€åœ¨ç›®å½• ä¾‹å¦‚ C:\mingw64\include\c++\14.2.0\x86_64-w64-mingw32\bits
#æ‰“å¼€cmdè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤  å…¶ä¸­-x c++-headerå¯ä»¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯å¤´æ–‡ä»¶,ç¡®ä¿ç¼–è¯‘å™¨æ­£ç¡®å¤„ç†æ–‡ä»¶
g++ stdc++.h -O2 -x c++-header -o stdc++.h.gch
#è¿›å…¥æºcppæ–‡ä»¶æ‰€åœ¨ç›®å½•
#é¢„ç¼–è¯‘å¤´æ–‡ä»¶çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ã€ç¼–è¯‘é€‰é¡¹(å¦‚-std=c++23ã€-O2ç­‰)å¿…é¡»ä¸åç»­ç¼–è¯‘å®Œå…¨ä¸€è‡´ã€‚
g++ 1.cpp -O2 -o -1.exe
```





### gccæ ‡å‡†

#### __int128

 `__int128` ä»…ä»…æ˜¯ GCC ç¼–è¯‘å™¨å†…çš„ä¸œè¥¿ï¼Œä¸åœ¨ C++æ ‡å‡†å†…ï¼Œä¸”ä»… **GCC4.6** ä»¥ä¸Š**64ä½**ç‰ˆæœ¬æ”¯æŒ

**æ•°æ®èŒƒå›´**

> `__int128`æ•°æ®èŒƒå›´ ï¼š $-2^{127} \sim 2^{127}-1$   å¤§äº1.7e38
>
> `unsigned __int128` æ•°æ®èŒƒå›´ ï¼š $0 \sim 2^{128}$

**è¾“å…¥è¾“å‡º**

> ç”±äºä¸åœ¨ C++ æ ‡å‡†å†…ï¼Œæ²¡æœ‰é…å¥—çš„ `printf` `scanf` `cin` `cout` ç­‰è¾“å…¥è¾“å‡ºï¼Œåªèƒ½æ‰‹å†™ï¼Œè¯·ä¸è¦ä¸`ios::sync_with_stdio(false)` åŒæ—¶ä½¿ç”¨ï¼Œå¦åˆ™ä¼šé€ æˆè¾“å…¥è¾“å‡ºæ··ä¹±ã€‚

**ä½¿ç”¨æ–¹æ³•**

> ä¸intã€long long ç­‰æ•´å‹ç±»ä¼¼ï¼Œæ”¯æŒå„ç§è¿ç®—ï¼Œå¦‚`+` `-` `*` `/` `%`ã€ç§»ä½`<<` `>>`ã€`&` `|` `ï¼` `^`ã€`==` `>` `<` ç­‰å¤šç§æ“ä½œï¼Œå¯ä»¥ç›´æ¥ä¸intè¿›è¡Œè¿ç®—

**åˆå§‹åŒ–**

> å¯ä»¥ä½¿ç”¨æ•´å‹èŒƒå›´å†…çš„å€¼ç›´æ¥èµ‹åˆå€¼  å¦‚  `__int128 a = 114514;`  
>
> å¯ä»¥ä½¿ç”¨æµ®ç‚¹æ•°èµ‹å€¼ï¼Œä½†è¶…å‡ºæµ®ç‚¹æ•°æœ‰æ•ˆç²¾åº¦çš„éƒ¨åˆ†èµ‹å€¼ä¸å‡†ç¡®ï¼Œ
> `__int128 a = 1e30`  ç»“æœä¸º 1000000000000000019884624838656
> `__int128 a = 1e40`  è¯ºè¶…å‡º`__int128`æ•°æ®èŒƒå›´ï¼Œåˆ™ä¼šèµ‹å€¼ä¸ºæœ€å¤§å€¼ï¼Œå³ $2^{127}-1$
>
> å¦‚æœè¦è‡ªå®šä¹‰èµ‹å€¼ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œå¯ä»¥ç”¨ `__int128 a = (__int128(1) << 126)` çš„æ–¹å¼
> ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†`å­—ç¬¦ä¸²`è½¬ä¸º `__int128`
>
> ```cpp
> __int128 sto__int128(const string &s){
> 	__int128 x = 0,f = 1;
> 	for(int i = 0;i < s.size();i++){
> 		if(s[i] == '-') { f = -1;}
> 		else{x *= 10;x += s[i] - '0';}
> 	}
> 	return x*f;
> }
> __int128 n = sto__int128("-114514191981000");
> ```

```cpp
//ä½¿ç”¨ä¾‹é¢˜  https://vjudge.net/contest/233969#problem/I
#include <bits/stdc++.h>
using namespace std;

inline __int128 read(){
    __int128 x = 0,f = 1;
    char ch = getchar();
    while(ch<'0'||ch>'9'){
        if(ch == '-') f=-1;
        ch = getchar();
    }
    while(ch>='0' && ch<='9'){
        x = x*10 + ch - '0';
        ch = getchar();
    }
    return x*f;
}

inline void write(__int128 x){
    if(x < 0){ putchar('-'),x *= -1;}
    if(x > 9) write(x/10);
    putchar(x % 10 + '0');
}

void soviet(){
	vector<__int128>a(4);
	__int128 ans = 0;
	for(int i = 0;i < 4;i++){
		a[i] = read();
		ans += a[i];
	}
	write(ans);
	cout << '\n';
}

int main() {
	int M_T = 1;//std::ios::sync_with_stdio(false),std::cin.tie(0);
	std::cin >> M_T;
	while(M_T--){ soviet(); }
	return 0;
}
```



#### __cplusplus

```cpp
cout << __cplusplus << endl;//å¯ä»¥ç›´æ¥è¾“å‡ºé¢„å¤„ç†å™¨å®å‚æ•°
```

| ä¸åŒå‚æ•°å¯¹åº”çš„é»˜è®¤c++æ ‡å‡† |               |
| ------------------------- | ------------- |
| 1                         | C++ pre-C++98 |
| 199711L                   | C++98         |
| 201103L                   | C++11         |
| 201402L                   | C++14         |
| 201703L                   | C++17         |
| 202002L                   | C++20         |
| 202302L                   | C++23         |



ç¼–è¯‘æ—¶å¦‚æœå­˜åœ¨ç±»ä¼¼ `-std=c++17` çš„é€‰é¡¹ï¼Œåˆ™æ˜¾å¼æŒ‡å®šäº†æ ‡å‡†ï¼›å¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨ `g++` é»˜è®¤çš„æ ‡å‡†ï¼ˆå–å†³äºç‰ˆæœ¬ï¼‰ã€‚

ä¸åŒç‰ˆæœ¬çš„ `g++` é»˜è®¤ä½¿ç”¨ä¸åŒçš„ C++ æ ‡å‡†ï¼šä½¿ç”¨bashæŒ‡ä»¤`gcc --version`å¯ä»¥æŸ¥çœ‹`g++`ç‰ˆæœ¬

[æ‰€æœ‰Gccç‰ˆæœ¬å¯¹Cå’ŒC++çš„æ”¯æŒæƒ…å†µï¼ˆè¶…è¯¦ç»†ç‰ˆæœ¬ï¼‰-CSDNåšå®¢](https://blog.csdn.net/qq_39974998/article/details/130396600)





### æ–‡ä»¶è¯»å†™

```cpp
//æ­£å¼æäº¤æ—¶è¯·åŠ¡å¿…æ³¨é‡Šæ‰
int main() {
	freopen("in.txt","r",stdin);
//	freopen("out.txt","w",stdout);
	int a,b; cin >> a >> b;
    cout << a + b << endl;
}
```

```bash
#windows cmdæ§åˆ¶å°è¯»å†™æ–¹å¼
a.exe < in.txt > out.txt

#linux æ§åˆ¶å°
./a.out < in.txt > out.txt
```



## æ—¶é—´å¤æ‚åº¦

| æ•°æ®èŒƒå›´ |                     |                                                              |
| -------- | ------------------- | ------------------------------------------------------------ |
| 20       | æŒ‡æ•°çº§åˆ«            | dfs+å‰ªæã€çŠ¶å‹dp                                             |
| 100      | O(n^3)              | floydã€dpã€é«˜æ–¯æ¶ˆå…ƒã€çŸ©é˜µ                                    |
| 1000     | O(n^2) ~ O(n^2logn) | dpã€äºŒåˆ†ï¼Œæœ´ç´ ç‰ˆDijkstraã€Bellman-Fordã€äºŒåˆ†å›¾               |
| 1e4      | O($n\sqrt n$)       | å—çŠ¶é“¾è¡¨ã€åˆ†å—ã€è«é˜Ÿã€åŒæŒ‡é’ˆ                                 |
| 1e5      | nlogn               | sortã€çº¿æ®µæ ‘ã€æ ‘çŠ¶æ•°ç»„ã€set/mapã€heapã€æ‹“æ‰‘æ’åºã€dijkstraã€prim+heapã€Kruskalã€spfaã€æ±‚å‡¸åŒ…ã€æ±‚åŠå¹³é¢äº¤ã€äºŒåˆ†ã€CDQåˆ†æ²»ã€æ•´ä½“äºŒåˆ†ã€åç¼€æ•°ç»„ã€æ ‘é“¾å‰–åˆ†ã€åŠ¨æ€æ ‘ |
| 1e6      | O(n)~O(nlogn)       | å•è°ƒé˜Ÿåˆ—ã€hashã€åŒæŒ‡é’ˆæ‰«æã€å¹¶æŸ¥é›†ï¼Œkmpã€ACè‡ªåŠ¨æœºï¼Œå¸¸æ•°æ¯”è¾ƒå°çš„O(nlogn)çš„åšæ³•ï¼šsortã€æ ‘çŠ¶æ•°ç»„ã€heapã€dijkstraã€spfa |
| 1e7      | O(n)                | åŒæŒ‡é’ˆæ‰«æã€kmpã€ACè‡ªåŠ¨æœºã€çº¿æ€§ç­›ç´ æ•°                        |
| 1e9      | O($\sqrt n$)        | åˆ¤æ–­è´¨æ•°ã€æ±‚æ¬§æ‹‰å‡½æ•°                                         |
| 1e18     | O(logn)             | æœ€å¤§å…¬çº¦æ•°ã€å¿«é€Ÿå¹‚ã€æ•°ä½DP                                   |
| 1e1000   | O((logn)^2)         | é«˜ç²¾åº¦åŠ å‡ä¹˜é™¤                                               |
| 1e100000 | O(logk*loglogk)     | é«˜ç²¾åº¦åŠ å‡ã€FFT/NTT                                          |

 

```cpp
//(n+n/2+n/3+...+n/n) = nlogn  è°ƒå’Œçº§æ•°
//https://codeforces.com/contest/1996/problem/D
//ab+bc+ac <= nï¼Œa+b+c <= xï¼Œ0 < a,b,c
for(int i = 1;i <= n;i++){//æšä¸¾æ‰€æœ‰a
	for(int j = 1;i*j <= n;j++){//æšä¸¾æ‰€æœ‰b
        //åˆ™0 < c <= min((b-ab)/(a+b),x-(a+b))
    }
}
```

```cpp
//https://codeforces.com/contest/1991/problem/F
1 1 2 3 5 8 ...
fib(26) çº¦ 1.2e5
fib(45) çº¦ 1.1e9
//è¯ºa[i] <= 1e9ï¼Œåˆ™é•¿åº¦>=45çš„åºåˆ—ä¸€å®šèƒ½æ„æˆä¸€ä¸ªä¸‰è§’å½¢
```

```cpp
//é˜¶ä¹˜
8!  çº¦ 4.0e4
12! çº¦ 4.7e8
```

```cpp
//è´¨æ•°ä¸ªæ•°
1e8 çº¦ 5.7e6ä¸ª
1e7 çº¦ 6.6e5ä¸ª
1e6 çº¦ 7.8e4ä¸ª
1e5 çº¦ 9.5e3ä¸ª
```

```cpp
C[n][0] + C[n][1] + C[n][2] + ... + C[n][n] = 2^n
```



$\sum_{i=1}^{n}\sum_{j=1}^{n}(a_i*a_j) \ \ [i \neq j] = \sum_{i=1}^{n}(2*a_i*sum_{i-1})$

$\sum_{i=1}^{n}\sum_{j=i+1}^{n}(a_i*a_j) = (sum^2 - \sum_{i=1}^{n}a_i^2)/2$

$\sum_{i=1}^{n}\sum_{j=1}^{n}(a_i+a_j) = sum*n*2$  ï¼Œè¯ºæœ‰$k$å±‚$\sum$æ±‚å’Œï¼Œåˆ™ç­”æ¡ˆä¸º$sum * n^{k-1} * k$

$\sum_{i=1}^{n}\sum_{j=i+1}^{n}(a_i+a_j) = sum*(n-1)$

$\sum_{i=1}^n\sum_{j=1}^n\gcd(i,j) = \sum_{d=1}^n\left\lfloor\frac{n}{d}\right\rfloor^2\varphi(d)$   ï¼Œ$\phi()$ä¸ºæ¬§æ‹‰å‡½æ•°ï¼Œå¯ä»¥ç”¨æ•´é™¤åˆ†å—è¿›ä¸€æ­¥ä¼˜åŒ–ä¸º$O(\sqrt{n})$



```cpp
//1~nå†…æ•°ä½éé€’å‡çš„æ•°,å¦‚123,223ç­‰
//https://atcoder.jp/contests/typical90/tasks/typical90_y
//n = 1e18,cnt = 5e6
//n = 1e9,cnt = 5e4
#include <iostream>
using namespace std;
long long n,cnt = 0;
void dfs(long long u){
	if(u > n) return;
	cnt++;
	for(int i = u%10;i <= 9;i++){
		dfs(u*10+i);
	}
}

int main(){
	cin >> n;
	for(int i = 1;i <= 9;i++){ dfs(i); }
	cout << cnt << endl;
}
```

```cpp
//1~æ ¹å·næšä¸¾
for(int i = 1;i*i <= n;i++);	//å»ºè®®ä½¿ç”¨,å¤§æ¦‚3å‘¨æœŸ,éœ€è¦æ³¨æ„æ•°æ®èŒƒå›´
for(int i = 1;i <= sqrt(n);i++);//å¤§æ¦‚10å‘¨æœŸ(éœ€è¦å¼€å¯O2ä¼˜åŒ–æˆ–å¾ªç¯å¤–æå‰è®¡ç®—sqrt(n)+eps)
for(int i = 1;i <= n/i;i++);	//å¤§æ¦‚40å‘¨æœŸ,å¦‚æœæ—¶é—´ç´§ä¸å»ºè®®ä½¿ç”¨
```



### **æ¡æ‰‹å®šç†**

> nä¸ªäººæ¡æ‰‹ï¼Œæ¯äººæ¡æ‰‹mæ¬¡ï¼Œæ¡æ‰‹æ€»æ¬¡æ•°$S = \frac{nm}{2}$
> ç»™å®šæ— å‘å›¾G=(V,E)ï¼Œæœ‰$\sum deg(V) = 2E$ï¼Œå›¾ä¸­æ‰€æœ‰ç»“ç‚¹çš„åº¦æ•°ä¹‹å’Œç­‰äºè¾¹æ•°çš„ä¸¤å€

```cpp
//https://codeforces.com/gym/104337/problem/H
//a1+a2+a3+... = n   ä¸åŒçš„aæœ€å¤šçº¦ä¸ºâˆš2nç§
```



### åˆ†å—æ‰“è¡¨

<img src="C:\Users\21003\AppData\Roaming\Typora\typora-user-images\image-20250802183956804.png" alt="image-20250802183956804" style="zoom: 50%;" />  

[Harmonic Number - LightOJ 1234 - Virtual Judge (vjudge.net)](https://vjudge.net/problem/LightOJ-1234)

> æ±‚$\sum_{i=1}^{n}\frac{1}{i}$ï¼Œ$1 \le n \le 10^8$ï¼Œæœ€å¤š$10^4$ç»„æµ‹è¯•æ ·ä¾‹ã€‚

å¦‚æœç›´æ¥ç”¨å‰ç¼€å’Œé¢„å¤„ç†ï¼Œæ•°ç»„éœ€è¦å¼€åˆ°10^8ä½†ç©ºé—´ä¸å…è®¸

æˆ‘ä»¬å¯ä»¥æ¯ $len$ å—ä¸ºä¸€ç»„ï¼Œæ¯ä¸€å—é¢„å¤„ç†ã€‚æŸ¥è¯¢æ—¶ï¼Œå¯¹äºåœ¨è¡¨ä¸­çš„æ•´å—éƒ¨åˆ†ç›´æ¥è®¡ç®—ï¼Œå…¶å®ƒéƒ¨åˆ†æš´åŠ›æšä¸¾

```cpp
//O(N)é¢„å¤„ç†,O(len)æŸ¥è¯¢,å…¶ä¸­lenä¸ºæ¯å—çš„å¤§å°
#include <iostream>

const int N = 100005;
double s[N];//ç»Ÿè®¡çš„ä¸ºå—çš„å‰ç¼€å’Œä¿¡æ¯
int len = 1000;

void init(int n){
	double ans = 0;
	for(int i = 1;i <= n*len;i++){
		ans += 1.0/i;
		if(i%len == 0){
			s[i/len] += ans;
		}
	}
}

void sol(){
	int n; std::cin >> n;
	int k = n/len;
	double ans = s[k];
	for(int i = k*len+1;i <= n;i++){
		ans += 1.0/i;
	}
	printf("%.10lf\n",ans);
}

int main(){
	init(N-1);
	int t; std::cin >> t;
	for(int i = 1;i <= t;i++){
		printf("Case %d: ",i);
		sol();
	}
}
```



## éšæœºæ•°ç”Ÿæˆ

```cpp
//mt19937
#include <iostream>
#include <random>
#include <chrono>
using namespace std;

auto SEED = chrono::steady_clock::now().time_since_epoch().count();//åˆ©ç”¨æ—¶é—´ç”Ÿæˆéšæœºç§å­
mt19937_64 rng(SEED);

int main() {
	cout << rng() << endl;//æ¯æ¬¡è°ƒç”¨rng()æ—¶,ç”Ÿæˆçš„æ•°éƒ½ä¸åŒ
	//cout << mt19937_64(1 + SEED)() << endl; //ç”Ÿæˆç§å­ä¸º1ä¸‹çš„å›ºå®šéšæœºæ•°
}
```



```cpp
//xor_shift
//å¼‚æˆ–å’Œç§»ä½æ¯æ¬¡éƒ½åœ¨ä¸Šä¸€æ¬¡äº§ç”Ÿçš„å€¼ä¸Šäº§ç”Ÿæ–°çš„å€¼,å› ä¸ºåœ¨å¾ˆå¤§çš„å€¼ä¸­èˆå¼ƒäº†ä¸€äº›å€¼,æ‰€ä»¥æ¯æ¬¡äº§ç”Ÿçš„å€¼çœ‹èµ·æ¥å°±è±¡æ˜¯éšæœºå€¼ï¼Œä¹Ÿå°±æ˜¯å¤šæ¬¡shiftä¸‹çš„ä¼ªéšæœºæ•°ï¼Œå¸¸ç”¨äºæ ‘å“ˆå¸Œ
//è¿™ç§å“ˆå¸Œååˆ†å¥½äº›ä¸”æ¯”mt19937_64(seed)()å¿«,ä½†éšæœºæ€§ä¸å¼º
const unsigned long long mask = mt19937_64(time(0))();//éšæœºä¸€ä¸ªæ•°ä½œä¸ºå›ºå®šç§å­
unsigned long long shift(unsigned long long x){//xåœ¨è¯¥ç§å­ä¸‹å¾—åˆ°çš„éšæœºæ•°
	x ^= mask;
	x ^= x << 13;
	x ^= x >> 7;
	x ^= x << 17;
	x ^= mask;
	return x;
}
```



```cpp
//æ›´å¼ºçš„å“ˆå¸Œå‡½æ•°
const auto RAND = std::chrono::steady_clock::now().time_since_epoch().count();
static long long splitmix64(long long x) {
	x += 0x9e3779b97f4a7c15;
	x = (x ^ (x >> 30)) * 0xbf58476d1ce4e5b9;
	x = (x ^ (x >> 27)) * 0x94d049bb133111eb;
	return (x ^ (x >> 31)) + RAND;
}
```



## .vimrc

```bash
imap jk <Esc>
nmap <space> :

set cin
set sw=4
set ts=4

map <F5> :w <cr> :!clear & g++ % -O2 <cr>
map <F6> :!clear & ./a.out <cr>
map <C-F6> :!clear & ./a.out < in <cr>
"map <C-F6> :!clear & time ./a.out < in \| tee out <cr>
"set mouse=a
"syntax on
```



## OI

![OIer](C:\Users\21003\Pictures\Camera Roll\OIer.png)
